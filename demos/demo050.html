<!DOCTYPE html>
<html>

<head>
  <title>Demo 050</title>
  <link href="css/prism.css" rel="stylesheet" />
  <link href="css/demo.css" rel="stylesheet" />
</head>

<body>
  <h1><a href="index.html">Scrawl.js</a> - demonstration 050</h1>
  <h2>Cloning Scrawl sprites</h2>
  <h3>Modules: animation, color, factories, block, wheel, images, path, phrase</h3>
  <p>Click on a sprite to clone it. Move mouse. Click to drop the cloned sprite.</p>
  <img src="img/carousel/angelfish.png" id="angelfish" class="demo050" />
  <img src="img/animtiger.png" id="tiger" class="demo050" />
  <canvas id="mycanvas" width="750" height="375"></canvas>
  <p id="testmessage"></p>
  <script src="../source/scrawlCore.js"></script>
  <script id="myscript">
  var mycode = function() {
    'use strict'
    var testTicker = Date.now(),
      testTime = testTicker,
      testNow,
      testMessage = document.getElementById('testmessage');

    //define variables
    var myPad = scrawl.pad.mycanvas,
      myCanvas = scrawl.canvas.mycanvas,
      here = false,
      currentObject = false,
      clickedObject,
      myCol,
      myGroup = scrawl.group[myPad.base],
      handleSprite;

    //import images into scrawl library
    scrawl.getImagesByClass('demo050');

    //define designs (gradients, colors)
    scrawl.newColor({
      name: 'myRed',
      color: '#f00',
    });

    myCol = scrawl.newColor({
      name: 'myBlue',
      random: true,
      aShift: 0.002,
      aBounce: true,
      autoUpdate: true,
    });

    scrawl.newGradient({
      name: 'gradient',
      roll: 0.002,
      setToSprite: true,
      color: [{
        color: '#333333',
        stop: 0
      }, {
        color: 'orange',
        stop: 0.2
      }, {
        color: 'gold',
        stop: 0.4
      }, {
        color: 'green',
        stop: 0.6
      }, {
        color: '#cccccc',
        stop: 0.8
      }, {
        color: '#333333',
        stop: 1
      }, ],
    });

    //define animation sheets
    scrawl.newAnimSheet({
      name: 'mytiger',
      running: 'forward',
      loop: 'loop',
      frames: [{
        x: (120 * 0),
        y: (66 * 1),
        w: 120,
        h: 66,
        d: 100,
      }, {
        x: (120 * 1),
        y: (66 * 1),
        w: 120,
        h: 66,
        d: 100,
      }, {
        x: (120 * 2),
        y: (66 * 1),
        w: 120,
        h: 66,
        d: 100,
      }, {
        x: (120 * 3),
        y: (66 * 1),
        w: 120,
        h: 66,
        d: 100,
      }, {
        x: (120 * 4),
        y: (66 * 1),
        w: 120,
        h: 66,
        d: 100,
      }],
    });

    //define sprites
    scrawl.makeRegularShape({
      startX: 420,
      startY: 100,
      angle: 144,
      radius: 50,
      winding: 'evenodd',
      fillStyle: 'myRed',
      order: myGroup.sprites.length,
      method: 'fillDraw',
    });

    scrawl.newPicture({
      source: 'angelfish',
      strokeStyle: 'Gold',
      lineWidth: 3,
      method: 'fillDraw',
      width: 150,
      height: 100,
      order: myGroup.sprites.length,
      shadowBlur: 4,
      shadowColor: 'Black',
      startX: 80,
      startY: 50,
    });

    scrawl.newBlock({
      strokeStyle: 'Orange',
      fillStyle: 'myBlue',
      lineWidth: 6,
      method: 'fillDraw',
      order: myGroup.sprites.length,
      width: 100,
      height: 100,
      startX: 300,
      startY: 200,
      lineDash: [20, 5],
    });

    scrawl.newWheel({
      strokeStyle: '#800',
      fillStyle: 'gradient',
      lineWidth: 6,
      method: 'fillDraw',
      radius: 40,
      startX: 600,
      startY: 90,
      lineDash: [20, 5, 5, 5],
      order: myGroup.sprites.length,
    });

    scrawl.newPicture({
      startX: 100,
      startY: 300,
      method: 'fill',
      source: 'tiger',
      animSheet: 'mytiger',
      order: myGroup.sprites.length,
      checkHitUsingImageData: true,
      handleX: 'center',
      handleY: 'center',
      flipReverse: true,
      roll: 10,
    }).getImageData();

    scrawl.newPhrase({
      method: 'fill',
      order: myGroup.sprites.length,
      text: 'No! Clone me! Me!',
      startX: 500,
      startY: 300,
      font: '20pt Arial, Helvetica',
    });

    //event listener
    handleSprite = function(e) {
      if (e) {
        e.stopPropagation();
        e.preventDefault();
      }
      if (currentObject) {
        currentObject.dropSprite();
        currentObject = null;
      } else {
        clickedObject = myGroup.getSpriteAt(here);
        if (clickedObject) {
          currentObject = clickedObject.clone({
            order: myGroup.sprites.length,
          }).pickupSprite(here);
          if (currentObject.type === 'Block') {
            var newColor = myCol.clone({
              random: true,
            });
            currentObject.set({
              fillStyle: newColor.name,
            });
          }
        }
      }
    };
    myCanvas.addEventListener('mouseup', handleSprite, false);

    //animation object
    scrawl.newAnimation({
      fn: function() {
        here = myPad.getMouse();
        for (var i = 0, z = myGroup.sprites.length; i < z; i++) {
          if (scrawl.sprite[myGroup.sprites[i]].type === 'Path') {
            scrawl.sprite[myGroup.sprites[i]].setDelta({
              roll: 0.5,
            });
          }
          if (scrawl.sprite[myGroup.sprites[i]].type === 'Block') {
            scrawl.sprite[myGroup.sprites[i]].setDelta({
              lineDashOffset: (i % 2 === 0) ? 0.1 : -0.1,
            });
          }
          if (scrawl.sprite[myGroup.sprites[i]].type === 'Wheel') {
            scrawl.sprite[myGroup.sprites[i]].setDelta({
              roll: (i % 2 === 0) ? 0.2 : -0.2,
            });
          }
        }
        if (here.active) {
          myCanvas.style.cursor = (myGroup.getSpriteAt(here)) ? 'pointer' : 'auto';
        }
        scrawl.render();

        testNow = Date.now();
        testTime = testNow - testTicker;
        testTicker = testNow;
        testMessage.innerHTML = 'Milliseconds per screen refresh: ' + parseInt(testTime) + '; fps: ' + parseInt(1000 / testTime);
      },
    });
  };

  scrawl.loadModules({
      path: '../source/js/',
      minified: false,
      modules: ['animation', 'color', 'factories', 'block', 'wheel', 'images', 'path', 'phrase'],
      callback: function() {
        window.addEventListener('load', function() {
            scrawl.init();
            mycode();
          };
        },
      });
  </script>
</body>

</html>
