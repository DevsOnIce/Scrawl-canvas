<!DOCTYPE html>
<html>

<head>
  <title>Demo 408</title>
  <link href="css/normalize.css" rel="stylesheet" />
  <link href="css/demo.css" rel="stylesheet" />
</head>

<body>
  <h1><a href="index.html">Scrawl.js</a> - demonstration 408</h1>
  <h2>Scrawl image filters - blur()</h2>
  <h3>Modules: images, filters, animation</h3>
  <p>Be aware: larger blur brush sizes are considerably slower than smaller ones</p>
  <canvas width="400" height="400" id="mycanvas"></canvas>
  <p>Radius value (px): 0.5
    <input id="radius" type="range" value="2" min="0.5" max="20" step="0.5" />20</p>
  <p>Radius X value (px): 0.5
    <input id="radiusx" type="range" value="2" min="0.5" max="20" step="0.5" />20</p>
  <p>Radius Y value (px): 0.5
    <input id="radiusy" type="range" value="2" min="0.5" max="20" step="0.5" />20</p>
  <p>Roll value (degrees): 0
    <input id="roll" type="range" value="0" min="0" max="180" step="1" />180</p>
  <img src="img/carousel/cagedparrot.png" id="parrot" alt="color version of parrot" class="demo408" />
  <p id="testmessage"></p>
  <script src="../source/scrawlCore.js"></script>
  <script id="myscript">
  var mycode = function() {
    'use strict'
    var testTicker = Date.now(),
      testTime = testTicker,
      testNow,
      testMessage = document.getElementById('testmessage');

    //define variables
    var radius,
      radiusX,
      radiusY,
      roll,
      radX = 5,
      radY = 5,
      rollVal = 0,
      getRadius,
      getRadiusX,
      getRadiusY,
      getRoll;

    //import image
    scrawl.getImagesByClass('demo408');

    //clone image and add filter to it
    scrawl.image.parrot.clone({
      name: 'blurparrot',
    }).filter('blur', {
      radius: 5,
      useSourceData: true,
    });

    //define sprites
    scrawl.newPicture({
      name: 'parrot',
      startX: 10,
      startY: 10,
      scale: 0.5,
      source: 'parrot',
    }).clone({
      startX: 120,
      startY: 210,
      source: 'blurparrot',
    });

    //preparing the DOM input elements
    radius = document.getElementById('radius');
    radius.value = 5;
    radiusX = document.getElementById('radiusx');
    radiusX.value = 5;
    radiusY = document.getElementById('radiusy');
    radiusY.value = 5;
    roll = document.getElementById('roll');
    roll.value = 0;

    //image update function
    updateInput = function() {
      scrawl.image.blurparrot.filter('blur', {
        radiusX: radX,
        radiusY: radY,
        roll: rollVal,
        useSourceData: true,
      });
    };

    //event listeners
    getRadius = function(e) {
      radX = parseFloat(radius.value);
      radiusX.value = radX;
      radY = parseFloat(radius.value);
      radiusY.value = radY;
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    radius.addEventListener('change', getRadius, false);
    getRadiusX = function(e) {
      radX = parseFloat(radiusX.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    radiusX.addEventListener('change', getRadiusX, false);
    getRadiusY = function(e) {
      radY = parseFloat(radiusY.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    radiusY.addEventListener('change', getRadiusY, false);
    getRoll = function(e) {
      rollVal = parseFloat(roll.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    roll.addEventListener('change', getRoll, false);

    //to make sure everything is in place ...
    updateInput();

    //animation object
    scrawl.newAnimation({
      fn: function() {
        scrawl.render();

        testNow = Date.now();
        testTime = testNow - testTicker;
        testTicker = testNow;
        testMessage.innerHTML = 'Milliseconds per screen refresh: ' + parseInt(testTime) + '; fps: ' + parseInt(1000 / testTime) + '<br />radius x: ' + radX + '; radius y: ' + radY + '; roll: ' + rollVal;
      },
    });
  };

  scrawl.loadModules({
      path: '../source/js/',
      minified: false,
      modules: ['images', 'filters', 'animation'],
      callback: function() {
        window.addEventListener('load', function() {
            scrawl.init();
            mycode();
          };
        },
      });
  </script>
</body>

</html>
