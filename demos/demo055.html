<!DOCTYPE html>
<html>
    <head>
        <title>Demo 055</title>
		<link href="css/normalize.css" rel="stylesheet" />
		<link href="css/demo.css" rel="stylesheet" />
    </head>
    <body>
		<h1><a href="index.html">Scrawl.js</a> - demonstration 055</h1>
		<h2>Scrawl animation - animate bezier curves by manipulating their point positions</h2>
		<h3>Modules: animation, path, factories</h3>
		<canvas id="mycanvas" width="750" height="375"></canvas>
		<p id="testmessage"></p>
		<script src="../source/scrawlCore.js"></script>
		<script>
			var mycode = function(){
				'use strict'
				var testTicker = Date.now(),
					testTime = testTicker,
					testNow,
					testMessage = document.getElementById('testmessage');
					
				//setup variables
				var makeLine,
					checkBounds,
					minX = 0,
					minY = 0,
					maxX = 750,
					maxY = 375,
					positions = [150, 200, 300, 200, 450, 200, 600, 200],
					positionDeltas = [],
					sprites = [],
					count = 0,
					noOfLines = 30;
				
				for(var i = 0; i < 8; i++){
					positionDeltas.push((Math.random() * 11) - 6);
					}
					
				//factory for producing bezier curves
				makeLine = function(item){
					return scrawl.makeBezier({
						name: item,
						startX: positions[0],
						startY: positions[1],
						startControlX: positions[2],
						startControlY: positions[3],
						endControlX: positions[4],
						endControlY: positions[5],
						endX: positions[6],
						endY: positions[7],
						strokeStyle: 'red',
						});
					};
					
				//bounds checking function
				checkBounds = function(){
					for(var i = 0; i < 8; i += 2){
						if(!scrawl.isBetween((positions[i] + positionDeltas[i]), minX, maxX)){
							positionDeltas[i] = -positionDeltas[i];
							}
						if(!scrawl.isBetween((positions[i+1] + positionDeltas[i+1]), minY, maxY)){
							positionDeltas[i+1] = -positionDeltas[i+1];
							}
						positions[i] += positionDeltas[i];
						positions[i+1] += positionDeltas[i+1];
						}
					};
				
				//build initial set of curves
				for(var i = 0; i < noOfLines; i++){
					checkBounds();
					sprites.push(makeLine('curve'+i));
					}
					
					
				//animation object
				scrawl.newAnimation({
					fn: function(){
						var sprite = sprites[count];
						checkBounds();
						sprite.start.set({
							x: positions[0],
							y: positions[1],
							});
						//scrawl bezier curve points are measured relative to the start point
						scrawl.point[sprite.name+'_p2'].local.set({
							x: positions[2] - positions[0],
							y: positions[3] - positions[1],
							});
						scrawl.point[sprite.name+'_p3'].local.set({
							x: positions[4] - positions[0],
							y: positions[5] - positions[1],
							});
						scrawl.point[sprite.name+'_p4'].local.set({
							x: positions[6] - positions[0],
							y: positions[7] - positions[1],
							});
						count++;
						if(count >= noOfLines){
							count = 0;
							}
						scrawl.render();
						
						testNow = Date.now();
						testTime =  testNow - testTicker;
						testTicker = testNow;
						testMessage.innerHTML = 'Milliseconds per screen refresh: '+parseInt(testTime)+'; fps: '+parseInt(1000/testTime);
						},
					});
				};
				
			scrawl.loadModules({
				path: '../source/js/',
				minified: false,
				modules: ['animation', 'path', 'factories'],
				callback: function(){
					window.addEventListener('load', function(){
						scrawl.init();
						mycode();
						};
					},
				});
		</script>
    </body>
</html>
