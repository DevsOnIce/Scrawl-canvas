<!DOCTYPE html>
<html>

<head>
  <title>Demo 205</title>
  <link href="css/normalize.css" rel="stylesheet" />
  <link href="css/demo.css" rel="stylesheet" />
  <style>
  #mystack {
    border: solid 1px red;
  }
  </style>
</head>

<body>
  <h1><a href="index.html">Scrawl.js</a> - demonstration 205</h1>
  <h2>CSS 3d rotating cube in Scrawl stack</h2>
  <h3>Modules: images, phrase, animation, stacks</h3>
  <div id="mystack" class="scrawlstack">
    <p id="instructions">Move mouse over stack</p>
    <canvas id="top" width="200" height="200"></canvas>
    <canvas id="bottom" width="200" height="200"></canvas>
    <canvas id="left" width="200" height="200"></canvas>
    <canvas id="right" width="200" height="200"></canvas>
    <canvas id="front" width="200" height="200"></canvas>
    <canvas id="back" width="200" height="200"></canvas>
  </div>
  <img src="img/graphs/burglary-color.jpg" id="burglary" class="demo205" />
  <img src="img/graphs/damage-color.jpg" id="damage" class="demo205" />
  <img src="img/graphs/fraud-color.jpg" id="fraud" class="demo205" />
  <img src="img/graphs/robbery-color.jpg" id="robbery" class="demo205" />
  <img src="img/graphs/theft-color.jpg" id="theft" class="demo205" />
  <img src="img/graphs/violence-color.jpg" id="violence" class="demo205" />
  <p id="testmessage"></p>
  <script src="../source/scrawlCore.js"></script>
  <script id="myscript">
  var mycode = function() {
    'use strict'
    var testTicker = Date.now(),
      testTime = testTicker,
      testNow,
      testMessage = document.getElementById('testmessage');

    //define variables
    var sides = ['top', 'bottom', 'left', 'right', 'front', 'back'],
      pics = ['robbery', 'theft', 'violence', 'fraud', 'burglary', 'damage'],
      pads = {
        top: scrawl.pad.top,
        bottom: scrawl.pad.bottom,
        left: scrawl.pad.left,
        right: scrawl.pad.right,
        front: scrawl.pad.front,
        back: scrawl.pad.back,
      },
      cells = {
        top: scrawl.cell[pads.top.base],
        bottom: scrawl.cell[pads.bottom.base],
        left: scrawl.cell[pads.left.base],
        right: scrawl.cell[pads.right.base],
        front: scrawl.cell[pads.front.base],
        back: scrawl.cell[pads.back.base],
      },
      mystack = scrawl.stack.mystack,
      //use a virtual cube to determine the constructed cube's orientation
      cube = scrawl.makeQuaternion(),
      //the amount (in degrees) by which the virtual cube will rotate on each screen refresh
      deltaCube = scrawl.makeQuaternion({
        pitch: 1,
        yaw: -0.8,
        roll: 0.3,
      }),
      instructions = scrawl.element.instructions,
      words;

    //load images into scrawl library
    scrawl.getImagesByClass('demo205');

    //initialize DOM 3d effects - stack
    mystack.set({
      width: 400,
      height: 400,
      perspectiveZ: 800,
    });

    //initialize instructions element
    instructions.set({
      startX: '50%',
      startY: '60%',
      handleX: 'center',
      handleY: 'center',
      pointerEvents: 'none',
    });

    //initialize DOM 3d effects - canvas elements
    for (var i = 0, z = sides.length; i < z; i++) {
      pads[sides[i]].set({
        pivot: 'mouse',
        handleX: 'center',
        handleY: 'center',
        mouse: false,
        pointerEvents: 'none',
      });
    }
    //each of the canvas elements has its own initial rotation and translation values
    pads.top.set({
      deltaPitch: 90,
      deltaTranslateY: -100
    });
    pads.bottom.set({
      deltaPitch: -90,
      deltaTranslateY: 100
    });
    pads.left.set({
      deltaYaw: -90,
      deltaTranslateX: -100
    });
    pads.right.set({
      deltaYaw: 90,
      deltaTranslateX: 100
    });
    pads.back.set({
      deltaYaw: -180,
      deltaTranslateZ: -100
    });
    pads.front.set({
      deltaYaw: 0,
      deltaTranslateZ: 100
    });

    //define sprites to display on each canvas
    words = scrawl.newGroup({
      name: 'words',
      visibility: false,
      sprites: sides,
    });
    for (var i = 0, z = sides.length; i < z; i++) {
      scrawl.newPicture({
        name: pics[i],
        pivot: sides[i],
        handleX: 'center',
        handleY: 'center',
        width: 200,
        height: 200,
        source: pics[i],
        order: 0,
        group: pads[sides[i]].base,
      });
      scrawl.newPhrase({
        name: sides[i],
        startX: 100,
        startY: 100,
        handleX: 'center',
        handleY: 'center',
        font: '36pt Arial, sans-serif',
        text: sides[i],
        order: 1,
        group: pads[sides[i]].base,
      });
    }

    //animation object
    scrawl.newAnimation({
      fn: function() {
        //rotate the cube
        cube.quaternionMultiply(deltaCube);
        scrawl.update3d({
          action: 'pads',
          quaternion: cube,
          distance: 100,
        });
        scrawl.renderElements();
        //animate the canvas sprites
        words.updateSpritesBy({
          roll: 0.5,
        });
        scrawl.render();

        testNow = Date.now();
        testTime = testNow - testTicker;
        testTicker = testNow;
        testMessage.innerHTML = 'Milliseconds per screen refresh: ' + parseInt(testTime) + '; fps: ' + parseInt(1000 / testTime);
      },
    });
  };

  scrawl.loadModules({
      path: '../source/js/',
      minified: false,
      modules: ['images', 'phrase', 'animation', 'stacks'],
      callback: function() {
        window.addEventListener('load', function() {
            scrawl.init();
            mycode();
          };
        },
      });
  </script>
</body>

</html>
