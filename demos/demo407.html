<!DOCTYPE html>
<html>

<head>
  <title>Demo 407</title>
  <link href="css/normalize.css" rel="stylesheet" />
  <link href="css/demo.css" rel="stylesheet" />
  <style>
  table {
    width: 100%;
  }
  th,
  td {
    border: 1px solid black;
    text-align: center;
    width: 24%;
  }
  table input {
    width: 80%;
  }
  </style>
</head>

<body>
  <h1><a href="index.html">Scrawl.js</a> - demonstration 407</h1>
  <h2>Scrawl image filters - tint()</h2>
  <h3>Modules: images, filters, animation</h3>
  <canvas width="400" height="400" id="mycanvas"></canvas>
  <p>Tint value: 0 ('0%')
    <input id="myvalue" type="range" value="1" min="0" max="1" step="0.05" />1 ('100%')</p>
  <table>
    <tr>
      <th rowspan="2">Source channel</th>
      <th colspan="3">Destination channels</th>
    </tr>
    <tr>
      <th>Red</th>
      <th>Green</th>
      <th>Blue</th>
    </tr>
    <tr>
      <td><b>Red</b>
      </td>
      <td>0
        <input id="rr" type="range" value="0.39" min="0" max="1" step="0.01" />1</td>
      <td>0
        <input id="rg" type="range" value="0.35" min="0" max="1" step="0.01" />1</td>
      <td>0
        <input id="rb" type="range" value="0.27" min="0" max="1" step="0.01" />1</td>
    </tr>
    <tr>
      <td><b>Green</b>
      </td>
      <td>0
        <input id="gr" type="range" value="0.77" min="0" max="1" step="0.01" />1</td>
      <td>0
        <input id="gg" type="range" value="0.69" min="0" max="1" step="0.01" />1</td>
      <td>0
        <input id="gb" type="range" value="0.53" min="0" max="1" step="0.01" />1</td>
    </tr>
    <tr>
      <td><b>Blue</b>
      </td>
      <td>0
        <input id="br" type="range" value="0.19" min="0" max="1" step="0.01" />1</td>
      <td>0
        <input id="bg" type="range" value="0.17" min="0" max="1" step="0.01" />1</td>
      <td>0
        <input id="bb" type="range" value="0.13" min="0" max="1" step="0.01" />1</td>
    </tr>
  </table>
  <img src="img/carousel/cagedparrot.png" id="parrot" alt="color version of parrot" class="demo407" />
  <p id="testmessage"></p>
  <script src="../source/scrawlCore.js"></script>
  <script id="myscript">
  var mycode = function() {
    'use strict'
    var testTicker = Date.now(),
      testTime = testTicker,
      testNow,
      testMessage = document.getElementById('testmessage');

    //define variables
    var myInput,
      updateInput,
      rr, rg, rb, gr, gg, gb, br, bg, bb,
      rrVal = 0.39,
      rgVal = 0.35,
      rbVal = 0.27,
      grVal = 0.77,
      ggVal = 0.69,
      gbVal = 0.53,
      brVal = 0.19,
      bgVal = 0.17,
      bbVal = 0.13,
      _rr, _rg, _rb, _gr, _gg, _gb, _br, _bg, _bb;

    //import image
    scrawl.getImagesByClass('demo407');

    //clone image and add filter to it
    scrawl.image.parrot.clone({
      name: 'tintparrot',
    }).filter('tint', {
      value: 1,
      useSourceData: true,
    });

    //define sprites
    scrawl.newPicture({
      name: 'parrot',
      startX: 10,
      startY: 10,
      scale: 0.5,
      source: 'parrot',
    }).clone({
      startX: 120,
      startY: 210,
      source: 'tintparrot',
    });

    //preparing the DOM input elements
    myInput = document.getElementById('myvalue');
    myInput.value = 1;
    rr = document.getElementById('rr');
    rr.value = rrVal;
    rg = document.getElementById('rg');
    rg.value = rgVal;
    rb = document.getElementById('rb');
    rb.value = rbVal;
    gr = document.getElementById('gr');
    gr.value = grVal;
    gg = document.getElementById('gg');
    gg.value = ggVal;
    gb = document.getElementById('gb');
    gb.value = gbVal;
    br = document.getElementById('br');
    br.value = brVal;
    bg = document.getElementById('bg');
    bg.value = bgVal;
    bb = document.getElementById('bb');
    bb.value = bbVal;

    //event listener
    updateInput = function(e) {
      scrawl.image.tintparrot.filter('tint', {
        value: parseFloat(myInput.value),
        useSourceData: true,
        rr: rrVal,
        rg: rgVal,
        rb: rbVal,
        gr: grVal,
        gg: ggVal,
        gb: gbVal,
        br: brVal,
        bg: bgVal,
        bb: bbVal,
      });
      if (e) {
        e.preventDefault();
        e.returnValue = false;
      }
    };
    myInput.addEventListener('input', updateInput, false); //for firefox real-time updating
    myInput.addEventListener('change', updateInput, false);
    _rr = function(e) {
      rrVal = parseFloat(rr.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    rr.addEventListener('change', _rr, false);
    _rg = function(e) {
      rgVal = parseFloat(rg.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    rg.addEventListener('change', _rg, false);
    _rb = function(e) {
      rbVal = parseFloat(rb.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    rb.addEventListener('change', _rb, false);
    _gr = function(e) {
      grVal = parseFloat(gr.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    gr.addEventListener('change', _gr, false);
    _gg = function(e) {
      ggVal = parseFloat(gg.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    gg.addEventListener('change', _gg, false);
    _gb = function(e) {
      gbVal = parseFloat(gb.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    gb.addEventListener('change', _gb, false);
    _br = function(e) {
      brVal = parseFloat(br.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    br.addEventListener('change', _br, false);
    _bg = function(e) {
      bgVal = parseFloat(bg.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    bg.addEventListener('change', _bg, false);
    _bb = function(e) {
      bbVal = parseFloat(bb.value);
      updateInput();
      e.preventDefault();
      e.returnValue = false;
    };
    bb.addEventListener('change', _bb, false);

    //to make sure everything is in place ...
    updateInput();

    //animation object
    scrawl.newAnimation({
      fn: function() {
        scrawl.render();

        testNow = Date.now();
        testTime = testNow - testTicker;
        testTicker = testNow;
        testMessage.innerHTML = 'Current tint value: ' + myInput.value + '. Milliseconds per screen refresh: ' + parseInt(testTime) + '; fps: ' + parseInt(1000 / testTime) + '<br />rr: ' + rrVal + '; rg: ' + rgVal + '; rb: ' + rbVal + '; gr: ' + grVal + '; gg: ' + ggVal + '; gb: ' + gbVal + '; br: ' + brVal + '; bg: ' + bgVal + '; bb: ' + bbVal;
      },
    });
  };

  scrawl.loadModules({
      path: '../source/js/',
      minified: false,
      modules: ['images', 'filters', 'animation'],
      callback: function() {
        window.addEventListener('load', function() {
            scrawl.init();
            mycode();
          };
        },
      });
  </script>
</body>

</html>
