<!DOCTYPE html>
<html>
    <head>
        <title>Scrawl.js</title>
 		<link href="css/prism.css" rel="stylesheet" />
 		<link href="css/demo.css" rel="stylesheet" />
    </head>
    <body>
		<h1><a href="index.html">Scrawl.js</a> - demonstration 043</h1>
		<h2>Scrawl animation - attaching sprites to Point pivots</h2>
		<h3>Modules: path, factories, animation, collisions, wheel, block</h3>
		<canvas id="mycanvas" width="750" height="375"></canvas>
		<p id="testmessage"></p>
		<script src="js/scrawlCore.js"></script>
		<script>
			var mycode = function(){
				var testTicker = Date.now(),
					testTime = testTicker,
					testNow,
					testMessage = document.getElementById('testmessage');
					
				//define variables
				var result,
					minX = 50, 
					minY = 50, 
					maxX = 700, 
					maxY = 325,
					mySprite,
					points = ['frame_p2', 'frame_p4', 'frame_p6', 'frame_p8', 'frame_p10'],
					dRadius = 2, 
					minRad = 20, 
					maxRad = 80, 
					radius = 50,
					dRoll = -1,
					moveSprites;
					
				//define sprites
				mySprite = scrawl.makeRegularShape({
					name: 'frame',
					startX: 562,
					startY: 187,
					deltaX: 3,
					deltaY: -2,
					method: 'none',
					radius: 50,
					sides: 10,
					collisionPoints: 'start',
					});
					
				for(var i=1; i<11; i++){
					scrawl.newWheel({
						pivot: 'frame_p'+i,
						radius: 12,
						fillStyle: 'Green',
						method: 'fillDraw',
						});
					}
				
				scrawl.newWheel({
					pivot: 'frame',
					radius: 4,
					fillStyle: 'red',
					method: 'fill',
					});

				//sprite used to build Cell collision zone image
				scrawl.newBlock({
					startX: 50,
					startY: 50,
					width: 650,
					height: 275,
					method: 'draw',
					order: 10,
					field: true,
					});
				scrawl.buildFields();

				//animation function
				moveSprites = function(){
					result = mySprite.checkField();
					if(typeof result !== 'boolean'){
						if(!scrawl.isBetween(result.x, minX, maxX, true)){
							mySprite.reverse('deltaX');
							}
						if(!scrawl.isBetween(result.y, minY, maxY, true)){
							mySprite.reverse('deltaY');
							}
						}
					mySprite.updateStart();
					if(!scrawl.isBetween((radius + dRadius), maxRad, minRad)){
						dRadius = -dRadius;
						}
					radius += dRadius;
					for(var j = 0, z = points.length; j < z; j++){
						scrawl.point[points[j]].set({
							distance: radius,
							});
						}
					mySprite.setDelta({
						roll: dRoll,
						});
					};
				
				//animation object
				scrawl.newAnimation({
					fn: function(){
						moveSprites();
						scrawl.render();
						
						testNow = Date.now();
						testTime =  testNow - testTicker;
						testTicker = testNow;
						testMessage.innerHTML = 'Milliseconds per screen refresh: '+parseInt(testTime)+'; fps: '+parseInt(1000/testTime);
						},
					});
				};
				
			scrawl.loadModules({
				path: 'js/',
				modules: ['path', 'factories', 'animation', 'collisions', 'wheel', 'block'],
				callback: function(){
					window.onload = function(){
						scrawl.init();
						mycode();
						};
					},
				});
		</script>
<pre><code class="language-javascript">var mycode = function(){
	//define variables
	var result,
		minX = 50, 
		minY = 50, 
		maxX = 700, 
		maxY = 325,
		mySprite,
		points = ['frame_p2', 'frame_p4', 'frame_p6', 'frame_p8', 'frame_p10'],
		dRadius = 2, 
		minRad = 20, 
		maxRad = 80, 
		radius = 50,
		dRoll = -1,
		moveSprites;
		
	//define sprites
	mySprite = scrawl.makeRegularShape({
		name: 'frame',
		startX: 562,
		startY: 187,
		deltaX: 3,
		deltaY: -2,
		method: 'none',
		radius: 50,
		sides: 10,
		collisionPoints: 'start',
		});
		
	for(var i=1; i<11; i++){
		scrawl.newWheel({
			pivot: 'frame_p'+i,
			radius: 12,
			fillStyle: 'Green',
			method: 'fillDraw',
			});
		}
	
	scrawl.newWheel({
		pivot: 'frame',
		radius: 4,
		fillStyle: 'red',
		method: 'fill',
		});

	//sprite used to build Cell collision zone image
	scrawl.newBlock({
		startX: 50,
		startY: 50,
		width: 650,
		height: 275,
		method: 'draw',
		order: 10,
		field: true,
		});
	scrawl.buildFields();

	//animation function
	moveSprites = function(){
		result = mySprite.checkField();
		if(typeof result !== 'boolean'){
			if(!scrawl.isBetween(result.x, minX, maxX, true)){
				mySprite.reverse('deltaX');
				}
			if(!scrawl.isBetween(result.y, minY, maxY, true)){
				mySprite.reverse('deltaY');
				}
			}
		mySprite.updateStart();
		if(!scrawl.isBetween((radius + dRadius), maxRad, minRad)){
			dRadius = -dRadius;
			}
		radius += dRadius;
		for(var j = 0, z = points.length; j < z; j++){
			scrawl.point[points[j]].set({
				distance: radius,
				});
			}
		mySprite.setDelta({
			roll: dRoll,
			});
		};
	
	//animation object
	scrawl.newAnimation({
		fn: function(){
			moveSprites();
			scrawl.render();
			},
		});
	};
	
scrawl.loadModules({
	path: 'js/',
	modules: ['path', 'factories', 'animation', 'collisions', 'wheel', 'block'],
	callback: function(){
		window.onload = function(){
			scrawl.init();
			mycode();
			};
		},
	});</code></pre>
		<script src="js/prism.js"></script>
    </body>
</html>
