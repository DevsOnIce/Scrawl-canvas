<!DOCTYPE html>
<html>
	<head>
		<title>Demo 206</title>
		<link href="css/normalize.css" rel="stylesheet" />
		<link href="css/demo.css" rel="stylesheet" />
		<style>
			canvas {
				border: 0;
				}
		</style>
    </head>
	<body>
		<h1><a href="index.html">Scrawl.js</a> - demonstration 206</h1>
		<h2>Animated cat across an animated 3D background</h2>
		<h3>Modules: images, animation, stacks</h3>
		<img id="catGround" src="img/groundimage.png" class="demo206" />
		<img id="cat" src="img/runningcat.png" class="demo206" />
		<img src="img/sky.jpg" id="catSky" class="demo206" />
		<div id="stackholder"></div>
		<p id="testmessage"></p>
		<script src="../source/scrawlCore.js"></script>
		<script id="myscript">
			var mycode = function(){
				'use strict'
				var testTicker = Date.now(),
					testTime = testTicker,
					testNow,
					testMessage = document.getElementById('testmessage');
			
				//define variables
				var groundSpeed = 3.2, 
					myGround,
					myGroundCell,
					groundSprite,
					skySpeed = 2.8, 
					mySky,
					mySkyCell,
					skySprite,
					catSpeed = 1,
					myCat;
				
				//load images into library
				scrawl.getImagesByClass('demo206');

				//add a stack to the web page
				scrawl.addStackToPage({
					stackName:			'catstack', 
					parentElement:		'stackholder',
					overflow: 			'hidden',
					width:				1000, 
					height:				500, 
					perspectiveY:		270,
					perspectiveZ:		400,
					});
					
				//add three new canvases/pads to the stack
				mySky = scrawl.addCanvasToPage({
					canvasName:			'sky',
					stackName:			'catstack',
					width:				1000,
					height:				280,
					backgroundColor:	'#b3f3ec',
					title:				'Background canvas',
					handleY:			'bottom',
					startY:				280,
					pitch:				-45,
					});
				myGround = scrawl.addCanvasToPage({
					canvasName:			'ground',
					stackName:			'catstack',
					width:				1000,
					height:				350,
					handleY:			'top',
					startY:				280,
					pitch:				80,
					title:				'canvas showing scrolled 3d ground',
					position:			'relative',
					});
				myCat = scrawl.addCanvasToPage({
					canvasName:			'catCanvas',
					stackName:			'catstack',
					width:				300,
					height:				150,
					//necessary for Safari, which only shows the cat if it is 'in front of' the scenery
					translateZ:			150,
					handleX:			'center',
					handleY:			'65%',
					startX:				'center',
					startY:				'center',
					title:				'Canvas showing running cat',
					});
					
				//build sky canvas
				mySkyCell = mySky.addNewCell({
					name:		'skyImage',
					width:		1100,
					height:		500,
					});
				scrawl.newPicture({
					name:		'temporary',
					source:		'catSky',
					width:		1100,
					height:		500,
					group:		'skyImage',
					}).stamp();
				scrawl.deleteSprite('temporary');
				skySprite = scrawl.newPicture({
					source:		'skyImage',
					width:		1000,
					height:		500,
					copyWidth:	1000,
					copyHeight:	500,
					group:		mySky.base,
					});
					
				//build ground canvas
				myGroundCell = myGround.addNewCell({
					name:		'groundImage',
					width:		1100,
					height:		500,
					});
				scrawl.newPicture({
					name:		'temporary',
					source:		'catGround',
					width:		1100,
					height:		500,
					group:		'groundImage',
					}).stamp();
				scrawl.deleteSprite('temporary');
				groundSprite = scrawl.newPicture({
					source:		'groundImage',
					width:		1000,
					height:		500,
					copyWidth:	1000,
					copyHeight:	500,
					group:		myGround.base,
					});
					
				//build cat canvas
				scrawl.newAnimSheet({
					name:		'animatedCat',
					sheet:		'cat',
					running:	'forward',
					loop:		'loop',
					speed:		catSpeed,
					frames:		[
						{x: 0, y: 0, w: 512, h: 256, d: 100,},
						{x: 512, y: 0, w: 512, h: 256, d: 100,},
						{x: 0, y: 256, w: 512, h: 256, d: 100,},
						{x: 512, y: 256, w: 512, h: 256, d: 100,},
						{x: 0, y: 512, w: 512, h: 256, d: 100,},
						{x: 512, y: 512, w: 512, h: 256, d: 100,},
						{x: 0, y: 768, w: 512, h: 256, d: 100,},
						{x: 512, y: 768, w: 512, h: 256, d: 100,},
						],
					});
				scrawl.newPicture({
					width:		300,
					height:		150,
					source:		'cat',
					animSheet:	'animatedCat',
					group:		myCat.base,
					});
					
				//animation objects
				scrawl.newAnimation({
					name: 'sky',
					delay: true,
					fn: function(){
						if(skySprite.copyX + skySpeed >= 100){
							mySkyCell.spliceCell({
								edge:	'left',
								strip:	100,
								});
							skySprite.setDelta({copyX: - 100});
							}
						skySprite.setDelta({copyX: skySpeed});
						mySky.render({
							clear:		'base',
							compile:	'base',
							show:		'wipe-display',
							});
						},
					});
				scrawl.newAnimation({
					name: 'ground',
					delay: true,
					fn: function(){
						if(groundSprite.copyX + groundSpeed >= 100){
							myGroundCell.spliceCell({
								edge:	'left',
								strip:	100,
								});
							groundSprite.setDelta({copyX: - 100});
							}
						groundSprite.setDelta({copyX: groundSpeed});
						myGround.render({
							clear:		'base',
							compile:	'base',
							show:		'wipe-display',
							});
						},
					});
				scrawl.newAnimation({
					name: 'cat',
					delay: true,
					fn: function(){
						myCat.render();
						
						testNow = Date.now();
						testTime =  testNow - testTicker;
						testTicker = testNow;
						testMessage.innerHTML = 'Milliseconds per screen refresh: '+parseInt(testTime)+'; fps: '+parseInt(1000/testTime);
						},
					});
					
				//render initial scene
				scrawl.renderElements();
				
				//start animation
				scrawl.animate = ['sky','ground'];		//setting the animate array directly
				scrawl.animation.cat.run();				//adding an animation to the end of the animate array
				};
				
			scrawl.loadModules({
				path: '../source/js/',
				minified: false,
				modules: ['images', 'animation', 'stacks'],
				callback: function(){
					window.addEventListener('load', function(){
						scrawl.init();
						mycode();
						};
					},
				});
		</script>
    </body>
</html>
