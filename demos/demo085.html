<!DOCTYPE html>
<html>
	<head>
		<title>Scrawl.js</title>
		<link href="css/prism.css" rel="stylesheet" />
		<link href="css/demo.css" rel="stylesheet" />
		<style>
			#mystack {
				border: solid 1px red;
				}
		</style>
	</head>
	<body>
		<h1><a href="index.html">Scrawl.js</a> - demonstration 085</h1>
		<h2>Scrawl.js video tile puzzle</h2>
		<h3>Modules: block, shape, animation, images, collisions</h3>
		<p>(currently not working in Internet Explorer, Chrome or Safari)</p>
		<p id="myP">Mixing tiles ...</p>
		<video id="dog" width="640" height="480" preload autoplay loop class="demo085">
			<source src="img/dog.mp4"  type="video/mp4; codecs=avc1.42E01E,mp4a.40.2">
			<source src="img/dog.webm" type="video/webm; codecs=vp8,vorbis">
		</video>
		<canvas id="mycanvas" width="640" height="480"></canvas>
		<p id="testmessage"></p>
		<script src="js/scrawlCore.js"></script>
		<script>
			var mycode = function(){
				var testTicker = Date.now(),
					testTime = testTicker,
					testNow,
					testMessage = document.getElementById('testmessage');
					
				//define variables
				var myCanvas = scrawl.canvas.mycanvas,
					myPad = scrawl.pad.mycanvas,
					selectedTile = false, 
					previousTile = false, 
					moving = false,
					prepare = true,
					mixCounter = 0, 
					here, 
					currentTile, 
					legalTiles,
					myTiles,
					mySpace,
					myTile,
					mySprite,
					spaceBlock,
					hits,
					myX, 
					myY,
					getLegalTiles,
					startTileMove,
					endTileMove,
					mixTiles,
					handleSprite;
					
				//load images (video) into scrawl library
				scrawl.getImagesByClass('demo085');
				
				//define groups
				myTiles = scrawl.newGroup({
					name: 	'tiles',
					order: 	1,
					});
				mySpace = scrawl.newGroup({
					name: 	'space',
					order: 	3,
					});
				scrawl.newGroup({
					name: 	'lines',
					order: 	2,
					});
					
				//define sprites
				myTile = scrawl.newPicture({
					source: 		'dog',
					group: 			'tiles',
					width: 			128,
					height: 		96,
					copyWidth: 		128,
					copyHeight: 	96,
					handleX: 		'center',
					handleY: 		'center',
					delta: 			{},
					});
				for(var i = 0; i < 5; i++){
					for(var j = 0; j < 5; j++){
						myTile.clone({
							name: 		'tile'+i+''+j,
							copyX: 		i * 128,
							startX: 	(i * 128) + 64,
							copyY: 		j * 96,
							startY: 	(j * 96) + 48,
							keepCopyDimensions: true,
							});
						}
					}
				scrawl.deleteSprite([myTile.name, 'tile44']);
				
				scrawl.newShape({
					strokeStyle: 	'white',
					lineWidth: 		2,
					group: 			'lines',
					data: 			'm0,96 640,0m0,96-640,0m0,96 640,0m0,96-640,0m128,96 0-480m128,0 0,480m128,0 0-480m128,0 0,480',
					});
				
				spaceBlock = scrawl.newBlock({
					name: 				'spacer',
					startX: 			576,
					startY: 			432,
					handleX: 			'center',
					handleY: 			'center',
					width: 				148,
					height: 			116,
					fillStyle: 			'rgba(0,0,0,0)',
					strokeStyle: 		'red',
					lineWidth: 			4,
					method: 			'fillDraw',
					group: 				'space',
					collisionPoints: 	'edges',
					});
					
				//animation functions
				getLegalTiles = function(){
					legalTiles = [];
					hits = mySpace.getBetweenGroupSpriteHits(myTiles);
					for(var i = 0, z = hits.length; i < z; i++){
						scrawl.pushUnique(legalTiles, hits[i][1]);
						}
					};
					
				startTileMove = function(t){
					if(scrawl.xt(t)){
						myX = 0, myY = 0;
						if(t.start.x !== spaceBlock.start.x){
							(t.start.x < spaceBlock.start.x) ? myX = 2 : myX = -2;
							}
						else{
							(t.start.y < spaceBlock.start.y) ? myY = 2 : myY = -2;
							}
						t.delta.set({
							x: myX,
							y: myY,
							});
						currentTile = t;
						moving = true;
						}
					};
					
				endTileMove = function(){
					myX = 0, myY = 0;
					if(currentTile.delta.x !== 0){
						myX = (currentTile.delta.x < 0) ? 128 : -128;
						}
					else{
						myY = (currentTile.delta.y < 0) ? 96 : -96;
						}
					spaceBlock.setDelta({
						start: {
							x: myX,
							y: myY,
							}
						});
					currentTile.delta.set();
					moving = false;
					};
					
				mixTiles = function(){
					if(!moving){
						getLegalTiles();
						if(selectedTile){
							scrawl.removeItem(legalTiles, previousTile);
							scrawl.removeItem(legalTiles, selectedTile);
							}
						previousTile = selectedTile;
						selectedTile = legalTiles[Math.floor(Math.random() * legalTiles.length)]
						startTileMove(scrawl.sprite[selectedTile]);
						mixCounter++;
						if(mixCounter >= 25){
							prepare = false;
							document.getElementById('myP').innerHTML = 'Click on tile to move it into the adjacent space'
							}
						}
					};
					
				//event handlers
				handleSprite = function(e){
					if(e){
						e.stopPropagation();
						e.preventDefault();
						}
					if(!prepare){
						if(!moving){
							mySprite = myTiles.getSpriteAt(here);
							if(mySprite){
								getLegalTiles();
								if(scrawl.contains(legalTiles, mySprite.name)){
									startTileMove(mySprite);
									}
								}
							}
						}
					};
				myCanvas.addEventListener('mouseup', handleSprite, false);
				
				//animation object
				scrawl.newAnimation({
					fn: function(){
						here = myPad.getMouse();
						if(prepare){
							mixTiles();
							}
						if(moving && currentTile){
							currentTile.updateStart();
							if(currentTile.start.isEqual(spaceBlock.start)){
								endTileMove();
								}
							}
						scrawl.render();
						
						testNow = Date.now();
						testTime =  testNow - testTicker;
						testTicker = testNow;
						testMessage.innerHTML = 'Milliseconds per screen refresh: '+parseInt(testTime)+'; fps: '+parseInt(1000/testTime);
						},
					});
				};
				
			scrawl.loadModules({
				path: 'js/',
				modules: ['block', 'shape', 'animation', 'images', 'collisions'],
				callback: function(){
					window.onload = function(){
						scrawl.init();
						mycode();
						};
					},
				});
		</script>
<pre><code class="language-markup">&lt;body>
	&lt;video id="dog" width="640" height="480" preload autoplay loop class="demo085">
		&lt;source src="img/dog.mp4"  type="video/mp4; codecs=avc1.42E01E,mp4a.40.2">
		&lt;source src="img/dog.webm" type="video/webm; codecs=vp8,vorbis">
	&lt;/video>
	&lt;canvas id="mycanvas" width="640" height="480">&lt;/canvas>
	&lt;script src="js/scrawlCore.js">&lt;/script>
	&lt;script>
		var mycode = function(){
			//define variables
			var myCanvas = scrawl.canvas.mycanvas,
				myPad = scrawl.pad.mycanvas,
				selectedTile = false, 
				previousTile = false, 
				moving = false,
				prepare = true,
				mixCounter = 0, 
				here, 
				currentTile, 
				legalTiles,
				myTiles,
				mySpace,
				myTile,
				mySprite,
				spaceBlock,
				hits,
				myX, 
				myY,
				getLegalTiles,
				startTileMove,
				endTileMove,
				mixTiles,
				handleSprite;
				
			//load images (video) into scrawl library
			scrawl.getImagesByClass('demo085');
			
			//define groups
			myTiles = scrawl.newGroup({
				name: 	'tiles',
				order: 	1,
				});
			mySpace = scrawl.newGroup({
				name: 	'space',
				order: 	3,
				});
			scrawl.newGroup({
				name: 	'lines',
				order: 	2,
				});
				
			//define sprites
			myTile = scrawl.newPicture({
				source: 		'dog',
				group: 			'tiles',
				width: 			128,
				height: 		96,
				copyWidth: 		128,
				copyHeight: 	96,
				handleX: 		'center',
				handleY: 		'center',
				delta: 			{},
				});
			for(var i = 0; i &lt; 5; i++){
				for(var j = 0; j &lt; 5; j++){
					myTile.clone({
						name: 		'tile'+i+''+j,
						copyX: 		i * 128,
						startX: 	(i * 128) + 64,
						copyY: 		j * 96,
						startY: 	(j * 96) + 48,
						keepCopyDimensions: true,
						});
					}
				}
			scrawl.deleteSprite([myTile.name, 'tile44']);
			
			scrawl.newShape({
				strokeStyle: 	'white',
				lineWidth: 		2,
				group: 			'lines',
				data: 			'm0,96 640,0m0,96-640,0m0,96 640,0m0,96-640,0m128,96 0-480m128,0 0,480m128,0 0-480m128,0 0,480',
				});
			
			spaceBlock = scrawl.newBlock({
				name: 				'spacer',
				startX: 			576,
				startY: 			432,
				handleX: 			'center',
				handleY: 			'center',
				width: 				148,
				height: 			116,
				fillStyle: 			'rgba(0,0,0,0)',
				strokeStyle: 		'red',
				lineWidth: 			4,
				method: 			'fillDraw',
				group: 				'space',
				collisionPoints: 	'edges',
				});
				
			//animation functions
			getLegalTiles = function(){
				legalTiles = [];
				hits = mySpace.getBetweenGroupSpriteHits(myTiles);
				for(var i = 0, z = hits.length; i &lt; z; i++){
					scrawl.pushUnique(legalTiles, hits[i][1]);
					}
				};
				
			startTileMove = function(t){
				if(scrawl.xt(t)){
					myX = 0, myY = 0;
					if(t.start.x !== spaceBlock.start.x){
						(t.start.x &lt; spaceBlock.start.x) ? myX = 2 : myX = -2;
						}
					else{
						(t.start.y &lt; spaceBlock.start.y) ? myY = 2 : myY = -2;
						}
					t.delta.set({
						x: myX,
						y: myY,
						});
					currentTile = t;
					moving = true;
					}
				};
				
			endTileMove = function(){
				myX = 0, myY = 0;
				if(currentTile.delta.x !== 0){
					myX = (currentTile.delta.x &lt; 0) ? 128 : -128;
					}
				else{
					myY = (currentTile.delta.y &lt; 0) ? 96 : -96;
					}
				spaceBlock.setDelta({
					start: {
						x: myX,
						y: myY,
						}
					});
				currentTile.delta.set();
				moving = false;
				};
				
			mixTiles = function(){
				if(!moving){
					getLegalTiles();
					if(selectedTile){
						scrawl.removeItem(legalTiles, previousTile);
						scrawl.removeItem(legalTiles, selectedTile);
						}
					previousTile = selectedTile;
					selectedTile = legalTiles[Math.floor(Math.random() * legalTiles.length)]
					startTileMove(scrawl.sprite[selectedTile]);
					mixCounter++;
					if(mixCounter >= 25){
						prepare = false;
						document.getElementById('myP').innerHTML = 'Click on tile to move it into the adjacent space'
						}
					}
				};
				
			//event handlers
			handleSprite = function(e){
				if(e){
					e.stopPropagation();
					e.preventDefault();
					}
				if(!prepare){
					if(!moving){
						mySprite = myTiles.getSpriteAt(here);
						if(mySprite){
							getLegalTiles();
							if(scrawl.contains(legalTiles, mySprite.name)){
								startTileMove(mySprite);
								}
							}
						}
					}
				};
			myCanvas.addEventListener('mouseup', handleSprite, false);
			
			//animation object
			scrawl.newAnimation({
				fn: function(){
					here = myPad.getMouse();
					if(prepare){
						mixTiles();
						}
					if(moving && currentTile){
						currentTile.updateStart();
						if(currentTile.start.isEqual(spaceBlock.start)){
							endTileMove();
							}
						}
					scrawl.render();
					},
				});
			};
			
		scrawl.loadModules({
			path: 'js/',
			modules: ['block', 'shape', 'animation', 'images', 'collisions'],
			callback: function(){
				window.onload = function(){
					scrawl.init();
					mycode();
					};
				},
			});
	&lt;/script>
&lt;/body></code></pre>
		<script src="js/prism.js"></script>
    </body>
</html>
