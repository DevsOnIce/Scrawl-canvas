/*! scrawl 2014-04-05 */
"use strict";var scrawl=function(a){return a.newWheel=function(b){return new a.Wheel(b)},a.Wheel=function(b){return b=a.safeObject(b),a.Sprite.call(this,b),a.Position.prototype.set.call(this,b),this.radius=b.radius||a.d.Wheel.radius,this.width=2*this.radius,this.height=this.width,this.checkHitUsingRadius=a.isa(b.checkHitUsingRadius,"bool")?b.checkHitUsingRadius:a.d.Wheel.checkHitUsingRadius,this.closed=a.isa(b.closed,"bool")?b.closed:a.d.Wheel.closed,this.includeCenter=a.isa(b.includeCenter,"bool")?b.includeCenter:a.d.Wheel.includeCenter,this.clockwise=a.isa(b.clockwise,"bool")?b.clockwise:a.d.Wheel.clockwise,this.registerInLibrary(),a.pushUnique(a.group[this.group].sprites,this.name),this},a.Wheel.prototype=Object.create(a.Sprite.prototype),a.Wheel.prototype.type="Wheel",a.Wheel.prototype.classname="spritenames",a.d.Wheel={startAngle:0,endAngle:360,clockwise:!1,closed:!0,includeCenter:!1,checkHitUsingRadius:!0,checkHitRadius:0},a.mergeInto(a.d.Wheel,a.d.Sprite),a.Wheel.prototype.set=function(b){return a.Sprite.prototype.set.call(this,b),this.radius=b.radius||this.radius,this.width=2*this.radius,this.height=this.width,this},a.Wheel.prototype.setDelta=function(b){a.Sprite.prototype.setDelta.call(this,b),b=a.isa(b,"obj")?b:{};var c={};return a.xt(b.radius)&&(this.radius+=b.radius,this.width=2*this.radius,this.height=this.width),a.xt(b.startAngle)&&(c.startAngle=this.get("startAngle")+b.startAngle),a.xt(b.endAngle)&&(c.endAngle=this.get("endAngle")+b.endAngle),this.set(c),this},a.Wheel.prototype.checkHit=function(b){b=a.safeObject(b);var c,d,e,f,g,h,i,j=a.xt(b.tests)?b.tests:[{x:b.x||!1,y:b.y||!1}],k=!1;if(this.checkHitUsingRadius){f=this.checkHitRadius?this.checkHitRadius:this.radius*this.scale;for(var l=0,m=j.length;m>l&&(c=j[l].x-this.start.x,d=j[l].y-this.start.y,e=Math.sqrt(c*c+d*d),!(k=f>=e?!0:!1));l++);}else{g=a.pad[b.pad]||a.pad[a.currentPad],h=a.cell[g.current].name,i=a.context[g.current],this.buildPath(i,h);for(var l=0,m=j.length;m>l&&!(k=i.isPointInPath(j[l].x,j[l].y));l++);}return k?j[l]:!1},a.Wheel.prototype.getPivotOffsetVector=function(){return this.getCenteredPivotOffsetVector()},a.Wheel.prototype.buildPath=function(b,c){var d=this.prepareStamp(),e=this.get("startAngle"),f=this.get("endAngle");return this.rotateCell(b,c),b.beginPath(),b.arc(d.x,d.y,this.radius*this.scale,e*a.radian,f*a.radian,this.clockwise),this.includeCenter&&b.lineTo(d.x,d.y),this.closed&&b.closePath(),this},a.Wheel.prototype.clip=function(a,b){return this.buildPath(a,b),a.clip(),this},a.Wheel.prototype.clear=function(b,c){return b.globalCompositeOperation="destination-out",this.buildPath(b,c),b.stroke(),b.fill(),b.globalCompositeOperation=a.ctx[c].get("globalCompositeOperation"),this},a.Wheel.prototype.clearWithBackground=function(b,c){var d=a.cell[c],e=d.get("backgroundColor"),f=a.ctx[c],g=f.get("fillStyle"),h=f.get("strokeStyle"),i=f.get("globalAlpha");return b.fillStyle=e,b.strokeStyle=e,b.globalAlpha=1,this.buildPath(b,c),b.stroke(),b.fill(),b.fillStyle=g,b.strokeStyle=h,b.globalAlpha=i,this},a.Wheel.prototype.draw=function(b,c){return a.cell[c].setEngine(this),this.buildPath(b,c),b.stroke(),this},a.Wheel.prototype.fill=function(b,c){return a.cell[c].setEngine(this),this.buildPath(b,c),b.fill(),this},a.Wheel.prototype.drawFill=function(b,c){return a.cell[c].setEngine(this),this.buildPath(b,c),b.stroke(),this.clearShadow(b,c),b.fill(),this},a.Wheel.prototype.fillDraw=function(b,c){return a.cell[c].setEngine(this),this.buildPath(b,c),b.fill(),this.clearShadow(b,c),b.stroke(),this},a.Wheel.prototype.sinkInto=function(b,c){return a.cell[c].setEngine(this),this.buildPath(b,c),b.fill(),b.stroke(),this},a.Wheel.prototype.floatOver=function(b,c){return a.cell[c].setEngine(this),this.buildPath(b,c),b.stroke(),b.fill(),this},a.Wheel.prototype.buildCollisionVectors=function(b){if(a.xt(a.d.Wheel.fieldChannel)){var c,d,e,f=a.newVector({x:this.radius,y:0});c=a.xt(b)?this.parseCollisionPoints(b):this.collisionPoints,this.collisionVectors=[];for(var g=0,h=c.length;h>g;g++)if(a.isa(c[g],"num")&&c[g]>1){d=360/Math.floor(c[g]);for(var i=0;i<c[g];i++)this.collisionVectors.push(f.getVector().rotate(d*i))}else if(a.isa(c[g],"str")){switch(c[g]){case"start":e=a.newVector();break;case"N":e=f.getVector().rotate(-90);break;case"NE":e=f.getVector().rotate(-45);break;case"E":e=f.getVector();break;case"SE":e=f.getVector().rotate(45);break;case"S":e=f.getVector().rotate(90);break;case"SW":e=f.getVector().rotate(135);break;case"W":e=f.getVector().rotate(180);break;case"NW":e=f.getVector().rotate(-135);break;case"center":e=a.newVector()}this.collisionVectors.push(e)}else a.isa(c[g],"obj")&&"Vector"===c[g].type&&this.collisionVectors.push(c[g])}return this},a}(scrawl);