/*! scrawl 2014-03-17 */
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.scrawl=function(){function a(a){return a=G.isa(a,"obj")?a:{},this.name=G.makeName({name:a.name||"",type:this.type,target:this.classname}),this}function b(a){return a=G.isa(a,"obj")?a:{},this.x=a.x||0,this.y=a.y||0,this.z=a.z||0,this}function c(a){a=G.isa(a,"obj")?a:{};var c=G.xt(a.v)?a.v:{};return this.n=a.n||1,this.v=new b({x:c.x||0,y:c.y||0,z:c.z||0}),this}function d(c){c=G.isa(c,"obj")?c:{};var d;return a.call(this,c),d=G.isa(c.start,"obj")?c.start:{},this.start=new b({x:G.xt(c.startX)?c.startX:G.xt(d.x)?d.x:0,y:G.xt(c.startY)?c.startY:G.xt(d.y)?d.y:0}),d=G.isa(c.delta,"obj")?c.delta:{},this.delta=new b({x:G.xt(c.deltaX)?c.deltaX:G.xt(d.x)?d.x:0,y:G.xt(c.deltaY)?c.deltaY:G.xt(d.y)?d.y:0}),d=G.isa(c.handle,"obj")?c.handle:{},this.handle=new b({x:G.xt(c.handleX)?c.handleX:G.xt(d.x)?d.x:0,y:G.xt(c.handleY)?c.handleY:G.xt(d.y)?d.y:0}),this.pivot=c.pivot||G.d[this.type].pivot,this.path=c.path||G.d[this.type].path,this.pathRoll=c.pathRoll||G.d[this.type].pathRoll,this.addPathRoll=c.addPathRoll||G.d[this.type].addPathRoll,this.pathSpeedConstant=G.isa(c.pathSpeedConstant,"bool")?c.pathSpeedConstant:G.d[this.type].pathSpeedConstant,this.pathPlace=c.pathPlace||G.d[this.type].pathPlace,this.deltaPathPlace=c.deltaPathPlace||G.d[this.type].deltaPathPlace,this.scale=G.isa(c.scale,"num")?c.scale:G.d[this.type].scale,this}function e(d){d=G.isa(d,"obj")?d:{};var e;return a.call(this,d),e=G.isa(d.start,"obj")?d.start:{},this.start=new b({x:G.xt(d.startX)?d.startX:G.xt(e.x)?e.x:0,y:G.xt(d.startY)?d.startY:G.xt(e.y)?e.y:0}),e=G.isa(d.delta,"obj")?d.delta:{},this.delta=new b({x:G.xt(d.deltaX)?d.deltaX:G.xt(e.x)?e.x:0,y:G.xt(d.deltaY)?d.deltaY:G.xt(e.y)?e.y:0}),e=G.isa(d.handle,"obj")?d.handle:{},this.handle=new b({x:G.xt(d.handleX)?d.handleX:G.xt(e.x)?e.x:0,y:G.xt(d.handleY)?d.handleY:G.xt(e.y)?e.y:0}),G.xto([d.handleX,d.handleY,d.handle])&&this.setTransformOrigin(),e=G.isa(d.translate,"obj")?d.translate:{},this.translate=new b({x:G.xt(d.translateX)?d.translateX:G.xt(e.x)?e.x:0,y:G.xt(d.translateY)?d.translateY:G.xt(e.y)?e.y:0,z:G.xt(d.translateZ)?d.translateZ:G.xt(e.y)?e.y:0}),this.pivot=d.pivot||G.d[this.type].pivot,this.path=d.path||G.d[this.type].path,this.pathRoll=d.pathRoll||G.d[this.type].pathRoll,this.addPathRoll=d.addPathRoll||G.d[this.type].addPathRoll,this.pathSpeedConstant=G.isa(d.pathSpeedConstant,"bool")?d.pathSpeedConstant:G.d[this.type].pathSpeedConstant,this.pathPlace=d.pathPlace||G.d[this.type].pathPlace,this.deltaPathPlace=d.deltaPathPlace||G.d[this.type].deltaPathPlace,this.lockX=d.lockX||G.d[this.type].lockX,this.lockY=d.lockY||G.d[this.type].lockY,this.scale=G.isa(d.scale,"num")?d.scale:G.d[this.type].scale,this.visibility=G.isa(d.visibility,"bool")?d.visibility:G.d[this.type].visibility,this.rotation=c.prototype.makeQuaternion({pitch:d.pitch||0,yaw:d.yaw||0,roll:d.roll||0}),this.deltaRotation=c.prototype.makeQuaternion({pitch:d.deltaPitch||0,yaw:d.deltaYaw||0,roll:d.deltaRoll||0}),this.rotationTolerance=d.rotationTolerance||.001,this}function f(a){if(a=G.isa(a,"obj")?a:{},e.call(this,a),G.xt(a.stackElement)){var c,d="";return G.xto([a.stackElement.id,a.stackElement.name])&&(d=a.stackElement.id||a.stackElement.name),e.call(this,{name:d}),G.stack[this.name]=this,G.stk[this.name]=a.stackElement,G.pushUnique(G.stacknames,this.name),G.stk[this.name].id=this.name,G.stk[this.name].style.position="relative",this.setDisplayOffsets(),c=G.isa(a.perspective,"obj")?a.perspective:{},this.perspective=new b({x:G.xt(a.perspectiveX)?a.perspectiveX:G.xt(c.x)?c.x:"center",y:G.xt(a.perspectiveY)?a.perspectiveY:G.xt(c.y)?c.y:"center",z:G.xt(a.perspectiveZ)?a.perspectiveZ:G.xt(c.z)?c.z:0}),this.width=a.width||this.get("width"),this.height=a.height||this.get("height"),this.setDimensions(),this.setPerspective(),this.setStyles(a),G.xto([a.title,a.comment])&&this.setAccessibility(a),this}return console.log("Failed to generate a Stack wrapper - no DOM element supplied"),!1}function g(a){if(a=G.isa(a,"obj")?a:{},e.call(this,a),G.xt(a.domElement)){var b="";return G.xto([a.domElement.id,a.domElement.name])&&(b=a.domElement.id||a.domElement.name),e.call(this,{name:b}),G.element[this.name]=this,G.elm[this.name]=a.domElement,G.pushUnique(G.elementnames,this.name),G.elm[this.name].id=this.name,G.elm[this.name].style.position="absolute",this.stack=a.stack||"",this.width=a.width||this.get("width"),this.height=a.height||this.get("height"),this.setDimensions(),this.setDisplayOffsets(),this.setStyles(a),G.xto([a.title,a.comment])&&this.setAccessibility(a),this}return console.log("Failed to generate an Element wrapper - no DOM element supplied"),!1}function h(a){a=G.isa(a,"obj")?a:{},e.call(this,a);var b,c,d,f;return G.xt(a.canvasElement)&&(G.canvas.PadConstructorTemporaryCanvas=a.canvasElement,this.display="PadConstructorTemporaryCanvas",b="",G.xto([a.canvasElement.id,a.canvasElement.name])&&(b=a.canvasElement.id||a.canvasElement.name),b.match(/_display$/)?e.call(this,{name:b.substr(0,b.length-8)}):e.call(this,{name:b}),a.canvasElement.id||(a.canvasElement.id=b),!G.contains(G.cellnames,this.name))?(this.cells=[],this.drawOrder=[],G.pad[this.name]=this,G.pushUnique(G.padnames,this.name),a.length>1&&this.set(a),c=new i({name:b,pad:this.name,canvas:a.canvasElement}),G.pushUnique(this.cells,c.name),this.display=c.name,delete G.canvas.PadConstructorTemporaryCanvas,d=a.canvasElement.cloneNode(!0),d.setAttribute("id",this.name+"_base"),f=new i({name:this.name+"_base",pad:this.name,canvas:d,backgroundColor:a.backgroundColor}),G.pushUnique(this.cells,f.name),this.base=f.name,this.current=f.name,this.width=a.width||this.get("width"),this.height=a.height||this.get("height"),this.setDimensions(),this.setDisplayOffsets(),this.setStyles(a),G.xto([a.title,a.comment])&&this.setAccessibility(a),this):(console.log("Failed to generate a Pad controller - no canvas element supplied"),!1)}function i(c){c=G.isa(c,"obj")?c:{};var e;d.call(this,c),a.prototype.set.call(this,c);var f;return G.xta([c,c.canvas])?(G.canvas[this.name]=c.canvas,G.context[this.name]=c.canvas.getContext("2d"),G.cell[this.name]=this,G.pushUnique(G.cellnames,this.name),this.pad=c.pad||!1,e=G.isa(c.source,"obj")?c.source:{},this.source=new b({x:G.xt(c.sourceX)?c.sourceX:G.xt(e.x)?e.x:0,y:G.xt(c.sourceY)?c.sourceY:G.xt(e.y)?e.y:0}),e=G.isa(c.sourceDelta,"obj")?c.sourceDelta:{},this.sourceDelta=new b({x:G.xt(c.sourceDeltaX)?c.sourceDeltaX:G.xt(e.x)?e.x:0,y:G.xt(c.sourceDeltaY)?c.sourceDeltaY:G.xt(e.y)?e.y:0}),this.actualWidth=c.actualWidth||c.width||G.canvas[this.name].width,this.actualHeight=c.actualHeight||c.height||G.canvas[this.name].height,this.sourceWidth=this.actualWidth,this.sourceHeight=this.actualHeight,this.targetWidth=this.actualWidth,this.targetHeight=this.actualHeight,this.setDimensions(c),G.xto([c.targetX,c.targetY])&&(this.start.x=G.xt(c.targetX)?c.targetX:this.start.x,this.start.y=G.xt(c.targetY)?c.targetY:this.start.y),G.xto([c.sourceWidth,c.sourceHeight,c.targetWidth,c.targetHeight,c.width,c.height])&&(this.sourceWidth=c.sourceWidth||c.width||this.sourceWidth,this.sourceHeight=c.sourceHeight||c.height||this.sourceHeight,this.targetWidth=c.targetWidth||c.width||this.targetWidth,this.targetHeight=c.targetHeight||c.height||this.targetHeight),this.usePadDimensions=G.isa(c.usePadDimensions,"bool")?c.usePadDimensions:G.xto([c.sourceWidth,c.sourceHeight,c.targetWidth,c.targetHeight,c.width,c.height])?!1:!0,f=new j({name:this.name,cell:G.context[this.name]}),this.context=f.name,this.flipUpend=G.xt(c.flipUpend)?c.flipUpend:G.d.Cell.flipUpend,this.flipReverse=G.xt(c.flipReverse)?c.flipReverse:G.d.Cell.flipReverse,this.lockX=G.xt(c.lockX)?c.lockX:G.d.Cell.lockX,this.lockY=G.xt(c.lockY)?c.lockY:G.d.Cell.lockY,this.roll=c.roll||G.d.Cell.roll,this.groups=G.xt(c.groups)?[].concat(c.groups):[],new m({name:this.name,cell:this.name}),new m({name:this.name+"_field",cell:this.name,visibility:!1}),c.field&&(G.group[this.name+"_field"].sprites=[].concat(c.field)),new m({name:this.name+"_fence",cell:this.name,visibility:!1}),c.fence&&(G.group[this.name+"_fence"].sprites=[].concat(c.fence)),this):(console.log("Cell constructor encountered an error: no canvas element supplied to it"),!1)}function j(b){return b=G.isa(b,"obj")?b:{},a.call(this,b),b.cell?this.getContextFromEngine(b.cell):this.set(b),G.ctx[this.name]=this,G.pushUnique(G.ctxnames,this.name),this}function k(b){b=G.isa(b,"obj")?b:{};var c,d=G.xt(b.imageData)?b.imageData:{},e=G.xt(b.element)?b.element:{},f=G.xt(b.makeCopy)?b.makeCopy:!1;return G.xto([b.element,b.imageData])?(b.name=b.name||e.getAttribute("id")||e.getAttribute("name")||e.getAttribute("src"),a.call(this,b),this.width=b.width||d.width||parseFloat(e.offsetWidth)||e.width||e.style.width||0,this.height=b.height||d.height||parseFloat(e.offsetHeight)||e.height||e.style.height||0,c=G.xt(b.element)?this.getImageDataUrl(e):d,G.xt(b.element)&&f&&(G.img[this.name]=this.makeImage(c)),G.image[this.name]=this,G.pushUnique(G.imagenames,this.name),G.object[this.name]=e,G.pushUnique(G.objectnames,this.name),this.source=b.source||this.name||"",this):!1}function l(b){return b=G.isa(b,"obj")?b:{},a.call(this,b),this.sheet=b.sheet||b.source||!1,this.frames=G.xt(b.frames)?[].concat(b.frames):[],this.currentFrame=b.currentFrame||0,this.speed=G.isa(b.speed,"num")?b.speed:1,this.loop=G.isa(b.loop,"str")?b.loop:"end",this.running=G.isa(b.running,"str")?b.running:"complete",this.lastCalled=G.xt(b.lastCalled)?b.lastCalled:Date.now(),G.anim[this.name]=this,G.pushUnique(G.animnames,this.name),this}function m(b){return b=G.isa(b,"obj")?b:{},a.call(this,b),this.sprites=G.xt(b.sprites)?[].concat(b.sprites):[],this.cell=b.cell||G.pad[G.currentPad].current,this.order=b.order||0,this.visibility=G.isa(b.visibility,"bool")?b.visibility:!0,this.spriteSort=G.isa(b.spriteSort,"bool")?b.spriteSort:!0,this.regionRadius=b.regionRadius||0,G.group[this.name]=this,G.pushUnique(G.groupnames,this.name),G.pushUnique(G.cell[this.cell].groups,this.name),this}function n(a){a=G.isa(a,"obj")?a:{},d.call(this,a),a.name=this.name;var b=new j(a);return this.context=b.name,this.group=this.getGroup(a),this.flipUpend=a.flipUpend||!1,this.flipReverse=a.flipReverse||!1,this.lockX=a.lockX||!1,this.lockY=a.lockY||!1,this.fastStamp=a.fastStamp||!1,this.scaleOutline=G.isa(a.scaleOutline,"bool")?a.scaleOutline:!0,this.roll=a.roll||0,this.order=a.order||0,this.visibility=G.isa(a.visibility,"bool")?a.visibility:!0,this.method=a.method||G.d[this.type].method,G.xt(a.field)&&this.addSpriteToCellFields(),G.xt(a.fence)&&this.addSpriteToCellFences(),this}function o(a){return a=G.isa(a,"obj")?a:{},n.call(this,a),d.prototype.set.call(this,a),this.registerInLibrary(),this.lineHeight=a.lineHeight||G.d.Phrase.lineHeight,a.font&&this.checkFont(a.font),this.constructFont(),this.size=this.get("size"),this.multiline(a),this.getMetrics(),this}function p(b){return b=G.isa(b,"obj")?b:{},a.call(this,b),this.text=b.text||G.d.Text.text,this.phrase=b.phrase||G.d.Text.phrase,this.context=G.sprite[this.phrase].context,this.fixedWidth=G.isa(b.fixedWidth,"bool")?b.fixedWidth:G.d.Text.fixedWidth,this.textAlongPath=b.textAlongPath||G.d.Text.textAlongPath,G.text[this.name]=this,G.pushUnique(G.textnames,this.name),G.pushUnique(G.sprite[this.phrase].texts,this.name),this.getMetrics(),this}function q(a){return a=G.isa(a,"obj")?a:{},n.call(this,a),d.prototype.set.call(this,a),this.width=a.width||G.d.Block.width,this.height=a.height||G.d.Block.height,this.registerInLibrary(),G.pushUnique(G.group[this.group].sprites,this.name),this}function r(a){return a=G.isa(a,"obj")?a:{},n.call(this,a),d.prototype.set.call(this,a),this.radius=a.radius||G.d.Wheel.radius,this.width=2*this.radius,this.height=this.width,this.checkHitUsingRadius=G.isa(a.checkHitUsingRadius,"bool")?a.checkHitUsingRadius:G.d.Wheel.checkHitUsingRadius,this.closed=G.isa(a.closed,"bool")?a.closed:G.d.Wheel.closed,this.includeCenter=G.isa(a.includeCenter,"bool")?a.includeCenter:G.d.Wheel.includeCenter,this.clockwise=G.isa(a.clockwise,"bool")?a.clockwise:G.d.Wheel.clockwise,this.registerInLibrary(),G.pushUnique(G.group[this.group].sprites,this.name),this}function s(a){if(G.isa(a,"obj")&&G.xt(a.url))return this.importImage(a);a=G.isa(a,"obj")?a:{},n.call(this,a),d.prototype.set.call(this,a);var b,c,e,f,g;return this.source=a.source||!1,this.imageType=this.sourceImage(a.source)||!1,this.source&&("img"===this.imageType?(b=G.image[this.source],c=b.get("width"),e=b.get("height"),f=0,g=0):"canvas"===this.imageType?(b=G.cell[this.source],c=b.sourceWidth,e=b.sourceHeight,f=b.source.x,g=b.source.y):"animation"===this.imageType&&(b=G.anim[this.get("animSheet")].getData(),c=b.copyWidth,e=b.copyHeight,f=b.copyX,g=b.copyY),this.width=a.width||c,this.height=a.height||e,this.copyX=a.copyX||f,this.copyY=a.copyY||g,this.copyWidth=a.copyWidth||c,this.copyHeight=a.copyHeight||e),this.registerInLibrary(),G.pushUnique(G.group[this.group].sprites,this.name),this}function t(a){return a=G.isa(a,"obj")?a:{},n.call(this,a),d.prototype.set.call(this,a),this.isLine=G.isa(a.isLine,"bool")?a.isLine:!0,this.dataSet=G.xt(this.data)?this.buildDataSet(this.data):"",this.registerInLibrary(),G.pushUnique(G.group[this.group].sprites,this.name),this}function u(a){return a=G.isa(a,"obj")?a:{},n.call(this,a),d.prototype.set.call(this,a),this.isLine=G.isa(a.isLine,"bool")?a.isLine:!0,this.linkList=[],this.linkDurations=[],this.pointList=[],this.registerInLibrary(),G.pushUnique(G.group[this.group].sprites,this.name),this}function v(c){c=G.isa(c,"obj")?c:{},a.call(this,c);var d=G.xt(c.local)?c.local:{};return this.sprite=c.sprite||"",this.local=c.local||new b({x:c.startX||c.currentX||d.x||0,y:c.startY||c.currentY||d.y||0}),this.startLink=c.startLink||"",this.fixed=c.fixed||!1,G.xto([c.angle,c.distance])&&this.setPolar(c),G.point[this.name]=this,G.pushUnique(G.pointnames,this.name),this.sprite&&"Shape"===G.sprite[this.sprite].type&&G.pushUnique(G.sprite[this.sprite].pointList,this.name),this}function w(b){return b=G.isa(b,"obj")?b:{},a.call(this,b),a.prototype.set.call(this,b),this.startPoint=b.startPoint||G.d.Link.startPoint,this.sprite=G.xt(G.point[this.startPoint])?G.point[this.startPoint].sprite:G.d.Link.sprite,this.endPoint=b.endPoint||G.d.Link.endPoint,this.species=b.species||G.d.Link.species,this.action=b.action||G.d.Link.action,G.link[this.name]=this,G.pushUnique(G.linknames,this.name),this.setPositions(),this.startPoint&&this.sprite&&"add"===this.action&&G.pushUnique(G.sprite[this.sprite].linkList,this.name),this}function x(b){return a.call(this,b),this}function y(b){return b=G.isa(b,"obj")?b:{},x.call(this,b),a.prototype.set.call(this,b),G.design[this.name]=this,G.pushUnique(G.designnames,this.name),this}function z(b){return b=G.isa(b,"obj")?b:{},x.call(this,b),a.prototype.set.call(this,b),G.design[this.name]=this,G.pushUnique(G.designnames,this.name),this}function A(b){return b=G.isa(b,"obj")?b:{},a.call(this,b),a.prototype.set.call(this,b),this.repeat=b.repeat||"repeat",this.cell=b.cell||G.pad[G.currentPad].current,this.setImage(b.source||b.imageData||G.image[b.image]||G.cell[b.canvas]||!1,b.callback),this}function B(b){return b=G.isa(b,"obj")?b:{},a.call(this,b),this.set(b),G.xt(b.color)&&this.convert(b.color),b.random&&this.generateRandomColor(b),this.checkValues(),G.design[this.name]=this,G.pushUnique(G.designnames,this.name),this}function C(c){return a.call(this,c),c=G.isa(c,"obj")?c:{},this.position=new b,this.velocity=new b,this.set(c),this.priorPosition=this.position.getVector(),this.engine=c.engine||"euler",this.userVar=c.userVar||{},this.mobile=G.isa(c.mobile,"bool")?c.mobile:!0,this.forces=c.forces||[],this.springs=c.springs||[],this.mass=c.mass||G.d.Particle.mass,this.elasticity=c.elasticity||G.d.Particle.elasticity,this.radius=c.radius||G.d.Particle.radius,(c.radius||c.area)&&(this.area=c.area||2*Math.PI*this.get("radius")*this.get("radius")||G.d.Particle.area),this.load=new b,G.sprite[this.name]=this,G.pushUnique(G.spritenames,this.name),this.group=n.prototype.getGroup.call(this,c),G.group[this.group].addSpritesToGroup(this.name),this}function D(c){if(c=G.isa(c,"obj")?c:{},G.xta([c.start,c.end])){var d=G.sprite[c.start],e=G.sprite[c.end];if(a.call(this,c),this.start=c.start,this.end=c.end,this.springConstant=c.springConstant||1e3,this.damperConstant=c.damperConstant||100,G.xt(c.restLength))this.restLength=c.restLength;else{var f=e.position.getVector();f.vectorSubtract(d.position),this.restLength=f.getMagnitude()}return this.currentLength=c.currentLength||this.restLength,this.force=new b,G.spring[this.name]=this,G.pushUnique(G.springnames,this.name),this}return!1}function E(b){return a.call(this,b),b=G.isa(b,"obj")?b:{},this.fn=b.fn||function(){},G.force[this.name]=this,G.pushUnique(G.forcenames,this.name),this}function F(b){a.call(this,b),b=G.isa(b,"obj")?b:{};var c=G.isa(b.delay,"bool")?b.delay:!1;return this.fn=b.fn||function(){},G.animation[this.name]=this,G.pushUnique(G.animationnames,this.name),c||this.run(),this}var G={type:"Library",version:"2.00",object:{},objectnames:[],pad:{},padnames:[],currentPad:null,cell:{},canvas:{},context:{},cellnames:[],ctx:{},ctxnames:[],image:{},imageData:{},img:{},imagenames:[],group:{},groupnames:[],design:{},dsn:{},designnames:[],sprite:{},spritenames:[],point:{},pointnames:[],link:{},linknames:[],anim:{},animnames:[],animation:{},animationnames:[],text:{},textnames:[],stack:{},stk:{},stacknames:[],element:{},elm:{},elementnames:[],spring:{},springnames:[],force:{},forcenames:[],nameslist:["objectnames","padnames","cellnames","imagenames","groupnames","designnames","spritenames","pointnames","linknames","ctxnames","animnames","animationnames","textnames","stacknames","elementnames","springnames","forcenames"],radian:Math.PI/180,mouseX:0,mouseY:0,contextKeys:[],animKeys:[],d:{},cv:document.createElement("canvas"),cvx:null,physics:{gravity:9.8,airDensity:1.23,deltaTime:0},mergeInto:function(a,b){for(var c in b)b.hasOwnProperty(c)&&!G.xt(a[c])&&(a[c]=b[c]);return a},mergeOver:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},contains:function(a,b){for(var c in a)if(a[c]===b)return!0;return!1},pushUnique:function(a,b){return this.contains(a,b)?!1:(a.push(b),!0)},removeItem:function(a,b){if(this.contains(a,b)){var c=a.indexOf(b);return a.splice(c,1),!0}return!1},isBetween:function(a,b,c,d){if(b>c){var e=b;b=c,c=e}return d?a>=b&&c>=a?!0:!1:a>b&&c>a||a===b&&a===c?!0:!1},newPad:function(a){return new h(a)},newStack:function(a){return new f(a)},newElement:function(a){return new g(a)},newCell:function(a){return new i(a)},newImage:function(a){return new k(a)},newGroup:function(a){return new m(a)},newPhrase:function(a){return new o(a)},newBlock:function(a){return new q(a)},newWheel:function(a){return new r(a)},newPicture:function(a){return new s(a)},newOutline:function(a){return new t(a)},newShape:function(a){return new u(a)},newPoint:function(a){return new v(a)},newLink:function(a){return new w(a)},newAnimSheet:function(a){return new l(a)},newAnimation:function(a){return new F(a)},newGradient:function(a){return new y(a)},newRadialGradient:function(a){return new z(a)},newColor:function(a){return new B(a)},newPattern:function(a){return new A(a)},newParticle:function(a){return new C(a)},newVector:function(a){return new b(a)},newQuaternion:function(a){return new c(a)},newSpring:function(a){return new D(a)},newForce:function(a){return new E(a)},isa:function(a,b){if(this.xta([a,b])){var c=b.toLowerCase();switch(c){case"num":return"number"==typeof a?!0:!1;case"str":return"string"==typeof a?!0:!1;case"bool":return"boolean"==typeof a?!0:!1;case"fn":return"function"==typeof a?!0:!1;case"arr":return"[object Array]"===Object.prototype.toString.call(a)?!0:!1;case"obj":return"[object Object]"===Object.prototype.toString.call(a)?!0:!1;case"date":return"[object Date]"===Object.prototype.toString.call(a)?!0:!1;default:return!1}}return!1},xt:function(a){return"undefined"!=typeof a?!0:!1},xta:function(a){var b=[].concat(a);if(b.length>0){for(var c=0,d=b.length;d>c;c++)if("undefined"==typeof b[c])return!1;return!0}return!1},xto:function(a){var b=[].concat(a);if(b.length>0)for(var c=0,d=b.length;d>c;c++)if("undefined"!=typeof b[c])return!0;return!1},makeName:function(a){a=this.isa(a,"obj")?a:{};var b={name:this.isa(a.name,"str")?a.name:null,type:this.isa(a.type,"str")?a.type:null,target:this.isa(a.target,"str")?a.target:null};if(this.contains(this.nameslist,b.target)){var c=b.name||b.type||"default",d=c.split("~£!"),e=this.contains(this[b.target],d[0])?d[0]+"~£!"+Math.floor(1e8*Math.random()):d[0];return e}return!1},getImagesByClass:function(a){if(a){var b=[],c=document.getElementsByClassName(a);if(c.length>0){for(var d=0,e=c.length;e>d;d++){var f=G.newImage({element:c[d]});b.push(f.name)}return b}}return console.log('scrawl.getImagesByClass() failed to find any <img> elements of class="'+a+'" on the page'),!1},clear:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)G.pad[c[d]].clear(a);return!0}return!1},stampBackground:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)G.pad[c[d]].stampBackground(a);return!0}return!1},compile:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)G.pad[c[d]].compile(a);return!0}return!1},show:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)G.pad[c[d]].show(a);return!0}return!1},render:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)G.pad[c[d]].render(a);return!0}return!1},reset:function(){return this.doAnimation=!1,this.objectnames=[],this.stack={},this.stk={},this.stacknames=[],this.element={},this.elm={},this.elementnames=[],this.pad={},this.padnames=[],this.currentPad=null,this.cell={},this.canvas={},this.context={},this.cellnames=[],this.ctx={},this.ctxnames=[],this.image={},this.imageData={},this.img={},this.imagenames=[],this.group={},this.groupnames=[],this.design={},this.dsn={},this.designnames=[],this.sprite={},this.spritenames=[],this.point={},this.pointnames=[],this.link={},this.linknames=[],this.anim={},this.animnames=[],this.animation={},this.animationnames=[],this.text={},this.textnames=[],this.spring={},this.springnames=[],this.force={},this.forcenames=[],this.initialize(),!0},addNewCell:function(a,b){var c=this.isa(b,"str")?b:this.currentPad;return G.pad[c].addNewCell(a)},deleteCells:function(a){if(this.xt(a)){for(var b=[].concat(a),c=0,d=b.length;d>c;c++){for(var e=0,f=this.padnames.length;f>e;e++)this.pad[this.padnames[e]].deleteCell(b[c]);delete this.group[b[c]],delete this.group[b[c]+"_field"],delete this.group[b[c]+"_fence"],G.removeItem(this.groupnames,b[c]),G.removeItem(this.groupnames,b[c]+"_field"),G.removeItem(this.groupnames,b[c]+"_fence"),delete this.context[b[c]],delete this.canvas[b[c]],delete this.ctx[G.cell[b[c]].context],G.removeItem(this.ctxnames,G.cell[b[c]].context),delete this.cell[b[c]],G.removeItem(this.cellnames,b[c])}return!0}return!1},setDrawOrder:function(a,b){for(var c=this.xt(b)?[].concat(b):[this.currentPad],d=0,e=c.length;e>d;d++)this.pad[c[d]].setDrawOrder(a);return!0},makeCartesianPoints:function(a){if(a=this.isa(a,"obj")?a:{},this.isa(a.pointLabel,"str")&&this.isa(a.sprite,"str")&&this.isa(a.data,"arr"))for(var b,c=[],d=this.xt(a.linkLabel)?a.linkLabel:a.pointLabel+"_link",e=0,f=a.data.length;f>e;e++)b=new v({name:a.pointLabel+e,sprite:a.sprite,currentX:a.data[e][0]||0,currentY:a.data[e][1]||0,startLink:d+e}),c.push(b.name);return c},makePolarPoints:function(a){if(a=this.isa(a,"obj")?a:{},this.isa(a.pointLabel,"str")&&this.isa(a.sprite,"str")&&this.isa(a.data,"arr"))for(var b,c=[],d=this.xt(a.linkLabel)?a.linkLabel:a.pointLabel+"_link",e=0,f=a.data.length;f>e;e++)b=new v({name:a.pointLabel+e,sprite:a.sprite,distance:a.data[e][0]||0,angle:a.data[e][1]||0,startLink:d+e}),c.push(b.name);return c},makePath:function(a){a=this.isa(a,"obj")?a:{};var b,c,d,e,f,g,h,i,j,k=999999,l=999999,m=-999999,n=-999999,o=0,p=0,q=0,r=0,s=this.xt(a.pivot)?this.point[s]||this.sprite[s]:!1;a.start=G.xt(a.start)?a.start:{},a.scaleX=a.scaleX||1,a.scaleY=a.scaleY||1,a.startX=s?"Point"===s.type?s.local.x:s.start.x:a.startX||a.start.x||0,a.startY=s?"Point"===s.type?s.local.y:s.start.y:a.startY||a.start.y||0,a.isLine=G.isa(a.isLine,"bool")?a.isLine:!0;var t=function(a,b){k=k>a?a:k,l=l>b?b:l,m=a>m?a:m,n=b>n?b:n},u=function(a){var b=a.match(/(-?[0-9.]+\b)/g);if(b){for(var c=0,d=b.length;d>c;c++)b[c]=parseFloat(b[c]);return b}return!1},x=function(a,b,c,d,e,f,g,h){new v({name:a+"_p"+b,sprite:c,currentX:d*g,currentY:e*h,startLink:a+"_l"+f})},y=function(b,c,d,e,f,g,h,i,j){h=G.xt(h)?h:{},i=G.xt(i)?i:{},j=G.xt(j)?j:{},new w({name:b+"_l"+c,sprite:d,species:e,startPoint:g.name,endPoint:h.name||!1,controlPoint1:i.name||!1,controlPoint2:j.name||!1,precision:a.precision||!1,action:f})};if(this.xt(a.data)&&(b=this.newShape(a),c=b.name,d=c.replace("~","_","g"),e=G.point,f=a.scaleX,g=a.scaleY,b)){h=a.data.match(/([A-Za-z][0-9. ,\-]*)/g),x(d,p,c,q,r,o,f,g),p++;for(var z=0,A=h.length;A>z;z++)switch(j=h[z][0],i=u(h[z]),j){case"M":q=i[0],r=i[1],t(q,r),x(d,p,c,q,r,o+1,f,g),p++,y(d,o,c,!1,"move",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++;for(var B=2,C=i.length;C>B;B+=2)x(d,p,c,i[B],i[B+1],o+1,f,g),p++,y(d,o,c,"line","add",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++,q=i[B],r=i[B+1],t(q,r);break;case"m":0===z?(q=i[0],r=i[1]):(q+=i[0],r+=i[1]),t(q,r),x(d,p,c,q,r,o+1,f,g),p++,y(d,o,c,!1,"move",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++;for(var B=2,C=i.length;C>B;B+=2)x(d,p,c,q+i[B],r+i[B+1],o+1,f,g),p++,y(d,o,c,"line","add",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++,q+=i[B],r+=i[B+1],t(q,r);break;case"Z":case"z":x(d,p,c,b.start.x,b.start.y,o+1,f,g),p++,y(d,o,c,!1,"close",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++;break;case"L":for(var B=0,C=i.length;C>B;B+=2)x(d,p,c,i[B],i[B+1],o+1,f,g),p++,y(d,o,c,"line","add",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++,q=i[B],r=i[B+1],t(q,r);break;case"l":for(var B=0,C=i.length;C>B;B+=2)x(d,p,c,q+i[B],r+i[B+1],o+1,f,g),p++,y(d,o,c,"line","add",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++,q+=i[B],r+=i[B+1],t(q,r);break;case"H":for(var B=0,C=i.length;C>B;B++)x(d,p,c,i[B],r,o+1,f,g),p++,y(d,o,c,"line","add",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++,q=i[B],t(q,r);break;case"h":for(var B=0,C=i.length;C>B;B++)x(d,p,c,q+i[B],r,o+1,f,g),p++,y(d,o,c,"line","add",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++,q+=i[B],t(q,r);break;case"V":for(var B=0,C=i.length;C>B;B++)x(d,p,c,q,i[B],o+1,f,g),p++,y(d,o,c,"line","add",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++,r=i[B],t(q,r);break;case"v":for(var B=0,C=i.length;C>B;B++)x(d,p,c,q,r+i[B],o+1,f,g),p++,y(d,o,c,"line","add",e[d+"_p"+(p-2)],e[d+"_p"+(p-1)]),o++,r+=i[B],t(q,r);break;case"C":for(var B=0,C=i.length;C>B;B+=6)x(d,p,c,i[B],i[B+1],o+1,f,g),p++,x(d,p,c,i[B+2],i[B+3],o+1,f,g),p++,x(d,p,c,i[B+4],i[B+5],o+1,f,g),p++,y(d,o,c,"bezier","add",e[d+"_p"+(p-4)],e[d+"_p"+(p-1)],e[d+"_p"+(p-3)],e[d+"_p"+(p-2)]),o++,q=i[B+4],r=i[B+5],t(q,r);break;case"c":for(var B=0,C=i.length;C>B;B+=6)x(d,p,c,q+i[B],r+i[B+1],o+1,f,g),p++,x(d,p,c,q+i[B+2],r+i[B+3],o+1,f,g),p++,x(d,p,c,q+i[B+4],r+i[B+5],o+1,f,g),p++,y(d,o,c,"bezier","add",e[d+"_p"+(p-4)],e[d+"_p"+(p-1)],e[d+"_p"+(p-3)],e[d+"_p"+(p-2)]),o++,q+=i[B+4],r+=i[B+5],t(q,r);break;case"S":for(var B=0,C=i.length;C>B;B+=4)z>0&&this.contains(["C","c","S","s"],h[z-1][0])?(e[d+"_p"+(p-2)].clone({name:d+"_p"+p,currentX:q+(q-e[d+"_p"+(p-2)].currentX),currentY:r+(r-e[d+"_p"+(p-2)].currentY)}),p++):(x(d,p,c,q,r,o+1,f,g),p++),x(d,p,c,i[B],i[B+1],o+1,f,g),p++,x(d,p,c,i[B+2],i[B+3],o+1,f,g),p++,y(d,o,c,"bezier","add",e[d+"_p"+(p-4)],e[d+"_p"+(p-1)],e[d+"_p"+(p-3)],e[d+"_p"+(p-2)]),o++,q=i[B+2],r=i[B+3],t(q,r);break;case"s":for(var B=0,C=i.length;C>B;B+=4)z>0&&this.contains(["C","c","S","s"],h[z-1][0])?(e[d+"_p"+(p-2)].clone({name:d+"_p"+p,currentX:q+(q-e[d+"_p"+(p-2)].currentX),currentY:r+(r-e[d+"_p"+(p-2)].currentY)}),p++):(x(d,p,c,q,r,o+1,f,g),p++),x(d,p,c,i[B],i[B+1],o+1,f,g),p++,x(d,p,c,i[B+2],i[B+3],o+1,f,g),p++,y(d,o,c,"bezier","add",e[d+"_p"+(p-4)],e[d+"_p"+(p-1)],e[d+"_p"+(p-3)],e[d+"_p"+(p-2)]),o++,q+=i[B+2],r+=i[B+3],t(q,r);break;case"Q":for(var B=0,C=i.length;C>B;B+=4)x(d,p,c,i[B],i[B+1],o+1,f,g),p++,x(d,p,c,i[B+2],i[B+3],o+1,f,g),p++,y(d,o,c,"quadratic","add",e[d+"_p"+(p-3)],e[d+"_p"+(p-1)],e[d+"_p"+(p-2)]),o++,q=i[B+2],r=i[B+3],t(q,r);break;case"q":for(var B=0,C=i.length;C>B;B+=4)x(d,p,c,q+i[B],r+i[B+1],o+1,f,g),p++,x(d,p,c,q+i[B+2],r+i[B+3],o+1,f,g),p++,y(d,o,c,"quadratic","add",e[d+"_p"+(p-3)],e[d+"_p"+(p-1)],e[d+"_p"+(p-2)]),o++,q+=i[B+2],r+=i[B+3],t(q,r);break;case"T":for(var B=0,C=i.length;C>B;B+=2)z>0&&this.contains(["Q","q","T","t"],h[z-1][0])?(e[d+"_p"+(p-2)].clone({name:d+"_p"+p,currentX:q+(q-e[d+"_p"+(p-2)].currentX),currentY:r+(r-e[d+"_p"+(p-2)].currentY)}),p++):(x(d,p,c,q,r,o+1,f,g),p++),x(d,p,c,i[B],i[B+1],o+1,f,g),p++,y(d,o,c,"quadratic","add",e[d+"_p"+(p-3)],e[d+"_p"+(p-1)],e[d+"_p"+(p-2)]),o++,q=i[B],r=i[B+1],t(q,r);break;case"t":for(var B=0,C=i.length;C>B;B+=2)z>0&&this.contains(["Q","q","T","t"],h[z-1][0])?(e[d+"_p"+(p-2)].clone({name:d+"_p"+p,currentX:q+(q-e[d+"_p"+(p-2)].currentX),currentY:r+(r-e[d+"_p"+(p-2)].currentY)}),p++):(x(d,p,c,q,r,o+1,f,g),p++),x(d,p,c,i[B],i[B+1],o+1,f,g),p++,y(d,o,c,"quadratic","add",e[d+"_p"+(p-3)],e[d+"_p"+(p-1)],e[d+"_p"+(p-2)]),o++,q+=i[B],r+=i[B+1],t(q,r)}return y(d,o,c,!1,"end",e[d+"_p"+(p-1)],e[d+"_p"+p]),b.set({firstPoint:d+"_p0",width:(m-k)*a.scaleX,height:(n-l)*a.scaleY}),b.buildPositions(),b}return!1},makeEllipse:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.radiusX=a.radiusX||0,a.radiusY=a.radiusY||0,a.closed=!0;var b="m",c=a.startX,d=a.startY,e=a.startX,f=a.startY-a.radiusY;return b+=c-e+","+(d-f),c=e,d=f,e=a.startX+.55*a.radiusX,f=a.startY-a.radiusY,b+="c"+(c-e)+","+(d-f),e=a.startX+a.radiusX,f=a.startY-.55*a.radiusY,b+=" "+(c-e)+","+(d-f),e=a.startX+a.radiusX,f=a.startY,b+=" "+(c-e)+","+(d-f),c=e,d=f,e=a.startX+a.radiusX,f=a.startY+.55*a.radiusY,b+="c"+(c-e)+","+(d-f),e=a.startX+.55*a.radiusX,f=a.startY+a.radiusY,b+=" "+(c-e)+","+(d-f),e=a.startX,f=a.startY+a.radiusY,b+=" "+(c-e)+","+(d-f),c=e,d=f,e=a.startX-.55*a.radiusX,f=a.startY+a.radiusY,b+="c"+(c-e)+","+(d-f),e=a.startX-a.radiusX,f=a.startY+.55*a.radiusY,b+=" "+(c-e)+","+(d-f),e=a.startX-a.radiusX,f=a.startY,b+=" "+(c-e)+","+(d-f),c=e,d=f,e=a.startX-a.radiusX,f=a.startY-.55*a.radiusY,b+="c"+(c-e)+","+(d-f),e=a.startX-.55*a.radiusX,f=a.startY-a.radiusY,b+=" "+(c-e)+","+(d-f),e=a.startX,f=a.startY-a.radiusY,b+=" "+(c-e)+","+(d-f),b+="z",a.isLine=!1,a.data=b,a.outline?this.newOutline(a):this.makePath(a)},makeRectangle:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.width=a.width||0,a.height=a.height||0,a.radius=a.radius||0,a.closed=!0;var b=a.radiusTopLeftX||a.radiusTopLeft||a.radiusTopX||a.radiusLeftX||a.radiusTop||a.radiusLeft||a.radiusX||a.radius||0,c=a.radiusTopLeftY||a.radiusTopLeft||a.radiusTopY||a.radiusLeftY||a.radiusTop||a.radiusLeft||a.radiusY||a.radius||0,d=a.radiusTopRightX||a.radiusTopRight||a.radiusTopX||a.radiusRightX||a.radiusTop||a.radiusRight||a.radiusX||a.radius||0,e=a.radiusTopRightY||a.radiusTopRight||a.radiusTopY||a.radiusRightY||a.radiusTop||a.radiusRight||a.radiusY||a.radius||0,f=a.radiusBottomRightX||a.radiusBottomRight||a.radiusBottomX||a.radiusRightX||a.radiusBottom||a.radiusRight||a.radiusX||a.radius||0,g=a.radiusBottomRightY||a.radiusBottomRight||a.radiusBottomY||a.radiusRightY||a.radiusBottom||a.radiusRight||a.radiusY||a.radius||0,h=a.radiusBottomLeftX||a.radiusBottomLeft||a.radiusBottomX||a.radiusLeftX||a.radiusBottom||a.radiusLeft||a.radiusX||a.radius||0,i=a.radiusBottomLeftY||a.radiusBottomLeft||a.radiusBottomY||a.radiusLeftY||a.radiusBottom||a.radiusLeft||a.radiusY||a.radius||0,j=a.width/2,k=a.height/2,l="m",m=a.startX,n=a.startY,o=a.startX-j+f,p=a.startY-k;
return l+=m-o+","+(n-p),m=o,n=p,o=a.startX+j-h,p=a.startY-k,l+="l"+(m-o)+","+(n-p),m=o,n=p,o=a.startX+j-h+.55*h,p=a.startY-k,l+="c"+(m-o)+","+(n-p),o=a.startX+j,p=a.startY-k+i-.55*i,l+=" "+(m-o)+","+(n-p),o=a.startX+j,p=a.startY-k+i,l+=" "+(m-o)+","+(n-p),m=o,n=p,o=a.startX+j,p=a.startY+k-c,l+="l"+(m-o)+","+(n-p),m=o,n=p,o=a.startX+j,p=a.startY+k-c+.55*c,l+="c"+(m-o)+","+(n-p),o=a.startX+j-b+.55*b,p=a.startY+k,l+=" "+(m-o)+","+(n-p),o=a.startX+j-b,p=a.startY+k,l+=" "+(m-o)+","+(n-p),m=o,n=p,o=a.startX-j+d,p=a.startY+k,l+="l"+(m-o)+","+(n-p),m=o,n=p,o=a.startX-j+d-.55*d,p=a.startY+k,l+="c"+(m-o)+","+(n-p),o=a.startX-j,p=a.startY+k-e+.55*e,l+=" "+(m-o)+","+(n-p),o=a.startX-j,p=a.startY+k-e,l+=" "+(m-o)+","+(n-p),m=o,n=p,o=a.startX-j,p=a.startY-k+g,l+="l"+(m-o)+","+(n-p),m=o,n=p,o=a.startX-j,p=a.startY-k+g-.55*g,l+="c"+(m-o)+","+(n-p),o=a.startX-j+f-.55*f,p=a.startY-k,l+=" "+(m-o)+","+(n-p),o=a.startX-j+f,p=a.startY-k,l+=" "+(m-o)+","+(n-p),l+="z",a.isLine=!1,a.data=l,a.outline?this.newOutline(a):this.makePath(a)},makeBezier:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.startControlX=a.startControlX||0,a.startControlY=a.startControlY||0,a.endControlX=a.endControlX||0,a.endControlY=a.endControlY||0,a.endX=a.endX||0,a.endY=a.endY||0,a.closed=!1,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top";var b,c,d,e=a.fixed||"none";if(a.fixed=!1,c="m0,0c"+(a.startControlX-a.startX)+","+(a.startControlY-a.startY)+" "+(a.endControlX-a.startX)+","+(a.endControlY-a.startY)+" "+(a.endX-a.startX)+","+(a.endY-a.startY),a.data=c,a.isLine=!0,a.outline)b=this.newOutline(a);else switch(b=this.makePath(a),d=b.name.replace("~","_","g"),e){case"all":this.point[d+"_p1"].setToFixed(a.startX,a.startY),this.point[d+"_p2"].setToFixed(a.startControlX,a.startControlY),this.point[d+"_p3"].setToFixed(a.endControlX,a.endControlY),this.point[d+"_p4"].setToFixed(a.endX,a.endY);break;case"both":this.point[d+"_p1"].setToFixed(a.startX,a.startY),this.point[d+"_p4"].setToFixed(a.endX,a.endY);break;case"start":this.point[d+"_p1"].setToFixed(a.startX,a.startY);break;case"startControl":this.point[d+"_p2"].setToFixed(a.startControlX,a.startControlY);break;case"endControl":this.point[d+"_p3"].setToFixed(a.endControlX,a.endControlY);break;case"end":this.point[d+"_p4"].setToFixed(a.endX,a.endY)}return b},makeQuadratic:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.controlX=a.controlX||0,a.controlY=a.controlY||0,a.endX=a.endX||0,a.endY=a.endY||0,a.closed=!1,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top";var b,c,d,e=a.fixed||"none";if(b="m0,0q"+(a.controlX-a.startX)+","+(a.controlY-a.startY)+" "+(a.endX-a.startX)+","+(a.endY-a.startY),a.fixed=!1,a.data=b,a.isLine=!0,a.outline)c=this.newOutline(a);else switch(c=this.makePath(a),d=c.name.replace("~","_","g"),e){case"all":this.point[d+"_p1"].setToFixed(a.startX,a.startY),this.point[d+"_p2"].setToFixed(a.controlX,a.controlY),this.point[d+"_p3"].setToFixed(a.endX,a.endY);break;case"both":this.point[d+"_p1"].setToFixed(a.startX,a.startY),this.point[d+"_p3"].setToFixed(a.endX,a.endY);break;case"start":this.point[d+"_p1"].setToFixed(a.startX,a.startY);break;case"control":this.point[d+"_p2"].setToFixed(a.controlX,a.controlY);break;case"end":this.point[d+"_p3"].setToFixed(a.endX,a.endY)}return c},makeLine:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.endX=a.endX||0,a.endY=a.endY||0,a.closed=!1,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top";var b,c,d,e=a.fixed||"none";if(b="m0,0 "+(a.endX-a.startX)+","+(a.endY-a.startY),a.fixed=!1,a.data=b,a.isLine=!0,a.outline)c=this.newOutline(a);else switch(c=this.makePath(a),d=c.name.replace("~","_","g"),e){case"both":this.point[d+"_p1"].setToFixed(a.startX,a.startY),this.point[d+"_p2"].setToFixed(a.endX,a.endY);break;case"start":this.point[d+"_p1"].setToFixed(a.startX,a.startY);break;case"end":this.point[d+"_p2"].setToFixed(a.endX,a.endY)}return c},makeRegularShape:function(a){if(a=this.isa(a,"obj")?a:{},this.xto([a.sides,a.angle])){a.startX=a.startX||0,a.startY=a.startY||0,a.radius=a.radius||20,a.closed=!0;var c,d,e,f,g=G.isa(a.sides,"num")&&a.sides>1?360/a.sides:G.isa(a.angle,"num")&&a.angle>0?a.angle:4,h=0,i=0,j=new b({x:a.radius}),k="m";e=j.getRotate(h),k+=""+e.x.toFixed(4)+","+e.y.toFixed(4)+" ",d=e.getVector();do i++,h+=g,h%=360,c=j.getRotate(h),e=c.getVectorSubtract(d),k+=""+e.x.toFixed(4)+","+e.y.toFixed(4)+" ",d=c.getVector(),f=h.toFixed(0);while("0"!==f&&1e3>i);return k+="z",a.data=k,a.isLine=!1,G.xt(a.outline)&&a.outline?this.newOutline(a):this.makePath(a)}return!1},deleteSprite:function(a){for(var b,c,d,e,f=G.isa(a,"str")?[a]:[].concat(a),g=0,h=f.length;h>g;g++)if(this.contains(this.spritenames,f[g])){if(e=this.sprite[f[g]],"Shape"===e.type){b=e.getFullPointList(),c=e.getFullLinkList();for(var i=0,j=b.length;j>i;i++)this.removeItem(this.pointnames,b[i]),delete this.point[b[i]];for(var i=0,j=c.length;j>i;i++)this.removeItem(this.linknames,c[i]),delete this.link[c[i]]}d=e.context,this.removeItem(this.ctxnames,d),delete this.ctx[d],this.removeItem(this.spritenames,f[g]),delete this.sprite[f[g]];for(var i=0,k=this.groupnames.length;k>i;i++)this.removeItem(this.group[this.groupnames[i]].sprites,f[g])}return!0},addSpritesToGroups:function(a,b){if(this.xta([a,b])){for(var c=[].concat(a),d=[].concat(b),e=0,f=c.length;f>e;e++)this.contains(this.groupnames,c[e])&&this.group[c[e]].addSpritesToGroup(d);return!0}return!1},removeSpritesFromGroups:function(a,b){if(this.xta([a,b])){for(var c=[].concat(a),d=[].concat(b),e=0,f=c.length;f>e;e++)this.contains(this.groupnames,c[e])&&this.group[c[e]].removeSpritesFromGroup(d);return!0}return!1},buildFields:function(a){var b=this.xt(a)?[].concat(a):[this.pad[this.currentPad].current];"all"===a&&(b=this.cellnames);for(var c=0,d=b.length;d>c;c++)this.cell[b[c]].buildField();return!0},initialize:function(){return this.getStacks(),this.getCanvases(),this.getElements(),this.setDisplayOffsets("all"),this.doAnimation=!0,this.animationLoop(),!0},getStacks:function(){var a,b=document.getElementsByClassName("scrawlstack"),c=[];if(b.length>0){for(var d=0,e=b.length;e>d;d++)c.push(b[d]);for(var d=0,e=b.length;e>d;d++){a=G.newStack({stackElement:c[d]});for(var f=0,g=G.stk[a.name].children.length;g>f;f++)G.stk[a.name].children[f].style.position="absolute","CANVAS"!==G.stk[a.name].children[f].tagName&&G.newElement({domElement:G.stk[a.name].children[f],stack:a.name});this.contains(this.elementnames,a.name)&&(a.stack=this.element[a.name].stack,delete this.element[a.name],delete this.elm[a.name],this.removeItem(this.elementnames,a.name))}return!0}return console.log('scrawl.getStacks() failed to find any elements with class="scrawlstack" on the page'),!1},getCanvases:function(){var a,b,c,d,e=document.getElementsByTagName("canvas"),f=[];if(e.length>0){for(var g=0,h=e.length;h>g;g++)f.push(e[g]);for(var g=0,h=e.length;h>g;g++)-1!==f[g].className.indexOf("stack:")&&(b=f[g].className.match(/stack:(\w+)/),this.contains(this.stacknames,b[1])?G.stk[b[1]].appendChild(f[g]):(c=document.createElement("div"),c.id=b[1],f[g].parentElement.appendChild(c),c.appendChild(f[g]),d=G.newStack({stackElement:document.getElementById(b[1])}))),a=G.newPad({canvasElement:f[g]}),this.contains(this.stacknames,f[g].parentElement.id)&&(a.stack=f[g].parentElement.id,f[g].style.position="absolute"),0===g&&(G.currentPad=a.name);return!0}return console.log("scrawl.getCanvases() failed to find any <canvas> elements on the page"),!1},getElements:function(){var a,b,c=document.getElementsByClassName("scrawl"),d=[];if(c.length>0){for(var e=0,f=c.length;f>e;e++)d.push(c[e]);for(var e=0,f=c.length;f>e;e++)a=d.id||d.name||!1,this.contains(this.elementnames,a)||-1!==d[e].className.indexOf("stack:")&&(b=d[e].className.match(/stack:(\w+)/),this.contains(this.stacknames,b[1])&&(G.stk[b[1]].appendChild(d[e]),G.newElement({domElement:d[e],stack:b[1]})));return!0}return console.log('scrawl.getElements() failed to find any elements with class="scrawl" on the page'),!1},addCanvasToPage:function(a){a=this.isa(a,"obj")?a:{};var b,c,d,e,f,g,h=!1;return this.xt(a.stackName)&&(h=document.getElementById(a.stackName)||!1,h||(g=G.xt(a.parentElement)?G.isa(a.parentElement,"str")?document.getElementById(a.parentElement):a.parentElement:document.body,h=this.addStackToPage({stackName:a.stackName,width:a.width,height:a.height,parentElement:g})),a.stack=h.name),b=G.stk[h.name||h.id]||document.getElementById(a.parentElement)||document.body,c=G.makeName({name:a.canvasName||a.name||!1,type:"Pad",target:"padnames"}),d=document.createElement("canvas"),d.id=c,b.appendChild(d),e=document.getElementById(c),e.width=a.width,e.height=a.height,f=G.newPad({canvasElement:e}),(this.xt(a.position)||h)&&(a.position=a.position||"absolute"),a.stack=a.stackName?a.stackName:"",f.set(a),this.setDisplayOffsets(),f},addStackToPage:function(a){if(this.isa(a.stackName,"str")&&this.xt(a.parentElement)){var b,c;return a.parentElement=G.isa(a.parentElement,"str")?document.getElementById(a.parentElement):a.parentElement,b=document.createElement("div"),b.id=a.stackName,a.parentElement.appendChild(b),a.stackElement=document.getElementById(a.stackName),c=new f(a),c.stack=this.contains(this.stacknames,a.parentElement.id)?a.parentElement.id:"",c}return!1},setDisplayOffsets:function(a){if(a=G.xt(a)?a:"all","stack"===a||"all"===a)for(var b=0,c=G.stacknames.length;c>b;b++)G.stack[G.stacknames[b]].setDisplayOffsets();if("pad"===a||"all"===a)for(var b=0,c=G.padnames.length;c>b;b++)G.pad[G.padnames[b]].setDisplayOffsets();if("element"===a||"all"===a)for(var b=0,c=G.elementnames.length;c>b;b++)G.element[G.elementnames[b]].setDisplayOffsets();return!0},renderElements:function(){for(var a=0,b=G.stacknames.length;b>a;a++)G.stack[G.stacknames[a]].renderElement();for(var a=0,b=G.padnames.length;b>a;a++)G.pad[G.padnames[a]].renderElement();for(var a=0,b=G.elementnames.length;b>a;a++)G.element[G.elementnames[a]].renderElement();return!0},handleMouseMove:function(a){if(!a)var a=window.event;return a.pageX||a.pageY?(G.mouseX=a.pageX,G.mouseY=a.pageY):(a.clientX||a.clientY)&&(G.mouseX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,G.mouseY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),!0},getImageDataValue:function(a){if(this.xta([a.table,a.channel])&&this.isa(a.x,"num")&&this.isa(a.y,"num")){var b,c,d,e;if(b=G.imageData[a.table],b&&G.isBetween(a.y,-1,b.height)&&G.isBetween(a.x,-1,b.width)){if(c=4*(a.y*b.width+a.x),"color"===a.channel)d="rgba("+b.data[c]+","+b.data[c+1]+","+b.data[c+2]+","+b.data[c+3]+")";else{switch(a.channel){case"red":e=0;break;case"blue":e=1;break;case"green":e=2;break;case"alpha":e=3}d=b.data[c+e]}return d}}return!1},updateSprings:function(a){if(this.springnames.length>0){var b=[];a=this.isa(a,"arr")?a:this.springnames;for(var c=0,d=a.length;d>c;c++)b.push(this.isa(a[c],"obj")?a[c]:this.isa(a[c],"str")?this.spring[a[c]]:!1);for(var c=0,d=b.length;d>c;c++)b[c]&&b[c].update();return!0}return!1},load:function(a){var b,c,d,e,f;this.isa(a,"str")&&(a=[a]);for(var g=0,h=a.length;h>g;g++)if(this.isa(a[g],"str")&&(b=JSON.parse(a[g]),this.xt(b.type)))if(c=b.type.toLowerCase(),this.contains(this[b.classname],b.name)){d=this[c][b.name].parse(),e=this.d[b.type],f=Object.keys(d);for(var i=0,j=f.length;j>i;i++)this.xt(b[f])||(b[f]=e[f]);this[c][b.name].set(b)}else switch(c){case"pad":this.addCanvasToPage(b),this.currentPad=b.name;break;case"cell":G.xt(b.pad)&&this.contains(this.padnames,b.pad)&&!this.contains(this.pad[b.pad].cells,b.name)&&this.pad[b.pad].addNewCell(b);break;case"spriteimage":new SpriteImage(b);break;case"animsheet":new l(b);break;case"group":new m(b);break;case"block":new q(b);break;case"wheel":new r(b);break;case"phrase":new o(b);break;case"picture":new s(b);break;case"outline":new t(b);break;case"shape":this.makePath(b);break;case"gradient":new y(b);break;case"radialgradient":new z(b);break;case"pattern":new A(b);break;case"color":new B(b);break;case"particle":new C(b);break;case"spring":new D(b)}return!0},save:function(a){var b=[];switch(a){case"pads":for(var c=0,d=this.padnames.length;d>c;c++)b=b.concat(this.pad[this.padnames[c]].toString());break;case"cells":for(var c=0,d=this.cellnames.length;d>c;c++)b=b.concat(this.cell[this.cellnames[c]].toString());break;case"groups":for(var c=0,d=this.groupnames.length;d>c;c++)b=b.concat(this.group[this.groupnames[c]].toString());break;case"sprites":for(var c=0,d=this.spritenames.length;d>c;c++)b=b.concat(this.sprite[this.spritenames[c]].toString());break;case"designs":for(var c=0,d=this.designnames.length;d>c;c++)b=b.concat(this.design[this.designnames[c]].toString());break;case"animsheets":for(var c=0,d=this.animnames.length;d>c;c++)b=b.concat(this.anim[this.animnames[c]].toString());break;case"springs":for(var c=0,d=this.springnames.length;d>c;c++)b=b.concat(this.spring[this.springnames[c]].toString())}return b},makeQuaternion:function(){return c.prototype.makeQuaternion(items)},doAnimation:!1,animate:[],animationLoop:function(){for(var a=0,b=G.animate.length;b>a;a++)G.animate[a]&&G.animation[G.animate[a]].fn();G.doAnimation&&window.requestAnimFrame(function(){G.animationLoop()})}};return a.prototype.type="Scrawl",a.prototype.classname="objectnames",G.d.Scrawl={comment:"",title:"",timestamp:""},a.prototype.get=function(a){return this[a]||G.d[this.type][a]},a.prototype.set=function(a){for(var b in a)G.xt(G.d[this.type][b])&&(this[b]=a[b]);return this},a.prototype.clone=function(a){var c=G.mergeOver(this.parse(),G.isa(a,"obj")?a:{});switch(delete c.context,this.type){case"Phrase":return new o(c);case"Block":return new q(c);case"Wheel":return new r(c);case"Picture":return new s(c);case"Outline":return new t(c);case"Shape":return G.makePath(c);case"Gradient":return new y(c);case"RadialGradient":return new z(c);case"Pattern":return new A(a);case"Color":return new B(c);case"Point":return new v(c);case"Link":return new w(c);case"Context":return new j(c);case"AnimSheet":return new l(c);case"Particle":return new C(c);case"Vector":return new b(c);case"Spring":return new D(c);case"ScrawlImage":return new k(c)}return!1},a.prototype.toString=function(){var a=Object.keys(G.d[this.type]),b={};b.type=this.type,b.classname=this.classname,b.name=this.name;for(var c=0,d=a.length;d>c;c++)G.xt(this[a[c]])&&this[a[c]]!==G.d[this.type][a[c]]&&(b[a[c]]=this[a[c]]);return JSON.stringify(b)},a.prototype.parse=function(){return JSON.parse(JSON.stringify(this))},b.prototype=Object.create(Object.prototype),b.prototype.type="Vector",G.d.Vector={x:0,y:0,z:0},b.prototype.setMagnitudeTo=function(a){return this.normalize(),this.scalarMultiply(a),this.getMagnitude()!==a&&(this.normalize(),this.scalarMultiply(a),this.getMagnitude()!==a&&(this.normalize(),this.scalarMultiply(a))),this},b.prototype.normalize=function(){var a=this.getMagnitude();return a>0?(this.x/=a,this.y/=a,this.z/=a,this):!1},b.prototype.set=function(a){return a=G.isa(a,"obj")?a:{},this.x=a.x||0,this.y=a.y||0,this.z=a.z||0,this},b.prototype.getNormal=function(){var a=this.getMagnitude();return a>0?new b({x:this.x/a,y:this.y/a,z:this.z/a}):!1},b.prototype.rotate=function(a){if(G.xt(a)){var b=Math.atan2(this.y,this.x);b+=a*G.radian;var c=this.getMagnitude();return this.x=c*Math.cos(b),this.y=c*Math.sin(b),this}return!1},b.prototype.getRotate=function(a){if(G.xt(a)){var c=Math.atan2(this.y,this.x);c+=a*G.radian;var d=this.getMagnitude();return new b({x:d*Math.cos(c),y:d*Math.sin(c)})}return!1},b.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},b.prototype.isEqual=function(a){return G.isa(a,"obj")&&G.xt(a.type)&&"Vector"===a.type&&this.x===a.x&&this.y===a.y&&this.z===a.z?!0:!1},b.prototype.isLike=function(a){return G.isa(a,"obj")&&this.x===a.x&&this.y===a.y&&this.z===a.z?!0:!1},b.prototype.getReverse=function(){return new b({x:-this.x,y:-this.y,z:-this.z})},b.prototype.vectorAdd=function(a){return G.isa(a,"obj")?(this.x+=a.x||0,this.y+=a.y||0,this.z+=a.z||0,this):!1},b.prototype.vectorSubtract=function(a){return G.isa(a,"obj")?(this.x-=a.x||0,this.y-=a.y||0,this.z-=a.z||0,this):!1},b.prototype.vectorMultiply=function(a){return G.isa(a,"obj")&&"Vector"===a.type?(this.x*=a.x||1,this.y*=a.y||1,this.z*=a.z||1,this):!1},b.prototype.vectorDivide=function(a){return G.isa(a,"obj")&&"Vector"===a.type?(this.x/=0!==(a.x||0)?a.x:1,this.y/=0!==(a.y||0)?a.y:1,this.z/=0!==(a.z||0)?a.z:1,this):!1},b.prototype.scalarMultiply=function(a){return G.isa(a,"num")?(this.x*=a,this.y*=a,this.z*=a,this):!1},b.prototype.scalarDivide=function(a){return G.isa(a,"num")&&0!==a?(this.x/=a,this.y/=a,this.z/=a,this):!1},b.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},b.prototype.checkNotZero=function(){return this.x||this.y||this.z?!0:!1},b.prototype.getVector=function(){return new b({x:this.x,y:this.y,z:this.z})},b.prototype.getConjugate=function(){return this.getReverse()},b.prototype.getVectorAdd=function(a,c){return G.isa(a,"obj")?(c=G.isa(c,"obj")&&"Vector"===c.type?c:this,new b({x:c.x+(a.x||0),y:c.y+(a.y||0),z:c.z+(a.z||0)})):!1},b.prototype.getVectorSubtract=function(a,c){return G.isa(a,"obj")?(c=G.isa(c,"obj")&&"Vector"===c.type?c:this,new b({x:c.x-(a.x||0),y:c.y-(a.y||0),z:c.z-(a.z||0)})):!1},b.prototype.getVectorMultiply=function(a,c){return G.isa(a,"obj")?(c=G.isa(c,"obj")&&"Vector"===c.type?c:this,new b({x:c.x*(a.x||1),y:c.y*(a.y||1),z:c.z*(a.z||1)})):!1},b.prototype.getVectorDivide=function(a,c){return G.isa(a,"obj")?(c=G.isa(c,"obj")&&"Vector"===c.type?c:this,new b({x:0!==(a.x||0)?c.x/(a.x||1):c.x,y:0!==(a.y||0)?c.y/(a.y||1):c.y,z:0!==(a.z||0)?c.z/(a.z||1):c.z})):!1},b.prototype.getScalarMultiply=function(a){return G.isa(a,"num")?new b({x:this.x*a,y:this.y*a,z:this.z*a}):!1},b.prototype.getScalarDivide=function(a){return G.isa(a,"num")?new b({x:this.x/a,y:this.y/a,z:this.z/a}):!1},b.prototype.getCrossProduct=function(a,c){if(G.isa(a,"obj")&&"Vector"===a.type){c=G.isa(c,"obj")&&"Vector"===c.type?c:this;var d=c.x||0,e=c.y||0,f=c.z||0,g=a.x||0,h=a.y||0,i=a.z||0;return new b({x:e*i-f*h,y:-(d*i)+f*g,z:d*h+e*g})}return!1},b.prototype.getDotProduct=function(a,b){return G.isa(a,"obj")&&"Vector"===a.type?(b=G.isa(b,"obj")&&"Vector"===b.type?b:this,(a.x||0)*(b.x||0)+(a.y||0)*(b.y||0)+(a.z||0)*(b.z||0)):!1},b.prototype.getTripleScalarProduct=function(a,b,c){if(G.isa(a,"obj")&&"Vector"===a.type&&G.isa(b,"obj")&&"Vector"===b.type){c=G.xt(c)?G.isa(c,"obj")?c:{}:this;var d=a.x||0,e=a.y||0,f=a.z||0,g=b.x||0,h=b.y||0,i=b.z||0,j=c.x||0,k=c.y||0,l=c.z||0;return d*(h*l-i*k)+e*(-(g*l)+i*j)+f*(g*k-h*j)}return!1},b.prototype.quaternionMultiply=function(a,b){if(G.isa(a,"obj")&&"Quaternion"===a.type){b=G.xt(b)?b:this.getMagnitude();var c=a.getConjugate(),d=a.getVectorMultiply(this);return d.quaternionMultiply(c),this.x=d.v.x,this.y=d.v.y,this.z=d.v.z,this.setMagnitudeTo(b),this}return!1},b.prototype.getQuaternionMultiply=function(a,b){if(G.isa(a,"obj")&&"Quaternion"===a.type){b=G.xt(b)?b:this.getMagnitude();var c=a.getConjugate(),d=a.getVectorMultiply(this);return d.quaternionMultiply(c),d.v.setMagnitudeTo(b),d.v}return!1},c.prototype=Object.create(Object.prototype),c.prototype.type="Quaternion",G.d.Quaternion={n:1,v:{x:0,y:0,z:0}},c.prototype.getMagnitude=function(){return Math.sqrt(this.n*this.n+this.v.x*this.v.x+this.v.y*this.v.y+this.v.z*this.v.z)},c.prototype.normalize=function(){var a=this.getMagnitude();return 0!==a&&(this.n/=a,this.v.x/=a,this.v.y/=a,this.v.z/=a),this},c.prototype.getNormal=function(){var a=this.getMagnitude();return 0!==a?new c({n:this.n/a,v:new b({x:this.v.x/a,y:this.v.y/a,z:this.v.z/a})}):!1},c.prototype.checkNormal=function(a){a=G.xt(a)?a:0;var b=this.n+this.v.x+this.v.y+this.v.z;return b>=1-a&&1+a>=b?!0:!1},c.prototype.getVector=function(){return this.v.getVector()},c.prototype.getScalar=function(){return this.n},c.prototype.quaternionAdd=function(a){return G.isa(a,"obj")&&"Quaternion"===a.type?(this.n+=a.n||0,this.v.x+=a.v.x||0,this.v.y+=a.v.y||0,this.v.z+=a.v.z||0,this):!1},c.prototype.quaternionSubtract=function(a){return G.isa(a,"obj")&&"Quaternion"===a.type?(this.n-=a.n||0,this.v.x-=a.v.x||0,this.v.y-=a.v.y||0,this.v.z-=a.v.z||0,this):!1},c.prototype.scalarMultiply=function(a){return G.isa(a,"num")?(this.n*=a,this.v.x*=a,this.v.y*=a,this.v.z*=a,this):!1},c.prototype.scalarDivide=function(a){return G.isa(a,"num")&&0!==a?(this.n/=a,this.v.x/=a,this.v.y/=a,this.v.z/=a,this):!1},c.prototype.getConjugate=function(){return new c({n:this.n,v:new b({x:-this.x,y:-this.y,z:-this.z})})},c.prototype.getQuaternionAdd=function(a){return G.isa(a,"obj")&&"Quaternion"===a.type?new c({n:this.n+a.n,v:new b({x:this.v.x+a.v.x,y:this.v.y+a.v.y,z:this.v.z+a.v.z})}):!1},c.prototype.getQuaternionSubtract=function(a){return G.isa(a,"obj")&&"Quaternion"===a.type?new c({n:this.n-a.n,v:new b({x:this.v.x-a.v.x,y:this.v.y-a.v.y,z:this.v.z-a.v.z})}):!1},c.prototype.getScalarMultiply=function(a){return G.isa(a,"num")?new c({n:this.n*a,v:new b({x:this.v.x*a,y:this.v.y*a,z:this.v.z*a})}):!1},c.prototype.getScalarDivide=function(a){return G.isa(a,"num")&&0!==a?new c({n:this.n/a,v:new b({x:this.v.x/a,y:this.v.y/a,z:this.v.z/a})}):!1},c.prototype.quaternionMultiply=function(a){if(G.isa(a,"obj")&&"Quaternion"===a.type){var b=this.n,c=this.v.x,d=this.v.y,e=this.v.z,f=a.n,g=a.v.x,h=a.v.y,i=a.v.z;return this.n=b*f-c*g-d*h-e*i,this.v.x=b*g+c*f+d*i-e*h,this.v.y=b*h+d*f+e*g-c*i,this.v.z=b*i+e*f+c*h-d*g,this}return!1},c.prototype.getQuaternionMultiply=function(a){if(G.isa(a,"obj")&&"Quaternion"===a.type){var d=this.n,e=this.v.x,f=this.v.y,g=this.v.z,h=a.n,i=a.v.x,j=a.v.y,k=a.v.z,l=new c({n:d*h-e*i-f*j-g*k,v:new b({x:d*i+e*h+f*k-g*j,y:d*j+f*h+g*i-e*k,z:d*k+g*h+e*j-f*i})});return l}return!1},c.prototype.getVectorMultiply=function(a){if(G.isa(a,"obj")&&"Vector"===a.type){var d=this.n,e=this.v.x,f=this.v.y,g=this.v.z,h=a.x,i=a.y,j=a.z,k=new c({n:-(e*h+f*i+g*j),v:new b({x:d*h+f*j-g*i,y:d*i+g*h-e*j,z:d*j+e*i-f*h})});return k}return!1},c.prototype.vectorMultiply=function(a){if(G.isa(a,"obj")&&"Vector"===a.type){var b=this.n,c=this.v.x,d=this.v.y,e=this.v.z,f=a.x,g=a.y,h=a.z;return this.n=-(c*f+d*g+e*h),this.v.x=b*f+d*h-e*g,this.v.y=b*g+e*f-c*h,this.v.z=b*h+c*g-d*f,this}return!1},c.prototype.getAngle=function(a){a=G.xt(a)?a:!1;var b=2*Math.acos(this.n);return a?b*(1/G.radian):b},c.prototype.getAxis=function(){var a=this.getVector(),b=this.getMagnitude();return 0!==b?a.scalarDivide(b):a},c.prototype.quaternionRotate=function(a){if(G.isa(a,"obj")&&"Quaternion"===a.type){var b=this.getConjugate(),c=this.getQuaternionMultiply(a);return c.quaternionMultiply(b)}return!1},c.prototype.vectorRotate=function(a){if(G.isa(a,"obj")&&"Vector"===a.type){var b=this.getConjugate(),c=this.getVectorMultiply(a),d=c.quaternionMultiply(b);return d.getVector()}return!1},c.prototype.makeQuaternion=function(a){a=G.isa(a,"obj")?a:{};var d=(a.pitch||a.x||0)*G.radian,e=(a.yaw||a.y||0)*G.radian,f=(a.roll||a.z||0)*G.radian,g=new c({n:Math.cos(d/2),v:new b({x:Math.sin(d/2)})}),h=new c({n:Math.cos(e/2),v:new b({y:Math.sin(e/2)})}),i=new c({n:Math.cos(f/2),v:new b({z:Math.sin(f/2)})}),j=h.getQuaternionMultiply(g),k=j.getQuaternionMultiply(i);return k.normalize(),k},c.prototype.getEulerAngles=function(){var a=this.n*this.n,b=this.v.x*this.v.x,c=this.v.y*this.v.y,d=this.v.z*this.v.z,e=a+b-c-d,f=2*(this.v.x*this.v.y+this.n*this.v.z),g=2*(this.v.x*this.v.z-this.n*this.v.y),h=2*(this.v.y*this.v.z+this.n*this.v.x),i=a-b-c+d,j=Math.abs(g),k=1/G.radian,l={};if(j>.999999){var m=2*(this.v.x*this.v.y-this.n*this.v.z),n=2*(this.v.x*this.v.z+this.n*this.v.y);l.pitch=0,l.yaw=-(Math.pi/2)*(g/j)*k,l.roll=Math.atan2(-m,-g*n)*k}else l.pitch=Math.atan2(h,i)*k,l.yaw=Math.asin(-g)*k,l.roll=Math.atan2(f,e)*k;return l},d.prototype=Object.create(a.prototype),d.prototype.type="SubScrawl",d.prototype.classname="objectnames",G.d.SubScrawl={start:{x:0,y:0,z:0},delta:{x:0,y:0,z:0},handle:{x:0,y:0,z:0},pivot:"",path:"",pathPlace:0,deltaPathPlace:0,scale:1,pathSpeedConstant:!0,pathRoll:0,addPathRoll:!1},G.mergeInto(G.d.SubScrawl,G.d.Scrawl),d.prototype.toString=function(){var a=Object.keys(G.d[this.type]),b={};b.type=this.type,b.classname=this.classname,b.name=this.name;for(var c=0,d=a.length;d>c;c++)G.contains(["start","delta","handle"],a[c])?this[a[c]].isLike(G.d[this.type][a[c]])||(b[a[c]]=this[a[c]]):G.xt(this[a[c]])&&this[a[c]]!==G.d[this.type][a[c]]&&(b[a[c]]=this[a[c]]);return JSON.stringify(b)},d.prototype.get=function(b){if(G.contains(["startX","startY","handleX","handleY","deltaX","deltaY"],b))switch(b){case"startX":return this.start.x;case"startY":return this.start.y;case"handleX":return this.handle.x;case"handleY":return this.handle.y;case"deltaX":return this.delta.x;case"deltaY":return this.delta.y}else{if(!G.contains(["start","handle","delta"],b))return a.prototype.get.call(this,b);switch(b){case"start":return this.start.getVector();case"handle":return this.handle.getVector();case"delta":return this.delta.getVector()}}},d.prototype.set=function(c){return c=G.xt(c)?c:{},a.prototype.set.call(this,c),this.start.type&&"Vector"===this.start.type||(this.start=new b(c.start||this.start)),G.xto([c.startX,c.startY])&&(this.start.x=G.xt(c.startX)?c.startX:this.start.x,this.start.y=G.xt(c.startY)?c.startY:this.start.y),this.delta.type&&"Vector"===this.delta.type||(this.delta=new b(c.delta||this.delta)),G.xto([c.deltaX,c.deltaY])&&(this.delta.x=G.xt(c.deltaX)?c.deltaX:this.delta.x,this.delta.y=G.xt(c.deltaY)?c.deltaY:this.delta.y),this.handle.type&&"Vector"===this.handle.type||(this.handle=new b(c.handle||this.handle)),G.xto([c.handleX,c.handleY])&&(this.handle.x=G.xt(c.handleX)?c.handleX:this.handle.x,this.handle.y=G.xt(c.handleY)?c.handleY:this.handle.y),this},d.prototype.setDelta=function(a){var b;return G.xto([a.start,a.startX,a.startY])&&(b=G.isa(a.start,"obj")?a.start:{},this.start.x+=G.xt(a.startX)?a.startX:G.xt(b.x)?b.x:this.start.x,this.start.y+=G.xt(a.startY)?a.startY:G.xt(b.y)?b.y:this.start.y),G.xto([a.delta,a.deltaX,a.deltaY])&&(b=G.isa(a.delta,"obj")?a.delta:{},this.delta.x+=G.xt(a.deltaX)?a.deltaX:G.xt(b.x)?b.x:this.delta.x,this.delta.y+=G.xt(a.deltaY)?a.deltaY:G.xt(b.y)?b.y:this.delta.y),G.xto([a.handle,a.handleX,a.handleY])&&G.isa(this.handle.x,"num")&&G.isa(this.handle.y,"num")&&(b=G.isa(a.handle,"obj")?a.handle:{},this.handle.x+=G.xt(a.handleX)?a.handleX:G.xt(b.x)?b.x:this.handle.x,this.handle.y+=G.xt(a.handleY)?a.handleY:G.xt(b.y)?b.y:this.handle.y),a.pathPlace&&(this.pathPlace+=a.pathPlace),a.deltaPathPlace&&(this.deltaPathPlace+=a.deltaPathPlace),a.scale&&(this.scale+=a.scale),this},d.prototype.clone=function(c){var d,e=a.prototype.clone.call(this,c);return d=G.isa(c.start,"obj")?c.start:{},e.start=new b({x:G.xt(c.startX)?c.startX:G.xt(d.x)?d.x:e.start.x,y:G.xt(c.startY)?c.startY:G.xt(d.y)?d.y:e.start.y}),d=G.isa(c.delta,"obj")?c.delta:{},e.delta=new b({x:G.xt(c.deltaX)?c.deltaX:G.xt(d.x)?d.x:e.delta.x,y:G.xt(c.deltaY)?c.deltaY:G.xt(d.y)?d.y:e.delta.y}),d=G.isa(c.handle,"obj")?c.handle:{},e.handle=new b({x:G.xt(c.handleX)?c.handleX:G.xt(d.x)?d.x:e.handle.x,y:G.xt(c.handleY)?c.handleY:G.xt(d.y)?d.y:e.handle.y}),e},d.prototype.updateStart=function(a){switch(a){case"x":this.start.x+=this.delta.x||0;break;case"y":this.start.y+=this.delta.y||0;break;case"path":this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1);break;default:this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1),this.start.vectorAdd(this.delta)}return this},d.prototype.revertStart=function(a){switch(a){case"x":this.start.x-=this.delta.x||0;break;case"y":this.start.y-=this.delta.y||0;break;case"path":this.pathPlace-=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1);break;default:this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1),this.start.vectorSubtract(this.delta)}return this},d.prototype.exchange=function(a,b){if(G.isa(a,"obj")){var c=this.get(b);this[b]=a.get(b),a[b]=c}return this},d.prototype.reverse=function(a){switch(a){case"deltaX":this.delta.x=-this.delta.x;break;case"deltaY":this.delta.y=-this.delta.y;break;case"delta":this.delta.reverse();break;case"deltaPathPlace":this.deltaPathPlace=-this.deltaPathPlace;break;default:this.deltaPathPlace=-this.deltaPathPlace,this.delta.reverse()}return this},d.prototype.getPivotOffsetVector=function(){var a=this.handle.getVector(),b=this.height||this.get("height"),c=this.width||this.get("width");if(G.isa(this.handle.x,"str")&&!G.contains(["left","center","right","top","bottom"],this.handle.x))a.x=parseFloat(this.handle.x)/100*c;else switch(this.handle.x){case"left":a.x=0;break;case"center":a.x=c/2;break;case"right":a.x=c}if(G.isa(this.handle.y,"str")&&!G.contains(["left","center","right","top","bottom"],this.handle.y))a.y=parseFloat(this.handle.y)/100*b;else switch(this.handle.y){case"top":a.y=0;break;case"center":a.y=b/2;break;case"bottom":a.y=b}return a},d.prototype.getOffsetStartVector=function(){var a=G.isa(this.handle.x,"str")?this.scale:1,b=G.isa(this.handle.y,"str")?this.scale:1,c=this.getPivotOffsetVector();return c.x*=a,c.y*=b,c.reverse()},d.prototype.getStartVector=function(){return console.log(this.name,".getStartVector() called - should use .start.getVector() instead",this.start),this.start.getVector()},d.prototype.getHandleVector=function(){return this.getPivotOffsetVector()},d.prototype.getDeltaVector=function(){return console.log(this.name,".getDeltaVector() called - should use .delta.getVector() instead",this.delta),this.delta.getVector()},e.prototype=Object.create(a.prototype),e.prototype.type="Scrawl3d",e.prototype.classname="objectnames",G.d.Scrawl3d={start:{x:0,y:0,z:0},delta:{x:0,y:0,z:0},translate:{x:0,y:0,z:0},width:300,height:150,handle:{x:"center",y:"center",z:0},pivot:"",stack:"",path:"",pathPlace:0,deltaPathPlace:0,scale:1,pathSpeedConstant:!0,pathRoll:0,addPathRoll:!1,lockX:!1,lockY:!1,rotation:{n:1,v:{x:0,y:0,z:0}},deltaRotation:{n:1,v:{x:0,y:0,z:0}},rotationTolerance:.001,visibility:!0},G.mergeInto(G.d.SubScrawl,G.d.Scrawl),e.prototype.toString=function(){var a,b=Object.keys(G.d[this.type]),c={};c.type=this.type,c.classname=this.classname,c.name=this.name;for(var d=0,e=b.length;e>d;d++)G.contains(["start","delta","handle","perspective","translate"],b[d])&&(this[b[d]].isLike(G.d[this.type][b[d]])||(c[b[d]]=this[b[d]])),"rotation"===b[d]&&(a=this.rotation.getEulerAngles(),0!==a.pitch&&(c.pitch=a.pitch),0!==a.yaw&&(c.yaw=a.yaw),0!==a.roll&&(c.roll=a.roll)),"deltaRotation"===b[d]?(a=this.rotation.getEulerAngles(),0!==a.pitch&&(c.deltaPitch=a.pitch),0!==a.yaw&&(c.deltaYaw=a.yaw),0!==a.roll&&(c.deltaRoll=a.roll)):G.xt(this[b[d]])&&this[b[d]]!==G.d[this.type][b[d]]&&(c[b[d]]=this[b[d]]);return JSON.stringify(c)},e.prototype.get=function(b){var c=this.getElement();if(G.contains(["startX","startY","handleX","handleY","deltaX","deltaY","translateX","translateY","translateZ"],b))switch(b){case"startX":return this.start.x;case"startY":return this.start.y;case"handleX":return this.handle.x;case"handleY":return this.handle.y;case"deltaX":return this.delta.x;case"deltaY":return this.delta.y;case"translateX":return this.translate.x;case"translateY":return this.translate.y;case"translateZ":return this.translate.z}else if(G.contains(["start","handle","delta","translate"],b))switch(b){case"start":return this.start.getVector();case"handle":return this.handle.getVector();case"delta":return this.delta.getVector();case"translate":return this.translate.getVector()}else{if(!G.contains(["width","height"],b))return"position"===b?c.style.position:"overflow"===b?c.style.overflow:"backfaceVisibility"===b?c.style.backfaceVisibility:a.prototype.get.call(this,b);switch(b){case"width":if(G.xt(this.width))return this.width;switch(this.type){case"Pad":return parseFloat(c.width)||G.d[this.type].width;default:return parseFloat(c.style.width)||parseFloat(c.clientWidth)||G.d[this.type].width
}break;case"height":if(G.xt(this.height))return this.height;switch(this.type){case"Pad":return parseFloat(c.height)||G.d[this.type].height;default:return parseFloat(c.style.height)||parseFloat(c.clientHeight)||G.d[this.type].height}}}},e.prototype.set=function(d){d=G.xt(d)?d:{};this.getElement();return a.prototype.set.call(this,d),this.start.type&&"Vector"===this.start.type||(this.start=new b(d.start||this.start)),G.xto([d.startX,d.startY])&&(this.start.x=G.xt(d.startX)?d.startX:this.start.x,this.start.y=G.xt(d.startY)?d.startY:this.start.y),this.delta.type&&"Vector"===this.delta.type||(this.delta=new b(d.delta||this.delta)),G.xto([d.deltaX,d.deltaY])&&(this.delta.x=G.xt(d.deltaX)?d.deltaX:this.delta.x,this.delta.y=G.xt(d.deltaY)?d.deltaY:this.delta.y),this.translate.type&&"Vector"===this.translate.type||(this.translate=new b(d.translate||this.translate)),G.xto([d.translateX,d.translateY,d.translateZ])&&(this.translate.x=G.xt(d.translateX)?d.translateX:this.translate.x,this.translate.y=G.xt(d.translateY)?d.translateY:this.translate.y,this.translate.z=G.xt(d.translateZ)?d.translateZ:this.translate.z),this.handle.type&&"Vector"===this.handle.type||(this.handle=new b(d.handle||this.handle)),G.xto([d.handleX,d.handleY])&&(this.handle.x=G.xt(d.handleX)?d.handleX:this.handle.x,this.handle.y=G.xt(d.handleY)?d.handleY:this.handle.y),G.xto([d.pitch,d.yaw,d.roll])&&(this.rotation=c.prototype.makeQuaternion({pitch:d.pitch||0,yaw:d.yaw||0,roll:d.roll||0})),G.xto([d.deltaPitch,d.deltaYaw,d.deltaRoll])&&(this.deltaRotation=c.prototype.makeQuaternion({pitch:d.deltaPitch||0,yaw:d.deltaYaw||0,roll:d.deltaRoll||0})),G.xto([d.width,d.height,d.scale])&&this.setDimensions(),G.xto([d.handleX,d.handleY,d.handle,d.width,d.height,d.scale])&&delete this.offset,G.xto([d.handleX,d.handleY,d.handle,d.width,d.height,d.scale,d.startX,d.startY,d.start])&&this.setDisplayOffsets(),G.xto([d.handleX,d.handleY,d.handle])&&this.setTransformOrigin(),G.xto([d.title,d.comment])&&this.setAccessibility(d),this.setStyles(d),this},e.prototype.setAccessibility=function(a){a=G.xt(a)?a:{};var b=this.getElement();return G.xt(a.title)&&(this.title=a.title,b.title=this.title),G.xt(a.comment)&&(this.comment=a.comment,b.setAttribute("data-comment",this.comment)),this},e.prototype.setStyles=function(a){a=G.xt(a)?a:{};var b=this.getElement();return G.xt(a.position)&&(b.style.position=a.position),G.xt(a.overflow)&&(b.style.overflow=a.overflow),G.xt(a.backfaceVisibility)&&(b.style.WebkitBackfaceVisibility=a.backfaceVisibility,b.style.mozBackfaceVisibility=a.backfaceVisibility,b.style.backfaceVisibility=a.backfaceVisibility),G.xt(a.margin)&&(b.style.margin=a.margin),G.xt(a.border)&&(b.style.border=a.border),G.xt(a.padding)&&(b.style.padding=a.padding),G.xt(a.visibility)&&(this.visibility=G.isa(a.visibility,"str")?G.contains(["hidden","none"],a.visibility)?!1:!0:a.visibility?!0:!1,this.stack?b.style.opacity=this.visibility?1:0:b.style.display=this.visibility?"block":"none"),this},e.prototype.setDelta=function(a){var b;return G.xto([a.start,a.startX,a.startY])&&(b=G.isa(a.start,"obj")?a.start:{},this.start.x+=G.xt(a.startX)?a.startX:G.xt(b.x)?b.x:0,this.start.y+=G.xt(a.startY)?a.startY:G.xt(b.y)?b.y:0),G.xto([a.delta,a.deltaX,a.deltaY])&&(b=G.isa(a.delta,"obj")?a.delta:{},this.delta.x+=G.xt(a.deltaX)?a.deltaX:G.xt(b.x)?b.x:0,this.delta.y+=G.xt(a.deltaY)?a.deltaY:G.xt(b.y)?b.y:0),G.xto([a.translate,a.translateX,a.translateY])&&(b=G.isa(a.translate,"obj")?a.translate:{},this.translate.x+=G.xt(a.translateX)?a.translateX:G.xt(b.x)?b.x:0,this.translate.y+=G.xt(a.translateY)?a.translateY:G.xt(b.y)?b.y:0,this.translate.z+=G.xt(a.translateZ)?a.translateZ:G.xt(b.z)?b.z:0),G.xto([a.handle,a.handleX,a.handleY])&&G.isa(this.handle.x,"num")&&G.isa(this.handle.y,"num")&&(b=G.isa(a.handle,"obj")?a.handle:{},this.handle.x+=G.xt(a.handleX)?a.handleX:G.xt(b.x)?b.x:0,this.handle.y+=G.xt(a.handleY)?a.handleY:G.xt(b.y)?b.y:0),a.pathPlace&&(this.pathPlace+=a.pathPlace),a.deltaPathPlace&&(this.deltaPathPlace+=a.deltaPathPlace),a.scale&&(this.scale+=a.scale),G.xto([a.pitch,a.yaw,a.roll])&&(b=c.prototype.makeQuaternion({pitch:a.pitch||0,yaw:a.yaw||0,roll:a.roll||0}),this.rotation.quaternionMultiply(b)),G.xto([a.deltaPitch,a.deltaYaw,a.deltaRoll])&&(b=c.prototype.makeQuaternion({pitch:a.deltaPitch||0,yaw:a.deltaYaw||0,roll:a.deltaRoll||0}),this.deltaRotation.quaternionMultiply(b)),G.xto([a.handleX,a.handleY,a.handle,a.width,a.height,a.scale])&&delete this.offset,G.xto([a.handleX,a.handleY,a.handle,a.width,a.height,a.scale,a.startX,a.startY,a.start])&&this.setDisplayOffsets(),G.xto([a.handleX,a.handleY,a.handle])&&this.setTransformOrigin(),G.xto([a.width,a.height,a.scale])&&this.setDimensions(),this},e.prototype.updateStart=function(a){switch(a){case"x":G.isa(this.start.x,"num")&&(this.start.x+=this.delta.x||0);break;case"y":G.isa(this.start.y,"num")&&(this.start.y+=this.delta.y||0);break;case"path":this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1);break;case"rotation":this.rotation=this.deltaRotation.getQuaternionMultiply(this.rotation);default:this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1),this.rotation=this.deltaRotation.getQuaternionMultiply(this.rotation),G.isa(this.start.x,"num")&&G.isa(this.start.y,"num")&&this.start.vectorAdd(this.delta)}return this.setDisplayOffsets(),this},e.prototype.revertStart=function(a){switch(a){case"x":this.start.x-=this.delta.x||0;break;case"y":this.start.y-=this.delta.y||0;break;case"rotation":this.rotation=this.deltaRotation.getConjugate().quaternionMultiply(this.rotation);case"path":this.pathPlace-=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1);break;default:this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1),this.rotation=this.deltaRotation.getConjugate().quaternionMultiply(this.rotation),this.start.vectorSubtract(this.delta)}return this.setDisplayOffsets(),this},e.prototype.reverse=function(a){switch(a){case"deltaX":this.delta.x=-this.delta.x;break;case"deltaY":this.delta.y=-this.delta.y;break;case"delta":this.delta.reverse();break;case"deltaPathPlace":this.deltaPathPlace=-this.deltaPathPlace;break;default:this.deltaPathPlace=-this.deltaPathPlace,this.delta.reverse()}return this},e.prototype.getPivotOffsetVector=function(){var a=this.handle.getVector(),b=this.height||this.get("height"),c=this.width||this.get("width");if(G.isa(a.x,"str")&&!G.contains(["left","center","right","top","bottom"],a.x))a.x=parseFloat(a.x)/100*c;else switch(a.x){case"left":a.x=0;break;case"center":a.x=c/2;break;case"right":a.x=c}if(G.isa(a.y,"str")&&!G.contains(["left","center","right","top","bottom"],a.y))a.y=parseFloat(a.y)/100*b;else switch(a.y){case"top":a.y=0;break;case"center":a.y=b/2;break;case"bottom":a.y=b}return a},e.prototype.getStartValues=function(){var a=this.start.getVector(),b=this.stack?G.stack[this.stack].get("height"):this.height||this.get("height"),c=this.stack?G.stack[this.stack].get("width"):this.width||this.get("width");if(G.isa(a.x,"str")&&!G.contains(["left","center","right","top","bottom"],a.x))a.x=parseFloat(a.x)/100*c;else switch(this.start.x){case"left":a.x=0;break;case"center":a.x=c/2;break;case"right":a.x=c}if(G.isa(a.y,"str")&&!G.contains(["left","center","right","top","bottom"],a.y))a.y=parseFloat(a.y)/100*b;else switch(this.start.y){case"top":a.y=0;break;case"center":a.y=b/2;break;case"bottom":a.y=b}return a},e.prototype.getOffsetStartVector=function(){var a=G.isa(this.handle.x,"str")?this.scale:1,b=G.isa(this.handle.y,"str")?this.scale:1,c=this.getPivotOffsetVector();return c.x*=a,c.y*=b,c.reverse()},e.prototype.renderElement=function(){var a=this.getElement(),b="",c=[];G.xt(this.offset)||(this.offset=this.getOffsetStartVector()),this.path?this.setStampUsingPath():this.pivot&&this.setStampUsingPivot(),this.updateStart(),1!==this.rotation.getMagnitude()&&this.rotation.normalize(),c.push(Math.round(this.translate.x*this.scale)),c.push(Math.round(this.translate.y*this.scale)),c.push(Math.round(this.translate.z*this.scale)),c.push(this.rotation.v.x),c.push(this.rotation.v.y),c.push(this.rotation.v.z),c.push(this.rotation.getAngle(!1));for(var d=0,e=c.length;e>d;d++)G.isBetween(c[d],1e-9,-1e-9)&&(c[d]=0);return b+="translate3d("+c[0]+"px,"+c[1]+"px,"+c[2]+"px) rotate3d("+c[3]+","+c[4]+","+c[5]+","+c[6]+"rad)",a.style.mozTransform=b,a.style.webkitTransform=b,a.style.msTransform=b,a.style.oTransform=b,a.style.transform=b,b=this.getStartValues(),a.style.left=b.x*this.scale+this.offset.x+"px",a.style.top=b.y*this.scale+this.offset.y+"px",this},e.prototype.setStampUsingPath=function(){var a,b;return G.contains(G.spritenames,this.path)&&"Shape"===G.sprite[this.path].type&&(a=G.sprite[this.path].getPerimeterPosition(this.pathPlace,this.pathSpeedConstant,this.addPathRoll),this.start.x=this.lockX?this.start.x:a.x,this.start.y=this.lockY?this.start.y:a.y,this.pathRoll=a.r||0,this.addPathRoll&&this.pathRoll&&(b=this.rotation.getEulerAngles(),this.setDelta({roll:this.pathRoll-b.roll}))),this},e.prototype.setStampUsingPivot=function(){var a,b,c,d,e;return G.contains(G.pointnames,this.pivot)?(b=G.point[this.pivot],d=G.sprite[b.sprite],c=b.getCurrentCoordinates().rotate(d.roll).vectorAdd(d.getStartValues()),this.start.x=this.lockX?this.start.x:c.x,this.start.y=this.lockY?this.start.y:c.y):G.contains(G.spritenames,this.pivot)?(b=G.sprite[this.pivot],c="Particle"===b.type?b.get("position"):b.get("start"),this.start.x=this.lockX?this.start.x:c.x,this.start.y=this.lockY?this.start.y:c.y):G.contains(G.padnames,this.pivot)?(b=G.pad[this.pivot],c=b.getStartValues(),this.start.x=this.lockX?this.start.x:c.x,this.start.y=this.lockY?this.start.y:c.y):G.contains(G.elementnames,this.pivot)?(b=G.element[this.pivot],c=b.getStartValues(),this.start.x=this.lockX?this.start.x:c.x,this.start.y=this.lockY?this.start.y:c.y):"mouse"===this.pivot&&this.stack&&(a=G.stack[this.stack].getMouse(),e=this.getStartValues(),G.xta([this.mouseX,this.mouseY])||(this.mouseX=e.x,this.mouseY=e.y),a.active&&(this.start.x=this.lockX?this.start.x:e.x+a.x-this.mouseX,this.start.y=this.lockY?this.start.y:e.y+a.y-this.mouseY,this.mouseX=a.x,this.mouseY=a.y)),this},e.prototype.setTransformOrigin=function(){var a=this.getElement(),b=G.isa(this.handle.x,"str")?this.handle.x:this.handle.x*this.scale+"px",c=G.isa(this.handle.y,"str")?this.handle.y:this.handle.y*this.scale+"px",d=b+" "+c;return a.style.mozTransformOrigin=d,a.style.webkitTransformOrigin=d,a.style.msTransformOrigin=d,a.style.oTransformOrigin=d,a.style.transformOrigin=d,this},e.prototype.setDisplayOffsets=function(){var a=0,b=0,c=this.getElement();if(c.offsetParent)do a+=c.offsetLeft,b+=c.offsetTop;while(c=c.offsetParent);return this.offset=this.getOffsetStartVector(),this.displayOffsetX=a,this.displayOffsetY=b,this},e.prototype.getMouse=function(){var a,c,d=new b,e=!1;return window.onmousemove||(window.onmousemove=G.handleMouseMove),a=this.displayOffsetX+this.width*this.scale,c=this.displayOffsetY+this.height*this.scale,G.mouseX>=this.displayOffsetX&&G.mouseX<=a&&G.mouseY>=this.displayOffsetY&&G.mouseY<=c&&(e=!0),d.x=e?(G.mouseX-this.displayOffsetX)*(1/this.scale):0,d.y=e?(G.mouseY-this.displayOffsetY)*(1/this.scale):0,d.active=e,d.source=this.name,d.type=this.type.toLowerCase(),d},e.prototype.scaleDimensions=function(a){return G.isa(a,"num")&&(this.scale=a,this.setDimensions()),this},e.prototype.setDimensions=function(){var a=this.getElement();switch(this.type){case"Pad":a.width=this.width*this.scale,a.height=this.height*this.scale;break;default:a.style.width=this.width*this.scale+"px",a.style.height=this.height*this.scale+"px"}return this},f.prototype=Object.create(e.prototype),f.prototype.type="Stack",f.prototype.classname="stacknames",G.d.Stack={perspective:{x:"center",y:"center",z:0}},G.mergeInto(G.d.Stack,G.d.Scrawl3d),f.prototype.getElement=function(){return G.stk[this.name]},f.prototype.set=function(a){return a=G.xt(a)?a:{},e.prototype.set.call(this,a),G.xto([a.perspective,a.perspectiveX,a.perspectiveY,a.perspectiveZ])&&(this.perspective.type&&"Vector"===this.perspective.type||(this.perspective=new b(a.perspective||this.perspective)),this.perspective.x=G.xt(a.perspectiveX)?a.perspectiveX:this.perspective.x,this.perspective.y=G.xt(a.perspectiveY)?a.perspectiveY:this.perspective.y,this.perspective.z=G.xt(a.perspectiveZ)?a.perspectiveZ:this.perspective.z,this.setPerspective()),this},f.prototype.addElementById=function(a){if(G.isa(a,"str")){var b=G.newElement({domElement:document.getElementById(a),stack:this.name});return G.stk[this.name].appendChild(G.elm[b.name]),G.elm[b.name]=document.getElementById(b.name),b}return!1},f.prototype.addElementsByClassName=function(a){if(G.isa(a,"str")){for(var b,c,d=[],e=document.getElementsByClassName(a),f=0,g=e.length;g>f;f++)c=e[f],"CANVAS"!==c.nodeName&&(b=G.newElement({domElement:c,stack:this.name}),d.push(b));for(var f=0,g=d.length;g>f;f++)G.stk[this.name].appendChild(G.elm[d[f].name]),G.elm[d[f].name]=document.getElementById(d[f].name);return d}return!1},f.prototype.renderElements=function(){for(var a,b=0,c=G.stacknames.length;c>b;b++)a=G.stack[G.stacknames[b]],a.stack===this.name&&a.renderElement();for(var b=0,c=G.padnames.length;c>b;b++)a=G.pad[G.padnames[b]],a.stack===this.name&&a.renderElement();for(var b=0,c=G.elementnames.length;c>b;b++)a=G.element[G.elementnames[b]],a.stack===this.name&&a.renderElement();return!0},f.prototype.parsePerspective=function(){var a=this.perspective.getVector(),b=this.height||this.get("height"),c=this.width||this.get("width");if(G.isa(this.perspective.x,"str")&&!G.contains(["left","center","right","top","bottom"],this.perspective.x))a.x=parseFloat(this.perspective.x)/100*c;else switch(this.perspective.x){case"left":a.x=0;break;case"center":a.x=c/2;break;case"right":a.x=c}if(G.isa(this.perspective.y,"str")&&!G.contains(["left","center","right","top","bottom"],this.perspective.y))a.y=parseFloat(this.perspective.y)/100*b;else switch(this.perspective.y){case"top":a.y=0;break;case"center":a.y=b/2;break;case"bottom":a.y=b}return a},f.prototype.setPerspective=function(){var a=G.isa(this.perspective.x,"str")?this.scale:1,b=G.isa(this.perspective.y,"str")?this.scale:1,c=this.parsePerspective(),d=this.getElement();c.x*=a,c.y*=b,c.z*=a,d.style.mozPerspectiveOrigin=c.x+"px "+c.y+"px",d.style.webkitPerspectiveOrigin=c.x+"px "+c.y+"px",d.style.perspectiveOrigin=c.x+"px "+c.y+"px",d.style.mozPerspective=c.z+"px",d.style.webkitPerspective=c.z+"px",d.style.perspective=c.z+"px"},f.prototype.scaleStack=function(a){if(G.isa(a,"num")&&"Stack"===this.type){for(var b=0,c=G.stacknames.length;c>b;b++)G.stack[G.stacknames[b]].stack===this.name&&G.stack[G.stacknames[b]].scaleStack(a);for(var b=0,c=G.elementnames.length;c>b;b++)G.element[G.elementnames[b]].stack===this.name&&G.element[G.elementnames[b]].scaleDimensions(a);for(var b=0,c=G.padnames.length;c>b;b++)G.pad[G.padnames[b]].stack===this.name&&G.pad[G.padnames[b]].scaleDimensions(a);this.scaleDimensions(a),"Stack"===this.type&&this.setPerspective()}return this},g.prototype=Object.create(e.prototype),g.prototype.type="Element",g.prototype.classname="elementnames",G.d.Element={},G.mergeInto(G.d.Element,G.d.Scrawl3d),g.prototype.getElement=function(){return G.elm[this.name]},h.prototype=Object.create(e.prototype),h.prototype.type="Pad",h.prototype.classname="padnames",G.d.Pad={drawOrder:[],cells:[],display:"",base:"",current:"",mouseX:0,mouseY:0,mouseOverPad:!1},G.mergeInto(G.d.Pad,G.d.Scrawl3d),h.prototype.toString=function(a){var b,c=Object.keys(G.d[this.type]),d={},e=[],f=[],g=[],h=[];d.type=this.type,d.classname=this.classname,d.name=this.name,d.parentElement=G.canvas[this.name].parentElement.id;for(var i=0,j=c.length;j>i;i++)G.contains(["start","delta","handle"],c[i])?this[c[i]].isLike(G.d[this.type][c[i]])||(d[c[i]]=this[c[i]]):G.xt(this[c[i]])&&this[c[i]]!==G.d[this.type][c[i]]&&(d[c[i]]=this[c[i]]);if(delete d.displayOffsetX,delete d.displayOffsetY,e.push(JSON.stringify(d)),!a){for(var i=0,j=this.cells.length;j>i;i++){for(var k=0,l=G.cell[this.cells[i]].groups.length;l>k;k++)G.pushUnique(f,G.cell[this.cells[i]].groups[k]);e.push(G.cell[this.cells[i]].toString(!0))}for(var i=0,j=f.length;j>i;i++){for(var k=0,l=G.group[f[i]].sprites.length;l>k;k++)G.pushUnique(g,G.group[f[i]].sprites[k]);e.push(G.group[f[i]].toString(!0))}for(var i=0,j=g.length;j>i;i++)b=G.ctx[G.sprite[g[i]].context],G.contains(G.designnames,b.fillStyle)&&G.pushUnique(h,b.fillStyle),G.contains(G.designnames,b.strokeStyle)&&G.pushUnique(h,b.strokeStyle),G.contains(G.designnames,b.shadowColor)&&G.pushUnique(h,b.shadowColor);for(var i=0,j=h.length;j>i;i++)e.push(G.design[h[i]].toString());for(var i=0,j=g.length;j>i;i++)e.push(G.sprite[g[i]].toString(!0))}return e},h.prototype.getElement=function(){return G.canvas[this.display]},h.prototype.set=function(a){if(e.prototype.set.call(this,a),a=G.isa(a,"obj")?a:{},this.setDrawOrder(a.drawOrder||this.get("drawOrder")),G.isa(a.scale,"num")&&(G.cell[this.display].scale=a.scale,this.scale=a.scale),G.xt(a.width)&&(G.cell[this.display].set({width:a.width}),this.width=a.width),G.xt(a.height)&&(G.cell[this.display].set({height:a.height}),this.height=a.height),G.xto([a.start,a.startX,a.startY,a.handle,a.handleX,a.handleY,a.scale,a.width,a.height])&&this.setDisplayOffsets(),G.xto([a.backgroundColor,a.globalAlpha,a.globalCompositeOperation])){var b=G.cell[this.base];G.cell[this.base].set({backgroundColor:a.backgroundColor?a.backgroundColor:b.backgroundColor,globalAlpha:a.globalAlpha?a.globalAlpha:b.globalAlpha,globalCompositeOperation:a.globalCompositeOperation?a.globalCompositeOperation:b.globalCompositeOperation})}return this},h.prototype.setDrawOrder=function(a){return this.drawOrder=G.xt(a)?[].concat(a):[],this},h.prototype.getCellsForDisplayAction=function(a){var b=[];if(G.isa(a,"arr"))b=a;else{for(var c=0,d=this.cells.length;d>c;c++)b.push(this.cells[c]);switch(a){case"all":break;case"display":b=[this.display];break;case"base":b=[this.base];break;case"non-base":G.removeItem(b,this.base);break;case"current":b=[this.current];break;case"non-current":G.removeItem(b,this.current);break;case"additionals":G.removeItem(b,this.display),G.removeItem(b,this.base);break;case"non-additionals":b=[this.display,this.base];break;case"none":b=[];break;default:G.removeItem(b,this.display)}}return b},h.prototype.clear=function(a){for(var b=this.getCellsForDisplayAction(a),c=0,d=b.length;d>c;c++)G.cell[b[c]].clear();return this},h.prototype.compile=function(a){for(var b=this.getCellsForDisplayAction(a),c=0,d=b.length;d>c;c++)G.cell[b[c]].compile();return this},h.prototype.stampBackground=function(a){for(var b=this.getCellsForDisplayAction(a),c=0,d=b.length;d>c;c++)G.cell[b[c]].stampBackground();return this},h.prototype.show=function(a){switch(a){case"wipe-base":G.cell[this.base].clear();break;case"wipe-both":G.cell[this.base].clear(),G.cell[this.display].clear();break;default:G.cell[this.display].clear()}if(this.drawOrder.length>0)for(var b=0,c=this.drawOrder.length;c>b;b++)G.cell[this.base].copyCellToSelf(G.cell[this.drawOrder[b]]);return G.cell[this.display].copyCellToSelf(G.cell[this.base],!0),this},h.prototype.render=function(a){return a=G.isa(a,"obj")?a:{},a.clear=G.xt(a.clear)?a.clear:null,a.compile=G.xt(a.compile)?a.compile:null,a.show=G.xt(a.show)?a.show:null,this.clear(a.clear),this.compile(a.compile),this.show(a.show),this},h.prototype.addNewCell=function(a){var b,c;return a=G.isa(a,"obj")?a:{},G.isa(a.name,"str")?(a.width=Math.round(a.width)||this.width,a.height=Math.round(a.height)||this.height,b=document.createElement("canvas"),b.setAttribute("id",a.name),b.setAttribute("height",a.height),b.setAttribute("width",a.width),a.pad=this.name,a.canvas=b,c=new i(a),G.pushUnique(this.cells,c.name),c):!1},h.prototype.addCells=function(a){a=[].concat(a);for(var b=0,c=a.length;c>b;b++)G.contains(G.cellnames,a[b])&&(this.cells.push(a[b]),this.drawOrder.push(a[b]));return this},h.prototype.deleteCell=function(a){return G.isa(a,"str")?(G.removeItem(this.cells,a),this.display===a&&(this.display=this.current),this.base===a&&(this.base=this.current),this.current===a&&(this.current=this.base),this):!1},h.prototype.makeCurrent=function(){return G.currentPad=this.name,this},h.prototype.buildFields=function(){for(var a=0,b=this.cells.length;b>a;a++)G.cell[this.cells[a]].buildField();return this},h.prototype.setAccessibility=function(a){a=G.xt(a)?a:{};var b=this.getElement();return G.xt(a.title)&&(this.title=a.title,b.title=this.title),G.xt(a.comment)&&(this.comment=a.comment,b.setAttribute("data-comment",this.comment),b.innerHTML="<p>"+this.comment+"</p>"),this},i.prototype=Object.create(d.prototype),i.prototype.type="Cell",i.prototype.classname="cellnames",G.d.Cell={pad:"",source:{x:0,y:0,z:0},sourceDelta:{x:0,y:0,z:0},sourceWidth:0,sourceHeight:0,sourceMaxWidth:0,sourceMaxHeight:0,sourceMinWidth:0,sourceMinHeight:0,targetWidth:0,targetHeight:0,actualWidth:0,actualHeight:0,lockTo:"",fieldLabel:"",globalAlpha:1,globalCompositeOperation:"source-over",backgroundColor:"rgba(0,0,0,0)",context:"",groups:[],usePadDimensions:!1,flipReverse:!1,flipUpend:!1,lockX:!1,lockY:!1,roll:0},G.mergeInto(G.d.Cell,G.d.SubScrawl),i.prototype.toString=function(a){var b,c=Object.keys(G.d[this.type]),d={},e=[],f=[],g=[];d.type=this.type,d.classname=this.classname,d.name=this.name;for(var h=0,i=c.length;i>h;h++)G.contains(["start","delta","handle","source","sourceDelta"],c[h])?this[c[h]].isLike(G.d[this.type][c[h]])||(d[c[h]]=this[c[h]]):G.xt(this[c[h]])&&this[c[h]]!==G.d[this.type][c[h]]&&(d[c[h]]=this[c[h]]);if(e.push(JSON.stringify(d)),!a){for(var h=0,i=this.groups.length;i>h;h++){for(var j=0,k=G.group[this.groups[h]].sprites.length;k>j;j++)G.pushUnique(f,G.group[this.groups[h]].sprites[j]);e.push(G.group[this.groups[h]].toString(!0))}for(var h=0,i=f.length;i>h;h++)b=G.ctx[G.sprite[f[h]].context],G.contains(G.designnames,b.fillStyle)&&G.pushUnique(g,b.fillStyle),G.contains(G.designnames,b.strokeStyle)&&G.pushUnique(g,b.strokeStyle),G.contains(G.designnames,b.shadowColor)&&G.pushUnique(g,b.shadowColor);for(var h=0,i=g.length;i>h;h++)e.push(G.design[g[h]].toString());for(var h=0,i=f.length;i>h;h++)e.push(G.sprite[f[h]].toString(!0))}return e},i.prototype.get=function(a){if(G.contains(["targetX","targetY","sourceX","sourceY","sourceDeltaX","sourceDeltaY"],a))switch(a){case"targetX":return this.start.x;case"targetY":return this.start.y;case"sourceX":return this.source.x;case"sourceY":return this.source.y;case"sourceDeltaX":return this.sourceDelta.x;case"sourceDeltaY":return this.sourceDelta.y}else if(G.contains(["target","source","sourceDelta"],a))switch(a){case"target":return this.start.getVector();case"source":return this.source.getVector();case"sourceDelta":return this.sourceDelta.getVector()}else{if(!G.contains(["width","height"],a))return d.prototype.get.call(this,a);switch(a){case"width":return this.usePadDimensions?this.getPadWidth():this.actualWidth;case"height":return this.usePadDimensions?this.getPadHeight():this.actualHeight}}},i.prototype.set=function(a){var b;return d.prototype.set.call(this,a),a=G.isa(a,"obj")?a:{},G.xto([a.target,a.targetX,a.targetY])&&(b=G.xt(a.target)?a.target:{},this.start.x=a.targetX||b.x||this.start.x,this.start.y=a.targetY||b.y||this.start.y),G.xto([a.source,a.sourceX,a.sourceY])&&(b=G.xt(a.source)?a.source:{},this.source.x=a.sourceX||b.x||this.source.x,this.source.y=a.sourceY||b.y||this.source.y),G.xto([a.sourceDelta,a.sourceDeltaX,a.sourceDeltaY])&&(b=G.xt(a.sourceDelta)?a.sourceDelta:{},this.sourceDelta.x=a.sourceDeltaX||b.x||this.sourceDelta.x,this.sourceDelta.y=a.sourceDeltaY||b.y||this.sourceDelta.y),G.xto([a.sourceWidth,a.sourceHeight,a.targetWidth,a.targetHeight,a.width,a.height])&&(this.sourceWidth=a.sourceWidth||a.width||this.sourceWidth,this.sourceHeight=a.sourceHeight||a.height||this.sourceHeight,this.targetWidth=a.targetWidth||a.width||this.targetWidth,this.targetHeight=a.targetHeight||a.height||this.targetHeight),G.xto([a.width,a.height,a.actualWidth,a.actualHeight])&&(this.actualWidth=a.actualWidth||a.width||this.actualWidth,this.actualHeight=a.actualHeight||a.height||this.actualHeight,this.setDimensions(a)),this},i.prototype.setDelta=function(a){var b;return d.prototype.setDelta.call(this,a),G.xto([a.source,a.sourceX,a.sourceY])&&(b=G.xt(a.source)?a.source:{},this.source.x+=a.sourceX||b.x||0,this.source.y+=a.sourceY||b.y||0),G.xto([a.sourceDelta,a.sourceDeltaX,a.sourceDeltaY])&&(b=G.xt(a.sourceDelta)?a.sourceDelta:{},this.sourceDelta.x+=a.sourceDeltaX||b.x||0,this.sourceDelta.y+=a.sourceDeltaY||b.y||0),G.xto([a.sourceWidth,a.sourceHeight])&&(this.sourceWidth+=a.sourceWidth||0,this.sourceHeight+=a.sourceHeight||0),G.xto([a.target,a.targetX,a.targetY])&&(b=G.xt(a.target)?a.target:{},this.start.x+=a.targetX||b.x||0,this.start.y+=a.targetY||b.y||0),G.xto([a.targetWidth,a.targetHeight])&&(this.targetWidth+=a.targetWidth||0,this.targetHeight+=a.targetHeight||0),G.xt(a.globalAlpha)&&(this.globalAlpha+=a.globalAlpha),this},i.prototype.getPadWidth=function(){return G.pad[this.pad].get("width")},i.prototype.getPadHeight=function(){return G.pad[this.pad].get("height")},i.prototype.updateStart=function(a){switch(a){case"x":this.start.x+=this.delta.x||0,this.source.x+=this.deltaSource.x||0;break;case"y":this.start.y+=this.delta.y||0,this.source.y+=this.deltaSource.y||0;break;case"start":case"target":this.start.vectorAdd(this.delta);break;case"source":this.source.vectorAdd(this.sourceDelta);break;case"path":this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1);break;default:this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1),this.start.vectorAdd(this.delta),this.source.vectorAdd(this.sourceDelta)}return this},i.prototype.revertStart=function(a){switch(a){case"x":this.start.x-=this.delta.x||0,this.source.x-=this.deltaSource.x||0;break;case"y":this.start.y-=this.delta.y||0,this.source.y-=this.deltaSource.y||0;break;case"start":case"target":this.start.vectorSubtract(this.delta);break;case"source":this.source.vectorSubtract(this.sourceDelta);break;case"path":this.pathPlace-=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1);break;default:this.pathPlace-=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1),this.start.vectorSubtract(this.delta),this.source.vectorSubtract(this.sourceDelta)}return this},i.prototype.getPivotOffsetVector=function(){var a=this.handle.getVector(),b=this.targetHeight||this.get("height"),c=this.targetWidth||this.get("width");if(G.isa(this.handle.x,"str")&&!G.contains(["left","center","right","top","bottom"],this.handle.x))a.x=parseFloat(this.handle.x)/100*c;else switch(this.handle.x){case"left":a.x=0;break;case"center":a.x=c/2;break;case"right":a.x=c}if(G.isa(this.handle.y,"str")&&!G.contains(["left","center","right","top","bottom"],this.handle.y))a.y=parseFloat(this.handle.y)/100*b;else switch(this.handle.y){case"top":a.y=0;break;case"center":a.y=b/2;break;case"bottom":a.y=b}return a},i.prototype.zoom=function(a){if(G.isa(a,"num")){var b,c,d=this.sourceWidth,e=this.sourceHeight,f=this.actualWidth,g=this.actualHeight,h=this.get("sourceMinWidth")||this.sourceWidth,i=this.get("sourceMinHeight")||this.sourceHeight,j=this.get("sourceMaxWidth")||this.sourceWidth,k=this.get("sourceMaxHeight")||this.sourceHeight,l=this.source.x,m=this.source.y,n=d+a,o=e+a;G.isBetween(n,h,j,!0)&&G.isBetween(o,i,k,!0)&&(d=n,b=l-a/2,l=0>b?0:b>f-d?f-d:b,e=o,c=m-a/2,m=0>c?0:c>g-e?g-e:c,this.source.x=l,this.source.y=m,this.sourceWidth=d,this.sourceHeight=e)}return this},i.prototype.buildField=function(){var a,b,c=[],d=[],e="",f=new q({width:this.actualWidth,height:this.actualHeight,group:this.name});f.stamp(),G.deleteSprite(f.name),c=G.group[this.name+"_field"].sprites;for(var g=0,h=c.length;h>g;g++)e=G.sprite[c[g]],a=G.ctx[e.context].fillStyle,b=G.ctx[e.context].strokeStyle,G.ctx[e.context].fillStyle="rgba(255,255,255,1)",G.ctx[e.context].strokeStyle="rgba(255,255,255,1)",e.forceStamp("fillDraw",this.name),G.ctx[e.context].fillStyle=a,G.ctx[e.context].strokeStyle=b;d=G.group[this.name+"_fence"].sprites;for(var g=0,h=d.length;h>g;g++)e=G.sprite[d[g]],a=G.ctx[e.context].fillStyle,b=G.ctx[e.context].strokeStyle,G.ctx[e.context].fillStyle="rgba(0,0,0,1)",G.ctx[e.context].strokeStyle="rgba(0,0,0,1)",e.forceStamp("fillDraw",this.name),G.ctx[e.context].fillStyle=a,G.ctx[e.context].strokeStyle=b;return this.set({fieldLabel:this.getImageData({name:"field"})}),this},i.prototype.checkFieldAt=function(a){a=G.isa(a,"obj")?a:!1;var b,c,d,e,f=a.channel||"anycolor",g=a.test||0,h=a.coordinates?a.coordinates:[{x:a.x||0,y:a.y||0}],i=this.get("fieldLabel");e=G.imageData[i];for(var j=0,k=h.length;k>j;j++){if(b=Math.round(h[j].x),c=Math.round(h[j].y),!G.isBetween(b,0,e.width,!0)||!G.isBetween(c,0,e.height,!0))return!1;switch(d=4*(c*e.width+b),f){case"red":if(e.data[d]<=g)return h[j];break;case"green":if(e.data[d+1]<=g)return h[j];break;case"blue":if(e.data[d+2]<=g)return h[j];break;case"alpha":if(e.data[d+3]<=g)return h[j];break;case"anycolor":if(e.data[d]<=g||e.data[d+1]<=g||e.data[d+2]<=g)return h[j]}}return!0},i.prototype.setEngine=function(a){if(!a.fastStamp){var b,c,d,e,f=G.ctx[this.context],g=G.ctx[a.context],h=g.getChanges(f,a.scale,a.scaleOutline);if(h){delete h.count,b=G.context[this.name];for(var i in h){if(e=!1,i[0]<"m")if(i[0]<"l")switch(i){case"fillStyle":G.xt(G.design[h[i]])?(e=G.design[h[i]],G.contains(["Gradient","RadialGradient"],e.type)&&e.update(a.name,this.name),c=e.getData()):c=h[i],b.fillStyle=c;break;case"font":b.font=h[i];break;case"globalAlpha":b.globalAlpha=h[i];break;case"globalCompositeOperation":b.globalCompositeOperation=h[i]}else switch(i){case"lineCap":b.lineCap=h[i];break;case"lineDash":b.mozDash=h[i],b.lineDash=h[i];try{b.setLineDash(h[i])}catch(j){}break;case"lineDashOffset":b.mozDashOffset=h[i],b.lineDashOffset=h[i];break;case"lineJoin":b.lineJoin=h[i];break;case"lineWidth":b.lineWidth=h[i]}else if("s"==i[0])switch(i){case"shadowBlur":b.shadowBlur=h[i];break;case"shadowColor":b.shadowColor=h[i];break;case"shadowOffsetX":b.shadowOffsetX=h[i];break;case"shadowOffsetY":b.shadowOffsetY=h[i];break;case"strokeStyle":G.xt(G.design[h[i]])?(e=G.design[h[i]],G.contains(["Gradient","RadialGradient"],e.type)&&e.update(a.name,this.name),d=e.getData()):d=h[i],b.strokeStyle=d}else switch(i){case"miterLimit":b.miterLimit=h[i];break;case"textAlign":b.textAlign=h[i];break;case"textBaseline":b.textBaseline=h[i];break;case"winding":b.mozFillRule=h[i],b.msFillRule=h[i]}f[i]=h[i]}}}return a},i.prototype.clear=function(){var a=G.context[this.name];return a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,this.actualWidth,this.actualHeight),this},i.prototype.compile=function(){"rgba(0,0,0,0)"!==this.get("backgroundColor")&&this.stampBackground(),this.groups.sort(function(a,b){return G.group[a].order-G.group[b].order});for(var a=0,b=this.groups.length;b>a;a++)G.group[this.groups[a]].get("visibility")&&G.group[this.groups[a]].stamp(!1,this.name);return this},i.prototype.stampBackground=function(){var a=G.context[this.name],b=this.get("backgroundColor"),c=this.actualWidth,d=this.actualHeight,e=a.fillStyle;return a.setTransform(1,0,0,1,0,0),a.fillStyle=b,a.fillRect(0,0,c,d),a.fillStyle=e,this},i.prototype.setStampUsingPivot=function(){var a,b,c,d,e,f;return G.contains(G.pointnames,this.pivot)?(b=G.point[this.pivot],d=G.sprite[b.sprite],c=b.getCurrentCoordinates().rotate(d.roll).vectorAdd(d.start),this.start.x=this.lockX?this.start.x:c.x,this.start.y=this.lockY?this.start.y:c.y):G.contains(G.spritenames,this.pivot)?(b=G.sprite[this.pivot],c="Particle"===b.type?b.get("position"):b.start.getVector(),this.start.x=this.lockX?this.start.x:c.x,this.start.y=this.lockY?this.start.y:c.y):"mouse"===this.pivot&&(e=G.pad[this.pad],f=G.cell[e.base],a=e.getMouse(),e.width!==f.actualWidth&&(a.x/=e.width/f.actualWidth),e.height!==f.actualHeight&&(a.y/=e.height/f.actualHeight),G.xta([this.mouseX,this.mouseY])||(this.mouseX=this.start.x,this.mouseY=this.start.y),a.active&&(this.start.x=this.lockX?this.start.x:this.start.x+a.x-this.mouseX,this.start.y=this.lockY?this.start.y:this.start.y+a.y-this.mouseY,this.mouseX=a.x,this.mouseY=a.y)),this
},i.prototype.rotateDestination=function(a){var b=this.flipReverse?-1:1,c=this.flipUpend?-1:1,d=this.addPathRoll?(this.roll+this.pathRoll)*G.radian:this.roll*G.radian,e=Math.cos(d),f=Math.sin(d);return a.setTransform(e*b,f*b,-f*c,e*c,this.start.x,this.start.y),this},i.prototype.prepareToCopyCell=function(a){var b;return this.offset||(this.offset=this.getOffsetStartVector()),this.pivot?this.setStampUsingPivot():G.contains(G.spritenames,this.path)&&"Shape"===G.sprite[this.path].type&&(b=G.sprite[this.path].getPerimeterPosition(this.pathPlace,this.pathSpeedConstant,this.addPathRoll),this.start.x=this.lockX?this.start.x:b.x,this.start.y=this.lockY?this.start.y:b.y,this.pathRoll=b.r||0),this.rotateDestination(a),this},i.prototype.copyCellToSelf=function(a,b){a=G.isa(a,"str")?G.cell[a]:a,b=G.xt(b)?b:!1;var c=a.get("lockTo"),d=c?G.cell[c]:a;if(G.xt(d)){var e=d.usePadDimensions,f=G.pad[d.pad],g=f.width,h=f.height,i=b?f.scale:this.scale,j=d.source.x||this.source.x,k=d.source.y||this.source.y,l=d.sourceWidth||this.sourceWidth,m=d.sourceHeight||this.sourceHeight,n=e?g*i:d.targetWidth*i,o=e?h*i:d.targetHeight*i,p=G.context[this.name],q=G.ctx[this.name],r=d.get("globalAlpha"),s=q.get("globalAlpha"),t=d.get("globalCompositeOperation"),u=q.get("globalCompositeOperation");r!==s&&(p.globalAlpha=r,q.set({globalAlpha:r})),t!==u&&(p.globalCompositeOperation=t,q.set({globalCompositeOperation:t})),G.context[d.name].setTransform(1,0,0,1,0,0),d.prepareToCopyCell(p),p.drawImage(G.canvas[d.name],j,k,l,m,d.offset.x,d.offset.y,n,o)}return this},i.prototype.clearShadow=function(){var a=G.context[this.name],b=G.ctx[this.context];return a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0,b.set({shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0}),this},i.prototype.restoreShadow=function(a){var b=G.context[this.name],c=G.ctx[this.context],d=G.ctx[a],e=d.get("shadowOffsetX"),f=d.get("shadowOffsetY"),g=d.get("shadowBlur");return b.shadowOffsetX=e,b.shadowOffsetY=f,b.shadowBlur=g,c.set({shadowOffsetX:e,shadowOffsetY:f,shadowBlur:g}),this},i.prototype.setToClearShape=function(){var a=G.context[this.name],b=G.ctx[this.context];return a.fillStyle="rgba(0, 0, 0, 0)",a.strokeStyle="rgba(0, 0, 0, 0)",a.shadowColor="rgba(0, 0, 0, 0)",b.set({fillStyle:"rgba(0, 0, 0, 0)",strokeStyle:"rgba(0, 0, 0, 0)",shadowColor:"rgba(0, 0, 0, 0)"}),this},i.prototype.setDimensions=function(b){var c,d;return G.xt(b)&&!this.usePadDimensions?(c=b.width||b.actualWidth||this.actualWidth,d=b.height||b.actualHeight||this.actualHeight):(c=this.getPadWidth(),d=this.getPadHeight()),G.canvas[this.name].width=c,G.canvas[this.name].height=d,a.prototype.set.call(this,{actualWidth:c,actualHeight:d}),this},i.prototype.saveContext=function(){return G.context[this.name].save(),this},i.prototype.restoreContext=function(){return G.context[this.name].restore(),this},i.prototype.getImageData=function(a){a=G.isa(a,"obj")?a:{};var b=G.isa(a.name,"str")?this.name+"_"+a.name:this.name+"_imageData",c=G.isa(a.x,"num")?a.x:0,d=G.isa(a.y,"num")?a.y:0,e=G.isa(a.width,"num")?a.width:this.actualWidth,f=G.isa(a.height,"num")?a.height:this.actualHeight;return G.imageData[b]=G.context[this.name].getImageData(c,d,e,f),b},i.prototype.spliceCell=function(a){if(a=G.isa(a,"obj")?a:{},G.contains(["horizontal","vertical","top","bottom","left","right"],a.edge)){var b,c,d,e,f,g=this.actualHeight,h=this.actualWidth,i=G.canvas[this.name],j=G.context[this.name];switch(e=document.createElement("canvas"),e.width=h,e.height=g,f=e.getContext("2d"),j.setTransform(1,0,0,1,0,0),a.edge){case"horizontal":b=c=h/2,d="left";break;case"vertical":b=c=g/2,d="top";break;case"top":case"bottom":b=a.strip||20,c=g-b,d=a.edge;break;case"left":case"right":b=a.strip||20,c=h-b,d=a.edge}switch(d){case"top":f.drawImage(i,0,0,h,b,0,c,h,b),f.drawImage(i,0,b,h,c,0,0,h,c);break;case"bottom":f.drawImage(i,0,0,h,c,0,b,h,c),f.drawImage(i,0,c,h,b,0,0,h,b);break;case"left":f.drawImage(i,0,0,b,g,c,0,b,g),f.drawImage(i,b,0,c,g,0,0,c,g);break;case"right":f.drawImage(i,0,0,c,g,b,0,c,g),f.drawImage(i,c,0,b,g,0,0,b,g)}j.clearRect(0,0,h,g),j.drawImage(e,0,0,h,g)}return this},j.prototype=Object.create(a.prototype),j.prototype.type="Context",j.prototype.classname="ctxnames",G.d.Context={fillStyle:"#000000",winding:"nonzero",strokeStyle:"#000000",globalAlpha:1,globalCompositeOperation:"source-over",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",font:"10pt sans-serif",textAlign:"start",textBaseline:"alphabetic"},G.contextKeys=Object.keys(G.d.Context),G.mergeInto(G.d.Context,G.d.Scrawl),j.prototype.toString=function(){for(var a={},b=0,c=G.contextKeys.length;c>b;b++)"lineDash"===G.contextKeys[b]?G.xt(this.lineDash)&&this.lineDash.length>0&&(a.lineDash=this.lineDash):G.xt(this[G.contextKeys[b]])&&this[G.contextKeys[b]]!==G.d.Context[G.contextKeys[b]]&&(a[G.contextKeys[b]]=this[G.contextKeys[b]]);return JSON.stringify(a)},j.prototype.setDelta=function(a){return a=G.isa(a,"obj")?a:{},G.xt(a.lineDashOffset)&&(G.xt(this.lineDashOffset)||(this.lineDashOffset=G.d.Context.lineDashOffset),this.lineDashOffset+=a.lineDashOffset),G.xt(a.lineWidth)&&(G.xt(this.lineWidth)||(this.lineWidth=G.d.Context.lineWidth),this.lineWidth+=a.lineWidth),G.xt(a.globalAlpha)&&(G.xt(this.globalAlpha)||(this.globalAlpha=G.d.Context.globalAlpha),this.globalAlpha+=a.globalAlpha),this},j.prototype.getContextFromEngine=function(a){for(var b=0,c=G.contextKeys.length;c>b;b++)this[G.contextKeys[b]]=a[G.contextKeys[b]];return this.winding=a.mozFillRule||a.msFillRule||"nonzero",this.lineDash=a.lineDash||[],this.lineDashOffset=a.mozDashOffset||a.lineDashOffset||0,this},j.prototype.getChanges=function(a,b,c){for(var d,e,f={},g=0,h=0,i=G.contextKeys.length;i>h;h++)if(d=this.get(G.contextKeys[h]),G.contains(["lineWidth","shadowOffsetX","shadowOffsetY","shadowBlur"],G.contextKeys[h]))c?d*b!==a[G.contextKeys[h]]&&(f[G.contextKeys[h]]=d*b,g++):d!==a[G.contextKeys[h]]&&(f[G.contextKeys[h]]=d,g++);else if(G.contains(["fillStyle","strokeStyle","shadowColor"],G.contextKeys[h])&&G.contains(G.designnames,d)&&"Color"===G.design[d].type)e=G.design[d].getData(),e!==a[G.contextKeys[h]]&&(f[G.contextKeys[h]]=e,g++);else if(G.contains(["fillStyle","strokeStyle"],G.contextKeys[h])&&G.contains(G.designnames,d)&&G.contains(["Gradient","RadialGradient"],G.design[d].type)&&G.design[d].autoUpdate)f[G.contextKeys[h]]=d,g++;else if(G.contains(["lineDash"],G.contextKeys[h])&&G.xt(a.lineDash)){if(d.length!==a.lineDash.length)f.lineDash=d,g++;else for(var j=0,k=d.length;k>j;j++)if(d[j]!==a.lineDash[j]){f.lineDash=d,g++;break}}else G.contains(["name","timestamp"],G.contextKeys[h])||d!==a[G.contextKeys[h]]&&(f[G.contextKeys[h]]=d,g++);return g>0?f:!1},k.prototype=Object.create(a.prototype),k.prototype.type="ScrawlImage",k.prototype.classname="imagenames",G.d.ScrawlImage={width:0,height:0,source:""},G.mergeInto(G.d.ScrawlImage,G.d.Scrawl),k.prototype.makeImage=function(a){var b=document.createElement("img");return b.width=this.width,b.height=this.height,b.src=a,b},k.prototype.getImageDataUrl=function(a,b){return b=G.xt(b)?b:!1,G.cv.width=this.width,G.cv.height=this.height,b?G.cvx.putImageData(a,0,0):G.cvx.drawImage(a,0,0),G.cv.toDataURL()},k.prototype.getImageData=function(a){a=G.xt(a)?a:!1;var b;return G.isa(a,"bool")?(b=a?G.object[this.source]:G.img[this.name],G.cv.width=this.width,G.cv.height=this.height,G.cvx.drawImage(b,0,0),G.cvx.getImageData(0,0,this.width,this.height)):a},k.prototype.clone=function(b){return b=G.isa(b,"obj")?b:{},b.element=G.xt(G.img[this.name])?G.img[this.name]:G.object[this.source],b.makeCopy=!0,a.prototype.clone.call(this,b)},k.prototype.grayscale=function(a){a=G.isa(a,"obj")?a:{};var b,c,d=G.xt(a.value)?a.value:1,e=G.xt(a.useSourceData)?a.useSourceData:!1,f=a.use||this.getImageData(e),g=f.data,h=G.xt(a.save)?a.save:!0;d=G.isa(d,"str")?parseFloat(d)/100:d,d=G.isBetween(d,0,1,!0)?d:d>.5?1:0;for(var i=0,j=g.length;j>i;i+=4)b=Math.floor(.2126*g[i]+.7152*g[i+1]+.0722*g[i+2]),g[i]=g[i]+(b-g[i])*d,g[i+1]=g[i+1]+(b-g[i+1])*d,g[i+2]=g[i+2]+(b-g[i+2])*d;return h&&(c=this.getImageDataUrl(f,!0),G.img[this.name]=this.makeImage(c)),f},k.prototype.sharpen=function(a){a=G.isa(a,"obj")?a:{};var b,c,d,e=G.xt(a.value)?a.value:1,f=G.xt(a.useSourceData)?a.useSourceData:!1,g=a.use||this.getImageData(f),h=G.xt(a.save)?a.save:!0;return e=G.isa(e,"str")?parseFloat(e)/100:e,b=this.matrix({useSourceData:f,data:[0,-1,0,-1,5,-1,0,-1,0],save:!1}),c=this.mergeImages({image1:g,image2:b,value:e}),h&&(d=this.getImageDataUrl(c,!0),G.img[this.name]=this.makeImage(d)),c},k.prototype.mergeImages=function(a){if(G.isa(a,"obj")&&G.xta([a.image1,a.image2,a.value])){var b=a.image1,c=b.data,d=a.image2,e=d.data,f=a.value;if(0===f)return b;if(1===f)return d;for(var g=0,h=c.length;h>g;g+=4)c[g]=c[g]*(1-f)+e[g]*f,c[g+1]=c[g+1]*(1-f)+e[g+1]*f,c[g+2]=c[g+2]*(1-f)+e[g+2]*f;return b}return!1},k.prototype.invert=function(a){a=G.isa(a,"obj")?a:{};var b,c=G.xt(a.value)?a.value:1,d=G.xt(a.useSourceData)?a.useSourceData:!1,e=a.use||this.getImageData(d),f=e.data,g=G.xt(a.save)?a.save:!0;c=G.isa(c,"str")?parseFloat(c)/100:c,c=G.isBetween(c,0,1,!0)?c:c>.5?1:0;for(var h=0,i=f.length;i>h;h+=4)f[h]=f[h]*(1-c)+(255-f[h])*c,f[h+1]=f[h+1]*(1-c)+(255-f[h+1])*c,f[h+2]=f[h+2]*(1-c)+(255-f[h+2])*c;return g&&(b=this.getImageDataUrl(e,!0),G.img[this.name]=this.makeImage(b)),e},k.prototype.brightness=function(a){a=G.isa(a,"obj")?a:{};var b,c=G.xt(a.value)?a.value:1,d=a.use||G.xt(a.useSourceData)?a.useSourceData:!1,e=this.getImageData(d),f=e.data,g=G.xt(a.save)?a.save:!0;c=G.isa(c,"str")?parseFloat(c)/100:c,c=0>c?0:c;for(var h=0,i=f.length;i>h;h+=4)f[h]=f[h]*c,f[h+1]=f[h+1]*c,f[h+2]=f[h+2]*c;return g&&(b=this.getImageDataUrl(e,!0),G.img[this.name]=this.makeImage(b)),e},k.prototype.saturation=function(a){a=G.isa(a,"obj")?a:{};var b,c=G.xt(a.value)?a.value:1,d=a.use||G.xt(a.useSourceData)?a.useSourceData:!1,e=this.getImageData(d),f=e.data,g=G.xt(a.save)?a.save:!0;c=G.isa(c,"str")?parseFloat(c)/100:c,c=0>c?0:c;for(var h=0,i=f.length;i>h;h+=4)f[h]=127+(f[h]-127)*c,f[h+1]=127+(f[h+1]-127)*c,f[h+2]=127+(f[h+2]-127)*c;return g&&(b=this.getImageDataUrl(e,!0),G.img[this.name]=this.makeImage(b)),e},k.prototype.threshold=function(a){a=G.isa(a,"obj")?a:{};var b,c,d,e=G.xt(a.value)?a.value:.5,f=G.xt(a.save)?a.save:!0;e=G.isa(e,"str")?parseFloat(e)/100:e,e=G.isBetween(e,0,1,!0)?e:e>.5?1:0,e*=255,d=this.grayscale({useSourceData:a.useSourceData,use:a.use,save:!1}),b=this.getImageData(d),c=b.data;for(var g=0,h=c.length;h>g;g+=4)c[g]=c[g]>e?255:0,c[g+1]=c[g+1]>e?255:0,c[g+2]=c[g+2]>e?255:0;return f&&(d=this.getImageDataUrl(b,!0),G.img[this.name]=this.makeImage(d)),b},k.prototype.channels=function(a){a=G.isa(a,"obj")?a:{};var b,c=G.xt(a.red)?a.red:1,d=G.xt(a.green)?a.green:1,e=G.xt(a.blue)?a.blue:1,f=G.xt(a.alpha)?a.alpha:1,g=a.use||G.xt(a.useSourceData)?a.useSourceData:!1,h=this.getImageData(g),i=h.data,j=G.xt(a.save)?a.save:!0;c=G.isa(c,"str")?parseFloat(c)/100:c,d=G.isa(d,"str")?parseFloat(d)/100:d,e=G.isa(e,"str")?parseFloat(e)/100:e,f=G.isa(f,"str")?parseFloat(f)/100:f;for(var k=0,l=i.length;l>k;k+=4)i[k]=i[k]*c,i[k+1]=i[k+1]*d,i[k+2]=i[k+2]*e,i[k+3]=i[k+3]*f;return j&&(b=this.getImageDataUrl(h,!0),G.img[this.name]=this.makeImage(b)),h},k.prototype.channelStep=function(a){a=G.isa(a,"obj")?a:{};for(var b,c=G.xt(a.red)?a.red:1,d=G.xt(a.green)?a.green:1,e=G.xt(a.blue)?a.blue:1,f=G.xt(a.alpha)?a.alpha:1,g=a.use||G.xt(a.useSourceData)?a.useSourceData:!1,h=this.getImageData(g),i=h.data,j=G.xt(a.save)?a.save:!0,k=0,l=i.length;l>k;k+=4)i[k]=Math.floor(i[k]/c)*c,i[k+1]=Math.floor(i[k+1]/d)*d,i[k+2]=Math.floor(i[k+2]/e)*e,i[k+3]=Math.floor(i[k+3]/f)*f;return j&&(b=this.getImageDataUrl(h,!0),G.img[this.name]=this.makeImage(b)),h},k.prototype.sepia=function(a){return a=G.isa(a,"obj")?a:{},a.rr=.393,a.rg=.349,a.rb=.272,a.gr=.769,a.gg=.686,a.gb=.534,a.br=.189,a.bg=.168,a.bb=.131,this.tint(a)},k.prototype.tint=function(a){a=G.isa(a,"obj")?a:{};var b,c,d,e,f=G.xt(a.value)?a.value:1,g=a.use||G.xt(a.useSourceData)?a.useSourceData:!1,h=a.rr||a.redInRed||.393,i=a.rg||a.redInGreen||.349,j=a.rb||a.redInBlue||.272,k=a.gr||a.greenInRed||.769,l=a.gg||a.greenInGreen||.686,m=a.gb||a.greenInBlue||.534,n=a.br||a.blueInRed||.189,o=a.bg||a.blueInGreen||.168,p=a.bb||a.blueInBlue||.131,q=this.getImageData(g),r=q.data,s=G.xt(a.save)?a.save:!0;f=G.isa(f,"str")?parseFloat(f)/100:f,f=G.isBetween(f,0,1,!0)?f:f>.5?1:0;for(var t=0,u=r.length;u>t;t+=4)b=r[t]*h+r[t+1]*k+r[t+2]*n,c=r[t]*i+r[t+1]*l+r[t+2]*o,d=r[t]*j+r[t+1]*m+r[t+2]*p,r[t]=r[t]*(1-f)+b*f,r[t+1]=r[t+1]*(1-f)+c*f,r[t+2]=r[t+2]*(1-f)+d*f;return s&&(e=this.getImageDataUrl(q,!0),G.img[this.name]=this.makeImage(e)),q},k.prototype.blur=function(a){a=G.isa(a,"obj")?a:{};var b,c=G.xt(a.radius)?Math.abs(a.radius):0,d=G.xt(a.radiusX)?Math.abs(a.radiusX):2,e=G.xt(a.radiusY)?Math.abs(a.radiusY):2,f=G.xt(a.roll)?a.roll:0,g=c||d||2,h=c||e||2,i=a.use||G.xt(a.useSourceData)?a.useSourceData:!1,j=G.xt(a.includeAlpha)?a.includeAlpha:!1,k=this.getBrush(g,h,f),l=G.xt(a.save)?a.save:!0,m=this.doMatrix(k,i,j);return l&&(b=this.getImageDataUrl(m,!0),G.img[this.name]=this.makeImage(b)),m},k.prototype.getBrush=function(a,b,c){var d=a>b?a+2:b+2,e=Math.floor(d/2),f=Math.cos(c*G.radian),g=Math.sin(c*G.radian),h=[];G.cv.width=d,G.cv.height=d,G.cvx.setTransform(f,g,-g,f,e,e),G.cvx.beginPath(),G.cvx.moveTo(0,-b),G.cvx.bezierCurveTo(.55*a,-b,a,.55*-b,a,0),G.cvx.bezierCurveTo(a,.55*b,.55*a,b,0,b),G.cvx.bezierCurveTo(.55*-a,b,-a,.55*b,-a,0),G.cvx.bezierCurveTo(-a,.55*-b,.55*-a,-b,0,-b),G.cvx.closePath();for(var i=0;d>i;i++)for(var j=0;d>j;j++)G.cvx.isPointInPath(j,i)&&h.push({ox:j-e,oy:i-e,wt:1});return G.cvx.setTransform(1,0,0,1,0,0),h},k.prototype.pixelate=function(a){a=G.isa(a,"obj")?a:{};var b,c,d,e,f,g,h,i,j,k,l=G.xt(a.width)?Math.ceil(a.width):5,m=G.xt(a.height)?Math.ceil(a.height):5,n=a.use||G.xt(a.useSourceData)?a.useSourceData:!1,o=G.xt(a.includeAlpha)?a.includeAlpha:!1,p=this.getImageData(n),q=G.xt(a.save)?a.save:!0;G.cv.width=p.width,G.cv.height=p.height,G.cvx.putImageData(p,0,0);for(var r=0;r<p.height;r+=m)for(var s=0;s<p.width;s+=l){b=c=d=e=g=0,h=s+l>p.width?p.width-s:l,i=r+m>p.height?p.height-r:m,j=h*i*4,f=G.cvx.getImageData(s,r,h,i);for(var t=0;j>t;t+=4)f.data[t+3]>0&&(b+=f.data[t],c+=f.data[t+1],d+=f.data[t+2],e+=f.data[t+3],g++);b=Math.floor(b/g),c=Math.floor(c/g),d=Math.floor(d/g),e=Math.floor(e/g),G.cvx.fillStyle=o?"rgba("+b+","+c+","+d+","+e+")":"rgb("+b+","+c+","+d+")",G.cvx.fillRect(s,r,h,i)}return f=G.cvx.getImageData(0,0,p.width,p.height),q&&(k=this.getImageDataUrl(f,!0),G.img[this.name]=this.makeImage(k)),f},k.prototype.matrix=function(a){a=G.isa(a,"obj")?a:{};var b,c,d,e,f,g,h=G.xt(a.useSourceData)?a.useSourceData:!1,i=G.xt(a.includeAlpha)?a.includeAlpha:!1,j=G.isa(a.wrap,"bool")?a.wrap:!1,k=G.isa(a.data,"arr")?a.data:[1],l=[],m=0,n=G.xt(a.save)?a.save:!0;b=Math.ceil(Math.sqrt(k.length)),b=b%2===1?Math.pow(b,2):Math.pow(b+1,2);for(var o=0;b>o;o++)k[o]=G.xt(k[o])?parseFloat(k[o]):0,k[o]=isNaN(k[o])?0:k[o];c=Math.floor(k.length/2),d=Math.sqrt(k.length),e=Math.floor(d/2);for(var o=0;d>o;o++)for(var p=0;d>p;p++)0!==k[m]&&l.push({ox:p-e,oy:o-e,wt:k[m]}),m++;return f=this.doMatrix(l,h,i,j),n&&(g=this.getImageDataUrl(f,!0),G.img[this.name]=this.makeImage(g)),f},k.prototype.doMatrix=function(a,b,c,d){d=G.isa(d,"bool")?d:!1;var e,f,g,h,i,j,k,l=this.getImageData(b),m=l.data,n=this.getImageData(b),o=n.data,p=0;if(a.length>0){for(var q=0;q<l.height;q++)for(var r=0;r<l.width;r++){e=g=f=h=p=0,i=4*(q*l.width+r);for(var s=0,t=a.length;t>s;s++)k=!0,G.isBetween(r+a[s].ox,0,l.width-1,!0)&&G.isBetween(q+a[s].oy,0,l.height-1,!0)||(d?(G.isBetween(r+a[s].ox,0,l.width-1,!0)||(a[s].ox+=a[s].ox>0?-l.width:l.width),G.isBetween(q+a[s].oy,0,l.height-1,!0)||(a[s].oy+=a[s].oy>0?-l.height:l.height)):k=!1),k&&(j=i+4*(a[s].oy*l.width+a[s].ox),e+=m[j]*a[s].wt,f+=m[j+1]*a[s].wt,g+=m[j+2]*a[s].wt,p+=a[s].wt,c&&(h+=m[j+3]*a[s].wt));o[i]=0!==p?e/p:e,o[i+1]=0!==p?f/p:f,o[i+2]=0!==p?g/p:g,c&&(o[i+3]=0!==p?h/p:h)}return n}return!1},l.prototype=Object.create(a.prototype),l.prototype.type="AnimSheet",l.prototype.classname="animnames",G.d.AnimSheet={sheet:"",frames:[],currentFrame:0,speed:1,loop:"end",running:"complete",lastCalled:0},G.animKeys=Object.keys(G.d.AnimSheet),G.mergeInto(G.d.AnimSheet,G.d.Scrawl),l.prototype.set=function(b){b=G.isa(b,"obj")?b:{};var c="pause"===this.loop?!0:!1;if(a.prototype.set.call(this,b),G.xt(b.running))switch(b.running){case"forward":this.running="forward",c||(this.currentFrame=0);break;case"backward":this.running="backward",c||(this.currentFrame=this.frames.length-1);break;default:this.running="complete",this.currentFrame=0}return this},l.prototype.getData=function(){if(this.speed>0){var a=this.frames[this.currentFrame].d/this.speed,b=this.lastCalled+a<Date.now()?!0:!1;switch(this.running){case"complete":this.lastCalled=Date.now();break;case"forward":if(b){switch(this.loop){case"pause":break;case"end":this.running=this.currentFrame+1>=this.frames.length?"complete":this.running,this.currentFrame=this.currentFrame+1>=this.frames.length?this.currentFrame:this.currentFrame+1;break;case"loop":this.currentFrame=this.currentFrame+1>=this.frames.length?0:this.currentFrame+1;break;case"reverse":this.running=this.currentFrame+1>=this.frames.length?"backward":"forward",this.currentFrame=this.currentFrame+1>=this.frames.length?this.currentFrame:this.currentFrame+1}this.lastCalled=Date.now()}break;case"backward":if(b){switch(this.loop){case"pause":break;case"end":this.running=this.currentFrame-1<=0?"complete":this.running,this.currentFrame=this.currentFrame-1<=0?this.currentFrame:this.currentFrame-1;break;case"loop":this.currentFrame=this.currentFrame-1<=0?this.frames.length-1:this.currentFrame-1;break;case"reverse":this.running=this.currentFrame-1<=0?"forward":"backward",this.currentFrame=this.currentFrame-1<=0?this.currentFrame:this.currentFrame-1}this.lastCalled=Date.now()}}}return{copyX:this.frames[this.currentFrame].x,copyY:this.frames[this.currentFrame].y,copyWidth:this.frames[this.currentFrame].w,copyHeight:this.frames[this.currentFrame].h}},m.prototype=Object.create(a.prototype),m.prototype.type="Group",m.prototype.classname="groupnames",G.d.Group={sprites:[],cell:"",order:0,visibility:!0,spriteSort:!0,regionRadius:0},G.mergeInto(G.d.Group,G.d.Scrawl),m.prototype.toString=function(a){var b,c=Object.keys(G.d[this.type]),d={},e=[],f=[];d.type=this.type,d.classname=this.classname,d.name=this.name;for(var g=0,h=c.length;h>g;g++)G.xt(this[c[g]])&&this[c[g]]!==G.d[this.type][c[g]]&&(d[c[g]]=this[c[g]]);if(delete d.sprites,e.push(JSON.stringify(d)),!a){for(var g=0,h=this.sprites.length;h>g;g++)b=G.ctx[G.sprite[this.sprites[g]].context],G.contains(G.designnames,b.fillStyle)&&G.pushUnique(f,b.fillStyle),G.contains(G.designnames,b.strokeStyle)&&G.pushUnique(f,b.strokeStyle),G.contains(G.designnames,b.shadowColor)&&G.pushUnique(f,b.shadowColor);for(var g=0,h=f.length;h>g;g++)e.push(G.design[f[g]].toString());for(var g=0,h=this.sprites.length;h>g;g++)e.push(G.sprite[this.sprites[g]].toString(!0))}return e},m.prototype.save=function(){var a=Object.keys(G.d[this.type]),b={};b.type=this.type,b.classname=this.classname,b.name=this.name;for(var c=0,d=a.length;d>c;c++)G.xt(this[a[c]])&&this[a[c]]!==G.d[this.type][a[c]]&&(b[a[c]]=this[a[c]]);return[JSON.stringify(b)]},m.prototype.sortSprites=function(){this.spriteSort&&this.sprites.sort(function(a,b){return G.sprite[a].order-G.sprite[b].order})},m.prototype.forceStamp=function(a,b){var c=this.visibility;return c||this.set({visibility:!0}),this.stamp(a,b),this.set({visibility:c}),this},m.prototype.stamp=function(a,b){if(this.visibility){this.sortSprites();for(var c=0,d=this.sprites.length;d>c;c++)G.sprite[this.sprites[c]].stamp(a,b)}return this},m.prototype.getSpriteAt=function(a){a=G.isa(a,"obj")?a:{};var c,d,e,f,g=new b(a);G.xta([a.source,a.type])&&(d=G[a.type][a.source],e=G.cell[this.cell],d.width!==e.actualWidth&&(g.x/=d.width/e.actualWidth),d.height!==e.actualHeight&&(g.y/=d.height/e.actualHeight)),this.sortSprites();for(var h=this.sprites.length-1;h>=0;h--)if(c=G.sprite[this.sprites[h]],!(this.regionRadius&&(f=c.start.getVectorSubtract(g),f.getMagnitude()>this.regionRadius))&&c.checkHit(g))return c;return!1},m.prototype.getSpritesCollidingWith=function(a){if(a=G.isa(a,"str")?G.sprite[a]:a,G.contains(G.spritenames,a.name)){for(var b=[],c=a.getCollisionPoints(),d=0,e=this.sprites.length;e>d;d++)G.sprite[this.sprites[d]].name!==a.name&&G.sprite[this.sprites[d]].get("visibility")&&G.sprite[this.sprites[d]].checkHit({tests:c})&&b.push(this.sprites[d]);return b.length>0?b:!1}return!1},m.prototype.getInGroupSpriteHits=function(){for(var a,b,c,d,e=[],f={},g={},h=0,i=this.sprites.length;i>h;h++)a=G.sprite[this.sprites[h]],g[a.name]=a.visibility,g[a.name]&&(f[a.name]=a.getCollisionPoints());for(var h=0,i=this.sprites.length;i>h;h++)if(g[this.sprites[h]]){b=G.sprite[this.sprites[h]].start;for(var j=h+1,k=this.sprites.length;k>j;j++)if(g[this.sprites[j]]){if(c=G.sprite[this.sprites[j]].start,this.regionRadius&&(d=b.getVectorSubtract(c).getMagnitude(),d>this.regionRadius))continue;if(G.sprite[this.sprites[j]].checkHit({tests:f[this.sprites[h]]})){e.push([this.sprites[h],this.sprites[j]]);continue}if(G.sprite[this.sprites[h]].checkHit({tests:f[this.sprites[j]]})){e.push([this.sprites[h],this.sprites[j]]);continue}}}return e},m.prototype.getBetweenGroupSpriteHits=function(a){var b,c,d,e,f=[],g={},h={};if(G.xt(a)){if(G.isa(a,"str")){if(!G.contains(G.groupnames,a))return!1;a=G.group[a]}else if(!G.xt(a.type)||"Group"!==a.type)return!1;for(var i=0,j=this.sprites.length;j>i;i++)b=G.sprite[this.sprites[i]],h[b.name]=b.visibility,h[b.name]&&(g[b.name]=b.getCollisionPoints());for(var i=0,j=a.sprites.length;j>i;i++)b=G.sprite[a.sprites[i]],h[b.name]=b.visibility,h[b.name]&&(g[b.name]=b.getCollisionPoints());for(var i=0,j=this.sprites.length;j>i;i++)if(h[this.sprites[i]]){c=G.sprite[this.sprites[i]].start;for(var k=0,l=a.sprites.length;l>k;k++)if(h[a.sprites[k]]){if(d=G.sprite[a.sprites[k]].start,this.regionRadius&&(e=c.getVectorSubtract(d).getMagnitude(),e>this.regionRadius))continue;if(G.sprite[a.sprites[k]].checkHit({tests:g[this.sprites[i]]})){f.push([this.sprites[i],a.sprites[k]]);continue}if(G.sprite[this.sprites[i]].checkHit({tests:g[a.sprites[k]]})){f.push([this.sprites[i],a.sprites[k]]);continue}}}return f}return!1},m.prototype.getFieldSpriteHits=function(a){a=G.xt(a)?a:this.cell;for(var b,c=[],d=0,e=this.sprites.length;e>d;d++)b=G.sprite[this.sprites[d]].checkField(a),G.isa(b,"bool")||c.push([this.sprites[d],b]);return c},m.prototype.addSpritesToGroup=function(a){a=G.xt(a)?[].concat(a):[];for(var b=0,c=a.length;c>b;b++)G.pushUnique(this.sprites,a[b]);return this},m.prototype.removeSpritesFromGroup=function(a){a=G.xt(a)?[].concat(a):[];for(var b=0,c=a.length;c>b;b++)G.removeItem(this.sprites,a[b]);return this},m.prototype.updateStart=function(a){for(var b=0,c=this.sprites.length;c>b;b++)G.sprite[this.sprites[b]].updateStart(a);return this},m.prototype.revertStart=function(a){for(var b=0,c=this.sprites.length;c>b;b++)G.sprite[this.sprites[b]].revertStart(a);return this},m.prototype.reverse=function(a){for(var b=0,c=this.sprites.length;c>b;b++)G.sprite[this.sprites[b]].reverse(a);return this},m.prototype.updateSpritesBy=function(a){a=G.isa(a,"obj")?a:{};for(var b=0,c=this.sprites.length;c>b;b++)G.sprite[this.sprites[b]].setDelta({startX:a.x||a.startX||0,startY:a.y||a.startY||0,scale:a.scale||0,roll:a.roll||0});return this},m.prototype.setSpritesTo=function(a){for(var b=0,c=this.sprites.length;c>b;b++)G.sprite[this.sprites[b]].set(a);return this},m.prototype.pivotSpritesTo=function(a){a=G.isa(a,"str")?a:!1;var b,c,d,e;if(a&&(b=G.sprite[a]||G.point[a]||!1)){c="Point"===b.type?b.get("current"):b.start.getVector();for(var f=0,g=this.sprites.length;g>f;f++)d=G.sprite[this.sprites[f]],e=d.start.getVector(),e.vectorSubtract(c),d.set({pivot:a,handleX:-e.x,handleY:-e.y})}return this},n.prototype=Object.create(d.prototype),n.prototype.type="Sprite",n.prototype.classname="spritenames",G.d.Sprite={order:0,visibility:!0,method:"fill",roll:0,data:"",radius:0,width:0,height:0,flipReverse:!1,flipUpend:!1,scaleOutline:!0,lockX:!1,lockY:!1,fastStamp:!1,context:"",group:"",fieldChannel:"anycolor",fieldTest:0,collisionVectors:[],collisionPoints:[]},G.mergeInto(G.d.Sprite,G.d.SubScrawl),n.prototype.registerInLibrary=function(){return G.sprite[this.name]=this,G.pushUnique(G.spritenames,this.name),G.group[this.group].addSpritesToGroup(this.name),G.xt(this.collisionPoints)&&(this.collisionPoints=G.isa(this.collisionPoints,"arr")?this.collisionPoints:[this.collisionPoints],this.collisionPoints=this.parseCollisionPoints(this.collisionPoints)),this},n.prototype.toString=function(a){a=G.xt(a)?a:!1;var b,c=Object.keys(G.d[this.type]),d={},e=G.ctx[this.context],f=[],g=[];if(d.type=this.type,d.classname=this.classname,d.name=this.name,!a){e&&e.fillStyle&&G.contains(G.designnames,e.fillStyle)&&G.pushUnique(f,e.fillStyle),e&&e.strokeStyle&&G.contains(G.designnames,e.strokeStyle)&&G.pushUnique(f,e.strokeStyle),e&&e.shadowColor&&G.contains(G.designnames,e.shadowColor)&&G.pushUnique(f,e.shadowColor);for(var h=0,i=f.length;i>h;h++)g.push(G.design[f[h]].toString())}for(var h=0,i=c.length;i>h;h++)if(G.contains(["start","delta","handle"],c[h]))this[c[h]].isLike(G.d[this.type][c[h]])||(d[c[h]]=this[c[h]]);else if("context"===c[h]&&G.xt(G.ctx[this.context])){e=JSON.parse(G.ctx[this.context].toString()),b=Object.keys(e);for(var j=0,k=b.length;k>j;j++)d[b[j]]=e[b[j]]}else G.contains(["collisionVectors","dataSet","pointList","firstPoint","linkList","linkDurations","perimeterLength","style","variant","weight","size","metrics","family","texts"],c[h])||G.xt(this[c[h]])&&this[c[h]]!==G.d[this.type][c[h]]&&(d[c[h]]=this[c[h]]);return"Picture"===this.type&&(d.url=G.image[this.source].source),g.push(JSON.stringify(d).replace("\\n","\\\\n")),g},n.prototype.get=function(b){return G.xt(G.d.Scrawl[b])?a.prototype.get.call(this,b):G.xt(G.d.Context[b])?G.ctx[this.context].get(b):d.prototype.get.call(this,b)},n.prototype.set=function(a){return d.prototype.set.call(this,a),G.ctx[this.context].set(a),a=G.isa(a,"obj")?a:{},G.xto([a.collisionPoints,a.field,a.fence,a.group])&&(G.xt(a.collisionPoints)&&(this.collisionPoints=G.isa(a.collisionPoints,"arr")?a.collisionPoints:[a.collisionPoints],this.collisionPoints=this.parseCollisionPoints(this.collisionPoints),delete this.collisionVectors),G.xt(a.field)&&this.addSpriteToCellFields(),G.xt(a.fence)&&this.addSpriteToCellFences(),G.xt(a.group)&&(G.group[this.group].removeSpritesFromGroup(this.name),this.group=this.getGroup(a.group),G.group[this.group].addSpritesToGroup(this.name))),G.xto([a.handleX,a.handleY,a.handle,a.width,a.height,a.radius,a.scale])&&delete this.offset,this},n.prototype.setDelta=function(a){d.prototype.setDelta.call(this,a),a=G.isa(a,"obj")?a:{};var b=G.ctx[this.context];return G.xto([a.lineDashOffset,a.lineWidth,a.globalAlpha])&&b.setDelta(a),this.roll+=a.roll||0,G.xto([a.handleX,a.handleY,a.handle,a.width,a.height,a.radius,a.scale])&&delete this.offset,this},n.prototype.clone=function(a){a=G.isa(a,"obj")?a:{};var b,c,e=JSON.parse(JSON.stringify(G.ctx[this.context]));return delete e.name,c=G.mergeInto(a,e),delete c.context,b=d.prototype.clone.call(this,c),G.xt(a.createNewContext)&&!a.createNewContext&&(delete G.ctx[b.context],G.removeItem(G.ctxnames,b.context),b.context=this.context),b},n.prototype.pickupSprite=function(a){a=G.isa(a,"obj")?a:{};var c,d,e=new b(a);return G.xta([a.source,a.type])&&(c=G[a.type][a.source],d=G.cell[G.group[this.group].cell],c.width!==d.actualWidth&&(e.x/=c.width/d.actualWidth),c.height!==d.actualHeight&&(e.y/=c.height/d.actualHeight)),G.xta([a.x,a.y])&&(this.mouseX=e.x||0,this.mouseY=e.y||0,this.realPivot=this.pivot,this.set({pivot:"mouse",order:this.order+9999})),this},n.prototype.dropSprite=function(a){var b=this.order;return this.set({pivot:a||this.realPivot||!1,order:b>=9999?b-9999:0}),delete this.realPivot,delete this.mouseX,delete this.mouseY,this},n.prototype.addSpriteToCellFields=function(a){a=G.xt(a)?[].concat(a):[this.group];for(var b=0,c=a.length;c>b;b++)G.contains(G.cellnames,a[b])&&G.group[a[b]+"_field"].addSpritesToGroup(this.name);return this},n.prototype.addSpriteToCellFences=function(a){a=G.xt(a)?[].concat(a):[this.group];for(var b=0,c=a.length;c>b;b++)G.contains(G.cellnames,a[b])&&G.group[a[b]+"_fence"].addSpritesToGroup(this.name);return this},n.prototype.removeSpriteFromCellFields=function(a){a=G.xt(a)?[].concat(a):[this.group];for(var b=0,c=a.length;c>b;b++)G.contains(G.cellnames,a[b])&&G.group[a[b]+"_field"].removeSpritesFromGroup(this.name);return this},n.prototype.removeSpriteFromCellFences=function(a){a=G.xt(a)?[].concat(a):[this.group];for(var b=0,c=a.length;c>b;b++)G.contains(G.cellnames,a[b])&&G.group[a[b]+"_fence"].removeSpritesFromGroup(this.name);return this},n.prototype.getGroup=function(a){return a=G.isa(a,"obj")?a:{},G.xt(a.group)&&G.contains(G.groupnames,a.group)?a.group:G.pad[G.currentPad].current},n.prototype.forceStamp=function(a,b){var c=this.visibility;return this.visibility=!0,this.stamp(a,b),this.visibility=c,this},n.prototype.prepareStamp=function(){return this.offset||(this.offset=this.getOffsetStartVector()),this.offset},n.prototype.setStampUsingPivot=function(a){var b,c,d,e,f,g;return G.contains(G.pointnames,this.pivot)?(e=G.point[this.pivot],g=G.sprite[e.sprite],f=e.getCurrentCoordinates().rotate(g.roll).vectorAdd(g.start),this.start.x=this.lockX?this.start.x:f.x,this.start.y=this.lockY?this.start.y:f.y):G.contains(G.spritenames,this.pivot)?(e=G.sprite[this.pivot],f="Particle"===e.type?e.get("position"):e.start.getVector(),this.start.x=this.lockX?this.start.x:f.x,this.start.y=this.lockY?this.start.y:f.y):"mouse"===this.pivot&&(c=G.cell[a],d=G.pad[c.pad],b=d.getMouse(),d.width!==c.actualWidth&&(b.x/=d.width/c.actualWidth),d.height!==c.actualHeight&&(b.y/=d.height/c.actualHeight),G.xta([this.mouseX,this.mouseY])||(this.mouseX=this.start.x,this.mouseY=this.start.y),b.active&&(this.start.x=this.lockX?this.start.x:this.start.x+b.x-this.mouseX,this.start.y=this.lockY?this.start.y:this.start.y+b.y-this.mouseY,this.mouseX=b.x,this.mouseY=b.y)),this},n.prototype.stamp=function(a,b){if(this.visibility){var c,d=G.isa(b,"str")&&G.contains(G.cellnames,b)?G.cell[b]:G.cell[G.group[this.group].cell],e=G.context[d.name],f=G.isa(a,"str")?a:this.method;this.pivot?this.setStampUsingPivot(d.name):G.contains(G.spritenames,this.path)&&"Shape"===G.sprite[this.path].type&&(c=G.sprite[this.path].getPerimeterPosition(this.pathPlace,this.pathSpeedConstant,this.addPathRoll),this.start.x=this.lockX?this.start.x:c.x,this.start.y=this.lockY?this.start.y:c.y,this.pathRoll=c.r||0),this.callMethod(e,d.name,f)}return this},n.prototype.callMethod=function(a,b,c){switch(c){case"clear":this.clear(a,b);break;case"clearWithBackground":this.clearWithBackground(a,b);break;case"draw":this.draw(a,b);break;case"fill":this.fill(a,b);break;case"drawFill":this.drawFill(a,b);break;case"fillDraw":this.fillDraw(a,b);break;case"sinkInto":this.sinkInto(a,b);break;case"floatOver":this.floatOver(a,b);break;case"clip":this.clip(a,b);break;case"none":this.none(a,b)}return this},n.prototype.rotateCell=function(a){var b=this.flipReverse?-1:1,c=this.flipUpend?-1:1,d=this.addPathRoll?(this.roll+this.pathRoll)*G.radian:this.roll*G.radian,e=Math.cos(d),f=Math.sin(d);return a.setTransform(e*b,f*b,-f*c,e*c,this.start.x,this.start.y),this},n.prototype.clear=function(){return this},n.prototype.clearWithBackground=function(){return this},n.prototype.draw=function(){return this},n.prototype.fill=function(){return this},n.prototype.drawFill=function(){return this},n.prototype.fillDraw=function(){return this},n.prototype.sinkInto=function(){return this},n.prototype.floatOver=function(){return this},n.prototype.clip=function(){return this},n.prototype.none=function(a,b){return G.cell[b].setEngine(this),this},n.prototype.getLocalCoordinate=function(a){a=G.isa(a,"obj")?a:{};
var c=new b({x:a.x||0,y:a.y||0}),d=this.getPivotOffsetVector();return c.vectorSubtract(this.start),c.scalarDivide(this.scale),c.rotate(-this.roll),c.x=this.flipReverse?-c.x:c.x,c.y=this.flipUpend?-c.y:c.y,c.vectorAdd(d),c},n.prototype.checkHit=function(a){a=G.isa(a,"obj")?a:{};var b,c,d=G.pad[G.currentPad],e=G.context[d.current],f=G.xt(a.tests)?[].concat(a.tests):[{x:a.x||!1,y:a.y||!1}];this.rotateCell(e),b=this.prepareStamp(),e.beginPath(),e.rect(b.x,b.y,this.width*this.scale,this.height*this.scale);for(var g=0,h=f.length;h>g&&!(c=e.isPointInPath(f[g].x,f[g].y));g++);return c?f[g]:!1},n.prototype.checkField=function(a){var b=a?G.cell[a]:G.cell[G.group[this.group].cell];return b.checkFieldAt({coordinates:this.getCollisionPoints(),test:this.get("fieldTest"),channel:this.get("fieldChannel")})},n.prototype.bounceOnFieldCollision=function(a,b){var c,d,e,f,g=b?G.cell[b]:G.cell[G.group[this.group].cell],h=this.start.getVector(),i=a.getVectorSubtract(h),j=i.getVector(),k=i.getVector(),l=!1,m=!1,n=this.get("fieldTest"),o=this.get("fieldChannel"),p=0,q=function(){var a=g.checkFieldAt({coordinates:[c.vectorAdd(h)],test:n,channel:o});return a};do c=j.rotate(-10).getVector(),l=q(),p++;while(36>p&&l!==!0);p=0;do c=j.rotate(1).getVector(),l=q(),p++;while(10>=p&&l===!0);p=0;do c=k.rotate(10).getVector(),m=q(),p++;while(36>p&&m!==!0);p=0;do c=k.rotate(-1).getVector(),m=q(),p++;while(10>=p&&m===!0);return j.vectorAdd(h),k.vectorAdd(h),d=Math.atan2(j.y-k.y,j.x-k.x)/G.radian,f=Math.atan2(this.delta.y,this.delta.x)/G.radian,e=2*(d-f),this.delta.rotate(e),this},n.prototype.clearShadow=function(a,b){var c=G.ctx[this.context];return(c.shadowOffsetX||c.shadowOffsetY||c.shadowBlur)&&G.cell[b].clearShadow(),this},n.prototype.restoreShadow=function(a,b){var c=G.ctx[this.context];return(c.shadowOffsetX||c.shadowOffsetY||c.shadowBlur)&&G.cell[b].restoreShadow(this.context),this},n.prototype.getCollisionPoints=function(){var a,b,c=[];if(G.xt(this.collisionVectors)||G.xt(this.collisionPoints)&&this.buildCollisionVectors(),b=this.collisionVectors||!1){for(var d=0,e=b.length;e>d;d++)a=b[d].getVector(),a.x=this.flipReverse?-a.x:a.x,a.y=this.flipUpend?-a.y:a.y,this.roll&&a.rotate(this.roll),1!==this.scale&&a.scalarMultiply(this.scale),a.vectorAdd(this.start),c.push(a);return c}return[]},n.prototype.buildCollisionVectors=function(a){var c,d=this.getPivotOffsetVector(),e=this.width,f=this.height;c=G.xt(a)?this.parseCollisionPoints(a):this.collisionPoints,this.collisionVectors=[];for(var g=0,h=c.length;h>g;g++)if(G.isa(c[g],"str"))switch(c[g]){case"start":this.collisionVectors.push(new b);break;case"N":this.collisionVectors.push(new b({x:e/2-d.x,y:-d.y}));break;case"NE":this.collisionVectors.push(new b({x:e-d.x,y:-d.y}));break;case"E":this.collisionVectors.push(new b({x:e-d.x,y:f/2-d.y}));break;case"SE":this.collisionVectors.push(new b({x:e-d.x,y:f-d.y}));break;case"S":this.collisionVectors.push(new b({x:e/2-d.x,y:f-d.y}));break;case"SW":this.collisionVectors.push(new b({x:-d.x,y:f-d.y}));break;case"W":this.collisionVectors.push(new b({x:-d.x,y:f/2-d.y}));break;case"NW":this.collisionVectors.push(new b({x:-d.x,y:-d.y}));break;case"center":this.collisionVectors.push(new b({x:e/2-d.x,y:f/2-d.y}))}else G.isa(c[g],"obj")&&"Vector"===c[g].type&&this.collisionVectors.push(c[g]);return this},n.prototype.parseCollisionPoints=function(a){for(var b=G.xt(a)?[].concat(a):[],c=[],d=0,e=b.length;e>d;d++)if(G.isa(b[d],"str"))switch(b[d].toLowerCase()){case"all":G.pushUnique(c,"N"),G.pushUnique(c,"NE"),G.pushUnique(c,"E"),G.pushUnique(c,"SE"),G.pushUnique(c,"S"),G.pushUnique(c,"SW"),G.pushUnique(c,"W"),G.pushUnique(c,"NW"),G.pushUnique(c,"start"),G.pushUnique(c,"center");break;case"corners":G.pushUnique(c,"NE"),G.pushUnique(c,"SE"),G.pushUnique(c,"SW"),G.pushUnique(c,"NW");break;case"edges":G.pushUnique(c,"N"),G.pushUnique(c,"E"),G.pushUnique(c,"S"),G.pushUnique(c,"W");break;case"perimeter":G.pushUnique(c,"N"),G.pushUnique(c,"NE"),G.pushUnique(c,"E"),G.pushUnique(c,"SE"),G.pushUnique(c,"S"),G.pushUnique(c,"SW"),G.pushUnique(c,"W"),G.pushUnique(c,"NW");break;case"north":case"n":G.pushUnique(c,"N");break;case"northeast":case"ne":G.pushUnique(c,"NE");break;case"east":case"e":G.pushUnique(c,"E");break;case"southeast":case"se":G.pushUnique(c,"SE");break;case"south":case"s":G.pushUnique(c,"S");break;case"southwest":case"sw":G.pushUnique(c,"SW");break;case"west":case"w":G.pushUnique(c,"W");break;case"northwest":case"nw":G.pushUnique(c,"NW");break;case"start":G.pushUnique(c,"start");break;case"center":G.pushUnique(c,"center")}else G.isa(b[d],"num")?c.push(b[d]):G.isa(b[d],"obj")&&"Vector"===b[d].type&&c.push(b[d]);return this.collisionPoints=c,c},o.prototype=Object.create(n.prototype),o.prototype.type="Phrase",o.prototype.classname="spritenames",G.d.Phrase={text:"",style:"normal",variant:"normal",weight:"normal",size:12,metrics:"pt",family:"sans-serif",lineHeight:1.5,backgroundColor:"",backgroundMargin:0,textAlongPath:"phrase",fixedWidth:!1,texts:[]},G.mergeInto(G.d.Phrase,G.d.Sprite),o.prototype.set=function(a){return n.prototype.set.call(this,a),a=G.isa(a,"obj")?a:{},this.lineHeight=a.lineHeight||this.lineHeight,a.font&&(this.checkFont(a.font),delete this.offset),(a.text||a.size||a.scale)&&delete this.offset,this.constructFont(),this.size=this.get("size"),this.multiline(a),this.getMetrics(),this},o.prototype.setDelta=function(a){return n.prototype.setDelta.call(this,a),a.text&&delete this.offset,(a.size||a.scale)&&(this.constructFont(),delete this.offset),this.getMetrics(),this},o.prototype.clone=function(a){return a.texts=[],n.prototype.clone.call(this,a)},o.prototype.multiline=function(a){var b=""+(a.text||this.get("text")),c=b.split("\n");if(G.xt(this.texts))for(var d=0,e=this.texts.length;e>d;d++)delete G.text[this.texts[d]],G.removeItem(G.textnames,this.texts[d]);this.texts=[],a.phrase=this.name;for(var d=0,e=c.length;e>d;d++)a.text=c[d],a.text.length>0&&new p(a);return this.text=b,this},o.prototype.checkFont=function(a){return G.xt(a)&&this.deconstructFont(),this.constructFont(),this},o.prototype.deconstructFont=function(){var b,c,d,e=G.ctx[this.context].font,f=[100,200,300,400,500,600,700,800,900,"italic","oblique","small-caps","bold","bolder","lighter","xx-small","x-small","small","medium","large","x-large","xx-large"],g=this.get("style"),h=this.get("variant"),i=this.get("weight"),j=this.get("size"),k=this.get("metrics"),l=this.get("family");/italic/i.test(e)?g="italic":/oblique/i.test(e)?g="oblique":this.style="normal",h=/small-caps/i.test(e)?"small-caps":"normal",/bold/i.test(e)?i="bold":/bolder/i.test(e)?i="bolder":/lighter/i.test(e)?i="lighter":/([1-9]00)/i.test(e)?(b=e.match(/([1-9]00)/i),i=b[1]):i="normal",b=!1,/(\d+)(%|in|cm|mm|em|ex|pt|pc|ex)?/i.test(e)?(b=e.match(/(\d+)(%|in|cm|mm|em|ex|pt|pc|ex|px)/i),j=parseFloat(b[1]),k=b[2]):/xx-small/i.test(e)?(j=3,k="pt"):/x-small/i.test(e)?(j=6,k="pt"):/small/i.test(e)?(j=9,k="pt"):/medium/i.test(e)?(j=12,k="pt"):/large/i.test(e)?(j=15,k="pt"):/x-large/i.test(e)?(j=18,k="pt"):/xx-large/i.test(e)?(j=21,k="pt"):(j=12,k="pt"),c="",d=e.split(" ");for(var m=0,n=d.length;n>m;m++)G.contains(f,d[m])||d[m].match(/[^\/](\d)+(%|in|cm|mm|em|ex|pt|pc|ex)?/i)||(c+=d[m]+" ");return c||(c="Verdana, Geneva, sans-serif"),l=c,a.prototype.set.call(this,{style:g,variant:h,weight:i,size:j,metrics:k,family:l}),this},o.prototype.constructFont=function(){var a="",b=this.get("style"),c=this.get("variant"),d=this.get("weight"),e=this.get("size"),f=this.get("metrics"),g=this.get("family");return"normal"!==b&&(a+=b+" "),"normal"!==c&&(a+=c+" "),"normal"!==d&&(a+=d+" "),a+=e*this.scale+f+" ",a+=g,G.ctx[this.context].font=a,this},o.prototype.stamp=function(a,b){var c;return this.visibility&&(c=G.contains(G.spritenames,this.path)&&"Shape"===G.sprite[this.path].type,this.pivot||!c||"phrase"===this.get("textAlongPath")?n.prototype.stamp.call(this,a,b):G.text[this.texts[0]].stampAlongPath(a,b)),this},o.prototype.clear=function(a,b){var c,d,e=this.getOffset(),f=this.prepareStamp(),g=this.size*this.lineHeight*this.scale;G.cell[b].setEngine(this),a.globalCompositeOperation="destination-out",this.rotateCell(a),c=f.x+e.x;for(var h=0,i=this.texts.length;i>h;h++)d=f.y+g*h+e.y,G.text[this.texts[h]].clear(a,b,c,d);return a.globalCompositeOperation=G.ctx[b].get("globalCompositeOperation"),this},o.prototype.clearWithBackground=function(a,b){var c,d,e=this.getOffset(),f=this.prepareStamp(),g=this.size*this.lineHeight*this.scale;G.cell[b].setEngine(this),this.rotateCell(a),c=f.x+e.x;for(var h=0,i=this.texts.length;i>h;h++)d=f.y+g*h+e.y,G.text[this.texts[h]].clearWithBackground(a,b,c,d);return this},o.prototype.draw=function(a,b){var c,d,e=this.getOffset(),f=this.prepareStamp(),g=this.size*this.lineHeight*this.scale;G.cell[b].setEngine(this),this.rotateCell(a),G.xt(this.backgroundColor)&&this.addBackgroundColor(a,f),c=f.x+e.x;for(var h=0,i=this.texts.length;i>h;h++)d=f.y+g*h+e.y,G.text[this.texts[h]].draw(a,b,c,d);return this},o.prototype.fill=function(a,b){var c,d,e=this.getOffset(),f=this.prepareStamp(),g=this.size*this.lineHeight*this.scale;G.cell[b].setEngine(this),this.rotateCell(a),G.xt(this.backgroundColor)&&this.addBackgroundColor(a,f),c=f.x+e.x;for(var h=0,i=this.texts.length;i>h;h++)d=f.y+g*h+e.y,G.text[this.texts[h]].fill(a,b,c,d);return this},o.prototype.drawFill=function(a,b){var c,d,e=this.getOffset(),f=this.prepareStamp(),g=this.size*this.lineHeight*this.scale;G.cell[b].setEngine(this),this.rotateCell(a),G.xt(this.backgroundColor)&&this.addBackgroundColor(a,f),c=f.x+e.x;for(var h=0,i=this.texts.length;i>h;h++)d=f.y+g*h+e.y,G.text[this.texts[h]].drawFill(a,b,c,d,this);return this},o.prototype.fillDraw=function(a,b){var c,d,e=this.getOffset(),f=this.prepareStamp(),g=this.size*this.lineHeight*this.scale;G.cell[b].setEngine(this),this.rotateCell(a),G.xt(this.backgroundColor)&&this.addBackgroundColor(a,f),c=f.x+e.x;for(var h=0,i=this.texts.length;i>h;h++)d=f.y+g*h+e.y,G.text[this.texts[h]].fillDraw(a,b,f.x+e.x,d,this);return this},o.prototype.sinkInto=function(a,b){var c,d,e=this.getOffset(),f=this.prepareStamp(),g=this.size*this.lineHeight*this.scale;G.cell[b].setEngine(this),this.rotateCell(a),G.xt(this.backgroundColor)&&this.addBackgroundColor(a,f),c=f.x+e.x;for(var h=0,i=this.texts.length;i>h;h++)d=f.y+g*h+e.y,G.text[this.texts[h]].sinkInto(a,b,f.x+e.x,d);return this},o.prototype.floatOver=function(a,b){var c,d,e=this.getOffset(),f=this.prepareStamp(),g=this.size*this.lineHeight*this.scale;G.cell[b].setEngine(this),this.rotateCell(a),G.xt(this.backgroundColor)&&addBackgroundColor(a,f),c=f.x+e.x;for(var h=0,i=this.texts.length;i>h;h++)d=f.y+g*h+e.y,G.text[this.texts[h]].floatOver(a,b,f.x+e.x,d);return this},o.prototype.getMetrics=function(){for(var a=0,b=0,c=this.texts,d=0,e=c.length;e>d;d++)b=G.text[c[d]].get("width")>b?G.text[c[d]].width:b,a+=G.text[c[d]].get("height");return this.width=b,this.height=a,this},o.prototype.addBackgroundColor=function(a,b){var c=this.get("backgroundMargin"),d=b.x-c,e=b.y-c,f=this.width*this.scale+2*c,g=this.height*this.scale+2*c;return a.fillStyle=this.backgroundColor,a.fillRect(d,e,f,g),a.fillStyle=G.ctx[this.context].get("fillStyle"),this},o.prototype.getOffset=function(){var a=G.ctx[this.context],b=0,c=0;switch(a.get("textAlign")){case"start":case"left":b=0;break;case"center":b=this.width/2*this.scale;break;case"right":case"end":b=this.width*this.scale}switch(a.get("textBaseline")){case"top":c=0;break;case"hanging":c=this.size*this.lineHeight*this.scale*.1;break;case"middle":c=this.size*this.lineHeight*this.scale*.5;break;case"bottom":c=this.size*this.lineHeight*this.scale;break;default:c=this.size*this.lineHeight*this.scale*.85}return{x:b,y:c}},p.prototype=Object.create(a.prototype),p.prototype.type="Text",p.prototype.classname="textnames",G.d.Text={text:"",phrase:"",context:"",fixedWidth:!1,textAlongPath:"phrase",width:0,height:0,glyphs:[],glyphWidths:[]},G.mergeInto(G.d.Text,G.d.Scrawl),p.prototype.stampAlongPath=function(a,b){var c=G.sprite[this.phrase];a=G.isa(a,"str")?a:c.method,b=G.isa(b,"str")&&G.contains(G.cellnames,b)?b:G.cell[G.group[c.group].cell];var d,e,f,g,h,i=G.context[b],j=G.cell[b],k=G.sprite[c.path].getPerimeterLength(),l=this.width*c.scale,m=l/k,n=c.pathPlace,o=this.text;G.xt(this.glyphs)||this.getMetrics(),j.setEngine(c);for(var p=0,q=this.glyphs.length;q>p;p++)if(G.xt(this.glyphs[p])){switch(this.text=this.glyphs[p],e=n+this.glyphWidths[p]/2/l*m,G.isBetween(e,0,1,!0)||(e+=e>.5?-1:1),d=G.sprite[c.path].getPerimeterPosition(e,c.pathSpeedConstant,!0),f=d.x,g=d.y,h=d.r*G.radian,i.setTransform(1,0,0,1,0,0),i.translate(f,g),i.rotate(h),i.translate(-f,-g),a){case"draw":this.draw(i,b,f,g);break;case"fill":this.fill(i,b,f,g);break;case"drawFill":this.drawFill(i,b,f,g,c);break;case"fillDraw":this.fillDraw(i,b,f,g,c);break;case"sinkInto":this.sinkInto(i,b,f,g);break;case"floatOver":this.floatOver(i,b,f,g);break;case"clear":case"clearWithBackground":case"clip":case"none":}n+=this.glyphWidths[p]/l*m,G.isBetween(n,0,1,!0)||(n+=n>.5?-1:1)}return this.text=o,this},p.prototype.clear=function(a,b,c,d){return a.fillText(this.text,c,d),this},p.prototype.clearWithBackground=function(a,b,c,d){return a.fillStyle=G.cell[b].backgroundColor,a.globalAlpha=1,a.fillText(this.text,c,d),a.fillStyle=G.ctx[b].fillStyle,a.globalAlpha=G.ctx[b].globalAlpha,this},p.prototype.draw=function(a,b,c,d){return a.strokeText(this.text,c,d),this},p.prototype.fill=function(a,b,c,d){return a.fillText(this.text,c,d),this},p.prototype.drawFill=function(a,b,c,d,e){return a.strokeText(this.text,c,d),e.clearShadow(a,b),a.fillText(this.text,c,d),e.restoreShadow(a,b),this},p.prototype.fillDraw=function(a,b,c,d,e){return a.fillText(this.text,c,d),e.clearShadow(a,b),a.strokeText(this.text,c,d),e.restoreShadow(a,b),this},p.prototype.sinkInto=function(a,b,c,d){return a.fillText(this.text,c,d),a.strokeText(this.text,c,d),this},p.prototype.floatOver=function(a,b,c,d){return a.strokeText(this.text,c,d),a.fillText(this.text,c,d),this},p.prototype.clip=function(){return this},p.prototype.getMetrics=function(){var a,b,c,d=G.sprite[this.phrase],e=G.context[G.pad[G.currentPad].current],f=G.ctx[this.context],g=e.font,h=e.textBaseline,i=e.textAlign;if(e.font=f.get("font"),e.textBaseline=f.get("textBaseline"),e.textAlign=f.get("textAlign"),this.width=e.measureText(this.text).width/d.scale,this.height=d.size*d.lineHeight,d.path)if(this.glyphs=[],this.glyphWidths=[],a=this.text,"word"===this.textAlongPath){c=this.text.split(" ");for(var j=0,k=c.length;k>j;j++)this.glyphs.push(c[j]),this.glyphWidths.push(e.measureText(c[j]).width),G.xt(c[j+1])&&(this.glyphs.push(" "),this.glyphWidths.push(e.measureText(" ").width))}else if(b=e.measureText(a).width,this.fixedWidth)for(var j=0,k=a.length;k>j;j++)this.glyphs.push(a[j]),this.glyphWidths.push(b/k);else for(var j=1,k=a.length;k>=j;j++)this.glyphs.push(a[j-1]),c=a.substr(0,j-1)+a.substr(j),this.glyphWidths.push(b-e.measureText(c).width);return e.font=g,e.textBaseline=h,e.textAlign=i,this},q.prototype=Object.create(n.prototype),q.prototype.type="Block",q.prototype.classname="spritenames",G.d.Block={width:0,height:0},G.mergeInto(G.d.Block,G.d.Sprite),q.prototype.set=function(a){return n.prototype.set.call(this,a),this.width=a.width||this.width,this.height=a.height||this.height,this},q.prototype.setDelta=function(a){return n.prototype.setDelta.call(this,a),G.xt(a.width)&&(this.width+=a.width),G.xt(a.height)&&(this.height+=a.height),this},q.prototype.clip=function(a){var b=this.prepareStamp();return a.save(),this.rotateCell(a),a.beginPath(),a.rect(b.x,b.y,this.width*this.scale,this.height*this.scale),a.clip(),this},q.prototype.clear=function(a,b){var c=this.prepareStamp();return G.cell[b].setToClearShape(),this.rotateCell(a),a.clearRect(c.x,c.y,this.width*this.scale,this.height*this.scale),this},q.prototype.clearWithBackground=function(a,b){var c=G.cell[b],d=c.get("backgroundColor"),e=G.ctx[b],f=e.get("fillStyle"),g=e.get("strokeStyle"),h=e.get("globalAlpha"),i=this.prepareStamp(),j=this.width*this.scale,k=this.height*this.scale;return this.rotateCell(a),a.fillStyle=d,a.strokeStyle=d,a.globalAlpha=1,a.strokeRect(i.x,i.y,j,k),a.fillRect(i.x,i.y,j,k),a.fillStyle=f,a.strokeStyle=g,a.globalAlpha=h,this},q.prototype.draw=function(a,b){var c=this.prepareStamp();return G.cell[b].setEngine(this),this.rotateCell(a),a.strokeRect(c.x,c.y,this.width*this.scale,this.height*this.scale),this},q.prototype.fill=function(a,b){var c=this.prepareStamp();return G.cell[b].setEngine(this),this.rotateCell(a),a.fillRect(c.x,c.y,this.width*this.scale,this.height*this.scale),this},q.prototype.drawFill=function(a,b){var c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale;return G.cell[b].setEngine(this),this.rotateCell(a),a.strokeRect(c.x,c.y,d,e),this.clearShadow(a,b),a.fillRect(c.x,c.y,d,e),this},q.prototype.fillDraw=function(a,b){var c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale;return G.cell[b].setEngine(this),this.rotateCell(a),a.fillRect(c.x,c.y,d,e),this.clearShadow(a,b),a.strokeRect(c.x,c.y,d,e),this},q.prototype.sinkInto=function(a,b){var c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale;return G.cell[b].setEngine(this),this.rotateCell(a),a.fillRect(c.x,c.y,d,e),a.strokeRect(c.x,c.y,this.width*this.scale,this.height*this.scale),this},q.prototype.floatOver=function(a,b){var c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale;return G.cell[b].setEngine(this),this.rotateCell(a),a.strokeRect(c.x,c.y,d,e),a.fillRect(c.x,c.y,d,e),this},r.prototype=Object.create(n.prototype),r.prototype.type="Wheel",r.prototype.classname="spritenames",G.d.Wheel={radius:0,startAngle:0,endAngle:360,clockwise:!1,closed:!0,includeCenter:!1,checkHitUsingRadius:!0,width:0,height:0},G.mergeInto(G.d.Wheel,G.d.Sprite),r.prototype.set=function(a){return n.prototype.set.call(this,a),this.radius=a.radius||this.radius,this.width=2*this.radius,this.height=this.width,this},r.prototype.setDelta=function(a){n.prototype.setDelta.call(this,a),a=G.isa(a,"obj")?a:{};var b={};return G.xt(a.radius)&&(this.radius+=a.radius,this.width=2*this.radius,this.height=this.width),G.xt(a.startAngle)&&(b.startAngle=this.get("startAngle")+a.startAngle),G.xt(a.endAngle)&&(b.endAngle=this.get("endAngle")+a.endAngle),this.set(b),this},r.prototype.checkHit=function(a){a=G.isa(a,"obj")?a:{};var b,c,d,e,f,g,h,i,j=G.xt(a.tests)?a.tests:[{x:a.x||!1,y:a.y||!1}],k=!1;if(this.checkHitUsingRadius){e=a.test||0,f=e?e:this.radius*this.scale;for(var l=0,m=j.length;m>l&&(b=j[l].x-this.start.x,c=j[l].y-this.start.y,d=Math.sqrt(b*b+c*c),!(k=f>=d?!0:!1));l++);}else{g=G.pad[a.pad]||G.pad[G.currentPad],h=G.cell[g.current].name,i=G.context[g.current],this.buildPath(i,h);for(var l=0,m=j.length;m>l&&!(k=i.isPointInPath(j[l].x,j[l].y));l++);}return k?j[l]:!1},r.prototype.getPivotOffsetVector=function(){var a=this.handle.getVector();if(G.isa(this.handle.x,"str")&&!G.contains(["left","center","right","top","bottom"],this.handle.x))a.x=parseFloat(this.handle.x)/100*this.width-this.radius;else switch(this.handle.x){case"left":a.x=-this.radius;break;case"center":a.x=0;break;case"right":a.x=this.radius}if(G.isa(this.handle.y,"str")&&!G.contains(["left","center","right","top","bottom"],this.handle.y))a.y=parseFloat(this.handle.y)/100*this.height-this.radius;else switch(this.handle.y){case"top":a.y=-this.radius;break;case"center":a.y=0;break;case"bottom":a.y=this.radius}return a},r.prototype.buildPath=function(a,b){var c=this.prepareStamp(),d=this.get("startAngle"),e=this.get("endAngle");return this.rotateCell(a,b),a.beginPath(),a.arc(c.x,c.y,this.radius*this.scale,d*G.radian,e*G.radian,this.clockwise),this.includeCenter&&a.lineTo(c.x,c.y),this.closed&&a.closePath(),this},r.prototype.clip=function(a,b){return this.buildPath(a,b),a.clip(),this},r.prototype.clear=function(a,b){return a.globalCompositeOperation="destination-out",this.buildPath(a,b),a.stroke(),a.fill(),a.globalCompositeOperation=G.ctx[b].get("globalCompositeOperation"),this},r.prototype.clearWithBackground=function(a,b){var c=G.cell[b],d=c.get("backgroundColor"),e=G.ctx[b],f=e.get("fillStyle"),g=e.get("strokeStyle"),h=e.get("globalAlpha");return a.fillStyle=d,a.strokeStyle=d,a.globalAlpha=1,this.buildPath(a,b),a.stroke(),a.fill(),a.fillStyle=f,a.strokeStyle=g,a.globalAlpha=h,this},r.prototype.draw=function(a,b){return G.cell[b].setEngine(this),this.buildPath(a,b),a.stroke(),this},r.prototype.fill=function(a,b){return G.cell[b].setEngine(this),this.buildPath(a,b),a.fill(),this},r.prototype.drawFill=function(a,b){return G.cell[b].setEngine(this),this.buildPath(a,b),a.stroke(),this.clearShadow(a,b),a.fill(),this},r.prototype.fillDraw=function(a,b){return G.cell[b].setEngine(this),this.buildPath(a,b),a.fill(),this.clearShadow(a,b),a.stroke(),this},r.prototype.sinkInto=function(a,b){return G.cell[b].setEngine(this),this.buildPath(a,b),a.fill(),a.stroke(),this},r.prototype.floatOver=function(a,b){return G.cell[b].setEngine(this),this.buildPath(a,b),a.stroke(),a.fill(),this},r.prototype.buildCollisionVectors=function(a){var c,d,e,f=new b({x:this.radius,y:0});c=G.xt(a)?this.parseCollisionPoints(a):this.collisionPoints,this.collisionVectors=[];for(var g=0,h=c.length;h>g;g++)if(G.isa(c[g],"num")&&c[g]>1){d=360/Math.floor(c[g]);for(var i=0;i<c[g];i++)this.collisionVectors.push(f.getVector().rotate(d*i))}else if(G.isa(c[g],"str")){switch(c[g]){case"start":e=new b;break;case"N":e=f.getVector().rotate(-90);break;case"NE":e=f.getVector().rotate(-45);break;case"E":e=f.getVector();break;case"SE":e=f.getVector().rotate(45);break;case"S":e=f.getVector().rotate(90);break;case"SW":e=f.getVector().rotate(135);break;case"W":e=f.getVector().rotate(180);break;case"NW":e=f.getVector().rotate(-135);break;case"center":e=new b}this.collisionVectors.push(e)}else G.isa(c[g],"obj")&&"Vector"===c[g].type&&this.collisionVectors.push(c[g]);return this},s.prototype=Object.create(n.prototype),s.prototype.type="Picture",s.prototype.classname="spritenames",G.d.Picture={source:"",imageData:"",imageDataChannel:"alpha",animSheet:"",imageType:"",checkHitUsingImageData:!1,width:0,height:0,copyX:0,copyY:0,copyWidth:0,copyHeight:0},G.mergeInto(G.d.Picture,G.d.Sprite),s.prototype.get=function(a){return G.contains(G.animKeys,a)?G.anim[this.animSheet].get(a):n.prototype.get.call(this,a)},s.prototype.set=function(a){return n.prototype.set.call(this,a),G.xt(this.animSheet)&&G.anim[this.animSheet].set(a),a=G.isa(a,"obj")?a:{},this.width=a.width||this.width,this.height=a.height||this.height,this.copyX=a.copyX||this.copyX,this.copyY=a.copyY||this.copyY,this.copyWidth=a.copyWidth||this.copyWidth,this.copyHeight=a.copyHeight||this.copyHeight,this},s.prototype.setDelta=function(a){return n.prototype.setDelta.call(this,a),a=G.isa(a,"obj")?a:{},G.xt(a.width)&&(this.width+=a.width),G.xt(a.height)&&(this.height+=a.height),G.xt(a.copyX)&&(this.copyX+=a.copyX),G.xt(a.copyY)&&(this.copyY+=a.copyY),G.xt(a.copyWidth)&&(this.copyWidth+=a.copyWidth),G.xt(a.copyHeight)&&(this.copyHeight+=a.copyHeight),this},s.prototype.importImage=function(a){if(!G.isa(a,"obj")||!G.xt(a.url))return console.log("Picture.importImage() failed - no url supplied"),!1;var b=new Image;b.id=a.name||"image"+Math.floor(1e8*Math.random()),b.onload=function(){try{var c=(G.newImage({name:b.id,element:b}),a.url);delete a.url,a.source=b.id;var d=G.newPicture(a);return G.isa(a.callback,"fn")&&a.callback.call(d),d}catch(e){return console.log("Image <"+c+"> failed to load - "+e.name+" error: "+e.message),!1}},b.src=a.url},s.prototype.clone=function(a){var b=n.prototype.clone.call(this,a);return a=G.isa(a,"obj")?a:{},a.keepCopyDimensions||b.fitToImageSize(),b},s.prototype.fitToImageSize=function(){if("img"===this.imageType){var a=G.image[this.source];this.set({copyWidth:a.get("width"),copyHeight:a.get("height"),copyX:0,copyY:0})}return this},s.prototype.sourceImage=function(){return this.get("animSheet")&&G.contains(G.imagenames,this.source)?"animation":G.contains(G.imagenames,this.source)?"img":G.contains(G.cellnames,this.source)?"canvas":!1},s.prototype.clip=function(a){var b=this.prepareStamp();return a.save(),this.rotateCell(a),a.beginPath(),a.rect(b.x,b.y,this.width*this.scale,this.height*this.scale),a.clip(),this},s.prototype.clear=function(a){var b=this.prepareStamp();return this.rotateCell(a),a.clearRect(b.x,b.y,this.width*this.scale,this.height*this.scale),this},s.prototype.clearWithBackground=function(a,b){var c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale;return this.rotateCell(a),a.fillStyle=G.cell[b].backgroundColor,a.strokeStyle=G.cell[b].backgroundColor,a.globalAlpha=1,a.strokeRect(c.x,c.y,d,e),a.fillRect(c.x,c.y,d,e),a.fillStyle=G.ctx[b].fillStyle,a.strokeStyle=G.ctx[b].strokeStyle,a.globalAlpha=G.ctx[b].globalAlpha,this},s.prototype.draw=function(a,b){var c=this.prepareStamp();return this.rotateCell(a),G.cell[b].setEngine(this),a.strokeRect(c.x,c.y,this.width*this.scale,this.height*this.scale),this},s.prototype.fill=function(a,b){var c;return this.imageType&&(c=this.prepareStamp(),this.rotateCell(a),G.cell[b].setEngine(this),a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,c.x,c.y,this.width*this.scale,this.height*this.scale)),this},s.prototype.drawFill=function(a,b){var c,d,e;return this.imageType&&(c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale,this.rotateCell(a),G.cell[b].setEngine(this),a.strokeRect(c.x,c.y,d,e),this.clearShadow(a,b),a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,c.x,c.y,d,e)),this},s.prototype.fillDraw=function(a,b){var c,d,e;return this.imageType&&(c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale,this.rotateCell(a),G.cell[b].setEngine(this),a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,c.x,c.y,d,e),this.clearShadow(a,b),a.strokeRect(c.x,c.y,d,e)),this},s.prototype.sinkInto=function(a,b){var c,d,e;return this.imageType&&(c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale,this.rotateCell(a),G.cell[b].setEngine(this),a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,c.x,c.y,d,e),a.strokeRect(c.x,c.y,d,e)),this},s.prototype.floatOver=function(a,b){var c,d,e;return this.imageType&&(c=this.prepareStamp(),d=this.width*this.scale,e=this.height*this.scale,this.rotateCell(a),G.cell[b].setEngine(this),a.strokeRect(c.x,c.y,d,e),a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,c.x,c.y,d,e)),this},s.prototype.getImageData=function(a){a=G.xt(a)?a:"data";var b,c=this.getImage();return"animation"===this.imageType?(b=G.image[this.source],G.cv.width=b.get("width"),G.cv.height=b.get("height"),G.cvx.drawImage(c,0,0)):(G.cv.width=this.copyWidth,G.cv.height=this.copyHeight,G.cvx.drawImage(c,this.copyX,this.copyY,this.copyWidth,this.copyHeight,0,0,this.copyWidth,this.copyHeight)),this.imageData=this.name+"_"+a,G.imageData[this.imageData]=G.cvx.getImageData(0,0,G.cv.width,G.cv.height),this},s.prototype.getImageDataValue=function(a){var b,c,d,e,f,g,h,i=this.getLocalCoordinate(a),j=G.imageData[this.get("imageData")],k=this.get("imageDataChannel");if("animation"===this.imageType&&G.image[this.source]?(d=G.anim[this.get("animSheet")].getData(),e=this.width/d.copyWidth,f=this.height/d.copyHeight,b=Math.round(i.x/e+d.copyX),c=Math.round(i.y/f+d.copyY)):(e=this.width/this.copyWidth,f=this.height/this.copyHeight,b=Math.round(i.x/e),c=Math.round(i.y/f)),g=!1,h=4*(c*j.width+b),G.isBetween(b,0,j.width-1,!0)&&G.isBetween(c,0,j.height-1,!0))switch(a.channel||k){case"red":g=G.xt(j.data[h])?j.data[h]:!1;break;case"blue":g=G.xt(j.data[h+1])?j.data[h+1]:!1;break;case"green":g=G.xt(j.data[h+2])?j.data[h+2]:!1;break;case"alpha":g=G.xt(j.data[h+3])?j.data[h+3]:!1;break;case"color":g=G.xta([j.data[h],j.data[h+1],j.data[h+2],j.data[h+3]])?"rgba("+j.data[h]+","+j.data[h+1]+","+j.data[h+2]+","+j.data[h+3]+")":!1;break;default:g=!1}return g},s.prototype.getImage=function(){var a,b;switch(this.imageType){case"canvas":b=G.canvas[this.source];break;case"animation":a=G.anim[this.animSheet].getData(),this.set({copyX:a.copyX,copyY:a.copyY,copyWidth:a.copyWidth,copyHeight:a.copyHeight}),b=G.xt(G.img[this.source])?G.img[this.source]:G.object[this.source];break;default:b=G.xt(G.img[this.source])?G.img[this.source]:G.object[this.source]}return b},s.prototype.checkHit=function(a){a=G.isa(a,"obj")?a:{};var b,c,d=n.prototype.checkHit.call(this,a);return this.checkHitUsingImageData&&d?(d.x=parseInt(d.x),d.y=parseInt(d.y),b=this.getImageDataValue(d),"color"===this.get("imageDataChannel")?"rgba(0,0,0,0)"===b?!1:d:(c=G.isa(a.test,"num")?a.test:0,b>c?d:!1)):d},t.prototype=Object.create(n.prototype),t.prototype.type="Outline",t.prototype.classname="spritenames",G.d.Outline={data:"",dataSet:!1,isLine:!0,method:"draw"},G.mergeInto(G.d.Outline,G.d.Sprite),t.prototype.set=function(a){return n.prototype.set.call(this,a),a=G.isa(a,"obj")?a:{},G.xt(a.data)&&(this.dataSet=this.buildDataSet(this.data),delete this.offset),this},t.prototype.getPivotOffsetVector=function(){return u.prototype.getPivotOffsetVector.call(this)},t.prototype.buildDataSet=function(a){for(var b,c,d=[],e=999999,f=999999,g=-999999,h=-999999,i=this.start.x,j=this.start.y,k=a.match(/([A-Za-z][0-9. ,\-]*)/g),l=function(a,b){e=e>a?a:e,f=f>b?b:f,g=a>g?a:g,h=b>h?b:h},m=0,n=k.length;n>m;m++){if(b=k[m][0],c=k[m].match(/(-?[0-9.]+\b)/g)){for(var o=0,p=c.length;p>o;o++)c[o]=parseFloat(c[o]);switch(b){case"H":for(var o=0,p=c.length;p>o;o++)i=c[o],l(i,j);break;case"V":for(var o=0,p=c.length;p>o;o++)j=c[o],l(i,j);break;case"M":for(var o=0,p=c.length;p>o;o+=2)i=c[o],j=c[o+1],l(i,j);case"L":case"T":for(var o=0,p=c.length;p>o;o+=2)i=c[o],j=c[o+1],l(i,j);break;case"Q":case"S":for(var o=0,p=c.length;p>o;o+=4)i=c[o+2],j=c[o+3],l(i,j);break;case"C":for(var o=0,p=c.length;p>o;o+=6)i=c[o+4],j=c[o+5],l(i,j);break;case"h":for(var o=0,p=c.length;p>o;o++)i+=c[o],l(i,j);break;case"v":for(var o=0,p=c.length;p>o;o++)j+=c[o],l(i,j);break;case"m":case"l":case"t":for(var o=0,p=c.length;p>o;o+=2)i+=c[o],j+=c[o+1],l(i,j);break;case"q":case"s":for(var o=0,p=c.length;p>o;o+=4)i+=c[o+2],j+=c[o+3],l(i,j);break;case"c":for(var o=0,p=c.length;p>o;o+=6)i+=c[o+4],j+=c[o+5],l(i,j)}}d.push({c:b,p:c})}for(var m=0,n=d.length;n>m;m++){if(G.contains(["M","L","C","Q","S","T"],d[m].c))for(var o=0,p=d[m].p.length;p>o;o+=2)d[m].p[o]-=e,d[m].p[o+1]-=f;if("H"===d[m].c)for(var o=0,p=d[m].p.length;p>o;o++)d[m].p[o]-=e;if("V"===d[m].c)for(var o=0,p=d[m].p.length;p>o;o++)d[m].p[o]-=f}return this.width=g-e,this.height=h-f,d},t.prototype.doOutline=function(a,b){if(G.cell[b].setEngine(this),!this.dataSet&&this.data&&this.buildDataSet(this.data),this.dataSet){var c,d,e,f=this.prepareStamp(),g=0,h=0,i=0,j=0;this.rotateCell(a),a.translate(f.x,f.y),a.beginPath(),G.contains(["M"],this.dataSet[0].c)||a.moveTo(g,h);for(var k=0,l=this.dataSet.length;l>k;k++)switch(c=this.dataSet[k],c.c){case"M":g=c.p[0],h=c.p[1],i=g,j=h,a.moveTo(g*this.scale,h*this.scale);for(var m=2,n=c.p.length;n>m;m+=2)g=c.p[m],h=c.p[m+1],i=g,j=h,a.lineTo(g*this.scale,h*this.scale);break;case"m":g+=c.p[0],h+=c.p[1],i=g,j=h,a.moveTo(g*this.scale,h*this.scale);for(var m=2,n=c.p.length;n>m;m+=2)g+=c.p[m],h+=c.p[m+1],i=g,j=h,a.lineTo(g*this.scale,h*this.scale);break;case"Z":case"z":a.closePath();break;case"L":for(var m=0,n=c.p.length;n>m;m+=2)g=c.p[m],h=c.p[m+1],i=g,j=h,a.lineTo(g*this.scale,h*this.scale);break;case"l":for(var m=0,n=c.p.length;n>m;m+=2)g+=c.p[m],h+=c.p[m+1],i=g,j=h,a.lineTo(g*this.scale,h*this.scale);break;case"H":for(var m=0,n=c.p.length;n>m;m++)g=c.p[m],i=g,a.lineTo(g*this.scale,h*this.scale);break;case"h":for(var m=0,n=c.p.length;n>m;m++)g+=c.p[m],i=g,a.lineTo(g*this.scale,h*this.scale);break;case"V":for(var m=0,n=c.p.length;n>m;m++)h=c.p[m],j=h,a.lineTo(g*this.scale,h*this.scale);break;case"v":for(var m=0,n=c.p.length;n>m;m++)h+=c.p[m],j=h,a.lineTo(g*this.scale,h*this.scale);break;case"C":for(var m=0,n=c.p.length;n>m;m+=6)a.bezierCurveTo(c.p[m]*this.scale,c.p[m+1]*this.scale,c.p[m+2]*this.scale,c.p[m+3]*this.scale,c.p[m+4]*this.scale,c.p[m+5]*this.scale),i=c.p[m+2],j=c.p[m+3],g=c.p[m+4],h=c.p[m+5];
break;case"c":for(var m=0,n=c.p.length;n>m;m+=6)a.bezierCurveTo((g+c.p[m])*this.scale,(h+c.p[m+1])*this.scale,(g+c.p[m+2])*this.scale,(h+c.p[m+3])*this.scale,(g+c.p[m+4])*this.scale,(h+c.p[m+5])*this.scale),i=g+c.p[m+2],j=h+c.p[m+3],g+=c.p[m+4],h+=c.p[m+5];break;case"S":for(var m=0,n=c.p.length;n>m;m+=4)k>0&&G.contains(["C","c","S","s"],this.dataSet[k-1].c)?(d=g+(g-i),e=h+(h-j)):(d=g,e=h),a.bezierCurveTo(d*this.scale,e*this.scale,c.p[m]*this.scale,c.p[m+1]*this.scale,c.p[m+2]*this.scale,c.p[m+3]*this.scale),i=c.p[m],j=c.p[m+1],g=c.p[m+2],h=c.p[m+3];break;case"s":for(var m=0,n=c.p.length;n>m;m+=4)k>0&&G.contains(["C","c","S","s"],this.dataSet[k-1].c)?(d=g+(g-i),e=h+(h-j)):(d=g,e=h),a.bezierCurveTo(d*this.scale,e*this.scale,(g+c.p[m])*this.scale,(h+c.p[m+1])*this.scale,(g+c.p[m+2])*this.scale,(h+c.p[m+3])*this.scale),i=g+c.p[m],j=h+c.p[m+1],g+=c.p[m+2],h+=c.p[m+3];break;case"Q":for(var m=0,n=c.p.length;n>m;m+=4)a.quadraticCurveTo(c.p[m]*this.scale,c.p[m+1]*this.scale,c.p[m+2]*this.scale,c.p[m+3]*this.scale),i=c.p[m],j=c.p[m+1],g=c.p[m+2],h=c.p[m+3];break;case"q":for(var m=0,n=c.p.length;n>m;m+=4)a.quadraticCurveTo((g+c.p[m])*this.scale,(h+c.p[m+1])*this.scale,(g+c.p[m+2])*this.scale,(h+c.p[m+3])*this.scale),i=g+c.p[m],j=h+c.p[m+1],g+=c.p[m+2],h+=c.p[m+3];break;case"T":for(var m=0,n=c.p.length;n>m;m+=2)k>0&&G.contains(["Q","q","T","t"],this.dataSet[k-1].c)?(d=g+(g-i),e=h+(h-j)):(d=g,e=h),a.quadraticCurveTo(d*this.scale,e*this.scale,c.p[m]*this.scale,c.p[m+1]*this.scale),i=d,j=e,g=c.p[m],h=c.p[m+1];break;case"t":for(var m=0,n=c.p.length;n>m;m+=2)k>0&&G.contains(["Q","q","T","t"],this.dataSet[k-1].c)?(d=g+(g-i),e=h+(h-j)):(d=g,e=h),a.quadraticCurveTo(d*this.scale,e*this.scale,(g+c.p[m])*this.scale,(h+c.p[m+1])*this.scale),i=d,j=e,g+=c.p[m],h+=c.p[m+1]}}return this},t.prototype.clip=function(a){return a.save(),this.doOutline(a),a.clip(),this},t.prototype.clear=function(a,b){var c=G.cell[b];return this.clip(a,b),a.clearRect(0,0,c.get("actualWidth"),c.get(".actualHeight")),a.restore(),this},t.prototype.clearWithBackground=function(a,b){var c=G.cell[b];return this.clip(a,b),a.fillStyle=c.backgroundColor,a.fillRect(0,0,c.get("actualWidth"),c.get("actualHeight")),a.fillStyle=G.ctx[b].get("fillStyle"),a.restore(),this},t.prototype.draw=function(a,b){return this.doOutline(a,b),a.stroke(),this},t.prototype.fill=function(a,b){return this.doOutline(a,b),a.fill(G.ctx[this.context].get("winding")),this},t.prototype.drawFill=function(a,b){return this.doOutline(a,b),a.stroke(),this.clearShadow(a,b),a.fill(G.ctx[this.context].get("winding")),this},t.prototype.fillDraw=function(a,b){return this.doOutline(a,b),a.fill(G.ctx[this.context].get("winding")),this.clearShadow(a,b),a.stroke(),this},t.prototype.sinkInto=function(a,b){return this.doOutline(a,b),a.fill(G.ctx[this.context].get("winding")),a.stroke(),this},t.prototype.floatOver=function(a,b){return this.doOutline(a,b),a.stroke(),a.fill(G.ctx[this.context].get("winding")),this},t.prototype.checkHit=function(a){a=G.isa(a,"obj")?a:{};var b=G.pad[G.currentPad],c=G.cell[b.current].name,d=G.context[b.current],e=G.xt(a.tests)?a.tests:[{x:a.x||!1,y:a.y||!1}],f=!1;this.doOutline(d,c);for(var g=0,h=e.length;h>g&&!(f=d.isPointInPath(e[g].x,e[g].y));g++);return f?e[g]:!1},u.prototype=Object.create(n.prototype),u.prototype.type="Shape",u.prototype.classname="spritenames",G.d.Shape={firstPoint:"",isLine:!0,closed:!0,radius:!1,linkList:[],linkDurations:[],pointList:[],perimeterLength:0,markStart:"",markMid:"",markEnd:"",mark:"",width:0,height:0,method:"draw",precision:10},G.mergeInto(G.d.Shape,G.d.Sprite),u.prototype.prepareShape=function(a,b){if(G.cell[b].setEngine(this),this.firstPoint){var c=this.prepareStamp();this.rotateCell(a),a.translate(c.x,c.y),a.beginPath(),G.link[G.point[this.firstPoint].startLink].sketch(a)}return this},u.prototype.getPivotOffsetVector=function(){if(this.isLine)return n.prototype.getPivotOffsetVector.call(this);var a=this.handle.getVector();if(G.isa(this.handle.x,"str")&&!G.contains(["left","center","right","top","bottom"],this.handle.x))a.x=parseFloat(this.handle.x)/100*this.width-this.width/2;else switch(this.handle.x){case"left":a.x=-(this.width/2);break;case"center":a.x=0;break;case"right":a.x=this.width/2}if(G.isa(this.handle.y,"str")&&!G.contains(["left","center","right","top","bottom"],this.handle.y))a.y=parseFloat(this.handle.y)/100*this.height-this.height/2;else switch(this.handle.y){case"top":a.y=-(this.height/2);break;case"center":a.y=0;break;case"bottom":a.y=this.height/2}return a},u.prototype.stampMark=function(a,b,c,d){var e,f,g,h,i,j,k,l;if("mid"===b){j=this.get("linkList"),h=a.pivot,g=a.group,i=a.handle;for(var m=0,n=j.length;n>m;m++)k=G.link[j[m]],l=G.point[k.get("endPoint")],G.xt(l)&&G.contains(["move","add"],k.get("action"))&&a.set({pivot:l.name,group:d,handle:this.handle}).forceStamp();a.set({pivot:h,group:g,handle:i})}else e=a.path,f=a.pathPlace,g=a.group,i=a.handle,a.set({path:this.name,pathPlace:b,group:d,handle:this.handle}).forceStamp(),a.set({path:e,pathPlace:f,group:g,handle:i});return this},u.prototype.addMarks=function(a,b){var c,d,e=this.get("mark"),f=this.get("markStart"),g=this.get("markMid"),h=this.get("markEnd"),i=!1;if(e||f||g||h){if(this.buildPositions(),d=this.get("linkDurations"),i=f||e||!1,i&&G.contains(G.spritenames,i)&&this.stampMark(G.sprite[i],0,a,b),i=g||e||!1,i&&G.contains(G.spritenames,i)){c=G.sprite[i];for(var j=0,k=d.length-1;k>j;j++)this.stampMark(c,d[j],a,b)}i=h||e||!1,i&&G.contains(G.spritenames,i)&&this.stampMark(G.sprite[i],1,a,b)}return this},u.prototype.clip=function(a,b){return this.closed&&(this.prepareShape(a,b),a.clip()),this},u.prototype.clear=function(a,b){return this.prepareShape(a,b),a.globalCompositeOperation="destination-out",a.stroke(),a.fill(G.ctx[this.context].get("winding")),a.globalCompositeOperation=G.ctx[b].get("globalCompositeOperation"),this},u.prototype.clearWithBackground=function(a,b){{var c=G.cell[b],d=c.get("backgroundColor"),e=G.ctx[b],f=e.get("fillStyle"),g=e.get("strokeStyle");e.get("globalAlpha")}return this.prepareShape(a,b),a.fillStyle=d,a.strokeStyle=d,a.globalAlpha=1,a.stroke(),a.fill(G.ctx[this.context].get("winding")),a.fillStyle=f,a.strokeStyle=g,a.globalAlpha=globalAlpha,this},u.prototype.fill=function(a,b){return this.get("closed")&&(this.prepareShape(a,b),a.fill(G.ctx[this.context].get("winding")),this.addMarks(a,b)),this},u.prototype.draw=function(a,b){return this.prepareShape(a,b),a.stroke(),this.addMarks(a,b),this},u.prototype.drawFill=function(a,b){return this.prepareShape(a,b),a.stroke(),this.get("closed")&&(this.clearShadow(a,b),a.fill(G.ctx[this.context].get("winding"))),this.addMarks(a,b),this},u.prototype.fillDraw=function(a,b){return this.prepareShape(a,b),this.get("closed")&&(a.fill(G.ctx[this.context].get("winding")),this.clearShadow(a,b)),a.stroke(),this.addMarks(a,b),this},u.prototype.sinkInto=function(a,b){return this.prepareShape(a,b),this.get("closed")&&a.fill(G.ctx[this.context].get("winding")),a.stroke(),this.addMarks(a,b),this},u.prototype.floatOver=function(a,b){return this.prepareShape(a,b),a.stroke(),this.get("closed")&&a.fill(G.ctx[this.context].get("winding")),this.addMarks(a,b),this},u.prototype.none=function(a,b){return this.prepareShape(a,b),this},u.prototype.getFullPointList=function(){for(var a=[],b=new RegExp(this.name+"_.*"),c=0,d=G.pointnames.length;d>c;c++)b.test(G.pointnames[c])&&a.push(G.pointnames[c]);return a},u.prototype.getFullLinkList=function(){for(var a=[],b=new RegExp(this.name+"_.*"),c=0,d=G.linknames.length;d>c;c++)b.test(G.linknames[c])&&a.push(G.linknames[c]);return a},u.prototype.checkHit=function(a){a=G.isa(a,"obj")?a:{};{var b=G.pad[a.pad]||G.pad[G.currentPad],c=G.cell[b.current].name,d=G.context[b.current],e=G.xt(a.tests)?a.tests:[{x:a.x||!1,y:a.y||!1}],f=!1;this.get("closed")}this.prepareShape(d,c);for(var g=0,h=e.length;h>g&&!(f=d.isPointInPath(e[g].x,e[g].y));g++);return f?e[g]:!1},u.prototype.buildCollisionVectors=function(a){var c,d,e=G.xt(a)?this.parseCollisionPoints(a):this.collisionPoints,f=0;this.collisionVectors=[];for(var g=0,h=e.length;h>g;g++)if(G.isa(e[g],"num")&&e[g]>=0)if(e[g]>1){c=1/e[g];for(var i=0;i<e[g];i++)d=this.getPerimeterPosition(f,!0,!1,!0),this.collisionVectors.push(d),f+=c}else d=this.getPerimeterPosition(e[g],!0,!1,!0),this.collisionVectors.push(d);else if(G.isa(e[g],"str"))switch(e[g]){case"start":this.collisionVectors.push(new b)}else G.isa(e[g],"obj")&&"Vector"===e[g].type&&this.collisionVectors.push(e[g]);return this},u.prototype.getPerimeterLength=function(a){return(a||!this.get("perimeterLength")||0===this.get("linkDurations").length)&&this.buildPositions(),this.get("perimeterLength")},u.prototype.buildPositions=function(){for(var b,c,d,e=this.get("linkList"),f=[],g=0,h=0,i=e.length;i>h;h++)G.link[e[h]].setPositions();for(var h=0,i=e.length;i>h;h++)c=G.link[e[h]],d=c.get("positions"),b=d[d.length-1].cumulativeLength,g+=b,f.push(g);for(var h=0,i=e.length;i>h;h++)f[h]/=g;return a.prototype.set.call(this,{perimeterLength:g,linkDurations:f}),this},u.prototype.getPerimeterPosition=function(a,b,c,d){a=G.isa(a,"num")?a:1,b=G.isa(b,"bool")?b:!0,c=G.isa(c,"num")&&c?!0:c,c=G.isa(c,"bool")?c:!1,d=G.isa(d,"bool")?d:!1;var e,f,g,h,i,j,k,l,m,n;this.getPerimeterLength(),g=this.get("linkList"),h=this.get("linkDurations");for(var o=0,p=g.length;p>o;o++)if(e=G.link[g[o]],h[o]>=a)return f=0===o?a/h[o]:(a-h[o-1])/(h[o]-h[o-1]),f=0>f?0:f>1?1:f,j=0>f-1e-7?0:f-1e-7,l=f+1e-7>1?1:f+1e-7,b?c?(i=d?e.getLocalSteadyPositionOnLink(j):e.getSteadyPositionOnLink(j),k=d?e.getLocalSteadyPositionOnLink(l):e.getSteadyPositionOnLink(l),m=d?e.getLocalSteadyPositionOnLink(f):e.getSteadyPositionOnLink(f),n=Math.atan2(k.y-i.y,k.x-i.x)/G.radian,{x:m.x,y:m.y,r:n}):d?e.getLocalSteadyPositionOnLink(f):e.getSteadyPositionOnLink(f):c?(i=d?e.getLocalPositionOnLink(j):e.getPositionOnLink(j),k=d?e.getLocalPositionOnLink(l):e.getPositionOnLink(l),m=d?e.getLocalPositionOnLink(f):e.getPositionOnLink(f),n=Math.atan2(k.y-i.y,k.x-i.x)/G.radian,{x:m.x,y:m.y,r:n}):d?e.getLocalPositionOnLink(f):e.getPositionOnLink(f);return!1},v.prototype=Object.create(a.prototype),v.prototype.type="Point",v.prototype.classname="pointnames",G.d.Point={sprite:"",local:new b,startLink:"",fixed:!1},G.mergeInto(G.d.Point,G.d.Scrawl),v.prototype.set=function(b){a.prototype.set.call(this,b),b=G.isa(b,"obj")?b:{};var c=G.xt(b.local)?b.local:{};return G.xto([b.distance,b.angle])?this.setPolar(b):G.xto([b.startX,b.startY,b.currentX,b.currentY,b.local])&&(this.local.x=G.xt(b.startX)?b.startX:G.xt(b.currentX)?b.currentX:G.xt(c.x)?c.x:this.local.x,this.local.y=G.xt(b.startY)?b.startY:G.xt(b.currentY)?b.currentY:G.xt(c.y)?c.y:this.local.y),this},v.prototype.setDelta=function(a){var b,c,d,e=G.xt(a.local)?a.local:{};return a=G.isa(a,"obj")?a:{},G.xto([a.startX,a.startY,a.currentX,a.currentY,a.local])&&(this.local.x+=G.xt(a.startX)?a.startX:G.xt(a.currentX)?a.currentX:G.xt(e.x)?e.x:0,this.local.y+=G.xt(a.startY)?a.startY:G.xt(a.currentY)?a.currentY:G.xt(e.y)?e.y:0),G.xt(a.distance)&&(b=this.local.getMagnitude(),this.local.scalarMultiply((a.distance+b)/b)),G.xt(a.angle)&&(c=this.local.getMagnitude(),d=Math.atan2(this.local.y,this.local.x),d+=a.angle*G.radian,this.local.x=c*Math.cos(d),this.local.y=c*Math.sin(d)),this},v.prototype.setPolar=function(b){var c,d,e;return a.prototype.set.call(this,b),b=G.isa(b,"obj")?b:{},G.xta([b.distance,b.angle])?(e=b.angle*G.radian,this.local.x=b.distance*Math.cos(e),this.local.y=b.distance*Math.sin(e)):(G.xt(b.distance)&&(c=this.local.getMagnitude(),c=G.xt(c)&&c>1e-7?c:1,this.local.scalarMultiply(b.distance/c)),G.xt(b.angle)&&(d=this.local.getMagnitude(),e=b.angle*G.radian,this.local.x=d*Math.cos(e),this.local.y=d*Math.sin(e))),this},v.prototype.getData=function(){var a,c,d,e=G.sprite[this.sprite],f=this.fixed,g=e.scale;return G.xt(this.local)&&"Vector"===this.local.type?(a=this.local.getVector(),G.isa(f,"str")&&(G.contains(G.spritenames,f)||G.contains(G.pointnames,f))?(c=G.sprite[f]||G.point[f],a="Point"===c.type?c.local.getVector().scalarMultiply(g||1):"Particle"===c.type?c.get("position"):c.start.getVector()):f?(d=0!==a.getMagnitude()?e.start.getVector():new b,a.vectorSubtract(d),a.scalarMultiply(g||1),a.rotate(-e.roll)):a.scalarMultiply(g||1),{name:this.name,current:a,startLink:this.startLink}):!1},v.prototype.getCurrentCoordinates=function(){return this.getData().current},v.prototype.setToFixed=function(a,b){var c,d;return G.isa(a,"str")?this.fixed=a:(c=G.isa(a,"obj")&&G.xt(a.x)?a.x:G.isa(a,"num")?a:0,d=G.isa(a,"obj")&&G.xt(a.y)?a.y:G.isa(b,"num")?b:0,this.local.set({x:c,y:d}),this.fixed=!0),this},w.prototype=Object.create(a.prototype),w.prototype.type="Link",w.prototype.classname="linknames",G.d.Link={species:"",startPoint:"",sprite:"",endPoint:"",controlPoint1:"",controlPoint2:"",action:"add",length:0,positions:[]},G.mergeInto(G.d.Link,G.d.Scrawl),w.prototype.set=function(b){return a.prototype.set.call(this,b),b=G.isa(b,"obj")?b:{},G.isa(b.sprite,"str")&&b.sprite!==this.sprite&&this.sprite&&G.removeItem(G.sprite[this.sprite].linkList,this.name),G.isa(b.action,"str")&&this.sprite&&G.contains(G.spritenames,this.sprite)&&("add"===b.action?G.pushUnique(G.sprite[this.sprite].linkList,this.name):G.removeItem(G.sprite[this.sprite].linkList,this.name)),this},w.prototype.pointOnLine=function(a,b,c){if(a&&b&&G.isa(c,"num")){var d=b.getVectorSubtract(a),e=d.getScalarMultiply(c),f=e.getVectorAdd(a);return f}return!1},w.prototype.getPointCoordinates=function(){var a={start:this.startPoint?G.point[this.startPoint].getCurrentCoordinates():new b,end:this.endPoint?G.point[this.endPoint].getCurrentCoordinates():new b};return G.contains(["quadratic","bezier"],this.species)&&(a.control1=this.controlPoint1?G.point[this.controlPoint1].getCurrentCoordinates():new b,"bezier"===this.species&&(a.control2=this.controlPoint2?G.point[this.controlPoint2].getCurrentCoordinates():new b)),a},w.prototype.getLocalPositionOnLink=function(a){a=G.isa(a,"num")?a:1;var c,d,e,f,g,h,i,j,k=this.getPointCoordinates();switch(this.species){case"line":j=this.pointOnLine(k.start,k.end,a);break;case"quadratic":c=this.pointOnLine(k.start,k.control1,a),d=this.pointOnLine(k.control1,k.end,a),j=this.pointOnLine(c,d,a);break;case"bezier":e=this.pointOnLine(k.start,k.control1,a),f=this.pointOnLine(k.control1,k.control2,a),g=this.pointOnLine(k.control2,k.end,a),h=this.pointOnLine(e,f,a),i=this.pointOnLine(f,g,a),j=this.pointOnLine(h,i,a);break;default:j=k.end||k.start||new b}return j},w.prototype.getPositionOnLink=function(a){var b,c=G.sprite[this.sprite],d=c.scale,e=c.roll;return G.isa(a,"num")?(b=this.getLocalPositionOnLink(a),b.scalarMultiply(d).rotate(e).vectorAdd(c.start)):!1},w.prototype.getLocalSteadyPositionOnLink=function(a){a=G.isa(a,"num")?a:1;var b,c,d,e=G.sprite[this.sprite].get("precision"),f=this.positions,g=this.length,h=g*a;h=h>f[e].cumulativeLength?f[e].cumulativeLength:0>h?0:h;for(var i=1;e>=i;i++)if(h<=f[i].cumulativeLength)return b=f[i-1].p,c=f[i].p.getVectorSubtract(b),d=(h-f[i-1].cumulativeLength)/f[i].length,c.scalarMultiply(d).vectorAdd(b);return!1},w.prototype.getSteadyPositionOnLink=function(a){var b=G.sprite[this.sprite],c=this.getLocalSteadyPositionOnLink(a);return c.scalarMultiply(b.scale).rotate(b.roll).vectorAdd(b.start),c},w.prototype.getLength=function(){return this.setPositions(),this.length},w.prototype.setPositions=function(a){var b,c,d,e,f=this.getPointCoordinates(),g=G.isa(a,"num")&&a>0?a:G.sprite[this.sprite].get("precision"),h=1/g,i=0,j=f.start.getVector(),k=G.sprite[this.sprite],l=k.roll;this.positions=[],this.positions.push({p:j.getVector(),length:0,cumulativeLength:i}),k.set({roll:0});for(var m=0;g>m;m++)b=h*(m+1),c=this.getPositionOnLink(b),c.vectorSubtract(k.start),d=c.getVector(),e=c.vectorSubtract(j).getMagnitude(),j=d,i+=e,this.positions.push({p:j.getVector(),length:e,cumulativeLength:i});return this.length=this.positions[g].cumulativeLength,k.roll=l,this},w.prototype.sketch=function(a){var b,c,d,e;switch(this.action){case"close":a.closePath();break;case"move":try{b=G.point[this.endPoint].getData(),a.moveTo(b.current.x,b.current.y)}catch(f){return!0}break;case"add":try{switch(this.species){case"line":b=G.point[this.endPoint].getData(),a.lineTo(b.current.x,b.current.y);break;case"quadratic":c=G.point[this.get("controlPoint1")].getData(),b=G.point[this.endPoint].getData(),a.quadraticCurveTo(c.current.x,c.current.y,b.current.x,b.current.y);break;case"bezier":c=G.point[this.get("controlPoint1")].getData(),d=G.point[this.get("controlPoint2")].getData(),b=G.point[this.endPoint].getData(),a.bezierCurveTo(c.current.x,c.current.y,d.current.x,d.current.y,b.current.x,b.current.y);break;default:return!0}}catch(f){return!0}break;default:return!0}try{e=G.link[G.point[this.endPoint].startLink].sketch(a)}catch(f){return!0}return!0},x.prototype=Object.create(a.prototype),x.prototype.type="Design",x.prototype.classname="designnames",G.d.Design={color:[{color:"black",stop:0},{color:"white",stop:.999999}],setToSprite:!1,roll:0,cell:"",startX:0,startY:0,endX:0,endY:0,startRangeX:1,startRangeY:1,endRangeX:1,endRangeY:1,autoUpdate:!1},G.mergeInto(G.d.Design,G.d.Scrawl),x.prototype.setDelta=function(a){a=G.isa(a,"obj")?a:{};var b={};return a.roll&&(b.roll=this.get("roll")+a.roll),a.startX&&(b.startX=this.get("startX")+a.startX),a.startY&&(b.startY=this.get("startY")+a.startY),a.startRadius&&(b.startRadius=this.get("startRadius")+a.startRadius),a.endX&&(b.endX=this.get("endX")+a.endX),a.endY&&(b.endY=this.get("endY")+a.endY),a.endRadius&&(b.endRadius=this.get("endRadius")+a.endRadius),a.startRangeRadius&&(b.startRangeRadius=this.get("startRangeRadius")+a.startRangeRadius),a.endRangeRadius&&(b.endRangeRadius=this.get("endRangeRadius")+a.endRangeRadius),a.startRangeX&&(b.startRangeX=this.get("startRangeX")+a.startRangeX),a.startRangeY&&(b.startRangeY=this.get("startRangeY")+a.startRangeY),a.endRangeX&&(b.endRangeX=this.get("endRangeX")+a.endRangeX),a.endRangeY&&(b.endRangeY=this.get("endRangeY")+a.endRangeY),this.set(b),this},x.prototype.update=function(a,b){return this.makeGradient(a,b),this.sortStops(),this.applyStops(),this},x.prototype.getData=function(){return G.xt(G.dsn[this.name])?G.dsn[this.name]:"rgba(0,0,0,0)"},x.prototype.makeGradient=function(a,b){b=G.xt(b)?G.cell[b]:G.cell[this.get("cell")],a=G.sprite[a];var c,d,e,f,g,h=G.context[b.name],i=a.getOffsetStartVector();switch(this.type){case"Gradient":if(this.get("setToSprite")){switch(a.type){case"Wheel":g=i.x-a.radius*a.scale,d=i.y-a.radius*a.scale,f=g+2*a.radius*a.scale,e=d+2*a.radius*a.scale;break;case"Shape":g=i.x-a.width/2*a.scale,d=i.y-a.height/2*a.scale,f=g+a.width*a.scale,e=d+a.height*a.scale;break;default:g=i.x,d=i.y,f=g+a.width*a.scale,e=d+a.height*a.scale}g*=this.get("startRangeX"),d*=this.get("startRangeY"),f*=this.get("endRangeX"),e*=this.get("endRangeY")}else g=-a.start.x+this.get("startX"),d=-a.start.y+this.get("startY"),f=-a.start.x+(this.get("endX")||b.actualWidth),e=-a.start.y+(this.get("endY")||b.actualHeight);c=h.createLinearGradient(g,d,f,e);break;case"RadialGradient":this.setToSprite?c=h.createRadialGradient(this.get("startX"),this.get("startY"),this.get("startRadius")*this.get("startRangeRadius"),this.get("endX"),this.get("endY"),this.get("endRadius")*this.get("endRangeRadius")):(g=this.get("startX")-a.start.x,f=this.get("startY")-a.start.y,d=this.get("endX")-a.start.x,e=this.get("endY")-a.start.y,c=h.createRadialGradient(g,f,this.get("startRadius"),d,e,this.get("endRadius")));break;default:c=!1}return G.dsn[this.name]=c,this},x.prototype.sortStops=function(){for(var a=this.get("color"),b=this.get("roll"),c=0,d=a.length;d>c;c++)a[c].stop+=b,G.isBetween(a[c].stop,0,1,!0)||(a[c].stop=a[c].stop>.5?a[c].stop-1:a[c].stop+1),a[c].stop<=0?a[c].stop=1e-6:a[c].stop>=1&&(a[c].stop=.999999);a.sort(function(a,b){return a.stop-b.stop}),this.set({color:a})},x.prototype.applyStops=function(){var a=this.get("color");if(G.dsn[this.name])for(var b=0,c=a.length;c>b;b++)G.dsn[this.name].addColorStop(a[b].stop,a[b].color);return this},x.prototype.remove=function(){return delete G.dsn[this.name],delete G.design[this.name],G.removeItem(G.designnames,this.name),!0},y.prototype=Object.create(x.prototype),y.prototype.type="Gradient",y.prototype.classname="designnames",G.d.Gradient={},G.mergeInto(G.d.Gradient,G.d.Design),y.prototype.swap=function(){var a=this.get("startX"),b=this.get("startY"),c=this.get("endX"),d=this.get("endY");return this.set({startX:c,startY:d,endX:a,endY:b}),this.update(),this},z.prototype=Object.create(x.prototype),z.prototype.type="RadialGradient",z.prototype.classname="designnames",G.d.RadialGradient={startRadius:0,endRadius:0,startRangeRadius:.5,endRangeRadius:0},G.mergeInto(G.d.RadialGradient,G.d.Design),z.prototype.swap=function(){var a=this.get("startX"),b=this.get("startY"),c=this.get("startRadius"),d=this.get("endY"),e=this.get("endY"),f=this.get("endRadius");return this.set({startX:d,startY:e,startRadius:f,endX:a,endY:b,endRadius:c}),this.update(),this},A.prototype=Object.create(a.prototype),A.prototype.type="Pattern",A.prototype.classname="designnames",G.d.Pattern={repeat:"repeat",cell:"",image:"",source:"",canvas:""},G.mergeInto(G.d.Pattern,G.d.Scrawl),A.prototype.set=function(b){return a.prototype.set.call(this,b),this.setImage(),this},A.prototype.setImage=function(a,b){if(G.isa(a,"str")){var c=new Image,d=this;c.id=this.name,c.onload=function(a){try{var b=G.newImage({name:d.name,element:c});G.design[d.name]=d,G.design[d.name].image=b.name,G.design[d.name].source=c.src,G.pushUnique(G.designnames,d.name),G.design[d.name].makeDesign(),G.isa(a,"fn")&&a()}catch(e){return console.log("Pattern "+[d.name]+" - setImage() #1 failed - "+e.name+" error: "+e.message),d}},c.src=a}else if(G.isa(a,"obj")){if("ScrawlImage"===a.type)try{this.image=a.name,this.source=a.source,G.design[this.name]=this,G.pushUnique(G.designnames,this.name),this.makeDesign(),G.isa(b,"fn")&&b()}catch(e){return console.log("Pattern "+[this.name]+" - setImage() #2 failed - "+e.name+" error: "+e.message),d}else if("Cell"===a.type)try{this.canvas=a.name,G.design[this.name]=this,G.pushUnique(G.designnames,this.name),this.makeDesign(),G.isa(b,"fn")&&b()}catch(e){return console.log("Pattern "+[this.name]+" - setImage() #3 failed - "+e.name+" error: "+e.message),d}}else console.log("Pattern "+[this.name]+" - setImage() #4 failed - source not a string or an object",a);return this},A.prototype.getData=function(){return G.xt(G.dsn[this.name])?G.dsn[this.name]:"rgba(0,0,0,0)"},A.prototype.makeDesign=function(){var a=G.context[this.cell],b=G.xt(G.img[this.image])?G.img[this.image]:G.object[this.image];return this.image?b&&(G.dsn[this.name]=a.createPattern(b,this.repeat)):this.canvas&&(G.dsn[this.name]=a.createPattern(G.canvas[this.canvas],this.repeat)),this},A.prototype.remove=function(){return delete G.dsn[this.name],delete G.design[this.name],G.removeItem(G.designnames,this.name),!0},A.prototype.update=function(){return this.makeDesign(),this},B.prototype=Object.create(a.prototype),B.prototype.type="Color",B.prototype.classname="designnames",G.d.Color={r:0,g:0,b:0,a:1,rShift:0,gShift:0,bShift:0,aShift:0,rMax:255,gMax:255,bMax:255,aMax:1,rMin:0,gMin:0,bMin:0,aMin:0,rBounce:!1,gBounce:!1,bBounce:!1,aBounce:!1,autoUpdate:!1},G.mergeInto(G.d.Color,G.d.Scrawl),B.prototype.get=function(b){return G.xt(b)?"random"===b?(this.generateRandomColor(),this.get()):a.prototype.get.call(this,b):"rgba("+(this.r||0)+", "+(this.g||0)+", "+(this.b||0)+", "+(this.a||1)+")"},B.prototype.clone=function(a){var b,c,d=this.parse();return b=G.mergeOver(d,G.isa(a,"obj")?a:{}),c=G.newColor(b),a=G.isa(a,"obj")?a:{},G.xt(a.random)&&a.random&&(delete c.r,delete c.g,delete c.b,delete c.a,c.generateRandomColor(a)),c},B.prototype.getData=function(){return this.get("autoUpdate")&&this.update(),this.checkValues(),this.get()},B.prototype.generateRandomColor=function(b){var c=this.get("rMax"),d=this.get("gMax"),e=this.get("bMax"),f=this.get("aMax"),g=this.get("rMin"),h=this.get("gMin"),i=this.get("bMin"),j=this.get("aMin");return b=G.isa(b,"obj")?b:{},a.prototype.set.call(this,{r:b.r||Math.round(Math.random()*(c-g)+g),g:b.g||Math.round(Math.random()*(d-h)+h),b:b.b||Math.round(Math.random()*(e-i)+i),a:b.a||Math.random()*(f-j)+j}),this.checkValues(),this},B.prototype.checkValues=function(){var b=this.r||0,c=this.g||0,d=this.b||0,e=this.a||1;return b=b>255?255:0>b?0:b,c=c>255?255:0>c?0:c,d=d>255?255:0>d?0:d,e=e>1?1:0>e?0:e,a.prototype.set.call(this,{r:b,g:c,b:d,a:e}),this},B.prototype.set=function(b){return a.prototype.set.call(this,b),b=G.isa(b,"obj")?b:{},b.random&&this.generateRandomColor(b),this.checkValues(),this},B.prototype.update=function(){for(var b,c,d,e,f,g=["r","g","b","a"],h=[],i=[],j=0,k=g.length;k>j;j++)b=this.get(g[j]),c=this.get(g[j]+"Shift"),d=this.get(g[j]+"Min"),e=this.get(g[j]+"Max"),f=this.get(g[j]+"Bounce"),G.isBetween(b+c,e,d,!0)||(f?c=-c:(b=b>(e+d)/2?e:d,c=0)),h[j]=b+c,i[j]=c;return a.prototype.set.call(this,{r:h[0],g:h[1],b:h[2],a:h[3],rShift:i[0],gShift:i[1],bShift:i[2],aShift:i[3]}),this},B.prototype.setDelta=function(b){return b=G.isa(b,"obj")?b:{},a.prototype.set.call(this,{r:(this.r||0)+(b.r||0),g:(this.g||0)+(b.g||0),b:(this.b||0)+(b.b||0),a:(this.a||1)+(b.a||0)}),this.checkValues(),this},B.prototype.convert=function(b){if(b=G.isa(b,"str")?b:"",b.length>0){b.toLowerCase();var c,d=0,e=0,f=0,g=1;if("#"===b[0])b.length<5?(d=this.toDecimal(b[1]+b[1]),e=this.toDecimal(b[2]+b[2]),f=this.toDecimal(b[3]+b[3])):b.length<8&&(d=this.toDecimal(b[1]+b[2]),e=this.toDecimal(b[3]+b[4]),f=this.toDecimal(b[5]+b[6]));else if(/rgb\(/.test(b))c=b.match(/([0-9.]+\b)/g),/%/.test(b)?(d=Math.round(c[0]/100*255),e=Math.round(c[1]/100*255),f=Math.round(c[2]/100*255)):(d=Math.round(c[0]),e=Math.round(c[1]),f=Math.round(c[2]));else if(/rgba\(/.test(b))c=b.match(/([0-9.]+\b)/g),d=c[0],e=c[1],f=c[2],g=c[3];else switch(b){case"green":d=0,e=128,f=0;break;case"silver":d=192,e=192,f=192;break;case"lime":d=0,e=255,f=0;break;case"gray":d=128,e=128,f=128;break;case"grey":d=128,e=128,f=128;break;case"olive":d=128,e=128,f=0;break;case"white":d=255,e=255,f=255;break;case"yellow":d=255,e=255,f=0;break;case"maroon":d=128,e=0,f=0;break;case"navy":d=0,e=0,f=128;break;case"red":d=255,e=0,f=0;break;case"blue":d=0,e=0,f=255;break;case"purple":d=128,e=0,f=128;break;case"teal":d=0,e=128,f=128;break;case"fuchsia":d=255,e=0,f=255;break;case"aqua":d=0,e=255,f=255;break;default:d=0,e=0,f=0}}return a.prototype.set.call(this,{r:d,g:e,b:f,a:g}),this.checkValues(),this},B.prototype.toDecimal=function(a){return parseInt(a,16)},B.prototype.toHex=function(a){return a.toString(16)},B.prototype.remove=function(){return delete G.dsn[this.name],delete G.design[this.name],G.removeItem(G.designnames,this.name),!0},C.prototype=Object.create(a.prototype),C.prototype.type="Particle",C.prototype.classname="spritenames",C.prototype.order=0,G.d.Particle={group:"",order:0,mobile:!0,mass:1,radius:.1,area:.03,drag:.42,elasticity:1,userVar:{},position:{x:0,y:0,z:0},velocity:{x:0,y:0,z:0},engine:"euler",forces:[],springs:[],load:new b},G.mergeInto(G.d.Particle,G.d.Scrawl),C.prototype.set=function(c){c=G.isa(c,"obj")?c:{};var d;return a.prototype.set.call(this,c),this.position.type&&"Vector"===this.position.type||(this.position=new b(c.position||this.position)),G.xto([c.start,c.startX,c.startY])&&(d=G.isa(c.start,"obj")?c.start:{},this.position.x=G.xt(c.startX)?c.startX:G.xt(d.x)?d.x:this.position.x,this.position.y=G.xt(c.startY)?c.startY:G.xt(d.y)?d.y:this.position.y),this.velocity.type&&"Vector"===this.velocity.type||(this.velocity=new b(c.velocity||this.velocity)),G.xto([c.delta,c.deltaX,c.deltaY])&&(d=G.isa(c.delta,"obj")?c.delta:{},this.velocity.x=G.xt(c.deltaX)?c.deltaX:G.xt(d.x)?d.x:this.velocity.x,this.velocity.y=G.xt(c.deltaY)?c.deltaY:G.xt(d.y)?d.y:this.velocity.y),this},C.prototype.clone=function(c){var d=a.prototype.clone.call(this,c);d.position=new b(d.position),d.velocity=new b(d.velocity),d.forces=[];for(var e=0,f=this.forces.length;f>e;e++)d.forces.push(this.forces[e]);return d},C.prototype.addForce=function(a){return G.xt(a)&&this.forces.push(a),this},C.prototype.revert=function(){return this.position=this.priorPosition.getVector(),this},C.prototype.stamp=function(){if(this.mobile)switch(this.calculateLoads(),this.engine){case"improvedEuler":this.updateImprovedEuler();break;case"rungeKutter":this.updateRungeKutter();break;default:this.updateEuler()}return this},C.prototype.forceStamp=function(){return this.stamp()},C.prototype.update=function(){return this.stamp()},C.prototype.calculateLoads=function(){this.load=new b;for(var a=0,c=this.forces.length;c>a;a++)G.isa(this.forces[a],"str")&&G.contains(G.forcenames,this.forces[a])?G.force[this.forces[a]].run(this):this.forces[a](this);for(var a=0,c=this.springs.length;c>a;a++)G.spring[this.springs[a]].start===this.name?this.load.vectorAdd(G.spring[this.springs[a]].force):G.spring[this.springs[a]].end===this.name&&this.load.vectorSubtract(G.spring[this.springs[a]].force);return this},C.prototype.updateEuler=function(){return this.velocity.vectorAdd(this.load.getScalarDivide(this.mass).scalarMultiply(G.physics.deltaTime)),this.priorPosition=this.position.getVector(),this.position.vectorAdd(this.velocity.getScalarMultiply(G.physics.deltaTime)),this},C.prototype.updateImprovedEuler=function(){var a=this.load.getScalarDivide(this.mass).scalarMultiply(G.physics.deltaTime),b=this.load.getVectorAdd(a).scalarDivide(this.mass).scalarMultiply(G.physics.deltaTime),c=a.getVectorAdd(b).scalarDivide(2);return this.velocity.vectorAdd(c),this.priorPosition=this.position.getVector(),this.position.vectorAdd(this.velocity.getScalarMultiply(G.physics.deltaTime)),this},C.prototype.updateRungeKutter=function(){var a=this.load.getScalarDivide(this.mass).scalarMultiply(G.physics.deltaTime).scalarDivide(2),b=this.load.getVectorAdd(a).scalarDivide(this.mass).scalarMultiply(G.physics.deltaTime).scalarDivide(2),c=this.load.getVectorAdd(b).scalarDivide(this.mass).scalarMultiply(G.physics.deltaTime),d=this.load.getVectorAdd(c).scalarDivide(this.mass).scalarMultiply(G.physics.deltaTime);b.scalarMultiply(2),c.scalarMultiply(2);var e=a.getVectorAdd(b).vectorAdd(c).vectorAdd(d).scalarDivide(6);return this.velocity.vectorAdd(e),this.priorPosition=this.position.getVector(),this.position.vectorAdd(this.velocity.getScalarMultiply(G.physics.deltaTime)),this},C.prototype.linearCollide=function(a){var b=this.position.getVectorSubtract(a.position),c=b.getNormal(),d=this.velocity.getVectorSubtract(a.velocity),e=d.getDotProduct(c);e=-e*(1+(this.elasticity+a.elasticity)/2),e/=1/this.mass+1/a.mass;var f=c.getScalarMultiply(e);return this.velocity.vectorAdd(f.scalarDivide(this.mass)),a.velocity.vectorAdd(f.scalarDivide(a.mass).reverse()),this},C.prototype.addSpring=function(a){var b=!1,c=!1;if(G.isa(a,"str")&&G.contains(G.spritenames,a)){c=a;var d={};d.start=this.name,d.end=a,b=G.newSpring(d)}else a=G.isa(a,"obj")?a:{},c=a.end||!1,c&&G.contains(G.spritenames,c)&&(a.start=this.name,b=G.newSpring(a));return b&&(G.pushUnique(this.springs,b.name),G.pushUnique(G.sprite[c].springs,b.name)),this},C.prototype.removeSprings=function(){for(var a=[],b=0,c=this.springs.length;c>b;b++)a.push(this.springs[b]);for(var b=0,c=a.length;c>b;b++)G.spring[a].kill();return this},C.prototype.removeSpringsTo=function(a){if(G.xt(a)&&G.contains(G.spritenames,a)){for(var b,c=[],d=0,e=this.springs.length;e>d;d++)b=G.spring[this.springs[d]],(b.start===this.name||b.end===this.name)&&c.push(this.springs[d]);for(var d=0,e=c.length;e>d;d++)G.spring[c].kill()}return this},C.prototype.pickupSprite=function(){return this},C.prototype.dropSprite=function(){return this},C.prototype.updateStart=function(){return this},D.prototype=Object.create(a.prototype),D.prototype.type="Spring",D.prototype.classname="springnames",G.d.Spring={start:"",end:"",springConstant:1e3,damperConstant:100,restLength:1,currentLength:1,force:{x:0,y:0,z:0}},G.mergeInto(G.d.Spring,G.d.Scrawl),D.prototype.update=function(){var a=G.sprite[this.end].velocity.getVectorSubtract(G.sprite[this.start].velocity),b=G.sprite[this.end].position.getVectorSubtract(G.sprite[this.start].position),c=b.getNormal();
return this.force=c.getScalarMultiply(this.springConstant*(b.getMagnitude()-this.restLength)).vectorAdd(a.vectorMultiply(c).scalarMultiply(this.damperConstant).vectorMultiply(c)),this},D.prototype.kill=function(){return G.removeItem(G.sprite[this.start].springs,this.name),G.removeItem(G.sprite[this.end].springs,this.name),delete G.spring[this.name],G.removeItem(G.springnames,this.name),!0},E.prototype=Object.create(a.prototype),E.prototype.type="Force",E.prototype.classname="forcenames",G.d.Force={fn:function(){}},G.mergeInto(G.d.Force,G.d.Scrawl),E.prototype.run=function(a){return this.fn(a)},E.prototype.kill=function(){return delete G.force[this.name],G.removeItem(G.forcenames,this.name),!0},G.newForce({name:"gravity",fn:function(a){a.load.vectorAdd({y:a.mass*G.physics.gravity})}}),G.newForce({name:"drag",fn:function(a){var b=a.velocity.getConjugate();b.normalize();var c=a.velocity.getMagnitude(),d=.5*G.physics.airDensity*c*c*a.get("area")*a.get("drag");b.scalarMultiply(d),a.load.vectorAdd(b)}}),F.prototype=Object.create(a.prototype),F.prototype.type="Animation",F.prototype.classname="animationnames",G.d.Animation={fn:function(){}},G.mergeInto(G.d.Animation,G.d.Scrawl),F.prototype.run=function(){return G.pushUnique(G.animate,this.name),!0},F.prototype.halt=function(){return G.removeItem(G.animate,this.name),!0},F.prototype.kill=function(){return delete G.animation[this.name],G.removeItem(G.animationnames,this.name),G.removeItem(G.animate,this.name),!0},G.initialize(),G.cvx=G.cv.getContext("2d"),G}();