/*! scrawl 2013-11-24 */
Array.prototype.contains=Array.prototype.contains||function(a){if(a instanceof RegExp){for(var b in this)if(this[b].match(a))return this[b];return!1}for(var b in this)if(this[b]===a)return!0;return!1},Array.prototype.pushUnique=Array.prototype.pushUnique||function(a){return this.contains(a)?!1:(this.push(a),!0)},Array.prototype.removeItem=Array.prototype.removeItem||function(a){if(this.contains(a)){var b=this.indexOf(a);return this.splice(b,1),!0}return!1},Number.prototype.isBetween=Number.prototype.isBetween||function(a,b,c){if(a>b){var d=a;a=b,b=d}return c?this>=a&&b>=this?!0:!1:this>a&&b>this||this===a&&this===b?!0:!1},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),window.scrawl=function(){function a(a){a=A.isa(a,"obj")?a:{};var b=a.name||"";return a.name=A.makeName({name:b,type:this.type,target:this.classname}),this.name=a.name,this.comment=a.comment||"",this.title=a.title||"",this.timestamp=Date.now(),this}function b(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.startX=b.startX||0,this.startY=b.startY||0,this.handleX=b.handleX||0,this.handleY=b.handleY||0,this.moveStartX=b.moveStartX||0,this.moveStartY=b.moveStartY||0,this.moveHandleX=b.moveHandleX||0,this.moveHandleY=b.moveHandleY||0,this.pivot=b.pivot||!1,this.path=b.path||!1,this.pathPosition=b.pathPosition||0,this.movePathPosition=b.movePathPosition||0,this.pathSpeedConstant=A.isa(b.pathSpeedConstant,"bool")?b.pathSpeedConstant:!0,this.pathRoll=0,this.addPathRoll=A.isa(b.addPathRoll,"bool")?b.addPathRoll:!1,this.scale=A.isa(b.scale,"num")?b.scale:1,this}function c(a){return b.call(this,a),a=A.isa(a,"obj")?a:{},this.isIE="Microsoft Internet Explorer"==navigator.appName?!0:!1,this}function d(a){if(a=A.isa(a,"obj")?a:{},A.xt(a.stackElement)){var b="";return A.xto([a.stackElement.id,a.stackElement.name])&&(b=a.stackElement.id||a.stackElement.name),c.call(this,{name:b}),A.stack[this.name]=this,A.stk[this.name]=a.stackElement,A.stacknames.pushUnique(this.name),A.stk[this.name].style.position="relative",A.stk[this.name].id=this.name,this.initialize2d(a),this.initialize3d(a),this}return console.log("Failed to generate a Stack wrapper - no DOM element supplied"),!1}function e(a){if(a=A.isa(a,"obj")?a:{},A.xt(a.domElement)){var b="";return A.xto([a.domElement.id,a.domElement.name])&&(b=a.domElement.id||a.domElement.name),c.call(this,{name:b}),A.element[this.name]=this,A.elm[this.name]=a.domElement,A.elementnames.pushUnique(this.name),A.elm[this.name].style.position="absolute",A.elm[this.name].id=this.name,this.initialize2d(a),this.initialize3d(a),this}return console.log("Failed to generate an Element wrapper - no DOM element supplied"),!1}function f(a){if(a=A.isa(a,"obj")?a:{},A.xt(a.canvasElement)){A.canvas.PadConstructorTemporaryCanvas=a.canvasElement,this.display="PadConstructorTemporaryCanvas";var b="";if(A.xto([a.canvasElement.id,a.canvasElement.name])&&(b=a.canvasElement.id||a.canvasElement.name),b.match(/_display$/)?c.call(this,{name:b.substr(0,b.length-8)}):c.call(this,{name:b}),a.canvasElement.id||(a.canvasElement.id=b),!A.cellnames.contains(this.name)){this.cells=[],this.drawOrder=[],A.pad[this.name]=this,A.padnames.pushUnique(this.name),a.length>1&&this.set(a);var d=new g({name:b,pad:this.name,canvas:a.canvasElement});this.cells.pushUnique(d.name),this.display=d.name,delete A.canvas.PadConstructorTemporaryCanvas;var e=a.canvasElement.cloneNode(!0);e.setAttribute("id",this.name+"_base");var f=new g({name:this.name+"_base",pad:this.name,canvas:e});return this.cells.pushUnique(f.name),this.base=f.name,this.current=f.name,this.initialize2d(),this}}return console.log("Failed to generate a Pad controller - no canvas element supplied"),!1}function g(a){if(A.xta([a,a.canvas])){b.call(this,a),this.pad=a.pad||!1,this.sourceX=a.sourceX||0,this.sourceY=a.sourceY||0,this.sourceWidth=a.sourceWidth||a.width||0,this.sourceHeight=a.sourceHeight||a.height||0,this.sourceMaxWidth=a.sourceMaxWidth||this.sourceWidth,this.sourceMaxHeight=a.sourceMaxHeight||this.sourceHeight,this.sourceMinWidth=a.sourceMinWidth||this.sourceWidth,this.sourceMinHeight=a.sourceMinHeight||this.sourceHeight,this.targetX=a.targetX||0,this.targetY=a.targetY||0,this.targetWidth=a.targetWidth||a.width||0,this.targetHeight=a.targetHeight||a.height||0,this.actualX=a.actualX||0,this.actualY=a.actualY||0,this.actualWidth=a.actualWidth||a.width||0,this.actualHeight=a.actualHeight||a.height||0,this.scaleX=A.isa(a.scaleX,"num")?a.scaleX:1,this.scaleY=A.isa(a.scaleY,"num")?a.scaleY:1,this.roll=a.roll||0,this.cellX=a.cellX||0,this.cellY=a.cellY||0,this.shearX=a.shearX||0,this.shearY=a.shearY||0,this.backgroundColor=A.isa(a.backgroundColor,"str")?a.backgroundColor:"rgba(0,0,0,0)",A.canvas[this.name]=a.canvas,A.context[this.name]=a.canvas.getContext("2d"),A.cell[this.name]=this,A.cellnames.pushUnique(this.name);var c=new h({name:this.name});return this.context=c.name,A.ctx[this.context].getContextFromEngine(A.context[this.name]),this.groups=A.xt(a.groups)?[].concat(a.groups):[],new k({name:this.name,cells:[this.name]}),new k({name:this.name+"_field",cells:[this.name],visibility:!1}),a.field&&(A.group[this.name+"_field"].sprites=[].concat(a.field)),new k({name:this.name+"_fence",cells:[this.name],visibility:!1}),a.fence&&(A.group[this.name+"_fence"].sprites=[].concat(a.fence)),this.usePadDimensions=A.isa(a.usePadDimensions,"bool")?a.usePadDimensions:0===this.sourceWidth&&0===this.sourceHeight&&0===this.targetWidth&&0===this.targetHeight&&0===this.actualWidth&&0===this.actualHeight?!0:!1,this.setDimensions(a),(1!==this.scaleX||1!==this.scaleY||this.shearX||this.shearY||this.cellX||this.cellY||this.roll)&&this.transformCell(),this}return console.log("Cell constructor encountered an error: no canvas element supplied to it"),!1}function h(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.fillStyle=A.isa(b.fillStyle,"str")?b.fillStyle:"#000000",this.winding=A.isa(b.winding,"str")?b.winding:"nonzero",this.strokeStyle=A.isa(b.strokeStyle,"str")?b.strokeStyle:"#000000",this.globalAlpha=A.isa(b.globalAlpha,"num")?b.globalAlpha:1,this.globalCompositeOperation=A.isa(b.globalCompositeOperation,"str")?b.globalCompositeOperation:"source-over",this.lineWidth=A.isa(b.lineWidth,"num")?b.lineWidth:1,this.lineCap=A.isa(b.lineCap,"str")?b.lineCap:"butt",this.lineJoin=A.isa(b.lineJoin,"str")?b.lineJoin:"miter",this.lineDash=A.isa(b.lineDash,"arr")?b.lineDash:[],this.lineDashOffset=A.isa(b.lineDashOffset,"num")?b.lineDashOffset:0,this.miterLimit=A.isa(b.miterLimit,"num")?b.miterLimit:10,this.shadowOffsetX=b.shadowOffsetX||0,this.shadowOffsetY=b.shadowOffsetY||0,this.shadowBlur=b.shadowBlur||0,this.shadowColor=A.isa(b.shadowColor,"str")?b.shadowColor:"rgba(0,0,0,0)",this.font=A.isa(b.font,"str")?b.font:"10pt sans-serif",this.textAlign=A.isa(b.textAlign,"str")?b.textAlign:"start",this.textBaseline=A.isa(b.textBaseline,"str")?b.textBaseline:"alphabetic",A.ctx[this.name]=this,A.ctxnames.pushUnique(this.name),this}function i(b){if(a.call(this,b),b=A.isa(b,"obj")?b:{},this.width=b.width||0,this.height=b.height||0,A.xt(b.imageData)){var c=document.createElement("img");c.id=this.name,c.width=this.width,c.height=this.height,c.src=b.imageData,b.element=c}if(this.source=b.source||!1,A.xt(b.element)){var d=b.element.getAttribute("id")||b.element.getAttribute("name")||b.element.getAttribute("src");this.name=A.makeName({name:d,type:this.type,target:"imagenames"}),this.width=parseFloat(b.element.offsetWidth)||b.element.width||b.element.style.width||0,this.height=parseFloat(b.element.offsetHeight)||b.element.height||b.element.style.height||0,this.source=b.element.src}return this.copyX=b.copyX||0,this.copyY=b.copyY||0,this.copyWidth=b.copyWidth||this.width||0,this.copyHeight=b.copyHeight||this.height||0,A.img[this.name]=b.element,A.image[this.name]=this,A.imagenames.pushUnique(this.name),this}function j(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.sheet=b.sheet||b.source||!1,this.frames=A.xt(b.frames)?[].concat(b.frames):[],this.currentFrame=b.currentFrame||0,this.speed=A.isa(b.speed,"num")?b.speed:1,this.loop=A.isa(b.loop,"str")?b.loop:"end",this.running=A.isa(b.running,"str")?b.running:"complete",this.lastCalled=A.xt(b.lastCalled)?b.lastCalled:Date.now(),A.anim[this.name]=this,A.animnames.pushUnique(this.name),this}function k(a){b.call(this,a),a=A.isa(a,"obj")?a:{},this.sprites=A.xt(a.sprites)?[].concat(a.sprites):[],this.cells=A.xt(a.cells)?[].concat(a.cells):[],this.order=a.order||0,this.visibility=A.isa(a.visibility,"bool")?a.visibility:!0,this.method=a.method||!1,this.fieldTest=a.fieldTest||0,this.fieldChannel=a.fieldChannel||"anycolor",this.roll=a.roll||0,this.groups=A.xt(a.groups)?[].concat(a.groups):[],A.group[this.name]=this,A.groupnames.pushUnique(this.name),0===this.cells.length&&this.cells.push(A.pad[A.currentPad].base);for(var c=0,d=this.cells.length;d>c;c++)A.cell[this.cells[c]].groups.pushUnique(this.name);return this}function l(a){b.call(this,a),a=A.isa(a,"obj")?a:{},this.order=a.order||0,this.visibility=A.isa(a.visibility,"bool")?a.visibility:!0,this.method=A.isa(a.method,"str")?a.method:"Shape"===this.type?"draw":"fill",this.collisionPoints=this.parseCollisionPoints(a.collisionPoints||[]),this.rollable=A.isa(a.rollable,"bool")?a.rollable:!0,this.roll=a.roll||0,this.data=a.data||!1,this.flipReverse=A.isa(a.flipReverse,"bool")?a.flipReverse:!1,this.flipUpend=A.isa(a.flipUpend,"bool")?a.flipUpend:!1,this.scaleOutline=A.isa(a.scaleOutline,"bool")?a.scaleOutline:!0;var c=new h(a);return this.context=c.name,this.group=this.getGroup(a),a.field&&this.addSpriteToCellFields(a.target||a.group),a.fence&&this.addSpriteToCellFences(a.target||a.group),this.fieldChannel=A.isa(a.fieldChannel,"str")?a.fieldChannel:"anycolor",this.fieldTest=a.fieldTest||0,A.xt(a.target)&&this.targetGroup(a),this}function m(a){return l.call(this,a),a=A.isa(a,"obj")?a:{},this.text=a.text||"",this.style=a.style||"normal",this.variant=a.variant||"normal",this.weight=a.weight||"normal",this.size=a.size||12,this.metrics=a.metrics||"pt",this.family=a.family||"sans-serif",this.lineHeight=A.isa(a.lineHeight,"num")?a.lineHeight:1.5,this.backgroundColor=a.backgroundColor||!1,this.backgroundMargin=a.backgroundMargin||0,this.textAlongPath=a.textAlongPath||"phrase",this.fixedWidth=A.isa(a.fixedWidth,"bool")?a.fixedWidth:!1,this.checkFont(a.font),A.sprite[this.name]=this,A.spritenames.pushUnique(this.name),A.group[this.group].addSpritesToGroup(this.name),this.texts=[],this.multiline(a),this}function n(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.text=b.text||"",this.phrase=b.phrase||!1,this.context=A.sprite[this.phrase].context,this.fixedWidth=A.isa(b.fixedWidth,"bool")?b.fixedWidth:!1,this.textAlongPath=b.textAlongPath||"phrase",A.text[this.name]=this,A.textnames.pushUnique(this.name),A.sprite[this.phrase].texts.pushUnique(this.name),this.getMetrics(),this}function o(a){return l.call(this,a),a=A.isa(a,"obj")?a:{},this.width=a.width||0,this.height=a.height||0,A.sprite[this.name]=this,A.spritenames.pushUnique(this.name),A.group[this.group].addSpritesToGroup(this.name),this}function p(a){return l.call(this,a),a=A.isa(a,"obj")?a:{},this.radius=a.radius||0,this.startAngle=a.startAngle||0,this.endAngle=A.isa(a.endAngle,"num")?a.endAngle:360,this.clockwise=A.isa(a.clockwise,"bool")?a.clockwise:!1,this.closed=A.isa(a.closed,"bool")?a.closed:!0,this.includeCenter=A.isa(a.includeCenter,"bool")?a.includeCenter:!1,this.checkHitUsingRadius=A.isa(a.checkHitUsingRadius,"bool")?a.checkHitUsingRadius:!0,this.handleX=a.handleX||"center",this.handleY=a.handleY||"center",this.width=2*this.radius,this.height=this.width,A.sprite[this.name]=this,A.spritenames.pushUnique(this.name),A.group[this.group].addSpritesToGroup(this.name),this}function q(a){if(A.isa(a,"obj")&&A.xt(a.url))return this.importImage(a);if(l.call(this,a),a=A.isa(a,"obj")?a:{},this.source=a.source||!1,this.imageData=a.imageData||!1,this.imageDataChannel=a.imageDataChannel||"alpha",this.animSheet=a.animSheet||!1,this.imageType=this.sourceImage(a.source)||!1,this.checkHitUsingImageData=A.isa(a.checkHitUsingImageData,"bool")?a.checkHitUsingImageData:!1,this.source)if("img"===this.imageType)this.width=a.width||A.image[this.source].copyWidth,this.height=a.height||A.image[this.source].copyHeight,this.copyX=a.copyX||A.image[this.source].copyX,this.copyY=a.copyY||A.image[this.source].copyY,this.copyWidth=a.copyWidth||A.image[this.source].copyWidth,this.copyHeight=a.copyHeight||A.image[this.source].copyHeight;else if("canvas"===this.imageType)this.width=a.width||A.cell[this.source].sourceWidth,this.height=a.height||A.cell[this.source].sourceHeight,this.copyX=a.copyX||A.cell[this.source].sourceX,this.copyY=a.copyY||A.cell[this.source].sourceY,this.copyWidth=a.copyWidth||A.cell[this.source].sourceWidth,this.copyHeight=a.copyHeight||A.cell[this.source].sourceHeight;else if("animation"===this.imageType){var b=A.anim[this.animSheet].getData();this.width=a.width||b.copyWidth,this.height=a.height||b.copyHeight,this.copyX=a.copyX||b.copyX,this.copyY=a.copyY||b.copyY,this.copyWidth=a.copyWidth||b.copyWidth,this.copyHeight=a.copyHeight||b.copyHeight}return A.sprite[this.name]=this,A.spritenames.pushUnique(this.name),A.group[this.group].addSpritesToGroup(this.name),this}function r(a){return l.call(this,a),a=A.isa(a,"obj")?a:{},this.dataSet=A.xt(this.data)?this.buildDataSet(this.data):!1,this.startX=a.startX||0,this.startY=a.startY||0,this.handleX=a.handleX||"left",this.handleY=a.handleY||"top",this.method=a.method||"draw",A.sprite[this.name]=this,A.spritenames.pushUnique(this.name),A.group[this.group].addSpritesToGroup(this.name),this}function s(a){return l.call(this,a),a=A.isa(a,"obj")?a:{},this.firstPoint=a.firstPoint||!1,this.collisionPoints=A.xt(a.collisionPoints)?a.collisionPoints:[],this.closed=A.isa(a.closed,"bool")?a.closed:!0,this.line=A.isa(a.line,"bool")?a.line:!1,this.radius=a.radius||!1,this.linkList=[],this.linkDurations=[],this.pointList=[],this.perimeterLength=!1,this.markStart=a.markStart||a.mark||!1,this.markMid=a.markMid||a.mark||!1,this.markEnd=a.markEnd||a.mark||!1,this.handleX=a.handleX||"center",this.handleY=a.handleY||"center",this.width=a.width||0,this.height=a.height||0,A.sprite[this.name]=this,A.spritenames.pushUnique(this.name),A.group[this.group].addSpritesToGroup(this.name),this}function t(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.sprite=b.sprite||!1,this.distance=b.distance||!1,this.angle=b.angle||!1,this.startLink=b.startLink||!1,this.currentX=b.currentX||0,this.currentY=b.currentY||0,this.visibility=A.isa(b.visibility,"bool")?b.visibility:!0,this.fixed=A.isa(b.fixed,"bool")?b.fixed:!1,A.point[this.name]=this,A.pointnames.pushUnique(this.name),this.sprite&&"Shape"===A.sprite[this.sprite].type&&A.sprite[this.sprite].pointList.pushUnique(this.name),this}function u(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.species=b.species||!1,this.startPoint=b.startPoint||!1,this.sprite=A.xt(A.point[this.startPoint])?A.point[this.startPoint].sprite:!1,this.endPoint=b.endPoint||!1,this.controlPoint1=b.controlPoint1||!1,this.controlPoint2=b.controlPoint2||!1,this.action=b.action||"add",A.link[this.name]=this,A.linknames.pushUnique(this.name),this.length=A.isa(b.length,"bool")&&b.length?this.getLength():!1,this.precision=A.isa(b.precision,"num")?b.precision:100,this.positions=A.isa(b.positions,"bool")&&b.positions?this.setPositions(this.precision):!1,this.startPoint&&this.sprite&&"add"===this.action&&A.sprite[this.sprite].linkList.pushUnique(this.name),this}function v(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.color=b.color||[{color:"black",stop:0},{color:"white",stop:.999999}],this.setToSprite=A.isa(b.setToSprite,"bool")?b.setToSprite:!1,this.roll=b.roll||0,this.cell=b.cell||A.pad[A.currentPad].current,this.startX=b.startX||0,this.startY=b.startY||0,this.endX=b.endX||0,this.endY=b.endY||0,this.handleX=b.handleX||0,this.handleY=b.handleY||0,this.startHandleX=b.startHandleX||0,this.startHandleY=b.startHandleY||0,this.endHandleX=b.endHandleX||0,this.endHandleY=b.endHandleY||0,this.startRangeX=b.startRangeX||0,this.startRangeY=b.startRangeY||0,this.endRangeX=A.isa(b.endRangeX,"num")?b.endRangeX:1,this.endRangeY=A.isa(b.endRangeY,"num")?b.endRangeY:0,this.autoUpdate=A.isa(b.autoUpdate,"bool")?b.autoUpdate:!1,this}function w(a){return v.call(this,a),a=A.isa(a,"obj")?a:{},A.design[this.name]=this,A.designnames.pushUnique(this.name),this.update(),this}function x(a){return v.call(this,a),a=A.isa(a,"obj")?a:{},this.startRadius=a.startRadius||0,this.endRadius=a.endRadius||0,this.startRangeRadius=A.isa(a.startRangeRadius,"num")?a.startRangeRadius:.5,this.endRangeRadius=a.endRangeRadius||0,A.design[this.name]=this,A.designnames.pushUnique(this.name),this.update(),this}function y(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.repeat=b.repeat||"repeat",this.setImage(b.source||b.imageData||A.image[b.image]||!1,this.name),this}function z(b){return a.call(this,b),b=A.isa(b,"obj")?b:{},this.r=b.r||0,this.g=b.g||0,this.b=b.b||0,this.a=b.a||1,this.rShift=b.rShift||0,this.gShift=b.gShift||0,this.bShift=b.bShift||0,this.aShift=b.aShift||0,this.rMax=b.rMax||255,this.gMax=b.gMax||255,this.bMax=b.bMax||255,this.aMax=b.aMax||1,this.rMin=b.rMin||0,this.gMin=b.gMin||0,this.bMin=b.bMin||0,this.aMin=b.aMin||0,this.rBounce=A.isa(b.rBounce,"bool")?b.rBounce:!1,this.gBounce=A.isa(b.gBounce,"bool")?b.gBounce:!1,this.bBounce=A.isa(b.bBounce,"bool")?b.bBounce:!1,this.aBounce=A.isa(b.aBounce,"bool")?b.aBounce:!1,this.autoUpdate=A.isa(b.autoUpdate,"bool")?b.autoUpdate:!1,A.xt(b.color)&&this.convert(b.color),b.random&&this.generateRandomColor(b),this.checkValues(),A.design[this.name]=this,A.designnames.pushUnique(this.name),this}var A={m:"",type:"Library",version:"1.01",object:{},objectnames:[],pad:{},padnames:[],currentPad:null,cell:{},canvas:{},context:{},cellnames:[],ctx:{},ctxnames:[],image:{},imageData:{},img:{},imagenames:[],group:{},groupnames:[],design:{},dsn:{},designnames:[],sprite:{},spritenames:[],point:{},pointnames:[],link:{},linknames:[],anim:{},animnames:[],text:{},textnames:[],stack:{},stk:{},stacknames:[],element:{},elm:{},elementnames:[],nameslist:["objectnames","padnames","cellnames","imagenames","groupnames","designnames","spritenames","pointnames","linknames","ctxnames","animnames","textnames","stacknames","elementnames"],radian:Math.PI/180,mouseX:0,mouseY:0,newPad:function(a){return new f(a)},newStack:function(a){return new d(a)},newElement:function(a){return new e(a)},newCell:function(a){return new g(a)},newImage:function(a){return new i(a)},newGroup:function(a){return new k(a)},newPhrase:function(a){return new m(a)},newBlock:function(a){return new o(a)},newWheel:function(a){return new p(a)},newPicture:function(a){return new q(a)},newOutline:function(a){return new r(a)},newShape:function(a){return new s(a)},newPoint:function(a){return new t(a)},newLink:function(a){return new u(a)},newAnimSheet:function(a){return new j(a)},newGradient:function(a){return new w(a)},newRadialGradient:function(a){return new x(a)},newColor:function(a){return new z(a)},newPattern:function(a){return new y(a)},isa:function(a,b){if(this.xta([a,b])){var c=b.toLowerCase();switch(c){case"bool":case"boolean":return"boolean"==typeof a?!0:!1;case"num":case"number":return"number"==typeof a?!0:!1;case"str":case"string":return"string"==typeof a?!0:!1;case"fn":case"func":case"function":return"function"==typeof a?!0:!1;case"arr":case"array":return"[object Array]"===Object.prototype.toString.call(a)?!0:!1;case"date":return"[object Date]"===Object.prototype.toString.call(a)?!0:!1;case"obj":case"object":return"[object Object]"===Object.prototype.toString.call(a)?!0:!1;default:return!1}}return!1},xt:function(a){return"undefined"!=typeof a?!0:!1},xta:function(a){var b=[].concat(a);if(b.length>0){for(var c=0,d=b.length;d>c;c++)if("undefined"==typeof b[c])return!1;return!0}return!1},xto:function(a){var b=[].concat(a);if(b.length>0)for(var c=0,d=b.length;d>c;c++)if("undefined"!=typeof b[c])return!0;return!1},makeName:function(a){a=this.isa(a,"obj")?a:{};var b={name:this.isa(a.name,"str")?a.name:null,type:this.isa(a.type,"str")?a.type:null,target:this.isa(a.target,"str")?a.target:null};if(this.nameslist.contains(b.target)){var c=b.name||b.type||"default",d=c.split("~£!"),e=this[b.target].contains(d[0])?d[0]+"~£!"+Math.floor(1e8*Math.random()):d[0];return e}return!1},loadNative:function(a){if(a=this.isa(a,"str")?[a]:a,this.isa(a,"arr"))for(var b,c=0,d=a.length;d>c;c++){b=JSON.parse(a[c]);for(var e=0,f=b.length;f>e;e++)switch(b[e].type){case"Group":this.groupnames.contains(b[e].name)?this.group[b[e].name].setToDefaults().set(b[e]):this.newGroup(b[e]);break;case"AnimSheet":this.animnames.contains(b[e].name)?this.anim[b[e].name].setToDefaults().set(b[e]):this.newAnimSheet(b[e]);break;case"ScrawlImage":this.imagenames.contains(b[e].name)?this.image[b[e].name].setToDefaults().set(b[e]):(this.xt(a.element)&&(a.element=document.getElementById(a.element)),this.newImage(b[e]));break;case"Gradient":this.designnames.contains(b[e].name)?this.design[b[e].name].setToDefaults().set(b[e]):this.newGradient(b[e]);break;case"RadialGradient":this.designnames.contains(b[e].name)?this.design[b[e].name].setToDefaults().set(b[e]):this.newRadialGradient(b[e]);break;case"Pattern":this.designnames.contains(b[e].name)?this.design[b[e].name].setToDefaults().set(b[e]):this.newPattern(b[e]);break;case"Color":this.designnames.contains(b[e].name)?this.design[b[e].name].setToDefaults().set(b[e]):this.newColor(b[e]);break;case"Phrase":this.spritenames.contains(b[e].name)?this.sprite[b[e].name].setToDefaults().set(b[e]):this.newPhrase(b[e]);break;case"Block":this.spritenames.contains(b[e].name)?this.sprite[b[e].name].setToDefaults().set(b[e]):this.newBlock(b[e]);break;case"Wheel":this.spritenames.contains(b[e].name)?this.sprite[b[e].name].setToDefaults().set(b[e]):this.newWheel(b[e]);break;case"Picture":var g;this.spritenames.contains(b[e].name)?(g=this.sprite[b[e].name],g.setToDefaults().set(b[e])):g=this.newPicture(b[e]),b[e].checkHitUsingImageData&&g.getImageData();break;case"Outline":this.spritenames.contains(b[e].name)?this.sprite[b[e].name].setToDefaults().set(b[e]):this.newOutline(b[e]);break;case"Shape":this.spritenames.contains(b[e].name)?this.sprite[b[e].name].setToDefaults().set(b[e]):this.newShape(b[e]);break;case"Point":this.pointnames.contains(b[e].name)?this.point[b[e].name].setToDefaults().set(b[e]):this.newPoint(b[e]);break;case"Link":this.linknames.contains(b[e].name)?this.link[b[e].name].setToDefaults().set(b[e]):this.newLink(b[e])}}return!0},getImagesByClass:function(a){if(a){var b=[],c=document.getElementsByClassName(a);if(c.length>0){for(var d,e=0,f=c.length;f>e;e++)d=A.newImage({element:c[e]}),b.push(d.name);return b}}return console.log('scrawl.getImagesByClass() failed to find any <img> elements of class="'+a+'" on the page'),!1},clear:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)A.pad[c[d]].clear(a);return!0}return!1},stampBackground:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)A.pad[c[d]].stampBackground(a);return!0}return!1},compile:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)A.pad[c[d]].compile(a);return!0}return!1},show:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)A.pad[c[d]].show(a);return!0}return!1},render:function(a,b){var c=this.xt(b)?[].concat(b):this.padnames;if(c.length>0){for(var d=0,e=c.length;e>d;d++)A.pad[c[d]].render(a);return!0}return!1},reset:function(){return this.objectnames=[],this.stack={},this.stk={},this.stacknames=[],this.element={},this.elm={},this.elementnames=[],this.pad={},this.padnames=[],this.currentPad=null,this.cell={},this.canvas={},this.context={},this.cellnames=[],this.ctx={},this.ctxnames=[],this.image={},this.imageData={},this.img={},this.imagenames=[],this.group={},this.groupnames=[],this.design={},this.dsn={},this.designnames=[],this.sprite={},this.spritenames=[],this.point={},this.pointnames=[],this.link={},this.linknames=[],this.anim={},this.animnames=[],this.text={},this.textnames=[],this.initialize(),!0},addNewCell:function(a,b){var c=this.isa(b,"str")?b:this.currentPad;return A.pad[c].addNewCell(a)},deleteCells:function(a){if(this.xt(a)){for(var b=[].concat(a),c=0,d=b.length;d>c;c++){for(var e=0,f=this.padnames.length;f>e;e++)this.pad[this.padnames[e]].deleteCell(b[c]);delete this.group[b[c]],delete this.group[b[c]+"_field"],delete this.group[b[c]+"_fence"],this.groupnames.removeItem(b[c]),this.groupnames.removeItem(b[c]+"_field"),this.groupnames.removeItem(b[c]+"_fence"),delete this.context[b[c]],delete this.canvas[b[c]],delete this.ctx[A.cell[b[c]].context],this.ctxnames.removeItem(A.cell[b[c]].context),delete this.cell[b[c]],this.cellnames.removeItem(b[c])}return!0}return!1},setDrawOrder:function(a,b){for(var c=this.xt(b)?[].concat(b):[this.currentPad],d=0,e=c.length;e>d;d++)this.pad[c[d]].setDrawOrder(a);return!0},makeCartesianPoints:function(a){if(a=this.isa(a,"obj")?a:{},this.isa(a.pointLabel,"str")&&this.isa(a.sprite,"str")&&this.isa(a.data,"arr"))for(var b,c=[],d=this.isa(a.visibility,"bool")?a.visibility:!0,e=this.xt(a.linkLabel)?a.linkLabel:a.pointLabel+"_link",f=0,g=a.data.length;g>f;f++)b=new t({name:a.pointLabel+f,sprite:a.sprite,currentX:a.data[f][0]||0,currentY:a.data[f][1]||0,visibility:d,startLink:e+f}),c.push(b.name);return c},makePolarPoints:function(a){if(a=this.isa(a,"obj")?a:{},this.isa(a.pointLabel,"str")&&this.isa(a.sprite,"str")&&this.isa(a.data,"arr"))for(var b,c=[],d=this.isa(a.visibility,"bool")?a.visibility:!0,e=this.xt(a.linkLabel)?a.linkLabel:a.pointLabel+"_link",f=0,g=a.data.length;g>f;f++)b=new t({name:a.pointLabel+f,sprite:a.sprite,distance:a.data[f][0]||0,angle:a.data[f][1]||0,visibility:d,startLink:e+f}),c.push(b.name);return c},makePath:function(a){a=this.isa(a,"obj")?a:{},a.scaleX=a.scaleX||1,a.scaleY=a.scaleY||1,a.startX=a.startX||0,a.startY=a.startY||0,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top";var b=999999,c=999999,d=-999999,e=-999999,f=function(a,f){b=b>a?a:b,c=c>f?f:c,d=a>d?a:d,e=f>e?f:e},g=function(a){var b=a.match(/(-?[0-9.]+\b)/g);if(b){for(var c=0,d=b.length;d>c;c++)b[c]=parseFloat(b[c]);return b}return!1},h=function(a,b,c,d,e,f,g,h,i){new t({name:a+"_p"+b,sprite:c,currentX:d*h,currentY:e*i,visibility:f,startLink:a+"_l"+g})},i=function(a,b,c,d,e,f,g,h,i){g=A.xt(g)?g:{},h=A.xt(h)?h:{},i=A.xt(i)?i:{},new u({name:a+"_l"+b,sprite:c,species:d,startPoint:f.name,endPoint:g.name||!1,controlPoint1:h.name||!1,controlPoint2:i.name||!1,precision:!1,action:e})};if(this.xt(a.data)){var j=this.newShape(a),k=j.name,l=k.replace("~","_","g"),m=A.point,n=a.scaleX,o=a.scaleY;if(j){var p,q,r=a.data.match(/([A-Za-z][0-9. ,\-]*)/g),s=0,v=0,w=j.startX,x=j.startY;h(l,v,k,w,x,!1,s,n,o),v++;for(var y=0,z=r.length;z>y;y++)switch(q=r[y][0],p=g(r[y]),q){case"M":0===y&&a.dataFile?(j.startX=p[0],j.startY=p[1],f(w,x)):(w=p[0],x=p[1],f(w,x),h(l,v,k,w,x,!0,s+1,n,o),v++,i(l,s,k,!1,"move",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++);for(var B=2,C=p.length;C>B;B+=2)h(l,v,k,p[B],p[B+1],!0,s+1,n,o),v++,i(l,s,k,"line","add",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++,w=p[B],x=p[B+1],f(w,x);break;case"m":w+=p[0],x+=p[1],f(w,x),h(l,v,k,w,x,!0,s+1,n,o),v++,i(l,s,k,!1,"move",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++;for(var B=2,C=p.length;C>B;B+=2)h(l,v,k,w+p[B],x+p[B+1],!0,s+1,n,o),v++,i(l,s,k,"line","add",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++,w+=p[B],x+=p[B+1],f(w,x);break;case"Z":case"z":h(l,v,k,j.startX,j.startY,!1,s+1,n,o),v++,i(l,s,k,!1,"close",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++;break;case"L":for(var B=0,C=p.length;C>B;B+=2)h(l,v,k,p[B],p[B+1],!0,s+1,n,o),v++,i(l,s,k,"line","add",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++,w=p[B],x=p[B+1],f(w,x);break;case"l":for(var B=0,C=p.length;C>B;B+=2)h(l,v,k,w+p[B],x+p[B+1],!0,s+1,n,o),v++,i(l,s,k,"line","add",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++,w+=p[B],x+=p[B+1],f(w,x);break;case"H":for(var B=0,C=p.length;C>B;B++)h(l,v,k,p[B],x,!0,s+1,n,o),v++,i(l,s,k,"line","add",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++,w=p[B],f(w,x);break;case"h":for(var B=0,C=p.length;C>B;B++)h(l,v,k,w+p[B],x,!0,s+1,n,o),v++,i(l,s,k,"line","add",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++,w+=p[B],f(w,x);break;case"V":for(var B=0,C=p.length;C>B;B++)h(l,v,k,w,p[B],!0,s+1,n,o),v++,i(l,s,k,"line","add",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++,x=p[B],f(w,x);break;case"v":for(var B=0,C=p.length;C>B;B++)h(l,v,k,w,x+p[B],!0,s+1,n,o),v++,i(l,s,k,"line","add",m[l+"_p"+(v-2)],m[l+"_p"+(v-1)]),s++,x+=p[B],f(w,x);break;case"C":for(var B=0,C=p.length;C>B;B+=6)h(l,v,k,p[B],p[B+1],!1,s+1,n,o),v++,h(l,v,k,p[B+2],p[B+3],!1,s+1,n,o),v++,h(l,v,k,p[B+4],p[B+5],!0,s+1,n,o),v++,i(l,s,k,"bezier","add",m[l+"_p"+(v-4)],m[l+"_p"+(v-1)],m[l+"_p"+(v-3)],m[l+"_p"+(v-2)]),s++,w=p[B+4],x=p[B+5],f(w,x);break;case"c":for(var B=0,C=p.length;C>B;B+=6)h(l,v,k,w+p[B],x+p[B+1],!1,s+1,n,o),v++,h(l,v,k,w+p[B+2],x+p[B+3],!1,s+1,n,o),v++,h(l,v,k,w+p[B+4],x+p[B+5],!0,s+1,n,o),v++,i(l,s,k,"bezier","add",m[l+"_p"+(v-4)],m[l+"_p"+(v-1)],m[l+"_p"+(v-3)],m[l+"_p"+(v-2)]),s++,w+=p[B+4],x+=p[B+5],f(w,x);break;case"S":for(var B=0,C=p.length;C>B;B+=4)y>0&&["C","c","S","s"].contains(r[y-1][0])?(m[l+"_p"+(v-2)].clone({name:l+"_p"+v,currentX:w+(w-m[l+"_p"+(v-2)].currentX),currentY:x+(x-m[l+"_p"+(v-2)].currentY)}),v++):(h(l,v,k,w,x,!1,s+1,n,o),v++),h(l,v,k,p[B],p[B+1],!1,s+1,n,o),v++,h(l,v,k,p[B+2],p[B+3],!0,s+1,n,o),v++,i(l,s,k,"bezier","add",m[l+"_p"+(v-4)],m[l+"_p"+(v-1)],m[l+"_p"+(v-3)],m[l+"_p"+(v-2)]),s++,w=p[B+2],x=p[B+3],f(w,x);break;case"s":for(var B=0,C=p.length;C>B;B+=4)y>0&&["C","c","S","s"].contains(r[y-1][0])?(m[l+"_p"+(v-2)].clone({name:l+"_p"+v,currentX:w+(w-m[l+"_p"+(v-2)].currentX),currentY:x+(x-m[l+"_p"+(v-2)].currentY)}),v++):(h(l,v,k,w,x,!1,s+1,n,o),v++),h(l,v,k,p[B],p[B+1],!1,s+1,n,o),v++,h(l,v,k,p[B+2],p[B+3],!0,s+1,n,o),v++,i(l,s,k,"bezier","add",m[l+"_p"+(v-4)],m[l+"_p"+(v-1)],m[l+"_p"+(v-3)],m[l+"_p"+(v-2)]),s++,w+=p[B+2],x+=p[B+3],f(w,x);break;case"Q":for(var B=0,C=p.length;C>B;B+=4)h(l,v,k,p[B],p[B+1],!1,s+1,n,o),v++,h(l,v,k,p[B+2],p[B+3],!0,s+1,n,o),v++,i(l,s,k,"quadratic","add",m[l+"_p"+(v-3)],m[l+"_p"+(v-1)],m[l+"_p"+(v-2)]),s++,w=p[B+2],x=p[B+3],f(w,x);break;case"q":for(var B=0,C=p.length;C>B;B+=4)h(l,v,k,w+p[B],x+p[B+1],!1,s+1,n,o),v++,h(l,v,k,w+p[B+2],x+p[B+3],!0,s+1,n,o),v++,i(l,s,k,"quadratic","add",m[l+"_p"+(v-3)],m[l+"_p"+(v-1)],m[l+"_p"+(v-2)]),s++,w+=p[B+2],x+=p[B+3],f(w,x);break;case"T":for(var B=0,C=p.length;C>B;B+=2)y>0&&["Q","q","T","t"].contains(r[y-1][0])?(m[l+"_p"+(v-2)].clone({name:l+"_p"+v,currentX:w+(w-m[l+"_p"+(v-2)].currentX),currentY:x+(x-m[l+"_p"+(v-2)].currentY)}),v++):(h(l,v,k,w,x,!1,s+1,n,o),v++),h(l,v,k,p[B],p[B+1],!1,s+1,n,o),v++,i(l,s,k,"quadratic","add",m[l+"_p"+(v-3)],m[l+"_p"+(v-1)],m[l+"_p"+(v-2)]),s++,w=p[B],x=p[B+1],f(w,x);break;case"t":for(var B=0,C=p.length;C>B;B+=2)y>0&&["Q","q","T","t"].contains(r[y-1][0])?(m[l+"_p"+(v-2)].clone({name:l+"_p"+v,currentX:w+(w-m[l+"_p"+(v-2)].currentX),currentY:x+(x-m[l+"_p"+(v-2)].currentY)}),v++):(h(l,v,k,w,x,!1,s+1,n,o),v++),h(l,v,k,p[B],p[B+1],!0,s+1,n,o),v++,i(l,s,k,"quadratic","add",m[l+"_p"+(v-3)],m[l+"_p"+(v-1)],m[l+"_p"+(v-2)]),s++,w+=p[B],x+=p[B+1],f(w,x)}return i(l,s,k,!1,"end",m[l+"_p"+(v-1)],m[l+"_p"+v]),j.firstPoint=l+"_p0",j.width=(d-b)*a.scaleX,j.height=(e-c)*a.scaleY,this.point[l+"_p0"].fixed=j.name,a.path?(j.path=!1,j.forceStamp("none"),j.path=a.path):j.forceStamp("none"),j.handleX=a.handleX||"center",j.handleY=a.handleY||"center",j}}return!1},makeEllipse:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.radiusX=a.radiusX||0,a.radiusY=a.radiusY||0,a.closed=!0;var b="m",c=a.startX,d=a.startY,e=a.startX,f=a.startY-a.radiusY;b+=c-e+","+(d-f),c=e,d=f,e=a.startX+.55*a.radiusX,f=a.startY-a.radiusY,b+="c"+(c-e)+","+(d-f),e=a.startX+a.radiusX,f=a.startY-.55*a.radiusY,b+=" "+(c-e)+","+(d-f),e=a.startX+a.radiusX,f=a.startY,b+=" "+(c-e)+","+(d-f),c=e,d=f,e=a.startX+a.radiusX,f=a.startY+.55*a.radiusY,b+="c"+(c-e)+","+(d-f),e=a.startX+.55*a.radiusX,f=a.startY+a.radiusY,b+=" "+(c-e)+","+(d-f),e=a.startX,f=a.startY+a.radiusY,b+=" "+(c-e)+","+(d-f),c=e,d=f,e=a.startX-.55*a.radiusX,f=a.startY+a.radiusY,b+="c"+(c-e)+","+(d-f),e=a.startX-a.radiusX,f=a.startY+.55*a.radiusY,b+=" "+(c-e)+","+(d-f),e=a.startX-a.radiusX,f=a.startY,b+=" "+(c-e)+","+(d-f),c=e,d=f,e=a.startX-a.radiusX,f=a.startY-.55*a.radiusY,b+="c"+(c-e)+","+(d-f),e=a.startX-.55*a.radiusX,f=a.startY-a.radiusY,b+=" "+(c-e)+","+(d-f),e=a.startX,f=a.startY-a.radiusY,b+=" "+(c-e)+","+(d-f),b+="z",a.data=b;
var g;return a.outline?(a.data="M"+a.startX+","+a.startY+a.data,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top",g=this.newOutline(a)):(a.handleX=a.handleX||"center",a.handleY=a.handleY||"center",g=this.makePath(a)),g},makeRectangle:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.width=a.width||0,a.height=a.height||0,a.radius=a.radius||0,a.closed=!0;var b=a.radiusTopLeftX||a.radiusTopLeft||a.radiusTopX||a.radiusLeftX||a.radiusTop||a.radiusLeft||a.radiusX||a.radius||0,c=a.radiusTopLeftY||a.radiusTopLeft||a.radiusTopY||a.radiusLeftY||a.radiusTop||a.radiusLeft||a.radiusY||a.radius||0,d=a.radiusTopRightX||a.radiusTopRight||a.radiusTopX||a.radiusRightX||a.radiusTop||a.radiusRight||a.radiusX||a.radius||0,e=a.radiusTopRightY||a.radiusTopRight||a.radiusTopY||a.radiusRightY||a.radiusTop||a.radiusRight||a.radiusY||a.radius||0,f=a.radiusBottomRightX||a.radiusBottomRight||a.radiusBottomX||a.radiusRightX||a.radiusBottom||a.radiusRight||a.radiusX||a.radius||0,g=a.radiusBottomRightY||a.radiusBottomRight||a.radiusBottomY||a.radiusRightY||a.radiusBottom||a.radiusRight||a.radiusY||a.radius||0,h=a.radiusBottomLeftX||a.radiusBottomLeft||a.radiusBottomX||a.radiusLeftX||a.radiusBottom||a.radiusLeft||a.radiusX||a.radius||0,i=a.radiusBottomLeftY||a.radiusBottomLeft||a.radiusBottomY||a.radiusLeftY||a.radiusBottom||a.radiusLeft||a.radiusY||a.radius||0,j=a.width/2,k=a.height/2,l="m",m=a.startX,n=a.startY,o=a.startX-j+b,p=a.startY-k;l+=m-o+","+(n-p),m=o,n=p,o=a.startX+j-d,p=a.startY-k,l+="l"+(m-o)+","+(n-p),m=o,n=p,o=a.startX+j-d+.55*d,p=a.startY-k,l+="c"+(m-o)+","+(n-p),o=a.startX+j,p=a.startY-k+e-.55*e,l+=" "+(m-o)+","+(n-p),o=a.startX+j,p=a.startY-k+e,l+=" "+(m-o)+","+(n-p),m=o,n=p,o=a.startX+j,p=a.startY+k-g,l+="l"+(m-o)+","+(n-p),m=o,n=p,o=a.startX+j,p=a.startY+k-g+.55*g,l+="c"+(m-o)+","+(n-p),o=a.startX+j-f+.55*f,p=a.startY+k,l+=" "+(m-o)+","+(n-p),o=a.startX+j-f,p=a.startY+k,l+=" "+(m-o)+","+(n-p),m=o,n=p,o=a.startX-j+h,p=a.startY+k,l+="l"+(m-o)+","+(n-p),m=o,n=p,o=a.startX-j+h-.55*h,p=a.startY+k,l+="c"+(m-o)+","+(n-p),o=a.startX-j,p=a.startY+k-i+.55*i,l+=" "+(m-o)+","+(n-p),o=a.startX-j,p=a.startY+k-i,l+=" "+(m-o)+","+(n-p),m=o,n=p,o=a.startX-j,p=a.startY-k+c,l+="l"+(m-o)+","+(n-p),m=o,n=p,o=a.startX-j,p=a.startY-k+c-.55*c,l+="c"+(m-o)+","+(n-p),o=a.startX-j+b-.55*b,p=a.startY-k,l+=" "+(m-o)+","+(n-p),o=a.startX-j+b,p=a.startY-k,l+=" "+(m-o)+","+(n-p),l+="z",a.data=l;var q;return a.outline?(a.data="M"+a.startX+","+a.startY+a.data,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top",q=this.newOutline(a)):(a.handleX=a.handleX||"center",a.handleY=a.handleY||"center",q=this.makePath(a)),q},makeBezier:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.startControlX=a.startControlX||0,a.startControlY=a.startControlY||0,a.endControlX=a.endControlX||0,a.endControlY=a.endControlY||0,a.endX=a.endX||0,a.endY=a.endY||0,a.closed=!1,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top";var b=a.fixed||"none";a.fixed=!1,a.data="m0,0c"+(a.startControlX-a.startX)+","+(a.startControlY-a.startY)+" "+(a.endControlX-a.startX)+","+(a.endControlY-a.startY)+" "+(a.endX-a.startX)+","+(a.endY-a.startY);var c;if(a.outline)a.data="M"+a.startX+","+a.startY+a.data,c=this.newOutline(a);else{a.line=!0,c=this.makePath(a);var d=c.name.replace("~","_","g");switch(b){case"all":this.point[d+"_p1"].fixed=!0,this.point[d+"_p2"].fixed=!0,this.point[d+"_p3"].fixed=!0,this.point[d+"_p4"].fixed=!0;break;case"both":this.point[d+"_p1"].fixed=!0,this.point[d+"_p4"].fixed=!0;break;case"start":this.point[d+"_p1"].fixed=!0;break;case"startControl":this.point[d+"_p2"].fixed=!0;break;case"endControl":this.point[d+"_p3"].fixed=!0;break;case"end":this.point[d+"_p4"].fixed=!0;break;default:this.point[d+"_p0"].fixed=c.name}}return c},makeQuadratic:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.controlX=a.controlX||0,a.controlY=a.controlY||0,a.endX=a.endX||0,a.endY=a.endY||0,a.closed=!1,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top";var b=a.fixed||"none";a.fixed=!1,a.data="m0,0q"+(a.controlX-a.startX)+","+(a.controlY-a.startY)+" "+(a.endX-a.startX)+","+(a.endY-a.startY);var c;if(a.outline)a.data="M"+a.startX+","+a.startY+a.data,c=this.newOutline(a);else{a.line=!0,c=this.makePath(a);var d=c.name.replace("~","_","g");switch(b){case"all":this.point[d+"_p1"].fixed=!0,this.point[d+"_p2"].fixed=!0,this.point[d+"_p3"].fixed=!0;break;case"both":this.point[d+"_p1"].fixed=!0,this.point[d+"_p3"].fixed=!0;break;case"start":this.point[d+"_p1"].fixed=!0;break;case"control":this.point[d+"_p2"].fixed=!0;break;case"end":this.point[d+"_p3"].fixed=!0;break;default:this.point[d+"_p0"].fixed=c.name}}return c},makeLine:function(a){a=this.isa(a,"obj")?a:{},a.startX=a.startX||0,a.startY=a.startY||0,a.endX=a.endX||0,a.endY=a.endY||0,a.closed=!1;var b=a.fixed||"none";a.fixed=!1,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top",a.data="m0,0 "+(a.endX-a.startX)+","+(a.endY-a.startY);var c;if(a.outline)a.data="M"+a.startX+","+a.startY+a.data,c=this.newOutline(a);else{a.line=!0,c=this.makePath(a);var d=c.name.replace("~","_","g");switch(b){case"both":this.point[d+"_p1"].fixed=!0,this.point[d+"_p2"].fixed=!0;break;case"start":this.point[d+"_p1"].fixed=!0;break;case"end":this.point[d+"_p2"].fixed=!0;break;default:this.point[d+"_p0"].fixed=c.name}}return c},makeRegularShape:function(a){if(a=this.isa(a,"obj")?a:{},this.xto([a.sides,a.angle])){a.startX=a.startX||0,a.startY=a.startY||0,a.radius=this.isa(a.radius,"num")?a.radius:20,a.closed=!0;for(var b=a.sides?360/a.sides:a.angle,c=0,d=b;d>1e-6&&360>c;)c++,d+=b,d%=360;c++;for(var e,f,g=b,h="m",i=0,j=0,k=0;c>=k;k++)e=a.radius*Math.cos(g*this.radian),f=a.radius*Math.sin(g*this.radian),h+=(e-i).toFixed(3)+","+(f-j).toFixed(3)+" ",i=e,j=f,g+=b,g%=360;h+="z",a.data=h;var l;if(a.outline)a.data="M"+a.startX+","+a.startY+a.data,a.handleX=a.handleX||"left",a.handleY=a.handleY||"top",l=this.newOutline(a);else{a.handleX=a.handleX||"center",a.handleY=a.handleY||"center";var l=this.makePath(a);l.width=2*l.radius,l.height=l.width}return l}return!1},deleteSprite:function(a){for(var b=[].concat(a),c=0,d=b.length;d>c;c++)if(this.spritenames.contains(b[c])){if("Shape"===this.sprite[b[c]].type){for(var e=[this.sprite[b[c]].firstPoint],f=this.point[this.sprite[b[c]].firstPoint].getData(),g=[f.startLink],h=this.link[f.startLink];h.action&&["move","add"].contains(h.action)&&(h.controlPoint1&&e.push(h.controlPoint1),h.controlPoint2&&e.push(h.controlPoint2),h.endPoint);)e.push(h.endPoint),g.push(this.point[h.endPoint].startLink),h=this.link[this.point[h.endPoint].startLink];for(var i=0,j=e.length;j>i;i++)this.pointnames.removeItem(e[i]),delete this.point[e[i]];for(var i=0,j=g.length;j>i;i++)this.linknames.removeItem(g[i]),delete this.link[g[i]]}this.ctxnames.removeItem(b[c]),delete this.ctx[b[c]],this.spritenames.removeItem(b[c]),delete this.sprite[b[c]];for(var k=0,l=this.groupnames.length;l>k;k++)this.group[this.groupnames[k]].sprites.removeItem(b[c])}return!0},addSpritesToGroups:function(a,b){if(this.xta([a,b])){for(var c=[].concat(a),d=[].concat(b),e=0,f=c.length;f>e;e++)this.groupnames.contains(c[e])&&this.group[c[e]].addSpritesToGroup(d);return!0}return!1},removeSpritesFromGroups:function(a,b){if(this.xta([a,b])){for(var c=[].concat(a),d=[].concat(b),e=0,f=c.length;f>e;e++)this.groupnames.contains(c[e])&&this.group[c[e]].removeSpritesFromGroup(d);return!0}return!1},buildFields:function(a){var b=this.xt(a)?[].concat(a):[this.pad[this.currentPad].current];"all"===a&&(b=this.cellnames);for(var c=0,d=b.length;d>c;c++)this.cell[b[c]].buildField();return!0},initialize:function(){return this.getStacks(),this.getCanvases(),this.getElements(),this.setDisplayOffsets("all"),!0},getStacks:function(){var a,b=document.getElementsByClassName("scrawlstack"),c=[];if(b.length>0){for(var d=0,e=b.length;e>d;d++)c.push(b[d]);for(var d=0,e=b.length;e>d;d++){a=A.newStack({stackElement:c[d]});for(var f=0,g=A.stk[a.name].children.length;g>f;f++)A.stk[a.name].children[f].style.position="absolute","CANVAS"!==A.stk[a.name].children[f].tagName&&A.newElement({domElement:A.stk[a.name].children[f],stack:a.name});this.elementnames.contains(a.name)&&(a.stack=this.element[a.name].stack,delete this.element[a.name],delete this.elm[a.name],this.elementnames.removeItem(a.name))}return!0}return console.log('scrawl.getStacks() failed to find any elements with class="scrawlstack" on the page'),!1},getCanvases:function(){var a,b,c,d,e=document.getElementsByTagName("canvas"),f=[];if(e.length>0){for(var g=0,h=e.length;h>g;g++)f.push(e[g]);for(var g=0,h=e.length;h>g;g++)-1!==f[g].className.indexOf("stack:")&&(b=f[g].className.match(/stack:(\w+)/),A.stacknames.contains(b[1])?A.stk[b[1]].appendChild(f[g]):(c=document.createElement("div"),c.id=b[1],f[g].parentElement.appendChild(c),c.appendChild(f[g]),d=A.newStack({stackElement:document.getElementById(b[1])}))),a=A.newPad({canvasElement:f[g]}),A.stacknames.contains(f[g].parentElement.id)&&(a.stack=f[g].parentElement.id,f[g].style.position="absolute",a.initialize3d()),0===g&&(A.currentPad=a.name);return!0}return console.log("scrawl.getCanvases() failed to find any <canvas> elements on the page"),!1},getElements:function(){var a,b,c=document.getElementsByClassName("scrawl"),d=[];if(c.length>0){for(var e=0,f=c.length;f>e;e++)d.push(c[e]);for(var e=0,f=c.length;f>e;e++)a=d.id||d.name||!1,A.elementnames.contains(a)||-1!==d[e].className.indexOf("stack:")&&(b=d[e].className.match(/stack:(\w+)/),A.stacknames.contains(b[1])&&(A.stk[b[1]].appendChild(d[e]),A.newElement({domElement:d[e],stack:b[1]})));return!0}return console.log('scrawl.getElements() failed to find any elements with class="scrawl" on the page'),!1},addCanvasToPage:function(a){a=this.isa(a,"obj")?a:{};var b=!1;this.xt(a.stackName)&&(b=document.getElementById(a.stackName)||!1,b||(b=this.addStackToPage({stackName:a.stackName,width:a.width,height:a.height,parentElement:document.getElementById(a.parentElement)||document.body})),a.stack=b.id);var c=b||document.getElementById(a.parentElement)||document.body,d=A.makeName({name:a.canvasName||!1,type:"Pad",target:"padnames"}),e=document.createElement("canvas");e.id=d,c.appendChild(e);var f=document.getElementById(d);f.width=a.width,f.height=a.height;var g=A.newPad({canvasElement:f});return(this.xt(a.position)||b)&&(a.position=a.position||"absolute"),g.set(a),g.setDisplayOffsets(),g},addStackToPage:function(a){if(this.isa(a.stackName,"str")&&this.xt(a.parentElement)){var b=document.createElement("div");b.id=a.stackName,a.parentElement.appendChild(b),a.stackElement=document.getElementById(a.stackName),a.stack=A.stacknames.contains(a.parentElement.id)?a.parentElement.id:!1;var c=new d(a);return A.stk[c.name]}return!1},setDisplayOffsets:function(a){var b=a||"all";if("stacks"===b||"all"===b)for(var c=0,d=A.stacknames.length;d>c;c++)A.stack[A.stacknames[c]].setDisplayOffsets();if("pads"===b||"all"===b)for(var c=0,d=A.padnames.length;d>c;c++)A.pad[A.padnames[c]].setDisplayOffsets();if("elements"===b||"all"===b)for(var c=0,d=A.elementnames.length;d>c;c++)A.element[A.elementnames[c]].setDisplayOffsets();return!0},handleMouseMove:function(a){if(!a)var a=window.event;return a.pageX||a.pageY?(A.mouseX=a.pageX,A.mouseY=a.pageY):(a.clientX||a.clientY)&&(A.mouseX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,A.mouseY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),!0},getImageDataValue:function(a){if(this.xta([a.table,a.channel])&&this.isa(a.x,"num")&&this.isa(a.y,"num")){var b=A.imageData[a.table];if(b&&a.y.isBetween(-1,b.height)&&a.x.isBetween(-1,b.width)){var c,d=4*(a.y*b.width+a.x);if("color"===a.channel)c="rgba("+b.data[d]+","+b.data[d+1]+","+b.data[d+2]+","+b.data[d+3]+")";else{var e;switch(a.channel){case"red":e=0;break;case"blue":e=1;break;case"green":e=2;break;case"alpha":e=3}c=b.data[d+e]}return c}}return!1}};return a.prototype.type="Scrawl",a.prototype.classname="objectnames",a.prototype.get=function(a){return this[a]},a.prototype.set=function(a){for(var b in a)A.xt(this[b])&&A.xt(a[b])&&(this[b]=a[b]);return this},a.prototype.clone=function(a){var b,c=JSON.parse(JSON.stringify(this));switch(a=A.isa(a,"obj")?a:{},c.name=a.name||c.name,this.type){case"Phrase":b=new m(c);break;case"Block":b=new o(c);break;case"Wheel":b=new p(c);break;case"Picture":b=new q(c);break;case"Outline":b=new r(c);break;case"Shape":b=new s(c);break;case"Gradient":b=new w(c);break;case"RadialGradient":b=new x(c);break;case"Pattern":b=new y(c);break;case"Color":b=new z(c);break;case"Point":b=new t(c);break;case"Link":b=new u(c);break;case"Context":b=new h(c);break;case"AnimSheet":b=new j(c)}return b.set(a),b},a.prototype.toString=function(){return JSON.stringify(this)},b.prototype=Object.create(a.prototype),b.prototype.type="SubScrawl",b.prototype.classname="objectnames",b.prototype.moveStart=function(a){switch(a){case"x":this.startX+=this.moveStartX;break;case"y":this.startY+=this.moveStartY;break;case"path":this.pathPosition+=this.movePathPosition,this.pathPosition>1&&(this.pathPosition-=1),this.pathPosition<0&&(this.pathPosition+=1);break;default:this.startX+=this.moveStartX,this.startY+=this.moveStartY,this.pathPosition+=this.movePathPosition,this.pathPosition>1&&(this.pathPosition-=1),this.pathPosition<0&&(this.pathPosition+=1)}return["Block","Phrase","Wheel","Outline","Shape","Picture"].contains(this.type)&&this.setCurrentParameters(A.group[this.group].getOverride(this.name,"none")),this},b.prototype.unmoveStart=function(a){switch(a){case"x":this.startX-=this.moveStartX;break;case"y":this.startY-=this.moveStartY;break;case"path":this.pathPosition-=this.movePathPosition,this.pathPosition>1&&(this.pathPosition-=1),this.pathPosition<0&&(this.pathPosition+=1);break;default:this.startX-=this.moveStartX,this.startY-=this.moveStartY,this.pathPosition-=this.movePathPosition,this.pathPosition>1&&(this.pathPosition-=1),this.pathPosition<0&&(this.pathPosition+=1)}return["Block","Phrase","Wheel","Outline","Shape","Picture"].contains(this.type)&&this.setCurrentParameters(A.group[this.group].getOverride(this.name,"none")),this},b.prototype.exchange=function(a,b){if(A.isa(a,"obj")){var c;switch(b){case"start":c=this.startX,this.startX=a.startX,a.startX=c,c=this.startY,this.startY=a.startY,a.startY=c;break;case"moveStart":c=this.moveStartX,this.moveStartX=a.moveStartX,a.moveStartX=c,c=this.moveStartY,this.moveStartY=a.moveStartY,a.moveStartY=c;break;case"handle":c=this.handleX,this.handleX=a.handleX,a.handleX=c,c=this.handleY,this.handleY=a.handleY,a.handleY=c;break;case"moveHandle":c=this.moveHandleX,this.moveHandleX=a.moveHandleX,a.moveHandleX=c,c=this.moveHandleY,this.moveHandleY=a.moveHandleY,a.moveHandleY=c;break;default:A.xt(this[b])&&A.xt(a[b])&&(c=this[b],this[b]=a[b],a[b]=c)}}return this},b.prototype.moveHandle=function(a){switch(a){case"x":this.handleX+=this.moveHandleX;break;case"y":this.handleY+=this.moveHandleY;break;default:this.handleX+=this.moveHandleX,this.handleY+=this.moveHandleY}return["Block","Phrase","Wheel","Outline","Shape","Picture"].contains(this.type)&&this.setCurrentParameters(A.group[this.group].getOverride(this.name,"none")),this},b.prototype.reverse=function(a){switch(a){case"moveStartX":this.moveStartX=-this.moveStartX;break;case"moveStartY":this.moveStartY=-this.moveStartY;break;case"moveStart":this.moveStartX=-this.moveStartX,this.moveStartY=-this.moveStartY;break;case"moveHandleX":this.moveHandleX=-this.moveHandleX;break;case"moveHandleY":this.moveHandleY=-this.moveHandleY;break;case"moveHandle":this.moveHandleX=-this.moveHandleX,this.moveHandleY=-this.moveHandleY;break;case"movePath":this.movePathPosition=-this.movePathPosition}return this},b.prototype.getPivotOffset=function(a,b){if(A.xt(a)){b=A.isa(b,"bool")?b:!1;var c;if(A.isa(a,"str")&&!["left","center","right","top","bottom"].contains(a))c=b?parseFloat(a)/100*this.height:parseFloat(a)/100*this.width;else switch(a){case"left":c=0;break;case"center":c=b?this.height/2:this.width/2;break;case"right":c=this.width;break;case"top":c=0;break;case"bottom":c=this.height;break;default:c=a}return c}return 0},b.prototype.getStartX=function(a){a=A.isa(a,"obj")?a:{};var b,c,d=this.currentScale||this.scale||1;return this.flipReverse?(b=this.getPivotOffset(this.handleX,!1),c=this.startX+b*d,A.xt(a.x)?c-a.x:c):(b=this.getPivotOffset(this.handleX,!1),c=this.startX-b*d,A.xt(a.x)?c+a.x:c)},b.prototype.getStartY=function(a){a=A.isa(a,"obj")?a:{};var b,c,d=this.currentScale||this.scale||1;return this.flipUpend?(b=this.getPivotOffset(this.handleY,!0),c=this.startY+b*d,A.xt(a.y)?c-a.y:c):(b=this.getPivotOffset(this.handleY,!0),c=this.startY-b*d,A.xt(a.y)?c+a.y:c)},c.prototype=Object.create(b.prototype),c.prototype.type="Scrawl3d",c.prototype.classname="objectnames",c.prototype.initialize2d=function(a){return a=A.isa(a,"obj")?a:{},this.stack=a.stack||!1,this.setTitle(a.title||this.getTitle()||""),this.setComment(a.comment||this.getComment()||""),this.setOverflow(a.overflow||this.getOverflow()||("Stack"===this.type?"hidden":"visible")),this.setZIndex(a.order||a.zIndex||this.getZIndex()||0),this.setWidth(a.width||this.getWidth()||300),this.setHeight(a.height||this.getHeight()||150),this.setLeft(a.startX||a.left||this.getLeft()||0),this.setTop(a.startY||a.top||this.getTop()||0),this.setDisplayOffsets(),this},c.prototype.initialize3d=function(a){return a=A.isa(a,"obj")?a:{},this.setPerspectiveOrigin({perspectiveOriginX:a.perspectiveOriginX,perspectiveOriginY:a.perspectiveOriginY}||a.perspectiveOrigin||this.getPerspectiveOrigin()||!1),this.setPerspective(a.perspective||this.getPerspective()),this.setTransformOrigin({transformOriginX:a.transformOriginX,transformOriginY:a.transformOriginY}||a.transformOrigin||this.getTransformOrigin()||!1),this.setTransformStyle(a.transformStyle||this.getTransformStyle()||"preserve-3d"),this.setBackfaceVisibility(a.backfaceVisibility||this.getBackfaceVisibility()||"visible"),this.setPitch(a.rotateX||a.pitch||0),this.setYaw(a.rotateY||a.yaw||0),this.setRoll(a.rotateZ||a.rotate||a.roll||0),this.setTranslateX(a.translateX||0),this.setTranslateY(a.translateY||0),this.setTranslateZ(a.translateZ||0),this.setRotateFirst(a.rotateFirst||!1),this.setTransform(),this.setDisplayOffsets(),this},c.prototype.set=function(b){return a.prototype.set.call(this,b),b=A.isa(b,"obj")?b:{},A.xt(b.title)&&this.setTitle(b.title),A.xt(b.comment)&&this.setComment(b.comment),A.xt(b.overflow)&&this.setOverflow(b.overflow),A.xto([b.order,b.zIndex])&&this.setZIndex(b.order||b.zIndex||0),A.xt(b.width)&&this.setWidth(b.width),A.xt(b.height)&&this.setHeight(b.height),A.xt(b.position)&&this.setPosition(b.position),A.xto([b.startX,b.left])&&this.setLeft(b.startX||b.left||0),A.xto([b.startY,b.top])&&this.setTop(b.startY||b.top||0),A.xt(b.perspective)&&this.setPerspective(b.perspective),A.xto([b.perspectiveOriginX,b.perspectiveOriginY])?this.setPerspectiveOrigin({perspectiveOriginX:b.perspectiveOriginX||this.perspectiveOriginX,perspectiveOriginY:b.perspectiveOriginY||this.perspectiveOriginY}):A.xt(b.perspectiveOrigin)&&this.setPerspectiveOrigin(b.perspectiveOrigin),A.xto([b.transformOriginX,b.transformOriginY])?this.setTransformOrigin({transformOriginX:b.transformOriginX||this.transformOriginX,transformOriginY:b.transformOriginY||this.transformOriginY}):A.xt(b.transformOrigin)&&this.setTransformOrigin(b.transformOrigin),A.xt(b.transformStyle)&&this.setTransformStyle(b.transformStyle),A.xt(b.backfaceVisibility)&&this.setBackfaceVisibility(b.backfaceVisibility),A.xto([b.rotateX,b.pitch])&&this.setPitch(b.rotateX||b.pitch||0),A.xto([b.rotateY,b.yaw])&&this.setYaw(b.rotateY||b.yaw||0),A.xto([b.rotateZ,b.rotate,b.roll])&&this.setRoll(b.rotateZ||b.rotate||b.roll||0),A.xt(b.translateX)&&this.setTranslateX(b.translateX),A.xt(b.translateY)&&this.setTranslateY(b.translateY),A.xt(b.translateZ)&&this.setTranslateZ(b.translateZ),A.xto([b.rotateX,b.pitch,b.rotateY,b.yaw,b.rotateZ,b.rotate,b.roll,b.translateX,b.translateY,b.translateZ])&&this.setTransform(),A.xto([b.startX,b.left,b.startY,b.top])&&this.setDisplayOffsets(),this},c.prototype.setDelta=function(a){return a=A.isa(a,"obj")?a:{},A.xt(a.width)&&this.setWidth(this.width+a.width),A.xt(a.height)&&this.setHeight(this.height+a.height),A.xto([a.startX,a.left])&&this.setLeft(this.startX+a.startX||this.startX+a.left||this.startX),A.xto([a.startY,a.top])&&this.setTop(this.startY+a.startY||this.startY+a.top||this.startY),A.xto([a.rotateX,a.pitch])&&this.setPitch(this.pitch+a.rotateX||this.pitch+a.pitch||this.pitch),A.xto([a.rotateY,a.yaw])&&this.setYaw(this.yaw+a.rotateY||this.yaw+a.yaw||this.yaw),A.xto([a.rotateZ,a.rotate,a.roll])&&this.setRoll(this.roll+a.rotateZ||this.roll+a.rotate||this.roll+a.roll||this.roll),A.xt(a.translateX)&&this.setTranslateX(this.translateX+a.translateX),A.xt(a.translateY)&&this.setTranslateY(this.translateY+a.translateY),A.xt(a.translateZ)&&this.setTranslateZ(this.translateZ+a.translateZ),A.xto([a.rotateX,a.pitch,a.rotateY,a.yaw,a.rotateZ,a.rotate,a.roll,a.translateX,a.translateY,a.translateZ])&&this.setTransform(),A.xto([a.startX,a.left,a.startY,a.top])&&this.setDisplayOffsets(),this},c.prototype.setDisplayOffsets=function(){this.displayOffsetX=0,this.displayOffsetY=0;var a=this.getElement();if(a.offsetParent)do this.displayOffsetX+=a.offsetLeft,this.displayOffsetY+=a.offsetTop;while(a=a.offsetParent);return this},c.prototype.getPosition=function(){var a=this.getElement();return a.style.position||!1},c.prototype.setPosition=function(a){this.position=A.xt(a)?a:this.position;var b=this.getElement();return b.style.position=this.position,this},c.prototype.getTitle=function(){var a=this.getElement();return a.title||!1},c.prototype.setTitle=function(a){this.title=A.xt(a)?a:this.title;var b=this.getElement();return b.title=this.title,this},c.prototype.getComment=function(){var a=this.getElement();return a.getAttribute("data-comment")||!1},c.prototype.setComment=function(a){this.comment=A.xt(a)?a:this.comment;var b=this.getElement();return b.setAttribute("data-comment",this.comment),this},c.prototype.getOverflow=function(){var a=this.getElement();return a.style.overflow||!1},c.prototype.setOverflow=function(a){this.overflow=A.xt(a)?a:this.overflow;var b=this.getElement();return b.style.overflow=this.overflow,this},c.prototype.getZIndex=function(){var a=this.getElement();return a.style.zIndex||!1},c.prototype.setZIndex=function(a){this.zIndex=a||this.zIndex||0;var b=this.getElement();return b.style.zIndex=this.zIndex,this},c.prototype.getWidth=function(){var a=this.getElement();return a.width||a.clientWidth||parseFloat(a.style.width)||!1},c.prototype.setWidth=function(a){this.width=A.xt(a)?a:this.width;var b=this.getElement();return"Pad"===this.type?b.width=this.width*this.scale:b.style.width=this.width*this.scale+"px",this},c.prototype.getHeight=function(){var a=this.getElement();return a.height||a.clientHeight||parseFloat(a.style.height)||!1},c.prototype.setHeight=function(a){this.height=A.xt(a)?a:this.height;var b=this.getElement();return"Pad"===this.type?b.height=this.height*this.scale:b.style.height=this.height*this.scale+"px",this},c.prototype.getStartX=function(){return this.getLeft()},c.prototype.setStartX=function(a,b){return this.setLeft(a,b)},c.prototype.getLeft=function(){var a=this.getElement();return parseFloat(a.style.left)||!1},c.prototype.setLeft=function(a,b){this.startX=A.xt(a)?a:this.startX;var c=this.getElement();return c.style.left=this.startX*this.scale+"px",A.xt(b)&&b&&this.setDisplayOffsets(),this},c.prototype.getStartY=function(){return this.getTop()},c.prototype.setStartY=function(a,b){return this.setTop(a,b)},c.prototype.getTop=function(){var a=this.getElement();return parseFloat(a.style.top)||!1},c.prototype.setTop=function(a,b){this.startY=A.xt(a)?a:this.startY;var c=this.getElement();return c.style.top=this.startY*this.scale+"px",A.xt(b)&&b&&this.setDisplayOffsets(),this},c.prototype.getPerspective=function(){var a=this.getElement();return parseFloat(a.style.webkitPerspective)||parseFloat(a.style.MozPerspective)||parseFloat(a.style.perspective)||!1},c.prototype.setPerspective=function(a){if(this.isIE&&"Stack"===this.type)for(var b=0,c=A.stacknames.length;c>b;b++)A.stack[A.stacknames[b]].stack===this.name&&A.stack[A.stacknames[b]].setPerspective(a);this.perspective=A.xt(a)?a:this.perspective;var d=this.getElement();return A.xt(d.style.webkitPerspective)?d.style.webkitPerspective=this.perspective*this.scale+"px":A.xt(d.style.MozPerspective)?d.style.MozPerspective=this.perspective*this.scale+"px":d.style.perspective=this.perspective*this.scale+"px",this},c.prototype.getPerspectiveOrigin=function(){var a=this.getElement();return a.style.webkitPerspectiveOrigin||a.style.MozPerspectiveOrigin||a.style.perspectiveOrigin||!1},c.prototype.setPerspectiveOrigin=function(a){if(this.isIE&&"Stack"===this.type)for(var b=0,c=A.stacknames.length;c>b;b++)A.stack[A.stacknames[b]].stack===this.name&&A.stack[A.stacknames[b]].setPerspectiveOrigin(a);if(A.isa(a,"str")){var d=a.split(" ");this.perspectiveOriginX=d[0]||"50%",this.perspectiveOriginY=d[1]||"50%"}else a=A.isa(a,"obj")?a:{},this.perspectiveOriginX=a.perspectiveOriginX||this.perspectiveOriginX||"50%",this.perspectiveOriginY=a.perspectiveOriginY||this.perspectiveOriginY||"50%";var e=this.getElement();return A.xt(e.style.webkitPerspectiveOrigin)?e.style.webkitPerspectiveOrigin=this.perspectiveOriginX+" "+this.perspectiveOriginY:A.xt(e.style.MozPerspectiveOrigin)?e.style.MozPerspectiveOrigin=this.perspectiveOriginX+" "+this.perspectiveOriginY:e.style.perspectiveOrigin=this.perspectiveOriginX+" "+this.perspectiveOriginY,this},c.prototype.getTransformOrigin=function(){var a=this.getElement();return a.style.webkitTransformOrigin||a.style.MozTransformOrigin||a.style.transformOrigin||!1},c.prototype.setTransformOrigin=function(a){if(A.isa(a,"str")){var b=a.split(" ");this.transformOriginX=b[0]||"50%",this.transformOriginY=b[1]||"50%"}else a=A.isa(a,"obj")?a:{},this.transformOriginX=a.transformOriginX||this.transformOriginX||"50%",this.transformOriginY=a.transformOriginY||this.transformOriginY||"50%";var c=this.getElement();return A.xt(c.style.webkitTransformOrigin)?c.style.webkitTransformOrigin=this.transformOriginX+" "+this.transformOriginY:A.xt(c.style.MozTransformOrigin)?c.style.MozTransformOrigin=this.transformOriginX+" "+this.transformOriginY:c.style.transformOrigin=this.transformOriginX+" "+this.transformOriginY,this},c.prototype.getTransformStyle=function(){var a=this.getElement();return a.style.WebkitTransformStyle||a.style.MozTransformStyle||a.style.transformStyle||!1},c.prototype.setTransformStyle=function(a){this.transformStyle=A.xt(a)?a:this.transformStyle;var b=this.getElement();return A.xt(b.style.WebkitTransformStyle)?b.style.WebkitTransformStyle=this.transformStyle:A.xt(b.style.MozTransformStyle)?b.style.MozTransformStyle=this.transformStyle:b.style.transformStyle=this.transformStyle,this},c.prototype.getRotateX=function(){return this.getPitch()},c.prototype.getPitch=function(){return this.pitch||!1},c.prototype.getRotateY=function(){return this.getYaw()},c.prototype.getYaw=function(){return this.yaw||!1},c.prototype.getRotateZ=function(){return this.getRoll()},c.prototype.getRotate=function(){return this.getRoll()},c.prototype.getRoll=function(){return this.roll||!1},c.prototype.setRotateX=function(a){return this.setPitch(a)},c.prototype.setPitch=function(a){return this.pitch=a||this.pitch||0,this},c.prototype.setRotateY=function(a){return this.setYaw(a)},c.prototype.setYaw=function(a){return this.yaw=a||this.yaw||0,this},c.prototype.setRotateZ=function(a){return this.setRoll(a)},c.prototype.setRotate=function(a){return this.setRoll(a)},c.prototype.setRoll=function(a){return this.roll=a||this.roll||0,this},c.prototype.getTranslateX=function(){return this.translateX||!1},c.prototype.setTranslateX=function(a){return this.translateX=a||this.translateX||0,this},c.prototype.getTranslateY=function(){return this.translateY||!1},c.prototype.setTranslateY=function(a){return this.translateY=a||this.translateY||0,this},c.prototype.getTranslateZ=function(){return this.translateZ||!1},c.prototype.setTranslateZ=function(a){return this.translateZ=a||this.translateZ||0,this},c.prototype.setRotateFirst=function(a){return this.rotateFirst=A.isa(a,"bool")?a:!1,this},c.prototype.getTransform=function(){return this.rotateFirst?"rotateX("+this.pitch+"deg) rotateY("+this.yaw+"deg) rotateZ("+this.roll+"deg) translateX("+this.translateX*this.scale+"px) translateY("+this.translateY*this.scale+"px) translateZ("+this.translateZ*this.scale+"px)":"translateX("+this.translateX*this.scale+"px) translateY("+this.translateY*this.scale+"px) translateZ("+this.translateZ*this.scale+"px) rotateX("+this.pitch+"deg) rotateY("+this.yaw+"deg) rotateZ("+this.roll+"deg)"},c.prototype.setTransform=function(a){a=A.isa(a,"obj")?a:{},this.setPitch(a.pitch||a.rotateX||!1),this.setYaw(a.yaw||a.rotateY||!1),this.setRoll(a.roll||a.rotateZ||a.rotate||!1),this.setTranslateX(a.translateX||!1),this.setTranslateY(a.translateY||!1),this.setTranslateZ(a.translateZ||!1);var b=this.getElement();if(A.xt(b.style.webkitTransform))b.style.webkitTransform=this.getTransform();else if(A.xt(b.style.MozTransform))b.style.MozTransform=this.getTransform();else if(this.isIE&&"Stack"===this.type){b.style.transform=this.getTransform();for(var c=0,d=A.stacknames.length;d>c;c++)A.stack[A.stacknames[c]].stack===this.name&&A.stack[A.stacknames[c]].setTransform();for(var c=0,d=A.elementnames.length;d>c;c++)A.element[A.elementnames[c]].stack===this.name&&A.element[A.elementnames[c]].setTransform();for(var c=0,d=A.padnames.length;d>c;c++)A.pad[A.padnames[c]].stack===this.name&&A.pad[A.padnames[c]].setTransform()}else b.style.transform=this.getTransform();return this},c.prototype.getBackfaceVisibility=function(){var a=this.getElement();return a.style.webkitBackfaceVisibility||a.style.MozBackfaceVisibility||a.style.backfaceVisibility||!1},c.prototype.setBackfaceVisibility=function(a){this.backfaceVisibility=A.xt(a)?a:this.backfaceVisibility;var b=this.getElement();return A.xt(b.style.webkitBackfaceVisibility)?b.style.webkitBackfaceVisibility=this.backfaceVisibility:A.xt(b.style.MozBackfaceVisibility)?b.style.MozBackfaceVisibility=this.backfaceVisibility:b.style.backfaceVisibility=this.backfaceVisibility,this},c.prototype.shiftPosition=function(){return this.shiftLeft(),this.shiftTop(),this.setDisplayOffsets(),this},c.prototype.shiftLeft=function(a){return this.moveStart("x"),this.setLeft(),A.xt(a)&&a&&this.setDisplayOffsets(),this},c.prototype.shiftTop=function(a,b){return this.moveStart("y"),this.setTop(),A.xt(b)&&b&&this.setDisplayOffsets(),this},c.prototype.scaleStack=function(a){if("Stack"===this.type){for(var b=0,c=A.stacknames.length;c>b;b++)A.stack[A.stacknames[b]].stack===this.name&&A.stack[A.stacknames[b]].scaleStack(a);for(var b=0,c=A.elementnames.length;c>b;b++)A.element[A.elementnames[b]].stack===this.name&&A.element[A.elementnames[b]].scaleDimensions(a);for(var b=0,c=A.padnames.length;c>b;b++)A.pad[A.padnames[b]].stack===this.name&&A.pad[A.padnames[b]].scaleDimensions(a);this.scaleDimensions(a)}return this},c.prototype.scaleDimensions=function(a){return this.scale=a||this.scale,this.setWidth(),this.setHeight(),this.setTop(),this.setLeft(),this.setPerspectiveOrigin(),this.setPerspective(),this.setTransformOrigin(),this.setTransform(),this.setDisplayOffsets(),"Pad"===this.type&&(A.cell[this.display].scale=this.scale),this},d.prototype=Object.create(c.prototype),d.prototype.type="Stack",d.prototype.classname="stacknames",d.prototype.getElement=function(){return A.stk[this.name]},d.prototype.addElementById=function(a){if(A.isa(a,"str")){var b=A.newElement({domElement:document.getElementById(a),stack:this.name});return A.stk[this.name].appendChild(A.elm[b.name]),A.elm[b.name]=document.getElementById(b.name),A.setDisplayOffsets("all"),b}return!1},d.prototype.addElementsByClassName=function(a){if(A.isa(a,"str")){for(var b,c,d=[],e=document.getElementsByClassName(a),f=0,g=e.length;g>f;f++)c=e[f],"CANVAS"!==c.nodeName&&(b=A.newElement({domElement:c,stack:this.name}),d.push(b));
for(var f=0,g=d.length;g>f;f++)A.stk[this.name].appendChild(A.elm[d[f].name]),A.elm[d[f].name]=document.getElementById(d[f].name);return A.setDisplayOffsets("all"),d}return!1},e.prototype=Object.create(c.prototype),e.prototype.type="Element",e.prototype.classname="elementnames",e.prototype.getElement=function(){return A.elm[this.name]},f.prototype=Object.create(c.prototype),f.prototype.type="Pad",f.prototype.classname="padnames",f.prototype.getElement=function(){return A.canvas[this.display]},f.prototype.set=function(a){return c.prototype.set.call(this,a),A.cell[this.display].set(a),A.cell[this.base].set(a),a=A.isa(a,"obj")?a:{},this.setDrawOrder(a.drawOrder||[]),A.isa(a.scale,"num")&&(A.cell[this.display].scale=a.scale,this.scale=a.scale),this},f.prototype.setDrawOrder=function(a){return this.drawOrder=A.xt(a)?[].concat(a):[],this},f.prototype.getMouse=function(){return window.onmousemove||(window.onmousemove=A.handleMouseMove),A.mouseX.isBetween(this.displayOffsetX,this.displayOffsetX+this.width*this.scale,!0)&&A.mouseY.isBetween(this.displayOffsetY,this.displayOffsetY+this.height*this.scale,!0)?(this.mouseX=(A.mouseX-this.displayOffsetX)*(1/this.scale),this.mouseY=(A.mouseY-this.displayOffsetY)*(1/this.scale),this.mouseOverPad=!0):(this.mouseX=0,this.mouseY=0,this.mouseOverPad=!1),{x:this.mouseX,y:this.mouseY,active:this.mouseOverPad}},f.prototype.getCellsForDisplayAction=function(a){var b=[];if(A.isa(a,"arr"))b=a;else{for(var c=0,d=this.cells.length;d>c;c++)b.push(this.cells[c]);switch(a){case"all":break;case"display":b=[this.display];break;case"base":b=[this.base];break;case"non-base":b.removeItem(this.base);break;case"current":b=[this.current];break;case"non-current":b.removeItem(this.current);break;case"additionals":b.removeItem(this.display),b.removeItem(this.base);break;case"non-additionals":b=[this.display,this.base];break;case"none":b=[];break;default:b.removeItem(this.display)}}return b},f.prototype.clear=function(a){for(var b=this.getCellsForDisplayAction(a),c=0,d=b.length;d>c;c++)A.cell[b[c]].clear();return this},f.prototype.compile=function(a){for(var b=this.getCellsForDisplayAction(a),c=0,d=b.length;d>c;c++)A.cell[b[c]].compile();return this},f.prototype.stampBackground=function(a){for(var b=this.getCellsForDisplayAction(a),c=0,d=b.length;d>c;c++)A.cell[b[c]].stampBackground();return this},f.prototype.show=function(a){switch(a){case"wipe-base":A.cell[this.base].clear();break;case"wipe-both":A.cell[this.base].clear(),A.cell[this.display].clear();break;default:A.cell[this.display].clear()}if(this.drawOrder.length>0)for(var b=0,c=this.drawOrder.length;c>b;b++)A.cell[this.base].copyCellToSelf(A.cell[this.drawOrder[b]]);return A.cell[this.display].copyCellToSelf(A.cell[this.base]),this},f.prototype.render=function(a){return a=A.isa(a,"obj")?a:{},a.clear=A.xt(a.clear)?a.clear:null,a.compile=A.xt(a.compile)?a.compile:null,a.show=A.xt(a.show)?a.show:null,this.clear(a.clear),this.compile(a.compile),this.show(a.show),this},f.prototype.addNewCell=function(a){if(a=A.isa(a,"obj")?a:{},A.xta([a.width,a.height])&&A.isa(a.name,"str")){a.width=parseFloat(a.width.toFixed()),a.height=parseFloat(a.height.toFixed());var b=document.createElement("canvas");b.setAttribute("id",a.name),b.setAttribute("height",a.height),b.setAttribute("width",a.width),a.pad=this.name,a.canvas=b;var c=new g(a);return this.cells.pushUnique(c.name),c}return!1},f.prototype.addCells=function(a){a=[].concat(a);for(var b=0,c=a.length;c>b;b++)A.cellnames.contains(a[b])&&(this.cells.push(a[b]),this.drawOrder.push(a[b]));return this},f.prototype.deleteCell=function(a){return A.isa(a,"str")?(this.cells.removeItem(a),this.display===a&&(this.display=!1),this.current===a&&(this.current=!1),this.base===a&&(this.base=!1),this):!1},f.prototype.makeCurrent=function(){return A.currentPad=this.name,this},f.prototype.buildFields=function(){for(var a=0,b=this.cells.length;b>a;a++)A.cell[this.cells[a]].buildField();return this},g.prototype=Object.create(b.prototype),g.prototype.type="Cell",g.prototype.classname="cellnames",g.prototype.set=function(b){return a.prototype.set.call(this,b),A.ctx[this.context].set(b),A.xt(b)&&(A.xto([b.width,b.height,b.actualWidth,b.actualHeight])&&this.setDimensions(b),A.xto([b.cellY,b.roll,b.scaleX,b.scaleY,b.shearX,b.shearY,b.cellX])&&this.transformCell()),this},g.prototype.setDelta=function(a){return A.xt(a)&&(A.xt(a.sourceX)&&(this.sourceX+=a.sourceX),A.xt(a.sourceY)&&(this.sourceY+=a.sourceY),A.xt(a.sourceWidth)&&(this.sourceWidth+=a.sourceWidth),A.xt(a.sourceHeight)&&(this.sourceHeight+=a.sourceHeight),A.xt(a.targetX)&&(this.targetX+=a.targetX),A.xt(a.targetY)&&(this.targetY+=a.targetY),A.xt(a.targetWidth)&&(this.targetWidth+=a.targetWidth),A.xt(a.targetHeight)&&(this.targetHeight+=a.targetHeight)),this},g.prototype.getPadWidth=function(){return A.pad[this.pad].getWidth()},g.prototype.getPadHeight=function(){return A.pad[this.pad].getHeight()},g.prototype.zoom=function(a){if(A.isa(a,"num")){var b=this.sourceWidth+a,c=this.sourceHeight+a;if(b.isBetween(this.sourceMinWidth,this.sourceMaxWidth,!0)&&c.isBetween(this.sourceMinHeight,this.sourceMaxHeight,!0)){this.sourceWidth=b;var d=this.sourceX-a/2;this.sourceX=0>d?0:d>this.actualWidth-this.sourceWidth?this.actualWidth-this.sourceWidth:d,this.sourceHeight=c;var e=this.sourceY-a/2;this.sourceY=0>e?0:e>this.actualHeight-this.sourceHeight?this.actualHeight-this.sourceHeight:e}}return this},g.prototype.buildField=function(){var a,b,c,d,e,f=new o({width:this.actualWidth,height:this.actualHeight,group:this.name}).stamp();A.deleteSprite(f.name),a=A.group[this.name+"_field"].sprites;for(var g=0,h=a.length;h>g;g++)c=A.sprite[a[g]],d=A.ctx[c.context].fillStyle,e=A.ctx[c.context].strokeStyle,A.ctx[c.context].fillStyle="rgba(255,255,255,1)",A.ctx[c.context].strokeStyle="rgba(255,255,255,1)",c.forceStamp("fillDraw",this.name),A.ctx[c.context].fillStyle=d,A.ctx[c.context].strokeStyle=e;b=A.group[this.name+"_fence"].sprites;for(var g=0,h=b.length;h>g;g++)c=A.sprite[b[g]],d=A.ctx[c.context].fillStyle,e=A.ctx[c.context].strokeStyle,A.ctx[c.context].fillStyle="rgba(0,0,0,1)",A.ctx[c.context].strokeStyle="rgba(0,0,0,1)",c.forceStamp("fillDraw",this.name),A.ctx[c.context].fillStyle=d,A.ctx[c.context].strokeStyle=e;return this.fieldLabel=this.getImageData({name:"field"}),this},g.prototype.checkFieldAt=function(a){if(a=A.isa(a,"obj")?a:!1,A.xt(a.coordinates)||A.xta([a.x,a.y])){var b,c,d,e,f=a.channel||"anycolor",g=a.test||0;d=A.xt(a.coordinates)?a.coordinates:[{x:a.x||0,y:a.y||0}];for(var h,i=A.imageData[this.fieldLabel],j=0,k=d.length;k>j;j++){if(b=parseFloat(d[j].x.toFixed()),c=parseFloat(d[j].y.toFixed()),!b.isBetween(0,i.width,!0)||!c.isBetween(0,i.height,!0))return!1;switch(h=!1,e=4*(c*i.width+b),f){case"red":if(i.data[e]<=g)return j+1;break;case"green":if(i.data[e+1]<=g)return j+1;break;case"blue":if(i.data[e+2]<=g)return j+1;break;case"alpha":if(i.data[e+3]<=g)return j+1;break;case"anycolor":if(i.data[e]<=g||i.data[e+1]<=g||i.data[e+2]<=g)return j+1}}return-1}return!1},g.prototype.setEngine=function(a){var b,c,d=A.ctx[this.context],e=A.ctx[a.context],f=e.getChanges(d,a.scale,a.scaleOutline),g=A.context[this.name];for(var h in f){switch(h){case"name":break;case"fillStyle":if(A.xt(A.dsn[f[h]])){var i=A.design[f[h]];if(i.setToSprite&&A.xta([a.currentX,a.currentWidth,i.startRangeX,a.currentY,a.currentHeight,i.startRangeY,i.endRangeX,i.endRangeY]))if("Gradient"===i.type)switch(a.type){case"Wheel":case"Shape":i.set({startX:a.currentX-a.currentWidth/2,startY:a.currentY-a.currentHeight/2,endX:a.currentX+a.currentWidth/2,endY:a.currentY+a.currentHeight/2}).update();break;default:i.set({startX:a.currentX+a.currentWidth*i.startRangeX,startY:a.currentY+a.currentHeight*i.startRangeY,endX:a.currentX+a.currentWidth*i.endRangeX,endY:a.currentY+a.currentHeight*i.endRangeY}).update()}else switch(a.type){case"Wheel":case"Shape":i.set({startX:a.currentX,startY:a.currentY,startRadius:a.currentWidth/2,endX:a.currentX,endY:a.currentY,endRadius:0}).update();break;default:i.set({startX:a.currentX+a.currentWidth*i.startRangeX,startY:a.currentY+a.currentHeight*i.startRangeY,startRadius:(a.currentWidth+a.currentHeight)/2*i.startRangeRadius,endX:a.currentX+a.currentWidth*i.endRangeX,endY:a.currentY+a.currentHeight*i.endRangeY,endRadius:0}).update()}b=A.dsn[f[h]]}else A.xt(A.design[f[h]])?b=A.design[f[h]].get():A.isa(f[h],"str")&&(b=f[h]);g.fillStyle=b;break;case"winding":g.mozFillRule=f[h],g.msFillRule=f[h];break;case"strokeStyle":if(A.xt(A.dsn[f[h]])){var i=A.design[f[h]];if(i.setToSprite&&A.xta([a.currentX,a.currentWidth,i.startRangeX,a.currentY,a.currentHeight,i.startRangeY,i.endRangeX,i.endRangeY]))if("Gradient"===i.type)switch(a.type){case"Wheel":case"Shape":i.set({startX:a.currentX-a.currentWidth/2,startY:a.currentY-a.currentHeight/2,endX:a.currentX+a.currentWidth/2,endY:a.currentY+a.currentHeight/2}).update();break;default:i.set({startX:a.currentX+a.currentWidth*i.startRangeX,startY:a.currentY+a.currentHeight*i.startRangeY,endX:a.currentX+a.currentWidth*i.endRangeX,endY:a.currentY+a.currentHeight*i.endRangeY}).update()}else switch(a.type){case"Wheel":case"Shape":i.set({startX:a.currentX,startY:a.currentY,startRadius:a.currentWidth/2,endX:a.currentX,endY:a.currentY,endRadius:0}).update();break;default:i.set({startX:a.currentX+a.currentWidth*i.startRangeX,startY:a.currentY+a.currentHeight*i.startRangeY,startRadius:(a.currentWidth+a.currentHeight)/2*i.startRangeRadius,endX:a.currentX+a.currentWidth*i.endRangeX,endY:a.currentY+a.currentHeight*i.endRangeY,endRadius:0}).update()}c=A.dsn[f[h]]}else A.xt(A.design[f[h]])?c=A.design[f[h]].get():A.isa(f[h],"str")&&(c=f[h]);g.strokeStyle=c;break;case"lineDash":g.mozDash=f[h],g.lineDash=f[h];try{g.setLineDash(f[h])}catch(j){}break;case"lineDashOffset":g.mozDashOffset=f[h],g.lineDashOffset=f[h];break;case"globalAlpha":g.globalAlpha=f[h];break;case"globalCompositeOperation":g.globalCompositeOperation=f[h];break;case"lineWidth":g.lineWidth=f[h];break;case"lineCap":g.lineCap=f[h];break;case"lineJoin":g.lineJoin=f[h];break;case"miterLimit":g.miterLimit=f[h];break;case"shadowOffsetX":g.shadowOffsetX=f[h];break;case"shadowOffsetY":g.shadowOffsetY=f[h];break;case"shadowBlur":g.shadowBlur=f[h];break;case"shadowColor":g.shadowColor=f[h];break;case"font":g.font=f[h];break;case"textAlign":g.textAlign=f[h];break;case"textBaseline":g.textBaseline=f[h]}"name"!==h&&(A.xt(A.dsn[f[h]])?"fillStyle"===h?g.fillStyle===b&&(d[h]=f[h]):"strokeStyle"===h&&g.strokeStyle===c&&(d[h]=f[h]):d[h]=f[h])}return g},g.prototype.clear=function(){var a=A.context[this.name];return a.clearRect(this.actualX-this.cellX,this.actualY-this.cellY,this.actualWidth*this.scale,this.actualHeight*this.scale),this},g.prototype.compile=function(){"rgba(0,0,0,0)"!==this.backgroundColor&&this.stampBackground(),this.groups.sort(function(a,b){return A.group[a].order-A.group[b].order});for(var a=0,b=this.groups.length;b>a;a++)A.group[this.groups[a]].visibility&&A.group[this.groups[a]].stamp(!1,this.name);return this},g.prototype.stampBackground=function(){var a=A.context[this.name],b=a.fillStyle;return a.fillStyle=this.backgroundColor,a.fillRect(this.actualX-this.cellX,this.actualY-this.cellY,this.actualWidth,this.actualHeight),a.fillStyle=b,this},g.prototype.copyCellToSelf=function(a){if(A.xt(a)){var b=A.context[this.name],c=a.usePadDimensions?A.pad[a.pad].width:a.sourceWidth,d=a.usePadDimensions?A.pad[a.pad].height:a.sourceHeight,e=a.usePadDimensions?A.pad[a.pad].width*this.scale:a.targetWidth*this.scale,f=a.usePadDimensions?A.pad[a.pad].height*this.scale:a.targetHeight*this.scale;b.drawImage(A.canvas[a.name],a.sourceX,a.sourceY,c,d,(a.targetX-a.handleX)*this.scale,(a.targetY-a.handleY)*this.scale,e,f)}return this},g.prototype.getCopyScaling=function(a){if(a=A.isa(a,"str")?A.cell[a]:a,A.xt(a)){var b=a.usePadDimensions?A.pad[a.pad].width:a.sourceWidth,c=a.usePadDimensions?A.pad[a.pad].height:a.sourceHeight,d=a.usePadDimensions?A.pad[a.pad].width*this.scale:a.targetWidth*this.scale,e=a.usePadDimensions?A.pad[a.pad].height*this.scale:a.targetHeight*this.scale;return{w:d/b,h:e/c}}return!1},g.prototype.clearShadow=function(){var a=A.context[this.name],b=A.ctx[this.context];return a.shadowOffsetX=0,b.shadowOffsetX=0,a.shadowOffsetY=0,b.shadowOffsetY=0,a.shadowBlur=0,b.shadowBlur=0,a.shadowColor="rgba(0, 0, 0, 0)",b.shadowColor="rgba(0, 0, 0, 0)",this},g.prototype.restoreShadow=function(a){var b=A.context[this.name],c=A.ctx[this.context],d=A.ctx[a];return b.shadowOffsetX=d.shadowOffsetX,c.shadowOffsetX=d.shadowOffsetX,b.shadowOffsetY=d.shadowOffsetY,c.shadowOffsetY=d.shadowOffsetY,b.shadowBlur=d.shadowBlur,c.shadowBlur=d.shadowBlur,b.shadowColor=d.shadowColor,c.shadowColor=d.shadowColor,this},g.prototype.setToClearShape=function(){var a=A.context[this.name],b=A.ctx[this.context];return a.fillStyle="rgba(0, 0, 0, 0)",b.fillStyle="rgba(0, 0, 0, 0)",a.strokeStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",a.shadowColor="rgba(0, 0, 0, 0)",b.shadowColor="rgba(0, 0, 0, 0)",this},g.prototype.setDimensions=function(a){var b,c;return A.xt(a)&&!this.usePadDimensions?(b=a.width||a.actualWidth||this.actualWidth,c=a.height||a.actualHeight||this.actualHeight):(b=this.getPadWidth(),c=this.getPadHeight()),A.canvas[this.name].width=b,A.canvas[this.name].height=c,this.actualWidth=b,this.actualHeight=c,this},g.prototype.scaleCell=function(a){return a=A.isa(a,"obj")?a:{},A.isa(a.x,"num")&&(this.scaleX=a.x),A.isa(a.y,"num")&&(this.scaleY=a.y),A.isa(a.scaleX,"num")&&(this.scaleX=a.scaleX),A.isa(a.scaleY,"num")&&(this.scaleY=a.scaleY),A.context[this.name].scale(this.scaleX,this.scaleY),this},g.prototype.translateCell=function(a){return a=A.isa(a,"obj")?a:{},A.isa(a.x,"num")&&(this.cellX=a.x),A.isa(a.y,"num")&&(this.cellY=a.y),A.isa(a.cellX,"num")&&(this.cellX=a.cellX),A.isa(a.cellY,"num")&&(this.cellY=a.cellY),A.context[this.name].translate(this.cellX,this.cellY),this},g.prototype.rotateCell=function(a){if(A.isa(a,"num")){var b=(a-this.roll)*A.radian;0!==b&&A.context[this.name].rotate(b),this.roll=a}return this},g.prototype.resetRotation=function(){return A.context[this.name].rotate(-this.roll*A.radian),this.roll=0,this},g.prototype.transformCell=function(a,b){a=A.isa(a,"obj")?a:{};var c=A.isa(b,"bool")?b:!1;return this.scaleX=a.scaleX||this.scaleX,this.scaleY=a.scaleY||this.scaleY,this.shearX=a.shearX||this.shearX,this.shearY=a.shearY||this.shearY,this.cellX=a.cellX||this.cellX,this.cellY=a.cellY||this.cellY,a.roll=a.roll||this.roll||0,this.rollDegree=A.isa(a.rollDegree,"bool")?a.rollDegree:this.rollDegree,c?(this.rotateCell(a.roll),A.context[this.name].setTransform(this.scaleX,this.shearX,this.shearY,this.scaleY,this.cellX,this.cellY)):(A.context[this.name].setTransform(this.scaleX,this.shearX,this.shearY,this.scaleY,this.cellX,this.cellY),this.rotateCell(a.roll)),this},g.prototype.saveContext=function(){return A.context[this.name].save(),this},g.prototype.restoreContext=function(){return A.context[this.name].restore(),this},g.prototype.getImageData=function(a){var b,c,d,e,f;return a=A.isa(a,"obj")?a:{},c=A.isa(a.x,"num")?a.x:this.actualX,d=A.isa(a.y,"num")?a.y:this.actualY,e=A.isa(a.width,"num")?a.width:this.actualWidth,f=A.isa(a.height,"num")?a.height:this.actualHeight,b=A.isa(a.name,"str")?this.name+"_"+a.name:this.name+"_imageData",A.imageData[b]=A.context[this.name].getImageData(c,d,e,f),b},g.prototype.spliceCell=function(a){if(a=A.isa(a,"obj")?a:{},["horizontal","vertical","top","bottom","left","right"].contains(a.edge)){var b,c,d,e,f,g=A.context[this.name];switch(a.edge){case"horizontal":b=c=this.actualWidth/2,d="left";break;case"vertical":b=c=this.actualHeight/2,d="top";break;case"top":case"bottom":b=a.strip||20,c=this.actualHeight-b,d=a.edge;break;case"left":case"right":b=a.strip||20,c=this.actualWidth-b,d=a.edge}switch(d){case"top":e=g.getImageData(0,0,this.actualWidth,b),f=g.getImageData(0,b,this.actualWidth,c),g.clearRect(0,0,this.actualWidth,this.actualHeight),g.putImageData(f,0,0),g.putImageData(e,0,c);break;case"bottom":f=g.getImageData(0,0,this.actualWidth,c),e=g.getImageData(0,c,this.actualWidth,b),g.clearRect(0,0,this.actualWidth,this.actualHeight),g.putImageData(e,0,0),g.putImageData(f,0,b);break;case"left":e=g.getImageData(0,0,b,this.actualHeight),f=g.getImageData(b,0,c,this.actualHeight),g.clearRect(0,0,this.actualWidth,this.actualHeight),g.putImageData(f,0,0),g.putImageData(e,c,0);break;case"right":f=g.getImageData(0,0,c,this.actualHeight),e=g.getImageData(c,0,b,this.actualHeight),g.clearRect(0,0,this.actualWidth,this.actualHeight),g.putImageData(e,0,0),g.putImageData(f,b,0)}}return this},h.prototype=Object.create(a.prototype),h.prototype.type="Context",h.prototype.classname="ctxnames",h.prototype.getContextFromEngine=function(a){for(var b=["fillStyle","strokeStyle","globalAlpha","globalCompositeOperation","lineWidth","lineCap","lineJoin","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","font","textAlign","textBaseline"],c=0,d=b.length;d>c;c++)this[b[c]]=a[b[c]];return b.winding=a.mozFillRule||a.msFillRule||"nonzero",b.lineDash=[],b.lineDashOffset=a.mozDashOffset||a.lineDashOffset,this},h.prototype.getChanges=function(a,b,c){var d={};for(var e in this)c&&["lineWidth","shadowOffsetX","shadowOffsetY","shadowBlur"].contains(e)?this[e]*b!==a[e]&&(d[e]=this[e]*b):["fillStyle","strokeStyle"].contains(e)?A.designnames.contains(this[e])?"Color"===A.design[this[e]].type&&A.design[this[e]].autoUpdate?(A.design[this[e]].update(),d[e]=this[e]):["Gradient","RadialGradient"].contains(A.design[this[e]].type)&&(A.design[this[e]].roll||A.design[this[e]].autoUpdate)?(A.design[this[e]].update(),d[e]=this[e]):this[e]!==a[e]&&(d[e]=this[e]):this[e]!==a[e]&&(d[e]=this[e]):this[e]!==a[e]&&(d[e]=this[e]);return d},h.prototype.swapStyles=function(){var a=this.fillStyle;this.fillStyle=this.strokeStyle,this.strokeStyle=a},i.prototype=Object.create(a.prototype),i.prototype.type="Image",i.prototype.classname="imagenames",i.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,width:0!==this.width?this.width:a,height:0!==this.height?this.height:a,imageData:A.xt(A.imageData[this.name])?A.imageData[this.name]:a,source:this.source?this.source:a,element:A.xt(A.img[this.name])?A.img[this.name].id:a,copyX:0!==this.copyX?this.copyX:a,copyY:0!==this.copyY?this.copyY:a,copyWidth:0!==this.copyWidth?this.copyWidth:a,copyHeight:0!==this.copyHeight?this.copyHeight:a}},i.prototype.setToDefaults=function(){return this.set({comment:"",title:"",width:0,height:0,copyX:0,copyY:0,copyWidth:0,copyHeight:0}),this},i.prototype.getImageData=function(){var a=document.createElement("canvas");a.width=this.width,a.height=this.height;var b=a.getContext("2d");return b.drawImage(A.img[this.name],0,0),a.toDataURL()},j.prototype=Object.create(a.prototype),j.prototype.type="AnimSheet",j.prototype.classname="animnames",j.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,sheet:this.sheet?this.sheet:a,frames:this.frames.length>0?this.frames:a,currentFrame:0!==this.currentFrame?this.currentFrame:a,speed:1!==this.speed?this.speed:a,loop:"end"!==this.loop?this.loop:a,running:"complete"!==this.running?this.running:a,lastCalled:this.lastCalled?this.lastCalled:a}},j.prototype.setToDefaults=function(){return this.set({comment:"",title:"",sheet:!1,frames:[],currentFrame:0,speed:1,loop:"end",running:"complete",lastCalled:!1}),this},j.prototype.set=function(b){b=A.isa(b,"obj")?b:{};var c="pause"===this.loop?!0:!1;if(a.prototype.set.call(this,b),A.xt(b.running))switch(b.running){case"forward":this.running="forward",c||(this.currentFrame=0);break;case"backward":this.running="backward",c||(this.currentFrame=this.frames.length-1);break;default:this.running="complete",this.currentFrame=0}return this},j.prototype.getData=function(){if(this.speed>0){var a=this.frames[this.currentFrame].d/this.speed,b=this.lastCalled+a<Date.now()?!0:!1;switch(this.running){case"complete":this.lastCalled=Date.now();break;case"forward":if(b){switch(this.loop){case"pause":break;case"end":this.running=this.currentFrame+1>=this.frames.length?"complete":this.running,this.currentFrame=this.currentFrame+1>=this.frames.length?this.currentFrame:this.currentFrame+1;break;case"loop":this.currentFrame=this.currentFrame+1>=this.frames.length?0:this.currentFrame+1;break;case"reverse":this.running=this.currentFrame+1>=this.frames.length?"backward":"forward",this.currentFrame=this.currentFrame+1>=this.frames.length?this.currentFrame:this.currentFrame+1}this.lastCalled=Date.now()}break;case"backward":if(b){switch(this.loop){case"pause":break;case"end":this.running=this.currentFrame-1<=0?"complete":this.running,this.currentFrame=this.currentFrame-1<=0?this.currentFrame:this.currentFrame-1;break;case"loop":this.currentFrame=this.currentFrame-1<=0?this.frames.length-1:this.currentFrame-1;break;case"reverse":this.running=this.currentFrame-1<=0?"forward":"backward",this.currentFrame=this.currentFrame-1<=0?this.currentFrame:this.currentFrame-1}this.lastCalled=Date.now()}}}return{copyX:this.frames[this.currentFrame].x,copyY:this.frames[this.currentFrame].y,copyWidth:this.frames[this.currentFrame].w,copyHeight:this.frames[this.currentFrame].h}},k.prototype=Object.create(b.prototype),k.prototype.type="Group",k.prototype.classname="groupnames",k.prototype.exportNative=function(a){a=A.xt(a)?a:{string:!0};var b,c={includeDesigns:a.includeDesigns||!0,includeImages:a.includeImages||!1,string:!1},d=[];d.push(this.prepareForExport());for(var e=0,f=this.groups.length;f>e;e++)if(this.groups[e]!==this.name){b=A.group[this.groups[e]].exportNative(c);for(var g=0,h=b.length;h>g;g++)d.pushUnique(b[g])}for(var e=0,f=this.sprites.length;f>e;e++){b=A.sprite[this.sprites[e]].exportNative(c);for(var g=0,h=b.length;h>g;g++)d.pushUnique(b[g])}for(var i=[],j=[],e=0,f=d.length;f>e;e++)j.contains(d[e].name)||(i.push(d[e]),j.push(d[e].name));return a.string?JSON.stringify(i):i},k.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,startX:0!==this.startX?this.startX:a,startY:0!==this.startY?this.startY:a,handleX:0!==this.handleX?this.handleX:a,handleY:0!==this.handleY?this.handleY:a,moveStartX:0!==this.moveStartX?this.moveStartX:a,moveStartY:0!==this.moveStartY?this.moveStartY:a,moveHandleX:0!==this.moveHandleX?this.moveHandleX:a,moveHandleY:0!==this.moveHandleY?this.moveHandleY:a,pivot:this.pivot?this.pivot:a,path:this.path?this.path:a,pathPosition:0!==this.pathPosition?this.pathPosition:a,movePathPosition:0!==this.movePathPosition?this.movePathPosition:a,pathSpeedConstant:this.pathSpeedConstant?a:this.pathSpeedConstant,pathRoll:0!==this.pathRoll?this.pathRoll:a,addPathRoll:this.addPathRoll?this.addPathRoll:a,scale:1!==this.scale?this.scale:a,groups:this.groups.length>0?this.groups:a,cells:this.cells.length>0?this.cells:a,order:0!==this.order?this.order:a,visibility:this.visibility?a:this.visibility,isSprite:this.isSprite?this.isSprite:a,isMarker:this.isMarker?this.isMarker:a,isDefinition:this.isDefinition?this.isDefinition:a,method:this.method?this.method:a,fieldTest:0!==this.fieldTest?this.fieldTest:a,fieldChannel:"anycolor"!==this.fieldChannel?this.fieldChannel:a,roll:0!==this.roll?this.roll:a}},k.prototype.setToDefaults=function(){return this.set({comment:"",title:"",startX:0,startY:0,handleX:0,handleY:0,moveStartX:0,moveStartY:0,moveHandleX:0,moveHandleY:0,pivot:!1,path:!1,pathPosition:0,movePathPosition:0,pathSpeedConstant:!0,pathRoll:0,addPathRoll:!1,scale:1,groups:[],cells:[],order:0,visibility:!0,isSprite:!1,isMarker:!1,isDefinition:!1,fieldTest:0,fieldChannel:"anycolor",roll:0}),this},k.prototype.sortSprites=function(){this.sprites.sort(function(a,b){return A.sprite[a].order-A.sprite[b].order})},k.prototype.sortGroups=function(){this.groups.sort(function(a,b){return A.group[a].order-A.group[b].order})},k.prototype.getOverride=function(a,b,c){return b=A.xt(b)?b:this.method,c=A.xt(c)?c:this.cells,A.xt(a)&&A.sprite[a].pivot===this.name?{x:0,y:0,r:this.roll,s:this.scale,method:b,cells:c}:{x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale,method:b,cells:c}},k.prototype.forceStamp=function(a,b){var c=this.visibility;return this.visibility=!0,this.stamp(a,b),this.visibility=c,this},k.prototype.stamp=function(a,b){this.sortSprites();for(var c=A.isa(a,"str")?a:this.method,d=A.xt(b)?[].concat(b):this.cells,e=0,f=this.sprites.length;f>e;e++)A.sprite[this.sprites[e]].stamp(this.getOverride(this.sprites[e],c,d));if(this.groups.length>0){this.sortGroups();for(var e=0,f=this.groups.length;f>e;e++)A.group[this.groups[e]].name!==this.name&&A.group[this.groups[e]].forceStamp(a,b)}return this},k.prototype.getSpriteAt=function(a){if(this.sortSprites(),a=A.isa(a,"obj")?a:{},A.xta([a.x,a.y])){a.pad=A.xt(a.pad)?a.pad:A.pad[A.cell[this.cells[0]].pad].name;for(var b=this.sprites.length-1;b>=0;b--)if(A.sprite[this.sprites[b]].checkHit(a,{x:this.getStartX(),y:this.getStartY()}))return A.sprite[this.sprites[b]]}return!1},k.prototype.getInGroupSpriteHits=function(){for(var a,b=[],c={x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale},d={x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale,pad:A.pad[A.cell[this.cells[0]].pad].name},e=0,f=this.sprites.length;f>e;e++)if(A.sprite[this.sprites[e]].visibility)for(var g=e+1,h=this.sprites.length;h>g;g++)if(A.sprite[this.sprites[g]].visibility){if(a=!1,A.sprite[this.sprites[g]].checkHit({tests:A.sprite[this.sprites[e]].getCollisionPoints(c)},d)){b.push([this.sprites[e],this.sprites[g]]),a=!0;break}if(!a&&A.sprite[this.sprites[e]].checkHit({tests:A.sprite[this.sprites[g]].getCollisionPoints(c)},d)){b.push([this.sprites[e],this.sprites[g]]);break}}return b},k.prototype.getBetweenGroupSpriteHits=function(a){if(A.xt(a)){if(A.isa(a,"str")){if(!A.groupnames.contains(a))return!1;a=A.group[a]}else if(!A.xt(a.type)||"Group"!==a.type)return!1;for(var b,c=[],d={x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale,pad:A.pad[A.cell[this.cells[0]].pad].name},e={x:a.getStartX(),y:a.getStartY(),r:this.roll,s:this.scale,pad:A.pad[A.cell[a.cells[0]].pad].name},f=0,g=this.sprites.length;g>f;f++)if(A.sprite[this.sprites[f]].visibility)for(var h=0,i=a.sprites.length;i>h;h++)A.sprite[a.sprites[h]].visibility&&(b=!1,A.sprite[a.sprites[h]].checkHit({tests:A.sprite[this.sprites[f]].getCollisionPoints(d)},e)&&(c.push([this.sprites[f],a.sprites[h]]),b=!0),b||A.sprite[this.sprites[f]].checkHit({tests:A.sprite[a.sprites[h]].getCollisionPoints(e)},d)&&c.push([this.sprites[f],a.sprites[h]]));return c}return!1},k.prototype.getFieldSpriteHits=function(a){var b,c,d={};a=A.xt(a)?[].concat(a):[this.cells[0]];for(var e={x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale},f=0,g=a.length;g>f;f++){b=[];for(var h=0,i=this.sprites.length;i>h;h++)c=A.sprite[this.sprites[h]].checkField(a[f],e),A.isa(c,"obj")&&b.push([this.sprites[h],c]);d[a[f]]=b}return 1===a.length?d[a[0]]:d},k.prototype.checkField=function(a){var b=A.xt(a)&&A.cellnames.contains(a)?A.cell[a]:A.cell[this.cells[0]]||A.cell[A.pad[A.currentPad].current],c={x:this.startX,y:this.startY},d=b.checkFieldAt({coordinates:[c],test:this.fieldTest,channel:this.fieldChannel});return d>0?c:d?!0:!1},k.prototype.setDelta=function(a){return a=A.isa(a,"obj")?a:{},A.xt(a.startX)&&(this.startX+=a.startX),A.xt(a.startY)&&(this.startY+=a.startY),A.xt(a.handleX)&&(this.handleX+=a.handleX),A.xt(a.handleY)&&(this.handleY+=a.handleY),A.xt(a.roll)&&(this.roll+=a.roll),A.xt(a.scale)&&(this.scale+=a.scale),A.xt(a.pathPosition)&&(this.pathPosition+=a.pathPosition),this},k.prototype.addSpritesToGroup=function(a){a=A.xt(a)?[].concat(a):[];for(var b=0,c=a.length;c>b;b++)this.sprites.pushUnique(a[b]);return this},k.prototype.removeSpritesFromGroup=function(a){a=A.xt(a)?[].concat(a):[];for(var b=0,c=a.length;c>b;b++)this.sprites.removeItem(a[b]);return this},k.prototype.moveSpriteStart=function(a){for(var b=0,c=this.sprites.length;c>b;b++)A.sprite[this.sprites[b]].moveStart(a);return this},k.prototype.setGroupDimensions=function(a){a=A.xt(a)?a:{x:this.startX,y:this.startY};var b,c,d,e,f,g,h,i=-9999,j=9999,k=-9999,l=9999,m=0;for(this.groups.length;n>m;m++)f=A.group[this.groups[m]],f.isMarker||f.isDefinition||(f.setGroupDimensions(),i=f.startX+f.width>i?f.startX+f.width:i,j=f.startX<j?f.startX:j,k=f.startY+f.height>k?f.startY+f.height:k,l=f.startY<l?f.startY:l);for(var m=0,n=this.sprites.length;n>m;m++)if(f=A.sprite[this.sprites[m]],!f.pivot||!f.path){switch(f.type){case"Block":case"Outline":case"Picture":case"Phrase":b=f.startX+f.width*f.scale,c=f.startX,d=f.startY+f.height*f.scale,e=f.startY;break;case"Wheel":b=f.startX+f.radius*f.scale,c=f.startX-f.radius*f.scale,d=f.startY+f.radius*f.scale,e=f.startY-f.radius*f.scale;break;case"Shape":b=-9999,d=-9999,c=9999,e=9999;for(var o=0,p=f.pointList.length;p>o;o++)g=A.point[f.pointList[o]].currentX,h=A.point[f.pointList[o]].currentY,b=g>b?g:b,c=c>g?g:c,d=h>d?h:d,e=e>h?h:e}i=b>i?b:i,j=j>c?c:j,k=d>k?d:k,l=l>e?e:l}return this.startX=a.x||j,this.startY=a.y||l,this.width=i-j,this.height=k-l,this.setSpritesToGroupHandle(),this},k.prototype.setSpritesToGroupHandle=function(){for(var a,b,c,d=this.getPivotOffset(this.handleX,!1),e=this.getPivotOffset(this.handleY,!0),f=0,g=this.sprites.length;g>f;f++)a=A.sprite[this.sprites[f]],A.spritenames.contains(a.name)&&a.pivot===this.name&&(b=a.getPivotOffset(a.handleX,!1),c=a.getPivotOffset(a.handleY,!0),a.set({handleX:b+d,handleY:c+e}));return this},l.prototype=Object.create(b.prototype),l.prototype.type="Sprite",l.prototype.classname="spritenames",l.prototype.targetGroup=function(){return this.pivot=this.group,this.handleX=A.group[this.group].startX-this.startX,this.handleY=A.group[this.group].startY-this.startY,this},l.prototype.exportNative=function(a){a=A.xt(a)?a:{includeDesigns:!0,includeImages:!1,string:!0};var b=[];if(a.includeDesigns){var c=a.designs||[];A.xt(this.context)&&A.designnames.contains(A.ctx[this.context].fillStyle)&&!c.contains(A.ctx[this.context].fillStyle)&&(b.push(A.design[A.ctx[this.context].fillStyle].prepareForExport()),c.push(A.ctx[this.context].fillStyle)),A.xt(this.context)&&A.designnames.contains(A.ctx[this.context].strokeStyle)&&!c.contains(A.ctx[this.context].strokeStyle)&&(b.push(A.design[A.ctx[this.context].strokeStyle].prepareForExport()),c.push(A.ctx[this.context].strokeStyle))}return a.includeImages&&A.xt(this.imageData)&&this.imageData&&A.xt(A.imageData[this.imageData])&&b.push(A.imageData[this.imageData]),A.xt(this.animSheet)&&this.animSheet&&A.animnames.contains(this.animSheet)&&b.push(A.anim[this.animSheet].prepareForExport()),b.push(this.prepareForExport()),a.string?JSON.stringify(b):b},l.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,startX:0!==this.startX?this.startX:a,startY:0!==this.startY?this.startY:a,handleX:0!==this.handleX?this.handleX:a,handleY:0!==this.handleY?this.handleY:a,moveStartX:0!==this.moveStartX?this.moveStartX:a,moveStartY:0!==this.moveStartY?this.moveStartY:a,moveHandleX:0!==this.moveHandleX?this.moveHandleX:a,moveHandleY:0!==this.moveHandleY?this.moveHandleY:a,pivot:this.pivot?this.pivot:a,path:this.path?this.path:a,pathPosition:0!==this.pathPosition?this.pathPosition:a,movePathPosition:0!==this.movePathPosition?this.movePathPosition:a,pathSpeedConstant:this.pathSpeedConstant?a:this.pathSpeedConstant,pathRoll:0!==this.pathRoll?this.pathRoll:a,addPathRoll:this.addPathRoll?this.addPathRoll:a,scale:1!==this.scale?this.scale:a,order:0!==this.order?this.order:a,visibility:this.visibility?a:this.visibility,method:this.method,collisionPoints:A.xt(this.collisionPoints)&&this.collisionPoints.length>0?this.collisionPoints:a,rollable:this.rollable?a:this.rollable,roll:0!==this.roll?this.roll:a,data:this.data?this.data:a,flipReverse:this.flipReverse?this.flipReverse:a,flipUpend:this.flipUpend?this.flipUpend:a,scaleOutline:this.scaleOutline?a:this.scaleOutline,group:this.group,fieldChannel:"anycolor"!==this.fieldChannel?this.fieldChannel:a,fieldTest:0!==this.fieldTest?this.fieldTest:a,text:A.xt(this.text)&&""!==this.text?this.text:a,style:A.xt(this.style)&&"normal"!==this.style?this.style:a,variant:A.xt(this.variant)&&"normal"!==this.variant?this.variant:a,weight:A.xt(this.weight)&&"normal"!==this.weight?this.weight:a,size:A.xt(this.size)&&12!==this.size?this.size:a,metrics:A.xt(this.metrics)&&"pt"!==this.metrics?this.metrics:a,family:A.xt(this.family)&&"sans-serif"!==this.family?this.family:a,lineHeight:A.xt(this.lineHeight)&&1.5!==this.lineHeight?this.lineHeight:a,backgroundColor:A.xt(this.backgroundColor)&&this.backgroundColor?this.backgroundColor:a,backgroundMargin:A.xt(this.backgroundMargin)&&0!==this.backgroundMargin?this.backgroundMargin:a,textAlongPath:A.xt(this.textAlongPath)&&"phrase"!==this.textAlongPath?this.textAlongPath:a,fixedWidth:A.xt(this.fixedWidth)&&this.fixedWidth?this.fixedWidth:a,width:A.xt(this.width)&&0!==this.width?this.width:a,height:A.xt(this.height)&&0!==this.height?this.height:a,radius:A.xt(this.radius)&&0!==this.radius?this.radius:a,startAngle:A.xt(this.startAngle)&&0!==this.startAngle?this.startAngle:a,endAngle:A.xt(this.endAngle)&&360!==this.endAngle?this.endAngle:a,clockwise:A.xt(this.clockwise)&&this.clockwise?this.clockwise:a,closed:A.xt(this.closed)?this.closed:a,includeCenter:A.xt(this.includeCenter)&&this.includeCenter?this.includeCenter:a,checkHitUsingRadius:A.xt(this.checkHitUsingRadius)&&!this.checkHitUsingRadius?this.checkHitUsingRadius:a,source:A.xt(this.source)&&this.source?this.source:a,imageData:A.xt(this.imageData)&&this.imageData?this.imageData:a,imageDataChannel:A.xt(this.imageDataChannel)&&"alpha"!==this.imageDataChannel?this.imageDataChannel:a,animSheet:A.xt(this.animSheet)&&this.animSheet?this.animSheet:a,imageType:A.xt(this.imageType)&&this.imageType?this.imageType:a,checkHitUsingImageData:A.xt(this.checkHitUsingImageData)&&this.checkHitUsingImageData?this.checkHitUsingImageData:a,copyX:A.xt(this.copyX)?this.copyX:a,copyY:A.xt(this.copyY)?this.copyY:a,copyWidth:A.xt(this.copyWidth)?this.copyWidth:a,copyHeight:A.xt(this.copyHeight)?this.copyHeight:a,firstPoint:A.xt(this.firstPoint)&&this.firstPoint?this.firstPoint:a,line:A.xt(this.line)&&this.line?this.line:a,linkDurations:A.xt(this.linkDurations)&&this.linkDurations.length>0?this.linkDurations:a,markStart:A.xt(this.markStart)&&this.markStart?this.markStart:a,markMid:A.xt(this.markMid)&&this.markMid?this.markMid:a,markEnd:A.xt(this.markEnd)&&this.markEnd?this.markEnd:a,fillStyle:"#000000"!==A.ctx[this.context].fillStyle?A.ctx[this.context].fillStyle:a,winding:"nonzero"!==A.ctx[this.context].winding?A.ctx[this.context].winding:a,strokeStyle:"#000000"!==A.ctx[this.context].strokeStyle?A.ctx[this.context].strokeStyle:a,globalAlpha:1!==A.ctx[this.context].globalAlpha?A.ctx[this.context].globalAlpha:a,globalCompositeOperation:"source-over"!==A.ctx[this.context].globalCompositeOperation?A.ctx[this.context].globalCompositeOperation:a,lineWidth:1!==A.ctx[this.context].lineWidth?A.ctx[this.context].lineWidth:a,lineCap:"butt"!==A.ctx[this.context].lineCap?A.ctx[this.context].lineCap:a,lineJoin:"miter"!==A.ctx[this.context].lineJoin?A.ctx[this.context].lineJoin:a,lineDash:A.ctx[this.context].lineDash.length>0?A.ctx[this.context].lineDash:a,lineDashOffset:0!==A.ctx[this.context].lineDashOffset?A.ctx[this.context].lineDashOffset:a,miterLimit:10!==A.ctx[this.context].miterLimit?A.ctx[this.context].miterLimit:a,shadowOffsetX:0!==A.ctx[this.context].shadowOffsetX?A.ctx[this.context].shadowOffsetX:a,shadowOffsetY:0!==A.ctx[this.context].shadowOffsetY?A.ctx[this.context].shadowOffsetY:a,shadowBlur:0!==A.ctx[this.context].shadowBlur?A.ctx[this.context].shadowBlur:a,shadowColor:"rgba(0,0,0,0)"!==A.ctx[this.context].shadowColor?A.ctx[this.context].shadowColor:a,font:"10pt sans-serif"!==A.ctx[this.context].font?A.ctx[this.context].font:a,textAlign:"start"!==A.ctx[this.context].textAlign?A.ctx[this.context].textAlign:a,textBaseline:"alphabetic"!==A.ctx[this.context].textBaseline?A.ctx[this.context].textBaseline:a}
},l.prototype.setToDefaults=function(){var a;return this.set({comment:"",title:"",startX:0,startY:0,handleX:0,handleY:0,moveStartX:0,moveStartY:0,moveHandleX:0,moveHandleY:0,pivot:!1,path:!1,pathPosition:0,movePathPosition:0,pathSpeedConstant:!0,pathRoll:0,addPathRoll:!1,scale:1,order:0,visibility:!0,collisionPoints:[],rollable:!0,roll:0,data:!1,flipReverse:!1,flipUpend:!1,scaleOutline:!0,group:!1,fieldChannel:"anycolor",fieldTest:0,text:A.xt(this.text)?"":a,style:A.xt(this.style)?"normal":a,variant:A.xt(this.variant)?"normal":a,weight:A.xt(this.weight)?"normal":a,size:A.xt(this.size)?12:a,metrics:A.xt(this.metrics)?"pt":a,family:A.xt(this.family)?"sans-serif":a,lineHeight:A.xt(this.lineHeight)?1.5:a,backgroundColor:A.xt(this.backgroundColor)?!1:a,backgroundMargin:A.xt(this.backgroundMargin)?0:a,textAlongPath:A.xt(this.textAlongPath)?"phrase":a,fixedWidth:A.xt(this.fixedWidth)?!1:a,width:A.xt(this.width)?0:a,height:A.xt(this.height)?0:a,radius:A.xt(this.radius)?0:a,startAngle:A.xt(this.startAngle)?0:a,endAngle:A.xt(this.endAngle)?360:a,clockwise:A.xt(this.clockwise)?!1:a,closed:A.xt(this.closed)?!1:a,includeCenter:A.xt(this.includeCenter)?!1:a,checkHitUsingRadius:A.xt(this.checkHitUsingRadius)?!0:a,imageData:A.xt(this.imageData)?!1:a,imageDataChannel:A.xt(this.imageDataChannel)?"alpha":a,animSheet:A.xt(this.animSheet)?!1:a,checkHitUsingImageData:A.xt(this.checkHitUsingImageData)?!1:a,copyX:A.xt(this.copyX)?!1:a,copyY:A.xt(this.copyY)?!1:a,copyWidth:A.xt(this.copyWidth)?!1:a,copyHeight:A.xt(this.copyHeight)?!1:a,firstPoint:A.xt(this.firstPoint)?!1:a,line:A.xt(this.line)?!1:a,markStart:A.xt(this.markStart)?!1:a,markMid:A.xt(this.markMid)?!1:a,markEnd:A.xt(this.markEnd)?!1:a,fillStyle:"#000000",winding:"nonzero",strokeStyle:"#000000",globalAlpha:1,globalCompositeOperation:"source-over",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",font:"10pt sans-serif",textAlign:"start",textBaseline:"alphabetic"}),this},l.prototype.pickupSprite=function(a){return a=A.isa(a,"obj")?a:{},A.xta([a.x,a.y])&&(this.mouseX=a.x||0,this.mouseY=a.y||0,this.realPivot=this.pivot,this.pivot="mouse",this.order+=9999),this},l.prototype.dropSprite=function(a){return this.pivot=a||this.realPivot||!1,this.order-=this.order>=9999?9999:0,delete this.realPivot,delete this.mouseX,delete this.mouseY,this},l.prototype.clone=function(b){b=A.isa(b,"obj")?b:{};var c=a.prototype.clone.call(this,b);if(!A.xt(b.createNewContext)||b.createNewContext){var d=A.ctx[c.context],e=JSON.parse(JSON.stringify(A.ctx[this.context]));if(delete e.name,d.set(e),delete b.name,d.set(b),A.designnames.contains(d.fillStyle))if("Pattern"!==A.design[d.fillStyle].type){var f=A.design[d.fillStyle].clone();d.fillStyle=f.name}else d.fillStyle=b.fillStyle||A.ctx[this.context].fillStyle;if(A.designnames.contains(d.strokeStyle))if("Pattern"!==A.design[d.strokeStyle].type){var g=A.design[d.strokeStyle].clone();d.strokeStyle=g.name}else d.strokeStyle=b.strokeStyle||A.ctx[this.context].strokeStyle}else delete A.ctx[c.context],A.ctxnames.removeItem(c.context),c.context=this.context;return b.field&&c.addSpriteToCellFields(),b.fence&&c.addSpriteToCellFences(),(b.group||b.target)&&(A.group[this.group].removeSpritesFromGroup(c.name),c.group=this.getGroup(b),A.group[c.group].addSpritesToGroup(c.name),A.xt(b.target)&&c.targetGroup(b)),c},l.prototype.addSpriteToCellFields=function(a){for(var a=A.xt(a)?[].concat(a):[A.pad[A.currentPad].current],b=0,c=a.length;c>b;b++)A.cellnames.contains(a[b])&&A.group[a[b]+"_field"].addSpritesToGroup(this.name);return this},l.prototype.addSpriteToCellFences=function(a){a=A.xt(a)?[].concat(a):[A.pad[A.currentPad].current];for(var b=0,c=a.length;c>b;b++)A.cellnames.contains(a[b])&&A.group[a[b]+"_fence"].addSpritesToGroup(this.name);return this},l.prototype.removeSpriteFromCellFields=function(a){a=A.xt(a)?[].concat(a):[A.pad[A.currentPad].current];for(var b=0,c=a.length;c>b;b++)A.cellnames.contains(a[b])&&A.group[a[b]+"_field"].removeSpritesFromGroup(this.name);return this},l.prototype.removeSpriteFromCellFences=function(a){a=A.xt(a)?[].concat(a):[A.pad[A.currentPad].current];for(var b=0,c=a.length;c>b;b++)A.cellnames.contains(a[b])&&A.group[a[b]+"_fence"].removeSpritesFromGroup(this.name);return this},l.prototype.set=function(b){return a.prototype.set.call(this,b),A.ctx[this.context].set(b),b=A.isa(b,"obj")?b:{},A.xt(b.collisionPoints)&&(this.collisionPoints=this.parseCollisionPoints(b.collisionPoints)),A.xt(b.field)&&this.addSpriteToCellFields(),A.xt(b.fence)&&this.addSpriteToCellFences(),A.xto([b.startX,b.handleX,b.startY,b.handleY])&&this.setCurrentParameters(),A.xto([b.group,b.target])&&(A.group[this.group].removeSpritesFromGroup(this.name),this.group=this.getGroup(b),A.group[this.group].addSpritesToGroup(this.name),A.xt(b.target)&&this.targetGroup(b)),this},l.prototype.get=function(a){return["globalAlpha","globalCompositeOperation","lineWidth","lineCap","lineJoin","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","font","textAlign","textBaseline","winding","lineDash","lineDashOffset","fillStyle","strokeStyle"].contains(a)?A.ctx[this.context].get(a):this[a]},l.prototype.swap=function(){return A.ctx[this.context].swapStyles(),this},l.prototype.getGroup=function(a){return a=A.isa(a,"obj")?a:{},A.xt(a.target)&&A.groupnames.contains(a.target)?a.target:A.xt(a.group)&&A.groupnames.contains(a.group)?a.group:A.pad[A.currentPad].current},l.prototype.forceStamp=function(a,b){var c=this.visibility;return this.visibility=!0,this.stamp(a,b),this.visibility=c,this},l.prototype.prepareStamp=function(a){return a=A.xt(a)?a:{x:0,y:0},{x:this.flipReverse?this.currentX-2*a.x:this.currentX,y:this.flipUpend?this.currentY-2*a.y:this.currentY}},l.prototype.prepareItemForStamp=function(a,b){var c;return c=A.xt(a)?A.isa(a,"str")?A.group[this.group].getOverride(this.name,a):a:A.group[this.group].getOverride(this.name,this.method),A.xt(b)&&A.cellnames.contains(b)&&(c.cells=[b]),c},l.prototype.setStampUsingPivot=function(a,b){var c,d;return A.pointnames.contains(this.pivot)?(this.startX=A.point[this.pivot].currentX,this.startY=A.point[this.pivot].currentY):A.spritenames.contains(this.pivot)?(this.startX=A.sprite[this.pivot].startX,this.startY=A.sprite[this.pivot].startY):"mouse"===this.pivot?(d=A.cell[b],c=A.pad[d.pad].getMouse(),A.xta([this.mouseX,this.mouseY])||(this.mouseX=this.startX,this.mouseY=this.startY),c.active&&(this.startX+=c.x-this.mouseX,this.startY+=c.y-this.mouseY,this.mouseX=c.x,this.mouseY=c.y)):A.groupnames.contains(this.pivot)&&(this.startX=A.group[this.pivot].startX,this.startY=A.group[this.pivot].startY),this},l.prototype.setCurrentParameters=function(a){return a=A.xt(a)?a:{x:0,y:0,r:0,s:1},this.currentScale=this.scale*a.s,this.currentX=this.getStartX(a),this.currentY=this.getStartY(a),this.currentWidth=this.width*this.currentScale,this.currentHeight=this.height*this.currentScale,A.xt(this.radius)&&(this.currentRadius=this.radius*this.currentScale),this.currentRoll=this.roll+a.r,this},l.prototype.stamp=function(a,b){if(this.visibility){var c,d,e,f,g=this.prepareItemForStamp(a,b);f=g.method||this.method;for(var h=0,i=g.cells.length;i>h;h++){c=A.cell[g.cells[h]],d=A.context[c.name],e=A.cell[g.cells[h]].name;var j;this.pivot?this.setStampUsingPivot(g,e):A.spritenames.contains(this.path)&&"Shape"===A.sprite[this.path].type&&(j=A.sprite[this.path].getPerimeterPosition(this.pathPosition,this.pathSpeedConstant,this.addPathRoll),this.startX=j.x,this.startY=j.y,this.pathRoll=j.r||0),this.setCurrentParameters(g),this.callMethod(d,e,g,f)}}return this},l.prototype.flipCanvas=function(a,b){var c=A.cell[b],d=c.actualWidth,e=c.actualHeight;return this.flipReverse&&this.flipUpend?(a.translate(d,e),a.scale(-1,-1),this.currentX=d-this.currentX,this.currentY=e-this.currentY):this.flipReverse?(a.translate(d,0),a.scale(-1,1),this.currentX=d-this.currentX):this.flipUpend&&(a.translate(0,e),a.scale(1,-1),this.currentY=e-this.currentY),this},l.prototype.callMethod=function(a,b,c,d){switch(this.flipCanvas(a,b),d){case"clear":this.clear(a,b,c);break;case"clearWithBackground":this.clearWithBackground(a,b,c);break;case"draw":this.draw(a,b,c);break;case"fill":this.fill(a,b,c);break;case"drawFill":this.drawFill(a,b,c);break;case"fillDraw":this.fillDraw(a,b,c);break;case"sinkInto":this.sinkInto(a,b,c);break;case"floatOver":this.floatOver(a,b,c);break;case"clip":this.clip(a,b,c);break;case"none":this.none(a,b,c)}return this.flipCanvas(a,b),this},l.prototype.rotateCell=function(a,b,c){if(A.xta([a,b])&&(this.rollable||this.addPathRoll)&&(this.currentRoll!==A.cell[b].roll||this.currentRoll+this.pathRoll!==A.cell[b].roll)){var d=this.addPathRoll?(this.currentRoll+this.pathRoll-A.cell[b].roll)*A.radian:(this.currentRoll-A.cell[b].roll)*A.radian;this.completeRotation(a,b,c,d)}return this},l.prototype.getRotationPoint=function(a){var b,c;return a=A.xt(a)?a:{x:0,y:0},b=this.flipReverse?this.currentX+this.getPivotOffset(this.handleX)*this.currentScale-2*a.x:this.currentX+this.getPivotOffset(this.handleX)*this.currentScale,c=this.flipUpend?this.currentY+this.getPivotOffset(this.handleY,!0)*this.currentScale-2*a.y:this.currentY+this.getPivotOffset(this.handleY,!0)*this.currentScale,{x:b,y:c}},l.prototype.completeRotation=function(a,b,c,d){var e=this.getRotationPoint(c,b);return a.translate(e.x,e.y),a.rotate(d),a.translate(-e.x,-e.y),this},l.prototype.unrotateCell=function(a,b,c){if(A.xta([a,b])&&(this.rollable||this.addPathRoll)&&(this.currentRoll!==A.cell[b].roll||this.currentRoll+this.pathRoll!==A.cell[b].roll)){var d=this.addPathRoll?(A.cell[b].roll-(this.currentRoll+this.pathRoll))*A.radian:(A.cell[b].roll-this.currentRoll)*A.radian;this.completeRotation(a,b,c,d)}return this},l.prototype.clear=function(){return this},l.prototype.clearWithBackground=function(){return this},l.prototype.draw=function(){return this},l.prototype.fill=function(){return this},l.prototype.drawFill=function(){return this},l.prototype.fillDraw=function(){return this},l.prototype.sinkInto=function(){return this},l.prototype.floatOver=function(){return this},l.prototype.clip=function(){return this},l.prototype.none=function(){return this},l.prototype.setDelta=function(a){return a=A.isa(a,"obj")?a:{},A.xt(a.startX)&&(this.startX+=a.startX),A.xt(a.startY)&&(this.startY+=a.startY),A.xt(a.handleX)&&(this.handleX+=a.handleX),A.xt(a.handleY)&&(this.handleY+=a.handleY),A.xt(a.width)&&(this.width+=a.width),A.xt(a.height)&&(this.height+=a.height),A.xt(a.radius)&&(this.radius+=a.radius),A.xt(a.scale)&&(this.scale+=a.scale),A.xt(a.roll)&&(this.roll+=a.roll),A.xt(a.startAngle)&&(this.startAngle+=a.startAngle),A.xt(a.endAngle)&&(this.endAngle+=a.endAngle),A.xt(a.copyX)&&(this.copyX+=a.copyX),A.xt(a.copyY)&&(this.copyY+=a.copyY),A.xt(a.copyWidth)&&(this.copyWidth+=a.copyWidth),A.xt(a.copyHeight)&&(this.copyHeight+=a.copyHeight),A.xt(a.pathPosition)&&(this.pathPosition+=a.pathPosition),A.xt(a.lineDashOffset)&&(A.ctx[this.context].lineDashOffset+=a.lineDashOffset),A.xt(a.lineWidth)&&(A.ctx[this.context].lineWidth+=a.lineWidth),A.xt(a.globalAlpha)&&(A.ctx[this.context].globalAlpha+=a.globalAlpha),this},l.prototype.getAngle=function(a){return this.addPathRoll?(a+this.currentRoll+this.pathRoll)*A.radian:(a+this.currentRoll)*A.radian},l.prototype.checkHit=function(a,b){var c=A.pad[a.pad]||A.pad[b.pad],d=A.cell[c.current].name,e=A.context[c.current],f=A.xt(a.tests)?a.tests:[{x:a.x||!1,y:a.y||!1}];this.flipCanvas(e,d),this.rotateCell(e,d,b);var g=this.prepareStamp(b);e.beginPath(),e.rect(g.x,g.y,this.currentWidth,this.currentHeight);for(var h=!1,i=0,j=f.length;j>i&&!(h=e.isPointInPath(f[i].x,f[i].y));i++);return this.unrotateCell(e,d,b),this.flipCanvas(e,d),h?f[i]:!1},l.prototype.checkField=function(a,b){var c=A.xt(a)&&A.cellnames.contains(a)?A.cell[a]:A.cell[A.group[this.group].cells[0]]||A.cell[A.pad[A.currentPad].current],d=this.getCollisionPoints(b),e=c.checkFieldAt({coordinates:d,test:this.fieldTest,channel:this.fieldChannel});return e>0?d[e-1]:e?!0:!1},l.prototype.clearShadow=function(a,b){A.cell[b].clearShadow()},l.prototype.restoreShadow=function(a,b){A.cell[b].restoreShadow(this.context)},l.prototype.getCollisionPoints=function(a){a=A.xt(a)?a:{x:0,y:0};var b,c,d,e,f,g=[],h=this.flipReverse?-(this.startX-this.currentX-(a.x||0)):this.startX-this.currentX+(a.x||0),i=this.flipUpend?-(this.startY-this.currentY-(a.y||0)):this.startY-this.currentY+(a.y||0);d=this.currentRoll*A.radian,e=this.flipReverse?this.startX+(a.x||0):this.startX+(a.x||0),f=this.flipUpend?this.startY+(a.y||0):this.startY+(a.y||0);for(var j=0,k=this.collisionPoints.length;k>j;j++)switch(this.collisionPoints[j]){case"start":g.push({x:this.currentX,y:this.currentY});break;case"N":c=this.currentWidth/2-h,b=0-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;case"NE":c=this.currentWidth-h,b=0-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;case"E":c=this.currentWidth-h,b=this.currentHeight/2-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;case"SE":c=this.currentWidth-h,b=this.currentHeight-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;case"S":c=this.currentWidth/2-h,b=this.currentHeight-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;case"SW":c=0-h,b=this.currentHeight-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;case"W":c=0-h,b=this.currentHeight/2-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;case"NW":c=0-h,b=0-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;case"center":c=this.currentWidth/2-h,b=this.currentHeight/2-i,g.push(this.getRotatedCoordinates(e,f,Math.sqrt(b*b+c*c),d+Math.atan2(b,c)));break;default:if(A.pointnames.contains(this.collisionPoints[j])){var l=A.point[this.collisionPoints[j]];l.visibility&&g.push({x:l.currentX,y:l.currentY})}}return g},l.prototype.getRotatedCoordinates=function(a,b,c,d){return d=this.flipReverse?180*A.radian-d:d,d=this.flipUpend?-d:d,{x:a+c*Math.cos(d),y:b+c*Math.sin(d)}},l.prototype.parseCollisionPoints=function(a){for(var b=A.xt(a)?[].concat(a):this.collisionPoints,c=[],d=0,e=b.length;e>d;d++)switch(b[d].toLowerCase()){case"all":c.pushUnique("N"),c.pushUnique("NE"),c.pushUnique("E"),c.pushUnique("SE"),c.pushUnique("S"),c.pushUnique("SW"),c.pushUnique("W"),c.pushUnique("NW"),c.pushUnique("start"),c.pushUnique("center");break;case"corners":c.pushUnique("NE"),c.pushUnique("SE"),c.pushUnique("SW"),c.pushUnique("NW");break;case"edges":c.pushUnique("N"),c.pushUnique("E"),c.pushUnique("S"),c.pushUnique("W");break;case"perimeter":c.pushUnique("N"),c.pushUnique("NE"),c.pushUnique("E"),c.pushUnique("SE"),c.pushUnique("S"),c.pushUnique("SW"),c.pushUnique("W"),c.pushUnique("NW");break;case"north":case"n":c.pushUnique("N");break;case"northeast":case"ne":c.pushUnique("NE");break;case"east":case"e":c.pushUnique("E");break;case"southeast":case"se":c.pushUnique("SE");break;case"south":case"s":c.pushUnique("S");break;case"southwest":case"sw":c.pushUnique("SW");break;case"west":case"w":c.pushUnique("W");break;case"northwest":case"nw":c.pushUnique("NW");break;case"start":c.pushUnique("start");break;case"center":c.pushUnique("center")}return c},m.prototype=Object.create(l.prototype),m.prototype.type="Phrase",m.prototype.classname="spritenames",m.prototype.multiline=function(a){for(var b=0,c=this.texts.length;c>b;b++)delete A.text[this.texts[b]],A.textnames.removeItem(this.texts[b]);this.texts=[],this.text=a.text||this.text;var d=this.text.split("\n");a.phrase=this.name;for(var e,b=0,c=d.length;c>b;b++)a.name=this.name+"_"+b,a.text=d[b],a.text.length>0&&(e=new n(a));return this.getMetrics(),this},m.prototype.set=function(a){return l.prototype.set.call(this,a),a=A.isa(a,"obj")?a:{},a.font&&this.checkFont(a.font),A.xto([a.style,a.variant,a.weight,a.size,a.metrics,a.family,a.scale])&&this.constructFont(),this.getMetrics(),this.multiline(a),this},m.prototype.setDelta=function(a){return l.prototype.setDelta.call(this,a),A.xto([a.size,a.scale])&&this.constructFont(),this.getMetrics(),this},m.prototype.clone=function(a){return a=A.xt(a)?a:{},a.textAlongPath=a.textAlongPath||this.textAlongPath,l.prototype.clone.call(this,a)},m.prototype.checkFont=function(a){return A.xt(a)&&this.deconstructFont(),this.constructFont(),this},m.prototype.deconstructFont=function(){var a,b=A.ctx[this.context].font;this.style=/italic/i.test(b)?"italic":/oblique/i.test(b)?"oblique":"normal",this.variant=/small-caps/i.test(b)?"small-caps":"normal",/bold/i.test(b)?this.weight="bold":/bolder/i.test(b)?this.weight="bolder":/lighter/i.test(b)?this.weight="lighter":/([1-9]00)/i.test(b)?(a=b.match(/([1-9]00)/i),this.weight=a[1]):this.weight="normal",/(\d+)(%|in|cm|mm|em|ex|pt|pc|ex)?/i.test(b)?(a=b.match(/(\d+)(%|in|cm|mm|em|ex|pt|pc|ex|px)?/i),this.size=parseFloat(a[1]),this.metrics=a[2]):/xx-small/i.test(b)?(this.size=3,this.metrics="pt"):/x-small/i.test(b)?(this.size=6,this.metrics="pt"):/small/i.test(b)?(this.size=9,this.metrics="pt"):/medium/i.test(b)?(this.size=12,this.metrics="pt"):/large/i.test(b)?(this.size=15,this.metrics="pt"):/x-large/i.test(b)?(this.size=18,this.metrics="pt"):/xx-large/i.test(b)?(this.size=21,this.metrics="pt"):(this.size=12,this.metrics="pt");for(var c="",d=b.split(" "),e=[100,200,300,400,500,600,700,800,900,"italic","oblique","small-caps","bold","bolder","lighter","xx-small","x-small","small","medium","large","x-large","xx-large"],f=0,g=d.length;g>f;f++)e.contains(d[f])||d[f].match(/[^\/](\d)+(%|in|cm|mm|em|ex|pt|pc|ex)?/i)||(c+=d[f]+" ");return c||(c="Verdana, Geneva, sans-serif"),this.family=c,this},m.prototype.constructFont=function(){var a="";return"normal"!==this.style&&(a+=this.style+" "),"normal"!==this.variant&&(a+=this.variant+" "),"normal"!==this.weight&&(a+=this.weight+" "),A.xt(this.currentScalse)||(this.currentScale=this.scale*A.group[this.group].scale),a+=this.size*this.currentScale+this.metrics+" ",a+=this.family,A.ctx[this.context].font=a,this},m.prototype.stamp=function(a,b){if(this.visibility){var c=A.spritenames.contains(this.path)&&"Shape"===A.sprite[this.path].type;this.pivot||!c||"phrase"===this.textAlongPath?l.prototype.stamp.call(this,a):A.text[this.texts[0]].stampAlongPath(a,b)}return this},m.prototype.clear=function(a,b,c){var d,e=this.getOffset();this.rotateCell(a,b,c),a.globalCompositeOperation="destination-out";for(var f=this.prepareStamp(c),g=0,h=this.texts.length;h>g;g++)d=f.y+this.size*this.lineHeight*this.currentScale*g+e.y,A.text[this.texts[g]].clear(a,b,c,f.x+e.x,d);return a.globalCompositeOperation=A.ctx[b].globalCompositeOperation,this.unrotateCell(a,b,c),this},m.prototype.clearWithBackground=function(a,b,c){var d,e=this.getOffset();this.rotateCell(a,b,c);for(var f=this.prepareStamp(c),g=0,h=this.texts.length;h>g;g++)d=f.y+this.size*this.lineHeight*this.currentScale*g+e.y,A.text[this.texts[g]].clearWithBackground(a,b,c,f.x+e.x,d);return this.unrotateCell(a,b,c),this},m.prototype.draw=function(a,b,c){var d,e=this.getOffset();this.rotateCell(a,b,c),A.cell[b].setEngine(this),this.backgroundColor&&this.addBackgroundColor(a,b,c);for(var f=this.prepareStamp(c),g=0,h=this.texts.length;h>g;g++)d=f.y+this.size*this.lineHeight*this.currentScale*g+e.y,A.text[this.texts[g]].draw(a,b,c,f.x+e.x,d);return this.unrotateCell(a,b,c),this},m.prototype.fill=function(a,b,c){var d,e=this.getOffset();this.rotateCell(a,b,c),A.cell[b].setEngine(this),this.backgroundColor&&this.addBackgroundColor(a,b,c);for(var f=this.prepareStamp(c),g=0,h=this.texts.length;h>g;g++)d=f.y+this.size*this.lineHeight*this.currentScale*g+e.y,A.text[this.texts[g]].fill(a,b,c,f.x+e.x,d);return this.unrotateCell(a,b,c),this},m.prototype.drawFill=function(a,b,c){var d,e=this.getOffset();this.rotateCell(a,b,c),A.cell[b].setEngine(this),this.backgroundColor&&this.addBackgroundColor(a,b,c);for(var f=this.prepareStamp(c),g=0,h=this.texts.length;h>g;g++)d=f.y+this.size*this.lineHeight*this.currentScale*g+e.y,A.text[this.texts[g]].drawFill(a,b,c,f.x+e.x,d);return this.unrotateCell(a,b,c),this},m.prototype.fillDraw=function(a,b,c){var d,e=this.getOffset();this.rotateCell(a,b,c),A.cell[b].setEngine(this),this.backgroundColor&&this.addBackgroundColor(a,b,c);for(var f=this.prepareStamp(c),g=0,h=this.texts.length;h>g;g++)d=f.y+this.size*this.lineHeight*this.currentScale*g+e.y,A.text[this.texts[g]].fillDraw(a,b,c,f.x+e.x,d);return this.unrotateCell(a,b,c),this},m.prototype.sinkInto=function(a,b,c){var d,e=this.getOffset();this.rotateCell(a,b,c),A.cell[b].setEngine(this),this.backgroundColor&&this.addBackgroundColor(a,b,c);for(var f=this.prepareStamp(c),g=0,h=this.texts.length;h>g;g++)d=f.y+this.size*this.lineHeight*this.currentScale*g+e.y,A.text[this.texts[g]].sinkInto(a,b,c,f.x+e.x,d);return this.unrotateCell(a,b,c),this},m.prototype.floatOver=function(a,b,c){var d,e=this.getOffset();this.rotateCell(a,b,c),A.cell[b].setEngine(this),this.backgroundColor&&this.addBackgroundColor(a,b,c);for(var f=this.prepareStamp(c),g=0,h=this.texts.length;h>g;g++)d=f.y+this.size*this.lineHeight*this.currentScale*g+e.y,A.text[this.texts[g]].floatOver(a,b,c,f.x+e.x,d);return this.unrotateCell(a,b,c),this},m.prototype.clip=function(){return this},m.prototype.getMetrics=function(){for(var a=0,b=0,c=0,d=this.texts.length;d>c;c++)b=A.text[this.texts[c]].width>b?A.text[this.texts[c]].width:b,a+=A.text[this.texts[c]].height;return this.width=b,this.height=a,this},m.prototype.addBackgroundColor=function(a,b,c){var d=this.prepareStamp(c),e=(this.backgroundMargin,this.backgroundMargin,d.x-this.backgroundMargin),f=d.y-this.backgroundMargin,g=this.currentWidth+2*this.backgroundMargin,h=this.currentHeight+2*this.backgroundMargin;return a.fillStyle=this.backgroundColor,a.fillRect(e,f,g,h),a.fillStyle=A.ctx[this.context].fillStyle,this},m.prototype.getOffset=function(){var a=A.ctx[this.context],b=0,c=0;switch(a.textAlign){case"start":case"left":b=0;break;case"center":b=this.width/2*this.currentScale;break;case"right":case"end":b=this.width*this.currentScale}switch(a.textBaseline){case"top":c=0;break;case"hanging":c=this.size*this.lineHeight*this.currentScale*.1;break;case"middle":c=this.size*this.lineHeight*this.currentScale*.5;break;case"bottom":c=this.size*this.lineHeight*this.currentScale;break;default:c=this.size*this.lineHeight*this.currentScale*.85}return{x:b,y:c}},n.prototype=Object.create(a.prototype),n.prototype.type="Text",n.prototype.classname="textnames",n.prototype.stampAlongPath=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;A.xt(this.glyphs)||this.getMetrics(),b=A.sprite[this.phrase],e=b.prepareItemForStamp(a),g=e.method||b.method,j=A.sprite[b.path].getPerimeterLength(),k=this.width*b.scale,i=k/j,n=this.text;for(var r=0,s=e.cells.length;s>r;r++){c=A.cell[e.cells[r]],c.setEngine(b),d=A.context[c.name],f=A.cell[e.cells[r]].name,l=b.pathPosition,this.flipCanvas(d,f,b);for(var t=0,u=this.glyphs.length;u>t;t++)if(A.xt(this.glyphs[t])){switch(this.text=this.glyphs[t],m=l+this.glyphWidths[t]/2/k*i,m.isBetween(0,1,!0)||(m+=m>.5?-1:1),h=A.sprite[b.path].getPerimeterPosition(m,b.pathSpeedConstant,!0),o=h.x,p=h.y,q=h.r*A.radian,d.translate(o,p),d.rotate(q),d.translate(-o,-p),g){case"draw":this.draw(d,f,e,o,p);break;case"fill":this.fill(d,f,e,o,p);break;case"drawFill":this.drawFill(d,f,e,o,p);break;case"fillDraw":this.fillDraw(d,f,e,o,p);break;case"sinkInto":this.sinkInto(d,f,e,o,p);break;case"floatOver":this.floatOver(d,f,e,o,p);break;case"clear":case"clearWithBackground":case"clip":case"none":}l+=this.glyphWidths[t]/k*i,l.isBetween(0,1,!0)||(l+=l>.5?-1:1),d.translate(o,p),d.rotate(-q),d.translate(-o,-p)}this.flipCanvas(d,f,b)}return this.text=n,this},n.prototype.flipCanvas=function(a,b,c){var d=A.cell[b],e=d.actualWidth,f=d.actualHeight;return c.flipReverse&&c.flipUpend?(a.translate(e,f),a.scale(-1,-1)):c.flipReverse?(a.translate(e,0),a.scale(-1,1)):c.flipUpend&&(a.translate(0,f),a.scale(1,-1)),this},n.prototype.clear=function(a,b,c,d,e){return a.fillText(this.text,d,e),this},n.prototype.clearWithBackground=function(a,b,c,d,e){return a.fillStyle=A.cell[b].backgroundColor,a.globalAlpha=1,a.fillText(this.text,d,e),a.fillStyle=A.ctx[b].fillStyle,a.globalAlpha=A.ctx[b].globalAlpha,this},n.prototype.draw=function(a,b,c,d,e){return a.strokeText(this.text,d,e),this},n.prototype.fill=function(a,b,c,d,e){return a.fillText(this.text,d,e),this},n.prototype.drawFill=function(a,b,c,d,e){var f=A.sprite[this.phrase];return a.strokeText(this.text,d,e),f.clearShadow(a,b),a.fillText(this.text,d,e),f.restoreShadow(a,b),this},n.prototype.fillDraw=function(a,b,c,d,e){var f=A.sprite[this.phrase];return a.fillText(this.text,d,e),f.clearShadow(a,b),a.strokeText(this.text,d,e),f.restoreShadow(a,b),this},n.prototype.sinkInto=function(a,b,c,d,e){return a.fillText(this.text,d,e),a.strokeText(this.text,d,e),this},n.prototype.floatOver=function(a,b,c,d,e){return a.strokeText(this.text,d,e),a.fillText(this.text,d,e),this},n.prototype.clip=function(){return this},n.prototype.getMetrics=function(){var a=A.sprite[this.phrase],b=A.context[A.pad[A.currentPad].current],c=A.ctx[this.context],d=b.font,e=b.textBaseline,f=b.textAlign;if(b.font=c.font,b.textBaseline=c.textBaseline,b.textAlign=c.textAlign,this.width=b.measureText(this.text).width/a.scale,this.height=1.5*a.size,a.path){this.glyphs=[],this.glyphWidths=[];var g,h=this.text;if("word"===this.textAlongPath){g=this.text.split(" ");for(var i=0,j=g.length;j>i;i++)this.glyphs.push(g[i]),this.glyphWidths.push(b.measureText(g[i]).width),A.xt(g[i+1])&&(this.glyphs.push(" "),this.glyphWidths.push(b.measureText(" ").width))}else{var k=b.measureText(h).width;if(this.fixedWidth)for(var i=0,j=h.length;j>i;i++)this.glyphs.push(h[i]),this.glyphWidths.push(k/j);else for(var i=1,j=h.length;j>=i;i++)this.glyphs.push(h[i-1]),g=h.substr(0,i-1)+h.substr(i),this.glyphWidths.push(k-b.measureText(g).width)}}return b.font=d,b.textBaseline=e,b.textAlign=f,this},o.prototype=Object.create(l.prototype),o.prototype.type="Block",o.prototype.classname="spritenames",o.prototype.clip=function(a,b,c){a.save(),this.rotateCell(a,b,c);var d=this.prepareStamp(c);return a.rect(d.x,d.y,this.currentWidth,this.currentHeight),a.clip(),this.unrotateCell(a,b,c),this},o.prototype.clear=function(a,b,c){A.cell[b].setToClearShape(),this.rotateCell(a,b,c);var d=this.prepareStamp(c);return a.clearRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},o.prototype.clearWithBackground=function(a,b,c){this.rotateCell(a,b,c),a.fillStyle=A.cell[b].backgroundColor,a.strokeStyle=A.cell[b].backgroundColor,a.globalAlpha=1;var d=this.prepareStamp(c);return a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),a.fillRect(d.x,d.y,this.currentWidth,this.currentHeight),a.fillStyle=A.ctx[b].fillStyle,a.strokeStyle=A.ctx[b].strokeStyle,a.globalAlpha=A.ctx[b].globalAlpha,this.unrotateCell(a,b,c),this},o.prototype.draw=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},o.prototype.fill=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.fillRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},o.prototype.drawFill=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),this.clearShadow(a,b),a.fillRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},o.prototype.fillDraw=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.fillRect(d.x,d.y,this.currentWidth,this.currentHeight),this.clearShadow(a,b),a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},o.prototype.sinkInto=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.fillRect(d.x,d.y,this.currentWidth,this.currentHeight),a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},o.prototype.floatOver=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),a.fillRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},p.prototype=Object.create(l.prototype),p.prototype.type="Wheel",p.prototype.classname="spritenames",p.prototype.checkHit=function(a,b){a=A.isa(a,"obj")?a:{};var c=A.xt(a.tests)?a.tests:[{x:a.x||!1,y:a.y||!1}],d=this.prepareStamp(b),e=!1;if(this.checkHitUsingRadius)for(var f=a.test||0,g=f?f:this.currentRadius,h=0,i=c.length;i>h;h++){var j=(c[h].x-d.x)*(c[h].x-d.x),k=(c[h].y-d.y)*(c[h].y-d.y),l=Math.sqrt(j+k);if(e=g>=l?!0:!1)break}else{var m=A.pad[a.pad]||A.pad[b.pad],n=A.cell[m.current].name,o=A.context[m.current];this.flipCanvas(o,n),this.buildPath(o,b);for(var h=0,i=c.length;i>h&&!(e=o.isPointInPath(c[h].x,c[h].y));h++);this.flipCanvas(o,n)}return e?c[h]:!1},p.prototype.getPivotOffset=function(a){if(A.xt(a)){var b;if(A.isa(a,"str")&&!["left","center","right","top","bottom"].contains(a))b=parseFloat(a)/100*this.width-this.radius;else switch(a){case"left":b=-this.radius;break;case"center":b=0;break;case"right":b=this.radius;break;case"top":b=-this.radius;break;case"bottom":b=this.radius;break;default:b=a}return b}return 0},p.prototype.buildPath=function(a,b,c){var d=this.prepareStamp(c);return a.beginPath(),a.arc(d.x,d.y,this.currentRadius,this.getAngle(this.startAngle),this.getAngle(this.endAngle),this.clockwise),this.includeCenter&&a.lineTo(d.x,d.y),this.closed&&a.closePath(),this},p.prototype.clip=function(a,b,c){return this.buildPath(a,b,c),a.clip(),this},p.prototype.clear=function(a,b,c){return this.buildPath(a,b,c),a.globalCompositeOperation="destination-out",a.stroke(),a.fill(A.ctx[this.context].winding),a.globalCompositeOperation=A.ctx[b].globalCompositeOperation,this},p.prototype.clearWithBackground=function(a,b,c){return this.buildPath(a,b,c),a.fillStyle=A.cell[b].backgroundColor,a.strokeStyle=A.cell[b].backgroundColor,a.globalAlpha=1,a.stroke(),a.fill(A.ctx[this.context].winding),a.fillStyle=A.ctx[b].fillStyle,a.strokeStyle=A.ctx[b].strokeStyle,a.globalAlpha=A.ctx[b].globalAlpha,this},p.prototype.draw=function(a,b,c){return A.cell[b].setEngine(this),this.buildPath(a,b,c),a.stroke(),this},p.prototype.fill=function(a,b,c){return A.cell[b].setEngine(this),this.buildPath(a,b,c),a.fill(A.ctx[this.context].winding),this},p.prototype.drawFill=function(a,b,c){return A.cell[b].setEngine(this),this.buildPath(a,b,c),a.stroke(),this.clearShadow(a,b),a.fill(A.ctx[this.context].winding),this},p.prototype.fillDraw=function(a,b,c){return A.cell[b].setEngine(this),this.buildPath(a,b,c),a.fill(A.ctx[this.context].winding),this.clearShadow(a,b),a.stroke(),this},p.prototype.sinkInto=function(a,b,c){return A.cell[b].setEngine(this),this.buildPath(a,b,c),a.fill(A.ctx[this.context].winding),a.stroke(),this},p.prototype.floatOver=function(a,b,c){return A.cell[b].setEngine(this),this.buildPath(a,b,c),a.stroke(),a.fill(A.ctx[this.context].winding),this},p.prototype.getCollisionPoints=function(a){var b,c=[],d={x:this.flipReverse?this.currentX+2*a.x:this.currentX,y:this.flipUpend?this.currentY+2*a.y:this.currentY};b=this.currentRoll*A.radian;for(var e=0,f=this.collisionPoints.length;f>e;e++)switch(this.collisionPoints[e]){case"start":c.push({x:d.x,y:d.y});break;case"N":c.push(this.getRotatedCoordinates(d.x,d.y,this.currentRadius,b+270*A.radian));break;case"NE":c.push(this.getRotatedCoordinates(d.x,d.y,this.currentRadius,b+315*A.radian));break;case"E":c.push(this.getRotatedCoordinates(d.x,d.y,this.currentRadius,b));break;case"SE":c.push(this.getRotatedCoordinates(d.x,d.y,this.currentRadius,b+45*A.radian));break;case"S":c.push(this.getRotatedCoordinates(d.x,d.y,this.currentRadius,b+90*A.radian));
break;case"SW":c.push(this.getRotatedCoordinates(d.x,d.y,this.currentRadius,b+135*A.radian));break;case"W":c.push(this.getRotatedCoordinates(d.x,d.y,this.currentRadius,b+180*A.radian));break;case"NW":c.push(this.getRotatedCoordinates(d.x,d.y,this.currentRadius,b+225*A.radian));break;case"center":c.push({x:d.x,y:d.y});break;default:if(A.pointnames.contains(this.collisionPoints[e])){var g=A.point[this.collisionPoints[e]];g.visibility&&c.push({x:g.currentX,y:g.currentY})}}return c},q.prototype=Object.create(l.prototype),q.prototype.type="Picture",q.prototype.classname="spritenames",q.prototype.importImage=function(a){if(!A.isa(a,"obj")||!A.xt(a.url))return console.log("Picture.importImage() failed - no url supplied"),!1;var b=new Image;b.id=a.name||"image"+Math.floor(1e8*Math.random()),b.onload=function(){try{{A.newImage({name:b.id,element:b})}return delete a.url,a.source=b.id,A.newPicture(a)}catch(c){return console.log("Image <"+url+"> failed to load - "+c.name+" error: "+c.message),!1}},b.src=a.url},q.prototype.clone=function(a){var b=l.prototype.clone.call(this,a);return a=A.isa(a,"obj")?a:{},a.keepCopyDimensions||b.fitToImageSize(),b},q.prototype.fitToImageSize=function(){return"img"===this.imageType&&(this.copyWidth=A.image[this.source].copyWidth,this.copyHeight=A.image[this.source].copyHeight,this.copyX=A.image[this.source].copyX,this.copyY=A.image[this.source].copyY),this},q.prototype.sourceImage=function(){return this.animSheet&&A.imagenames.contains(this.source)?"animation":A.imagenames.contains(this.source)?"img":A.cellnames.contains(this.source)?"canvas":!1},q.prototype.clip=function(a,b,c){a.save(),this.rotateCell(a,b,c);var d=this.prepareStamp(c);return a.rect(d.x,d.y,this.currentWidth,this.currentHeight),a.clip(),this.unrotateCell(a,b,c),this},q.prototype.clear=function(a,b,c){this.rotateCell(a,b,c);var d=this.prepareStamp(c);return a.clearRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},q.prototype.clearWithBackground=function(a,b,c){this.rotateCell(a,b,c),a.fillStyle=A.cell[b].backgroundColor,a.strokeStyle=A.cell[b].backgroundColor,a.globalAlpha=1;var d=this.prepareStamp(c);return a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),a.fillRect(d.x,d.y,this.currentWidth,this.currentHeight),a.fillStyle=A.ctx[b].fillStyle,a.strokeStyle=A.ctx[b].strokeStyle,a.globalAlpha=A.ctx[b].globalAlpha,this.unrotateCell(a,b,c),this},q.prototype.draw=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c),this},q.prototype.fill=function(a,b,c){if(this.imageType){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);try{a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,d.x,d.y,this.currentWidth,this.currentHeight)}catch(e){}this.unrotateCell(a,b,c)}return this},q.prototype.drawFill=function(a,b,c){if(this.imageType){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),this.clearShadow(a,b);try{a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,d.x,d.y,this.currentWidth,this.currentHeight)}catch(e){}this.unrotateCell(a,b,c)}return this},q.prototype.fillDraw=function(a,b,c){if(this.imageType){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);try{a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,d.x,d.y,this.currentWidth,this.currentHeight)}catch(e){}this.clearShadow(a,b),a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c)}return this},q.prototype.sinkInto=function(a,b,c){if(this.imageType){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);try{a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,d.x,d.y,this.currentWidth,this.currentHeight)}catch(e){}a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight),this.unrotateCell(a,b,c)}return this},q.prototype.floatOver=function(a,b,c){if(this.imageType){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);a.strokeRect(d.x,d.y,this.currentWidth,this.currentHeight);try{a.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,d.x,d.y,this.currentWidth,this.currentHeight)}catch(e){}this.unrotateCell(a,b,c)}return this},q.prototype.getImageData=function(){var a,b;if("animation"===this.imageType&&A.image[this.source])b=A.image[this.source],a=A.addNewCell({name:this.name,height:b.height,width:b.width}),A.context[a.name].drawImage(A.img[this.source],0,0);else{a=A.addNewCell({name:this.name,height:this.copyHeight,width:this.copyWidth});try{A.context[a.name].drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,0,0,this.copyWidth,this.copyHeight)}catch(c){}}return this.imageData=a.getImageData({name:"data"}),A.deleteCells([a.name]),this},q.prototype.getImageDataValue=function(a,b){a=A.isa(a,"obj")?a:{x:0,y:0},b=A.isa(b,"obj")?b:{x:0,y:0};var c=A.pad[a.pad]||A.pad[b.pad]||A.pad[A.cell[A.group[this.group].cells[0]].pad],d=A.cell[c.current].name,e=A.context[c.current],f=A.imageData[this.imageData];this.flipCanvas(e,d),this.rotateCell(e,d,b);var g=this.prepareStamp(b),h=!1,i=this.getLocalRotatedPoint(b,d,c,a,g),j=4*(parseFloat((i.y*f.width).toFixed())+parseFloat(i.x.toFixed()));if(i.x.isBetween(0,f.width-1,!0)&&i.y.isBetween(0,f.height-1,!0))switch(a.channel||this.imageDataChannel){case"red":h=A.xt(f.data[j])?f.data[j]:!1;break;case"blue":h=A.xt(f.data[j+1])?f.data[j+1]:!1;break;case"green":h=A.xt(f.data[j+2])?f.data[j+2]:!1;break;case"alpha":h=A.xt(f.data[j+3])?f.data[j+3]:!1;break;case"color":h=A.xta([f.data[j],f.data[j+1],f.data[j+2],f.data[j+3]])?"rgba("+f.data[j]+","+f.data[j+1]+","+f.data[j+2]+","+f.data[j+3]+")":!1;break;default:h=!1}return this.unrotateCell(e,d,b),this.flipCanvas(e,d),h},q.prototype.getImage=function(){if("animation"===this.imageType){var a=A.anim[this.animSheet].getData();return this.copyX=a.copyX,this.copyY=a.copyY,this.copyWidth=a.copyWidth,this.copyHeight=a.copyHeight,A.img[this.source]}return A[this.imageType][this.source]},q.prototype.set=function(a){return l.prototype.set.call(this,a),A.xto([a.sheet,a.frames,a.currentFrame,a.speed,a.loop,a.running,a.lastCalled])&&A.anim[this.animSheet].set(a),this},q.prototype.get=function(a){return["sheet","frames","currentFrame","speed","loop","running","lastCalled"].contains(a)?A.anim[this.animSheet].get(a):l.prototype.get.call(this,a)},q.prototype.checkHit=function(a,b){if(a=A.isa(a,"obj")?a:{},this.checkHitUsingImageData){var c=A.pad[a.pad]||A.pad[b.pad],d=A.cell[c.current].name,e=A.context[c.current],f=A.xt(a.tests)?a.tests:[{x:a.x||0,y:a.y||0}],g=A.imageData[this.imageData],h=A.isa(a.test,"num")?a.test:0;this.flipCanvas(e,d),this.rotateCell(e,d,b);var i=this.prepareStamp(b);e.beginPath(),e.rect(i.x,i.y,this.currentWidth,this.currentHeight);for(var j=!1,k=0,m=f.length;m>k;k++)if(j=e.isPointInPath(f[k].x,f[k].y)){var n,o=this.getLocalRotatedPoint(b,d,c,f[k],i),p=4*(parseFloat((o.y*g.width).toFixed())+parseFloat(o.x.toFixed()));switch(a.channel||this.imageDataChannel){case"red":n=0;break;case"blue":n=1;break;case"green":n=2;break;case"alpha":n=3}if(j=g.data[p+n]>h?!0:!1)break}return this.unrotateCell(e,d,b),this.flipCanvas(e,d),j?f[k]:!1}return l.prototype.checkHit.call(this,a,b)},q.prototype.getLocalRotatedCoordinates=function(a,b,c,d){return{x:a+c*Math.cos(d),y:b+c*Math.sin(d)}},q.prototype.getLocalRotatedPoint=function(a,b,c,d,e){var f,g,h,i,j,k=this.getRotationPoint(a,b);return g=this.flipReverse?c.width-d.x-k.x:d.x-k.x,h=this.flipUpend?c.height-d.y-k.y:d.y-k.y,f=this.getLocalRotatedCoordinates(k.x,k.y,Math.sqrt(g*g+h*h),Math.atan2(h,g)-this.currentRoll*A.radian),i=(f.x-k.x+(k.x-e.x))/this.currentScale*(this.copyWidth/this.width),j=(f.y-k.y+(k.y-e.y))/this.currentScale*(this.copyHeight/this.height),"animation"===this.imageType&&(i+=this.copyX,j+=this.copyY),i=parseFloat(i.toFixed()),j=parseFloat(j.toFixed()),{x:i,y:j}},r.prototype=Object.create(l.prototype),r.prototype.type="Outline",r.prototype.classname="spritenames",r.prototype.set=function(a){return l.prototype.set.call(this,a),a=A.isa(a,"obj")?a:{},A.xt(a.data)&&(this.dataSet=this.buildDataSet(this.data)),this},r.prototype.buildDataSet=function(a){for(var b,c,d=[],e=999999,f=999999,g=-999999,h=-999999,i=this.startX,j=this.startY,k=function(a,b){e=e>a?a:e,f=f>b?b:f,g=a>g?a:g,h=b>h?b:h},l=a.match(/([A-Za-z][0-9. ,\-]*)/g),m=0,n=l.length;n>m;m++){if(b=l[m][0],c=l[m].match(/(-?[0-9.]+\b)/g)){for(var o=0,p=c.length;p>o;o++)c[o]=parseFloat(c[o]);switch(b){case"H":for(var o=0,p=c.length;p>o;o++)i=c[o],k(i,j);break;case"V":for(var o=0,p=c.length;p>o;o++)j=c[o],k(i,j);break;case"M":for(var o=0,p=c.length;p>o;o+=2)i=c[o],j=c[o+1],k(i,j);case"L":case"T":for(var o=0,p=c.length;p>o;o+=2)i=c[o],j=c[o+1],k(i,j);break;case"Q":case"S":for(var o=0,p=c.length;p>o;o+=4)i=c[o+2],j=c[o+3],k(i,j);break;case"C":for(var o=0,p=c.length;p>o;o+=6)i=c[o+4],j=c[o+5],k(i,j);break;case"h":for(var o=0,p=c.length;p>o;o++)i+=c[o],k(i,j);break;case"v":for(var o=0,p=c.length;p>o;o++)j+=c[o],k(i,j);break;case"m":case"l":case"t":for(var o=0,p=c.length;p>o;o+=2)i+=c[o],j+=c[o+1],k(i,j);break;case"q":case"s":for(var o=0,p=c.length;p>o;o+=4)i+=c[o+2],j+=c[o+3],k(i,j);break;case"c":for(var o=0,p=c.length;p>o;o+=6)i+=c[o+4],j+=c[o+5],k(i,j)}}d.push({c:b,p:c})}this.width=g-e,this.height=h-f;for(var m=0,n=d.length;n>m;m++){if(["M","L","C","Q","S","T"].contains(d[m].c))for(var o=0,p=d[m].p.length;p>o;o+=2)d[m].p[o]-=e,d[m].p[o+1]-=f;if("H"===d[m].c)for(var o=0,p=d[m].p.length;p>o;o++)d[m].p[o]-=e;if("V"===d[m].c)for(var o=0,p=d[m].p.length;p>o;o++)d[m].p[o]-=f}return this.compiledData=!1,d},r.prototype.doOutline=function(a,b){if(!this.dataSet&&this.data&&this.buildDataSet(this.data),this.dataSet){var c,d,e,f=this.prepareStamp(b),g=f.x,h=f.y,i=f.x,j=f.y;a.beginPath(),["M","m"].contains(this.dataSet[0].c)||(g=0,h=0,i=g,j=h,a.moveTo(0,0));for(var k=0,l=this.dataSet.length;l>k;k++)switch(c=this.dataSet[k],c.c){case"M":g=c.p[0],h=c.p[1],i=g,j=h,a.moveTo(g*this.scale,h*this.scale);for(var m=2,n=c.p.length;n>m;m+=2)g=c.p[m],h=c.p[m+1],i=g,j=h,a.lineTo(g*this.scale,h*this.scale);break;case"m":g+=c.p[0],h+=c.p[1],i=g,j=h,a.moveTo(g*this.scale,h*this.scale);for(var m=2,n=c.p.length;n>m;m+=2)g+=c.p[m],h+=c.p[m+1],i=g,j=h,a.lineTo(g*this.scale,h*this.scale);break;case"Z":case"z":a.closePath();break;case"L":for(var m=0,n=c.p.length;n>m;m+=2)g=c.p[m],h=c.p[m+1],i=g,j=h,a.lineTo(g*this.scale,h*this.scale);break;case"l":for(var m=0,n=c.p.length;n>m;m+=2)g+=c.p[m],h+=c.p[m+1],i=g,j=h,a.lineTo(g*this.scale,h*this.scale);break;case"H":for(var m=0,n=c.p.length;n>m;m++)g=c.p[m],i=g,a.lineTo(g*this.scale,h*this.scale);break;case"h":for(var m=0,n=c.p.length;n>m;m++)g+=c.p[m],i=g,a.lineTo(g*this.scale,h*this.scale);break;case"V":for(var m=0,n=c.p.length;n>m;m++)h=c.p[m],j=h,a.lineTo(g*this.scale,h*this.scale);break;case"v":for(var m=0,n=c.p.length;n>m;m++)h+=c.p[m],j=h,a.lineTo(g*this.scale,h*this.scale);break;case"C":for(var m=0,n=c.p.length;n>m;m+=6)a.bezierCurveTo(c.p[m]*this.scale,c.p[m+1]*this.scale,c.p[m+2]*this.scale,c.p[m+3]*this.scale,c.p[m+4]*this.scale,c.p[m+5]*this.scale),i=c.p[m+2],j=c.p[m+3],g=c.p[m+4],h=c.p[m+5];break;case"c":for(var m=0,n=c.p.length;n>m;m+=6)a.bezierCurveTo((g+c.p[m])*this.scale,(h+c.p[m+1])*this.scale,(g+c.p[m+2])*this.scale,(h+c.p[m+3])*this.scale,(g+c.p[m+4])*this.scale,(h+c.p[m+5])*this.scale),i=g+c.p[m+2],j=h+c.p[m+3],g+=c.p[m+4],h+=c.p[m+5];break;case"S":for(var m=0,n=c.p.length;n>m;m+=4)k>0&&["C","c","S","s"].contains(this.dataSet[k-1].c)?(d=g+(g-i),e=h+(h-j)):(d=g,e=h),a.bezierCurveTo(d*this.scale,e*this.scale,c.p[m]*this.scale,c.p[m+1]*this.scale,c.p[m+2]*this.scale,c.p[m+3]*this.scale),i=c.p[m],j=c.p[m+1],g=c.p[m+2],h=c.p[m+3];break;case"s":for(var m=0,n=c.p.length;n>m;m+=4)k>0&&["C","c","S","s"].contains(this.dataSet[k-1].c)?(d=g+(g-i),e=h+(h-j)):(d=g,e=h),a.bezierCurveTo(d*this.scale,e*this.scale,(g+c.p[m])*this.scale,(h+c.p[m+1])*this.scale,(g+c.p[m+2])*this.scale,(h+c.p[m+3])*this.scale),i=g+c.p[m],j=h+c.p[m+1],g+=c.p[m+2],h+=c.p[m+3];break;case"Q":for(var m=0,n=c.p.length;n>m;m+=4)a.quadraticCurveTo(c.p[m]*this.scale,c.p[m+1]*this.scale,c.p[m+2]*this.scale,c.p[m+3]*this.scale),i=c.p[m],j=c.p[m+1],g=c.p[m+2],h=c.p[m+3];break;case"q":for(var m=0,n=c.p.length;n>m;m+=4)a.quadraticCurveTo((g+c.p[m])*this.scale,(h+c.p[m+1])*this.scale,(g+c.p[m+2])*this.scale,(h+c.p[m+3])*this.scale),i=g+c.p[m],j=h+c.p[m+1],g+=c.p[m+2],h+=c.p[m+3];break;case"T":for(var m=0,n=c.p.length;n>m;m+=2)k>0&&["Q","q","T","t"].contains(this.dataSet[k-1].c)?(d=g+(g-i),e=h+(h-j)):(d=g,e=h),a.quadraticCurveTo(d*this.scale,e*this.scale,c.p[m]*this.scale,c.p[m+1]*this.scale),i=d,j=e,g=c.p[m],h=c.p[m+1];break;case"t":for(var m=0,n=c.p.length;n>m;m+=2)k>0&&["Q","q","T","t"].contains(this.dataSet[k-1].c)?(d=g+(g-i),e=h+(h-j)):(d=g,e=h),a.quadraticCurveTo(d*this.scale,e*this.scale,(g+c.p[m])*this.scale,(h+c.p[m+1])*this.scale),i=d,j=e,g+=c.p[m],h+=c.p[m+1]}}return this},r.prototype.clip=function(a,b,c){a.save(),this.rotateCell(a,b,c);var d=this.prepareStamp(c);return a.translate(d.x,d.y),this.doOutline(a,c),a.clip(),a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.clear=function(a,b,c){A.cell[b].setToClearShape(),this.rotateCell(a,b,c);var d=this.prepareStamp(c);return a.translate(d.x,d.y),this.doOutline(a,c),a.globalCompositeOperation="destination-out",a.fill(A.ctx[this.context].winding),a.globalCompositeOperation=A.ctx[b].globalCompositeOperation,a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.clearWithBackground=function(a,b,c){this.rotateCell(a,b,c);var d=this.prepareStamp(c);return a.translate(d.x,d.y),a.fillStyle=A.cell[b].backgroundColor,a.strokeStyle=A.cell[b].backgroundColor,a.globalAlpha=1,this.doOutline(a,c),a.fill(A.ctx[this.context].winding),a.stroke(),a.fillStyle=A.ctx[b].fillStyle,a.strokeStyle=A.ctx[b].strokeStyle,a.globalAlpha=A.ctx[b].globalAlpha,a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.draw=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.translate(d.x,d.y),this.doOutline(a,c),a.stroke(),a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.fill=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.translate(d.x,d.y),this.doOutline(a,c),a.fill(A.ctx[this.context].winding),a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.drawFill=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.translate(d.x,d.y),this.doOutline(a,c),a.stroke(),this.clearShadow(a,b),a.fill(A.ctx[this.context].winding),a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.fillDraw=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.translate(d.x,d.y),this.doOutline(a,c),a.fill(A.ctx[this.context].winding),this.clearShadow(a,b),a.stroke(),a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.sinkInto=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.translate(d.x,d.y),this.doOutline(a,c),a.fill(A.ctx[this.context].winding),a.stroke(),a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.floatOver=function(a,b,c){this.rotateCell(a,b,c),A.cell[b].setEngine(this);var d=this.prepareStamp(c);return a.translate(d.x,d.y),this.doOutline(a,c),a.stroke(),a.fill(A.ctx[this.context].winding),a.translate(-d.x,-d.y),this.unrotateCell(a,b,c),this},r.prototype.checkHit=function(a,b){a=A.isa(a,"obj")?a:{};var c=A.pad[a.pad]||A.pad[b.pad],d=A.cell[c.current].name,e=A.context[c.current],f=A.xt(a.tests)?a.tests:[{x:a.x||!1,y:a.y||!1}];this.flipCanvas(e,d),this.rotateCell(e,d,b);var g=this.prepareStamp(b);e.translate(g.x,g.y),this.doOutline(e,b);for(var h=!1,i=0,j=f.length;j>i&&!(h=e.isPointInPath(f[i].x,f[i].y));i++);return e.translate(-g.x,-g.y),this.unrotateCell(e,d,b),this.flipCanvas(e,d),h?f[i]:!1},s.prototype=Object.create(l.prototype),s.prototype.type="Shape",s.prototype.classname="spritenames",s.prototype.exportNative=function(a){for(var b=l.prototype.exportNative.call(this,a),c=this.getFullPointList(),d=0,e=c.length;e>d;d++)b.push(A.point[c[d]].prepareForExport(a)),A.xt(A.point[c[d]].startLink)&&A.linknames.contains(A.point[c[d]].startLink)&&b.push(A.link[A.point[c[d]].startLink].prepareForExport(a));return b},s.prototype.getRadius=function(){for(var a=0,b=0,c=this.pointList.length;c>b;b++)a=A.point[this.pointList[b]].distance>a?A.point[this.pointList[b]].distance:a;return this.radius=a,this.radius},s.prototype.set=function(a){return l.prototype.set.call(this,a),(this.linkDurations.length>0||this.perimeterLength)&&this.buildPositions(),this},s.prototype.setDelta=function(a){return l.prototype.setDelta.call(this,a),(this.linkDurations.length>0||this.perimeterLength)&&this.buildPositions(),this},s.prototype.parseCollisionPoints=function(){return this.collisionPoints},s.prototype.prepareShape=function(a,b,c){if(this.firstPoint){var d=A.point[this.firstPoint].getData(c);a.beginPath(),A.link[d.startLink].sketch(a,c)}return this},s.prototype.getPivotOffset=function(a,b){if(A.xt(a)){var c;if(A.isa(a,"str")&&!["left","center","right","top","bottom"].contains(a))c=b?parseFloat(a)/100*this.height-this.height/2:parseFloat(a)/100*this.width-this.width/2;else switch(a){case"left":c=-(this.width/2);break;case"center":c=0;break;case"right":c=this.width/2;break;case"top":c=-(this.height/2);break;case"bottom":c=this.height/2;break;default:c=a}return this.line&&(c+=b?this.height/2:this.width/2),c}return 0},s.prototype.stampMark=function(a,b,c,d){var e=a.path,f=a.pathPosition,g=a.group;a.set({path:this.name,pathPosition:b,group:d}).forceStamp(),a.set({path:e,pathPosition:f,group:g})},s.prototype.addMarks=function(a,b,c){if(this.markStart&&(A.spritenames.contains(this.markStart)||A.groupnames.contains(this.markStart)))if(A.groupnames.contains(this.markStart))for(var d=0,e=A.group[this.markStart].sprites.length;e>d;d++)this.stampMark(A.sprite[A.group[this.markStart].sprites[d]],0,a,b,c);else this.stampMark(A.sprite[this.markStart],0,a,b,c);if(this.markMid&&(A.spritenames.contains(this.markMid)||A.groupnames.contains(this.markMid))){0!==this.linkDurations.length&&this.perimeterLength||this.buildPositions();for(var f=0,g=this.linkDurations.length-1;g>f;f++)if(A.groupnames.contains(this.markMid))for(var d=0,e=A.group[this.markMid].sprites.length;e>d;d++)this.stampMark(A.sprite[A.group[this.markMid].sprites[d]],this.linkDurations[f],a,b,c);else this.stampMark(A.sprite[this.markMid],this.linkDurations[f],a,b,c)}if(this.markEnd&&(A.spritenames.contains(this.markEnd)||A.groupnames.contains(this.markEnd)))if(A.groupnames.contains(this.markEnd))for(var d=0,e=A.group[this.markEnd].sprites.length;e>d;d++)this.stampMark(A.sprite[A.group[this.markEnd].sprites[d]],1,a,b,c);else this.stampMark(A.sprite[this.markEnd],1,a,b,c);return!1},s.prototype.clip=function(a,b,c){return this.closed&&(this.prepareShape(a,b,c),a.clip()),this},s.prototype.clear=function(a,b,c){return this.prepareShape(a,b,c),a.globalCompositeOperation="destination-out",a.stroke(),a.fill(A.ctx[this.context].winding),a.globalCompositeOperation=A.ctx[b].globalCompositeOperation,this},s.prototype.clearWithBackground=function(a,b,c){return this.prepareShape(a,b,c),a.fillStyle=A.cell[b].backgroundColor,a.strokeStyle=A.cell[b].backgroundColor,a.globalAlpha=1,a.stroke(),a.fill(A.ctx[this.context].winding),a.fillStyle=A.ctx[b].fillStyle,a.strokeStyle=A.ctx[b].strokeStyle,a.globalAlpha=A.ctx[b].globalAlpha,this},s.prototype.fill=function(a,b,c){return this.closed&&(this.prepareShape(a,b,c),A.cell[b].setEngine(this),a.fill(A.ctx[this.context].winding),(this.markStart||this.markMid||this.markEnd)&&this.addMarks(a,b,c)),this},s.prototype.draw=function(a,b,c){return A.cell[b].setEngine(this),this.prepareShape(a,b,c),a.stroke(),(this.markStart||this.markMid||this.markEnd)&&this.addMarks(a,b,c),this},s.prototype.drawFill=function(a,b,c){return A.cell[b].setEngine(this),this.prepareShape(a,b,c),a.stroke(),this.closed&&(this.clearShadow(a,b),a.fill(A.ctx[this.context].winding)),this},s.prototype.fillDraw=function(a,b,c){return A.cell[b].setEngine(this),this.prepareShape(a,b,c),this.closed&&(a.fill(A.ctx[this.context].winding),this.clearShadow(a,b)),a.stroke(),(this.markStart||this.markMid||this.markEnd)&&this.addMarks(a,b,c),this},s.prototype.sinkInto=function(a,b,c){return A.cell[b].setEngine(this),this.prepareShape(a,b,c),this.closed&&a.fill(A.ctx[this.context].winding),a.stroke(),(this.markStart||this.markMid||this.markEnd)&&this.addMarks(a,b,c),this},s.prototype.floatOver=function(a,b,c){return A.cell[b].setEngine(this),this.prepareShape(a,b,c),a.stroke(),this.closed&&a.fill(A.ctx[this.context].winding),(this.markStart||this.markMid||this.markEnd)&&this.addMarks(a,b,c),this},s.prototype.none=function(a,b,c){return this.prepareShape(a,b,c),this},s.prototype.getFullPointList=function(){for(var a=[this.firstPoint],b=A.point[this.firstPoint].getData(),c=A.link[b.startLink];c.action&&["move","add"].contains(c.action)&&(c.controlPoint1&&a.push(c.controlPoint1),c.controlPoint2&&a.push(c.controlPoint2),c.endPoint);)a.push(c.endPoint),c=A.link[A.point[c.endPoint].startLink];return a},s.prototype.setRotationPointTo=function(a){a=A.xt(a)?a:{};var b=A.xt(a.x)?this.getPivotOffset(a.x,!1):this.getPivotOffset("center",!1),c=A.xt(a.y)?this.getPivotOffset(a.y,!0):this.getPivotOffset("center",!0),d=this.path,e=this.roll;this.path=!1,this.roll=0;var f=this.getFullPointList(),g=this.startX,h=this.startY;this.startX+=b,this.startY+=c;for(var i=0,j=f.length;j>i;i++)f[i]&&A.point[f[i]].setPolar();return this.forceStamp("none"),this.startX=g,this.startY=h,this.path=d,this.roll=e,this},s.prototype.checkHit=function(a,b){a=A.isa(a,"obj")?a:{};var c=A.pad[a.pad]||A.pad[b.pad],d=A.cell[c.current].name,e=A.context[c.current],f=A.xt(a.tests)?a.tests:[{x:a.x||!1,y:a.y||!1}];this.flipCanvas(e,d),this.closed,this.prepareShape(e,b);for(var g=!1,h=0,i=f.length;i>h&&!(g=e.isPointInPath(f[h].x,f[h].y));h++);return this.closed,this.flipCanvas(e,d),g?f[h]:!1},s.prototype.getCollisionPoints=function(a){if(A.isa(this.collisionPoints,"num")){var b,c,d=0,e=1/this.collisionPoints,f=[],g=A.cell[A.group[this.group].cells[0]];c=this.currentRoll*A.radian;for(var h=0;h<this.collisionPoints;h++)b=this.getPerimeterPosition(d,!0,c),b.x=this.flipReverse?g.actualWidth-b.x:b.x,b.y=this.flipUpend?g.actualHeight-b.y:b.y,f.push(b),d+=e;return f}var i=this.prepareStamp(a);return[{x:i.x,y:i.y}]},s.prototype.getPerimeterLength=function(a){return(a||!this.perimeterLength||0===this.linkDurations.length)&&this.buildPositions(),this.perimeterLength},s.prototype.buildPositions=function(){for(var a=0,b=this.linkList.length;b>a;a++)A.link[this.linkList[a]].setPositions();this.linkDurations=[];for(var c,d,e=0,a=0,b=this.linkList.length;b>a;a++)d=A.link[this.linkList[a]],c=d.positions[d.precision].cumulativeLength,e+=c,this.linkDurations.push(e);this.perimeterLength=e;for(var a=0,b=this.linkList.length;b>a;a++)this.linkDurations[a]=this.linkDurations[a]/this.perimeterLength;return this},s.prototype.getPerimeterPosition=function(a,b,c){this.getPerimeterLength(),a=A.isa(a,"num")?a:1;for(var d,e,f=0,g=this.linkList.length;g>f;f++)if(d=A.link[this.linkList[f]],this.linkDurations[f]>=a){if(e=0===f?a/this.linkDurations[f]:(a-this.linkDurations[f-1])/(this.linkDurations[f]-this.linkDurations[f-1]),e=0>e?0:e>1?1:e,b){if(c){var h=d.getSteadyPositionOnLink(0>e-1e-7?0:e-1e-7),i=d.getSteadyPositionOnLink(e+1e-7>1?1:e+1e-7),j=d.getSteadyPositionOnLink(e),k=Math.atan2(i.y-h.y,i.x-h.x)/A.radian;return{x:j.x,y:j.y,r:k}}return d.getSteadyPositionOnLink(e)}if(c){var h=d.getPositionOnLink(0>e-1e-7?0:e-1e-7),i=d.getPositionOnLink(e+1e-7>1?1:e+1e-7),j=d.getPositionOnLink(e),k=Math.atan2(i.y-h.y,i.x-h.x)/A.radian;return{x:j.x,y:j.y,r:k}}return d.getPositionOnLink(e)}return!1},s.prototype.clone=function(a){a=A.isa(a,"obj")?a:{};var b=JSON.parse(JSON.stringify(this));b.name=a.name||this.name,b.data=a.data||this.data,b.startX=a.startX||this.startX,b.startY=a.startY||this.startY,b.handleX=a.handleX||this.handleX,b.handleY=a.handleY||this.handleY;var c=A.makePath(b);if(!A.xt(a.createNewContext)||a.createNewContext){var d=JSON.parse(JSON.stringify(A.ctx[this.context]));delete d.name,c.set(d)}return delete a.name,delete a.data,delete a.startX,delete a.startY,delete a.handleX,delete a.handleY,c.set(a),c},t.prototype=Object.create(a.prototype),t.prototype.type="Point",t.prototype.classname="pointnames",t.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,sprite:this.sprite,distance:this.distance?this.distance:a,angle:this.angle?this.angle:a,startLink:this.startLink?this.startLink:a,currentX:0!==this.currentX?this.currentX:a,currentY:0!==this.currentY?this.currentY:a,visibility:this.visibility?a:this.visibility,fixed:this.fixed?this.fixed:a}},t.prototype.setToDefaults=function(){return this.set({comment:"",title:"",sprite:!1,distance:!1,angle:!1,startLink:!1,currentX:0,currentY:0,visibility:!1,fixed:!1}),this},t.prototype.getData=function(a){return A.isa(this.distance,"num")||A.isa(this.angle,"num")||this.setPolar(),this.recalculate(a),{name:this.name,currentX:this.currentX,currentY:this.currentY,startLink:this.startLink}},t.prototype.set=function(b){this.sprite;if(a.prototype.set.call(this,b),b=A.isa(b,"obj")?b:{},A.xto([b.currentX,b.currentY])&&this.setPolar(),A.isa(b.sprite,"str")){try{A.sprite[this.sprite].pointList.removeItem(this.name)}catch(c){}try{A.sprite[b.sprite].pointList.pushUnique(this.name)}catch(c){}this.sprite=b.sprite}return this},t.prototype.setDelta=function(a){a=A.isa(a,"obj")?a:{},a.distance&&(this.distance+=a.distance),a.angle&&(this.angle+=a.angle);var b=a.override?a.override:{x:0,y:0};return this.recalculate(b),this},t.prototype.recalculate=function(a){var a=a?a:{x:0,y:0};if(A.isa(this.fixed,"str")&&(A.spritenames.contains(this.fixed)||A.pointnames.contains(this.fixed))){var b=A.sprite[this.fixed]||A.point[this.fixed];"Point"===b.type?(this.currentX=b.currentX+a.x,this.currentY=b.currentY+a.y):(this.currentX=b.startX,this.currentY=b.startY)}else if(!this.fixed){var c,d,e,f;c=A.sprite[this.sprite],f=c.prepareStamp(a),"Shape"===c.type?(d=c.addPathRoll?(this.angle+c.currentRoll+c.pathRoll)*A.radian:(this.angle+c.currentRoll)*A.radian,e=this.distance*c.scale):(d=this.angle*A.radian,e=this.distance),this.currentX=f.x+e*Math.cos(d),this.currentY=f.y+e*Math.sin(d)}return this},t.prototype.setPolar=function(){var a=A.sprite[this.sprite],b=this.currentX-a.startX,c=this.currentY-a.startY;return this.angle=Math.atan2(c,b)/A.radian,this.distance=Math.sqrt(b*b+c*c),this},u.prototype=Object.create(a.prototype),u.prototype.type="Link",u.prototype.classname="linknames",u.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,species:this.species?this.species:a,startPoint:this.startPoint?this.startPoint:a,sprite:this.sprite?this.sprite:a,endPoint:this.endPoint?this.endPoint:a,controlPoint1:this.controlPoint1?this.controlPoint1:a,controlPoint2:this.controlPoint2?this.controlPoint2:a,action:"add"!==this.action?this.action:a,precision:100!==this.precision?this.precision:a,positions:this.positions?!0:a}},u.prototype.setToDefaults=function(){return this.set({comment:"",title:"",species:!1,startPoint:!1,sprite:!1,endPoint:!1,controlPoint1:!1,controlPoint2:!1,action:!1,precision:100,positions:!1}),this},u.prototype.set=function(b){var c=this.sprite;return a.prototype.set.call(this,b),b=A.isa(b,"obj")?b:{},A.isa(b.sprite,"str")&&b.sprite!==c&&c&&A.sprite[c].linkList.removeItem(this.name),A.isa(b.action,"str")&&this.sprite&&A.spritenames.contains(this.sprite)&&("add"===b.action?A.sprite[this.sprite].linkList.pushUnique(this.name):A.sprite[this.sprite].linkList.removeItem(this.name)),this},u.prototype.pointOnLine=function(a,b,c){return{x:a.x+(b.x-a.x)*c,y:a.y+(b.y-a.y)*c}},u.prototype.getPointCoordinates=function(){A.point[this.startPoint].currentX||A.sprite[this.sprite].forceStamp("empty");var a={x:A.point[this.startPoint].currentX,y:A.point[this.startPoint].currentY},b={x:A.point[this.endPoint].currentX,y:A.point[this.endPoint].currentY},c=["quadratic","bezier"].contains(this.species)?{x:A.point[this.controlPoint1].currentX,y:A.point[this.controlPoint1].currentY}:!1,d="bezier"===this.species?{x:A.point[this.controlPoint2].currentX,y:A.point[this.controlPoint2].currentY}:!1;return{start:a,end:b,control1:c,control2:d}},u.prototype.getPositionOnLink=function(a){a=A.isa(a,"num")?a:1;var b=this.getPointCoordinates();switch(this.species){case"line":return this.pointOnLine(b.start,b.end,a);case"quadratic":var c=this.pointOnLine(b.start,b.control1,a),d=this.pointOnLine(b.control1,b.end,a);return this.pointOnLine(c,d,a);case"bezier":var e=this.pointOnLine(b.start,b.control1,a),f=this.pointOnLine(b.control1,b.control2,a),g=this.pointOnLine(b.control2,b.end,a),h=this.pointOnLine(e,f,a),i=this.pointOnLine(f,g,a);return this.pointOnLine(h,i,a)}return!1},u.prototype.getSteadyPositionOnLink=function(a){a=A.isa(a,"num")?a:1,0===this.positions.length&&this.setPositions();var b=this.length*a;b=b>this.positions[this.precision].cumulativeLength?this.positions[this.precision].cumulativeLength:0>b?0:b;for(var c,d,e,f,g,h,i=1;i<=this.precision;i++)if(b<=this.positions[i].cumulativeLength)return c=this.positions[i-1].x,d=this.positions[i-1].y,e=this.positions[i].x-c,f=this.positions[i].y-d,g=(b-this.positions[i-1].cumulativeLength)/this.positions[i].length,h={x:c+e*g,y:d+f*g};return!1},u.prototype.getLength=function(){this.getPointCoordinates();return this.setPositions(this.precision),this.length},u.prototype.setPositions=function(a){var b=this.getPointCoordinates();this.precision=A.isa(a,"num")&&a>0?a:this.precision||100,this.positions=[];var c,d,e,f,g,h=1/this.precision,i=0,j=b.start.x,k=b.start.y;this.positions.push({x:j,y:k,length:0,cumulativeLength:i});for(var l=0;l<this.precision;l++)c=h*(l+1),d=this.getPositionOnLink(c),f=d.x-j,g=d.y-k,j=d.x,k=d.y,e=Math.sqrt(f*f+g*g),i+=e,this.positions.push({x:j,y:k,length:e,cumulativeLength:i});return this.length=this.positions[this.precision].cumulativeLength,this},u.prototype.sketch=function(a,b){var c,d,e,f;switch(this.action){case"close":a.closePath();break;case"move":try{c=A.point[this.endPoint].getData(b),a.moveTo(c.currentX,c.currentY)}catch(g){return!0}break;case"add":try{switch(this.species){case"line":c=A.point[this.endPoint].getData(b),a.lineTo(c.currentX,c.currentY);break;case"quadratic":d=A.point[this.controlPoint1].getData(b),c=A.point[this.endPoint].getData(b),a.quadraticCurveTo(d.currentX,d.currentY,c.currentX,c.currentY);break;case"bezier":d=A.point[this.controlPoint1].getData(b),e=A.point[this.controlPoint2].getData(b),c=A.point[this.endPoint].getData(b),a.bezierCurveTo(d.currentX,d.currentY,e.currentX,e.currentY,c.currentX,c.currentY);break;default:return!0}}catch(g){return!0}break;default:return!0}try{f=A.link[A.point[this.endPoint].startLink].sketch(a,b)}catch(g){return!0}return!0},v.prototype=Object.create(a.prototype),v.prototype.type="Design",v.prototype.classname="designnames",v.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,color:this.color?this.color:a,setToSprite:this.setToSprite?this.setToSprite:a,roll:0!==this.roll?this.roll:a,cell:this.cell?this.cell:a,startX:0!==this.startX?this.startX:a,startY:0!==this.startY?this.startY:a,endX:0!==this.endX?this.endX:a,endY:0!==this.endY?this.endY:a,handleX:0!==this.handleX?this.handleX:a,handleY:0!==this.handleY?this.handleY:a,startHandleX:0!==this.startHandleX?this.startHandleX:a,startHandleY:0!==this.startHandleY?this.startHandleY:a,endHandleX:0!==this.endHandleX?this.endHandleX:a,endHandleY:0!==this.endHandleY?this.endHandleY:a,startRangeX:0!==this.startRangeX?this.startRangeX:a,startRangeY:0!==this.startRangeY?this.startRangeY:a,endRangeX:1!==this.endRangeX?this.endRangeX:a,endRangeY:1!==this.endRangeY?this.endRangeY:a,autoUpdate:this.autoUpdate?this.autoUpdate:a,startRadius:A.xt(this.startRadius)&&0!==this.startRadius?this.startRadius:a,endRadius:A.xt(this.endRadius)&&0!==this.endRadius?this.endRadius:a,startRangeRadius:A.xt(this.startRangeRadius)&&.5!==this.startRangeRadius?this.startRangeRadius:a,endRangeRadius:A.xt(this.endRangeRadius)&&0!==this.endRangeRadius?this.endRangeRadius:a}
},v.prototype.setToDefaults=function(){var a;return this.set({comment:"",title:"",setToSprite:!1,roll:0,startX:0,startY:0,endX:0,endY:0,handleX:0,handleY:0,startHandleX:0,startHandleY:0,endHandleX:0,endHandleY:0,startRangeX:0,startRangeY:0,endRangeX:1,endRangeY:1,autoUpdate:!1,startRadius:A.xt(this.startRadius)?0:a,endRadius:A.xt(this.endRadius)?0:a,startRangeRadius:A.xt(this.startRangeRadius)?.5:a,endRangeRadius:A.xt(this.endRangeRadius)?0:a}),this},v.prototype.setDelta=function(a){return a=A.isa(a,"obj")?a:{},a.roll&&(this.roll+=a.roll),a.startX&&(this.startX+=a.startX),a.startY&&(this.startY+=a.startY),a.startRadius&&(this.startRadius+=a.startRadius),a.endX&&(this.endX+=a.endX),a.endY&&(this.endY+=a.endY),a.endRadius&&(this.endRadius+=a.endRadius),a.startRangeRadius&&(this.startRangeRadius+=a.startRangeRadius),a.endRangeRadius&&(this.endRangeRadius+=a.endRangeRadius),a.handleX&&(this.handleX+=a.handleX),a.handleY&&(this.handleY+=a.handleY),a.startHandleX&&(this.startHandleX+=a.startHandleX),a.startHandleY&&(this.startHandleY+=a.startHandleY),a.endHandleX&&(this.endHandleX+=a.endHandleX),a.endHandleY&&(this.endHandleY+=a.endHandleY),a.startRangeX&&(this.startRangeX+=a.startRangeX),a.startRangeY&&(this.startRangeY+=a.startRangeY),a.endRangeX&&(this.endRangeX+=a.endRangeX),a.endRangeY&&(this.endRangeY+=a.endRangeY),this.update(),this},v.prototype.set=function(b){return a.prototype.set.call(this,b),this.update(),this},v.prototype.update=function(){return this.makeGradient(),this.sortStops(),this.applyStops(),this},v.prototype.makeGradient=function(){var a,b=A.context[this.cell];switch(this.type){case"Gradient":a=b.createLinearGradient(this.startX+this.startHandleX+this.handleX,this.startY+this.startHandleY+this.handleY,this.endX+this.endHandleX+this.handleX,this.endY+this.endHandleY+this.handleY);break;case"RadialGradient":a=b.createRadialGradient(this.startX+this.startHandleX+this.handleX,this.startY+this.startHandleY+this.handleY,this.startRadius,this.endX+this.endHandleX+this.handleX,this.endY+this.endHandleY+this.handleY,this.endRadius);break;default:a=!1}return A.dsn[this.name]=a,this},v.prototype.sortStops=function(){for(var a=0,b=this.color.length;b>a;a++)this.color[a].stop+=this.roll,this.color[a].stop.isBetween(0,1,!0)||(this.color[a].stop=this.color[a].stop>.5?this.color[a].stop-1:this.color[a].stop+1),this.color[a].stop<=0?this.color[a].stop=1e-6:this.color[a].stop>=1&&(this.color[a].stop=.999999);this.color.sort(function(a,b){return a.stop-b.stop})},v.prototype.applyStops=function(){if(A.dsn[this.name])for(var a=0,b=this.color.length;b>a;a++)A.dsn[this.name].addColorStop(this.color[a].stop,this.color[a].color);return this},v.prototype.remove=function(){return delete A.dsn[this.name],delete A.design[this.name],A.designnames.removeItem(this.name),!0},w.prototype=Object.create(v.prototype),w.prototype.type="Gradient",w.prototype.classname="designnames",w.prototype.swap=function(){var a=this.startX;this.startX=this.endX,this.endX=a;var b=this.startY;return this.startY=this.endY,this.endY=b,this.update(),this},x.prototype=Object.create(v.prototype),x.prototype.type="RadialGradient",x.prototype.classname="designnames",x.prototype.swap=function(){var a=this.startX;this.startX=this.endX,this.endX=a;var b=this.startY;this.startY=this.endY,this.endY=b;this.startRadius;return this.startRadius=this.endRadius,this.endRadius=b,this.update(),this},y.prototype=Object.create(a.prototype),y.prototype.type="Pattern",y.prototype.classname="designnames",y.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,repeat:"repeat"!==this.repeat?this.repeat:a,image:this.image?this.image:a,source:this.source?this.source:a}},y.prototype.setToDefaults=function(){return this.set({comment:"",title:"",repeat:"repeat"}),this},y.prototype.setImage=function(a,b,c){if(A.isa(a,"str")){var d=new Image,e=this;d.id=b,d.onload=function(c){try{var f=A.newImage({name:b,element:d});A.design[b]=e,A.design[b].image=f.name,A.design[b].source=a,A.designnames.pushUnique(b),A.design[b].makeDesign(),A.isa(c,"fn")&&c()}catch(g){return console.log("Pattern "+[this.name]+" - setImage() failed - "+g.name+" error: "+g.message),this}},d.src=a}else A.isa(a,"obj")?(this.image=a.name,this.source=a.source,A.design[this.name]=this,A.designnames.pushUnique(this.name),this.makeDesign(),A.isa(c,"fn")&&c()):console.log("Pattern "+[this.name]+" - setImage() failed - source not a string or an object");return this},y.prototype.set=function(b){return a.prototype.set.call(this,b),this.setImage(),this},y.prototype.get=function(){return A.xt(A.dsn[this.name])?A.dsn[this.name]:"rgba(0,0,0,0)"},y.prototype.makeDesign=function(a){var b=A.xt(a)?A.context[a]:A.context[A.pad[A.currentPad].current];try{return this.image?A.img[this.image]?(A.dsn[this.name]=b.createPattern(A.img[this.image],this.repeat),this):this:this}catch(c){return this}},y.prototype.clone=function(a){var b=A.newPattern(a);return b},y.prototype.remove=function(){return delete A.dsn[this.name],delete A.design[this.name],A.designnames.removeItem(this.name),!0},z.prototype=Object.create(a.prototype),z.prototype.type="Color",z.prototype.classname="designnames",z.prototype.prepareForExport=function(){var a;return{name:this.name,comment:""!==this.comment?this.comment:a,title:""!==this.title?this.title:a,timestamp:this.timestamp,type:this.type,r:0!==this.r?this.r:a,g:0!==this.g?this.g:a,b:0!==this.b?this.b:a,a:1!==this.a?this.a:a,rShift:0!==this.rShift?this.rShift:a,gShift:0!==this.gShift?this.gShift:a,bShift:0!==this.bShift?this.bShift:a,aShift:0!==this.aShift?this.aShift:a,rMax:255!==this.rMax?this.rMax:a,gMax:255!==this.gMax?this.gMax:a,bMax:255!==this.bMax?this.bMax:a,aMax:1!==this.aMax?this.aMax:a,rMin:0!==this.rMin?this.rMin:a,gMin:0!==this.gMin?this.gMin:a,bMin:0!==this.bMin?this.bMin:a,aMin:0!==this.aMin?this.aMin:a,rBounce:this.rBounce?this.rBounce:a,gBounce:this.gBounce?this.gBounce:a,bBounce:this.bBounce?this.bBounce:a,aBounce:this.aBounce?this.aBounce:a,autoUpdate:this.autoUpdate?this.autoUpdate:a}},z.prototype.setToDefaults=function(){return this.set({comment:"",title:"",r:0,g:0,b:0,a:1,rShift:0,gShift:0,bShift:0,aShift:0,rMax:255,gMax:255,bMax:255,aMax:1,rMin:0,gMin:0,bMin:0,aMin:0,rBounce:!1,gBounce:!1,bBounce:!1,aBounce:!1,autoUpdate:!1}),this},z.prototype.get=function(){return this.checkValues(),"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},z.prototype.generateRandomColor=function(a){return a=A.isa(a,"obj")?a:{},this.r=a.r||parseInt((Math.random()*(this.rMax-this.rMin)+this.rMin).toFixed()),this.g=a.g||parseInt((Math.random()*(this.gMax-this.gMin)+this.gMin).toFixed()),this.b=a.b||parseInt((Math.random()*(this.bMax-this.bMin)+this.bMin).toFixed()),this.a=a.a||parseFloat((Math.random()*(this.aMax-this.aMin)+this.aMin).toFixed(6)),this.checkValues(),this},z.prototype.checkValues=function(){return this.r=this.r>255?255:this.r<0?0:this.r,this.g=this.g>255?255:this.g<0?0:this.g,this.b=this.b>255?255:this.b<0?0:this.b,this.a=this.a>1?1:this.a<0?0:this.a,this},z.prototype.set=function(b){return a.prototype.set.call(this,b),b=A.isa(b,"obj")?b:{},b.random&&this.generateRandomColor(b),this.checkValues(),this},z.prototype.update=function(){for(var a=["r","g","b","a"],b=0,c=a.length;c>b;b++)(this[a[b]]+this[a[b]+"Shift"]).isBetween(this[a[b]+"Max"],this[a[b]+"Min"],!0)||(this[a[b]+"Bounce"]?this[a[b]+"Shift"]=-this[a[b]+"Shift"]:(this[a[b]]=this[a[b]]>(this[a[b]+"Max"]+this[a[b]+"Min"])/2?this[a[b]+"Max"]:this[a[b]+"Min"],this[a[b]+"Shift"]=0)),this[a[b]]+=this[a[b]+"Shift"];return this},z.prototype.setDelta=function(a){return a=A.isa(a,"obj")?a:{},this.r+=a.r||0,this.g+=a.g||0,this.b+=a.b||0,this.a+=a.a||0,this.checkValues(),this},z.prototype.convert=function(a){if(a=A.isa(a,"str")?a:"",a.length>0){a.toLowerCase();var b;if("#"===a[0])a.length<5?(this.r=this.toDecimal(a[1]+a[1]),this.g=this.toDecimal(a[2]+a[2]),this.b=this.toDecimal(a[3]+a[3])):a.length<8&&(this.r=this.toDecimal(a[1]+a[2]),this.g=this.toDecimal(a[3]+a[4]),this.b=this.toDecimal(a[5]+a[6]));else if(/rgb\(/.test(a))b=a.match(/([0-9.]+\b)/g),/%/.test(a)?(this.r=parseInt(b[0]/100*255,10),this.g=parseInt(b[1]/100*255,10),this.b=parseInt(b[2]/100*255,10)):(this.r=parseInt(b[0],10),this.g=parseInt(b[1],10),this.b=parseInt(b[2],10));else if(/rgba\(/.test(a))b=a.match(/([0-9.]+\b)/g),this.r=b[0],this.g=b[1],this.b=b[2],this.a=b[3];else switch(a){case"green":this.r=0,this.g=128,this.b=0;break;case"silver":this.r=192,this.g=192,this.b=192;break;case"lime":this.r=0,this.g=255,this.b=0;break;case"gray":this.r=128,this.g=128,this.b=128;break;case"grey":this.r=128,this.g=128,this.b=128;break;case"olive":this.r=128,this.g=128,this.b=0;break;case"white":this.r=255,this.g=255,this.b=255;break;case"yellow":this.r=255,this.g=255,this.b=0;break;case"maroon":this.r=128,this.g=0,this.b=0;break;case"navy":this.r=0,this.g=0,this.b=128;break;case"red":this.r=255,this.g=0,this.b=0;break;case"blue":this.r=0,this.g=0,this.b=255;break;case"purple":this.r=128,this.g=0,this.b=128;break;case"teal":this.r=0,this.g=128,this.b=128;break;case"fuchsia":this.r=255,this.g=0,this.b=255;break;case"aqua":this.r=0,this.g=255,this.b=255;break;default:this.r=0,this.g=0,this.b=0}}return this.checkValues(),this},z.prototype.toDecimal=function(a){return parseInt(a,16)},z.prototype.toHex=function(a){return a.toString(16)},z.prototype.remove=function(){return delete A.dsn[this.name],delete A.design[this.name],A.designnames.removeItem(this.name),!0},A.initialize(),A}();