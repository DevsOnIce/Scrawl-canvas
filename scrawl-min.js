Array.prototype.contains=Array.prototype.contains||function(e){if(e instanceof RegExp){for(var t in this){if(this[t].match(e))return this[t]}return false}else{for(var t in this){if(this[t]===e)return true}return false}};Array.prototype.pushUnique=Array.prototype.pushUnique||function(e){if(!this.contains(e)){this.push(e);return true}return false};Array.prototype.removeItem=Array.prototype.removeItem||function(e){if(this.contains(e)){var t=this.indexOf(e);this.splice(t,1);return true}return false};Number.prototype.isBetween=Number.prototype.isBetween||function(e,t,n){if(e>t){var r=e;e=t;t=r}if(n){if(this>=e&&this<=t){return true}return false}else{if(this>e&&this<t||this===e&&this===t){return true}return false}};window.requestAnimFrame=function(e){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();window.scrawl=function(){function t(t){t=e.isa(t,"obj")?t:{};var n=t.name||"";t.name=e.makeName({name:n,type:this.type,target:this.classname});this.name=t.name;this.comment=t.comment||"";this.title=t.title||"";this.timestamp=Date.now();return this}function n(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.startX=n.startX||0;this.startY=n.startY||0;this.handleX=n.handleX||0;this.handleY=n.handleY||0;this.moveStartX=n.moveStartX||0;this.moveStartY=n.moveStartY||0;this.moveHandleX=n.moveHandleX||0;this.moveHandleY=n.moveHandleY||0;this.pivot=n.pivot||false;this.path=n.path||false;this.pathPosition=n.pathPosition||0;this.movePathPosition=n.movePathPosition||0;this.pathSpeedConstant=e.isa(n.pathSpeedConstant,"bool")?n.pathSpeedConstant:true;this.pathRoll=0;this.addPathRoll=e.isa(n.addPathRoll,"bool")?n.addPathRoll:false;this.scale=e.isa(n.scale,"num")?n.scale:1;return this}function r(t){n.call(this,t);t=e.isa(t,"obj")?t:{};this.isIE=navigator.appName=="Microsoft Internet Explorer"?true:false;return this}function i(t){t=e.isa(t,"obj")?t:{};if(e.xt(t.stackElement)){var n="";if(e.xto([t.stackElement.id,t.stackElement.name])){n=t.stackElement.id||t.stackElement.name}r.call(this,{name:n});e.stack[this.name]=this;e.stk[this.name]=t.stackElement;e.stacknames.pushUnique(this.name);e.stk[this.name].style.position="relative";e.stk[this.name].id=this.name;this.initialize2d(t);this.initialize3d(t);return this}console.log("Failed to generate a Stack wrapper - no DOM element supplied");return false}function s(t){t=e.isa(t,"obj")?t:{};if(e.xt(t.domElement)){var n="";if(e.xto([t.domElement.id,t.domElement.name])){n=t.domElement.id||t.domElement.name}r.call(this,{name:n});e.element[this.name]=this;e.elm[this.name]=t.domElement;e.elementnames.pushUnique(this.name);e.elm[this.name].style.position="absolute";e.elm[this.name].id=this.name;this.initialize2d(t);this.initialize3d(t);return this}console.log("Failed to generate an Element wrapper - no DOM element supplied");return false}function o(t){t=e.isa(t,"obj")?t:{};if(e.xt(t.canvasElement)){e.canvas["PadConstructorTemporaryCanvas"]=t.canvasElement;this.display="PadConstructorTemporaryCanvas";var n="";if(e.xto([t.canvasElement.id,t.canvasElement.name])){n=t.canvasElement.id||t.canvasElement.name}n.match(/_display$/)?r.call(this,{name:n.substr(0,n.length-8)}):r.call(this,{name:n});if(!t.canvasElement.id){t.canvasElement.id=n}if(!e.cellnames.contains(this.name)){this.cells=[];this.drawOrder=[];e.pad[this.name]=this;e.padnames.pushUnique(this.name);if(t.length>1){this.set(t)}var i=new u({name:n,pad:this.name,canvas:t.canvasElement});this.cells.pushUnique(i.name);this.display=i.name;delete e.canvas.PadConstructorTemporaryCanvas;var s=t.canvasElement.cloneNode(true);s.setAttribute("id",this.name+"_base");var o=new u({name:this.name+"_base",pad:this.name,canvas:s});this.cells.pushUnique(o.name);this.base=o.name;this.current=o.name;this.initialize2d();return this}}console.log("Failed to generate a Pad controller - no canvas element supplied");return false}function u(t){if(e.xta([t,t.canvas])){n.call(this,t);this.pad=t.pad||false;this.sourceX=t.sourceX||0;this.sourceY=t.sourceY||0;this.sourceWidth=t.sourceWidth||t.width||0;this.sourceHeight=t.sourceHeight||t.height||0;this.targetX=t.targetX||0;this.targetY=t.targetY||0;this.targetWidth=t.targetWidth||t.width||0;this.targetHeight=t.targetHeight||t.height||0;this.actualX=t.actualX||0;this.actualY=t.actualY||0;this.actualWidth=t.actualWidth||t.width||0;this.actualHeight=t.actualHeight||t.height||0;this.scaleX=e.isa(t.scaleX,"num")?t.scaleX:1;this.scaleY=e.isa(t.scaleY,"num")?t.scaleY:1;this.roll=t.roll||0;this.cellX=t.cellX||0;this.cellY=t.cellY||0;this.shearX=t.shearX||0;this.shearY=t.shearY||0;this.backgroundColor=e.isa(t.backgroundColor,"str")?t.backgroundColor:"rgba(0,0,0,0)";e.canvas[this.name]=t.canvas;e.context[this.name]=t.canvas.getContext("2d");e.cell[this.name]=this;e.cellnames.pushUnique(this.name);var r=new a({name:this.name});this.context=r.name;e.ctx[this.context].getContextFromEngine(e.context[this.name]);this.groups=e.xt(t.groups)?[].concat(t.groups):[];new c({name:this.name,cells:[this.name]});new c({name:this.name+"_field",cells:[this.name],visibility:false});if(t.field){e.group[this.name+"_field"].sprites=[].concat(t.field)}new c({name:this.name+"_fence",cells:[this.name],visibility:false});if(t.fence){e.group[this.name+"_fence"].sprites=[].concat(t.fence)}this.usePadDimensions=e.isa(t.usePadDimensions,"bool")?t.usePadDimensions:this.sourceWidth===0&&this.sourceHeight===0&&this.targetWidth===0&&this.targetHeight===0&&this.actualWidth===0&&this.actualHeight===0?true:false;this.setDimensions(t);if(this.scaleX!==1||this.scaleY!==1||this.shearX||this.shearY||this.cellX||this.cellY||this.roll){this.transformCell()}return this}console.log("Cell constructor encountered an error: no canvas element supplied to it");return false}function a(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.fillStyle=e.isa(n.fillStyle,"str")?n.fillStyle:"#000000";this.winding=e.isa(n.winding,"str")?n.winding:"nonzero";this.strokeStyle=e.isa(n.strokeStyle,"str")?n.strokeStyle:"#000000";this.globalAlpha=e.isa(n.globalAlpha,"num")?n.globalAlpha:1;this.globalCompositeOperation=e.isa(n.globalCompositeOperation,"str")?n.globalCompositeOperation:"source-over";this.lineWidth=e.isa(n.lineWidth,"num")?n.lineWidth:1;this.lineCap=e.isa(n.lineCap,"str")?n.lineCap:"butt";this.lineJoin=e.isa(n.lineJoin,"str")?n.lineJoin:"miter";this.lineDash=e.isa(n.lineDash,"arr")?n.lineDash:[];this.lineDashOffset=e.isa(n.lineDashOffset,"num")?n.lineDashOffset:0;this.miterLimit=e.isa(n.miterLimit,"num")?n.miterLimit:10;this.shadowOffsetX=n.shadowOffsetX||0;this.shadowOffsetY=n.shadowOffsetY||0;this.shadowBlur=n.shadowBlur||0;this.shadowColor=e.isa(n.shadowColor,"str")?n.shadowColor:"rgba(0,0,0,0)";this.font=e.isa(n.font,"str")?n.font:"10pt sans-serif";this.textAlign=e.isa(n.textAlign,"str")?n.textAlign:"start";this.textBaseline=e.isa(n.textBaseline,"str")?n.textBaseline:"alphabetic";e.ctx[this.name]=this;e.ctxnames.pushUnique(this.name);return this}function f(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.width=n.width||0;this.height=n.height||0;if(e.xt(n.imageData)){var r=document.createElement("img");r.id=this.name;r.width=this.width;r.height=this.height;r.src=n.imageData;n["element"]=r}this.source=n.source||false;if(e.xt(n.element)){var i=n.element.getAttribute("id")||n.element.getAttribute("name")||n.element.getAttribute("src");this.name=e.makeName({name:i,type:this.type,target:"imagenames"});this.width=parseFloat(n.element.offsetWidth)||n.element.width||n.element.style.width||0;this.height=parseFloat(n.element.offsetHeight)||n.element.height||n.element.style.height||0;this.source=n.element.src}this.copyX=n.copyX||0;this.copyY=n.copyY||0;this.copyWidth=n.copyWidth||this.width||0;this.copyHeight=n.copyHeight||this.height||0;e.img[this.name]=n.element;e.image[this.name]=this;e.imagenames.pushUnique(this.name);return this}function l(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.sheet=n.sheet||n.source||false;this.frames=e.xt(n.frames)?[].concat(n.frames):[];this.currentFrame=n.currentFrame||0;this.speed=e.isa(n.speed,"num")?n.speed:1;this.loop=e.isa(n.loop,"str")?n.loop:"end";this.running=e.isa(n.running,"str")?n.running:"complete";this.lastCalled=e.xt(n.lastCalled)?n.lastCalled:Date.now();e.anim[this.name]=this;e.animnames.pushUnique(this.name);return this}function c(t){n.call(this,t);t=e.isa(t,"obj")?t:{};this.sprites=e.xt(t.sprites)?[].concat(t.sprites):[];this.cells=e.xt(t.cells)?[].concat(t.cells):[];this.order=t.order||0;this.visibility=e.isa(t.visibility,"bool")?t.visibility:true;this.method=t.method||false;this.fieldTest=t.fieldTest||0;this.fieldChannel=t.fieldChannel||"anycolor";this.roll=t.roll||0;this.groups=e.xt(t.groups)?[].concat(t.groups):[];e.group[this.name]=this;e.groupnames.pushUnique(this.name);if(this.cells.length===0){this.cells.push(e.pad[e.currentPad].base)}for(var r=0,i=this.cells.length;r<i;r++){e.cell[this.cells[r]].groups.pushUnique(this.name)}return this}function h(t){n.call(this,t);t=e.isa(t,"obj")?t:{};this.order=t.order||0;this.visibility=e.isa(t.visibility,"bool")?t.visibility:true;this.method=e.isa(t.method,"str")?t.method:this.type==="Shape"?"draw":"fill";this.collisionPoints=this.parseCollisionPoints(t.collisionPoints||[]);this.rollable=e.isa(t.rollable,"bool")?t.rollable:true;this.roll=t.roll||0;this.data=t.data||false;this.flipReverse=e.isa(t.flipReverse,"bool")?t.flipReverse:false;this.flipUpend=e.isa(t.flipUpend,"bool")?t.flipUpend:false;this.scaleOutline=e.isa(t.scaleOutline,"bool")?t.scaleOutline:true;var r=new a(t);this.context=r.name;this.group=this.getGroup(t);if(t.field){this.addSpriteToCellFields(t.target||t.group)}if(t.fence){this.addSpriteToCellFences(t.target||t.group)}this.fieldChannel=e.isa(t.fieldChannel,"str")?t.fieldChannel:"anycolor";this.fieldTest=t.fieldTest||0;if(e.xt(t.target)){this.targetGroup(t)}return this}function p(t){h.call(this,t);t=e.isa(t,"obj")?t:{};this.text=t.text||"";this.style=t.style||"normal";this.variant=t.variant||"normal";this.weight=t.weight||"normal";this.size=t.size||12;this.metrics=t.metrics||"pt";this.family=t.family||"sans-serif";this.lineHeight=e.isa(t.lineHeight,"num")?t.lineHeight:1.5;this.backgroundColor=t.backgroundColor||false;this.backgroundMargin=t.backgroundMargin||0;this.textAlongPath=t.textAlongPath||"phrase";this.fixedWidth=e.isa(t.fixedWidth,"bool")?t.fixedWidth:false;this.checkFont(t.font);e.sprite[this.name]=this;e.spritenames.pushUnique(this.name);e.group[this.group].addSpritesToGroup(this.name);this.texts=[];this.multiline(t);return this}function d(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.text=n.text||"";this.phrase=n.phrase||false,this.context=e.sprite[this.phrase].context;this.fixedWidth=e.isa(n.fixedWidth,"bool")?n.fixedWidth:false;this.textAlongPath=n.textAlongPath||"phrase";e.text[this.name]=this;e.textnames.pushUnique(this.name);e.sprite[this.phrase].texts.pushUnique(this.name);this.getMetrics();return this}function v(t){h.call(this,t);t=e.isa(t,"obj")?t:{};this.width=t.width||0;this.height=t.height||0;e.sprite[this.name]=this;e.spritenames.pushUnique(this.name);e.group[this.group].addSpritesToGroup(this.name);return this}function m(t){h.call(this,t);t=e.isa(t,"obj")?t:{};this.radius=t.radius||0;this.startAngle=t.startAngle||0;this.endAngle=e.isa(t.endAngle,"num")?t.endAngle:360;this.clockwise=e.isa(t.clockwise,"bool")?t.clockwise:false;this.closed=e.isa(t.closed,"bool")?t.closed:true;this.includeCenter=e.isa(t.includeCenter,"bool")?t.includeCenter:false;this.checkHitUsingRadius=e.isa(t.checkHitUsingRadius,"bool")?t.checkHitUsingRadius:true;this.handleX=t.handleX||"center";this.handleY=t.handleY||"center";this.width=this.radius*2;this.height=this.width;e.sprite[this.name]=this;e.spritenames.pushUnique(this.name);e.group[this.group].addSpritesToGroup(this.name);return this}function g(t){if(e.isa(t,"obj")&&e.xt(t.url)){return this.importImage(t)}else{h.call(this,t);t=e.isa(t,"obj")?t:{};this.source=t.source||false;this.imageData=t.imageData||false;this.imageDataChannel=t.imageDataChannel||"alpha";this.animSheet=t.animSheet||false;this.imageType=this.sourceImage(t.source)||false;this.checkHitUsingImageData=e.isa(t.checkHitUsingImageData,"bool")?t.checkHitUsingImageData:false;if(this.source){if(this.imageType==="img"){this.width=t.width||e.image[this.source].copyWidth;this.height=t.height||e.image[this.source].copyHeight;this.copyX=t.copyX||e.image[this.source].copyX;this.copyY=t.copyY||e.image[this.source].copyY;this.copyWidth=t.copyWidth||e.image[this.source].copyWidth;this.copyHeight=t.copyHeight||e.image[this.source].copyHeight}else if(this.imageType==="canvas"){this.width=t.width||e.cell[this.source].sourceWidth;this.height=t.height||e.cell[this.source].sourceHeight;this.copyX=t.copyX||e.cell[this.source].sourceX;this.copyY=t.copyY||e.cell[this.source].sourceY;this.copyWidth=t.copyWidth||e.cell[this.source].sourceWidth;this.copyHeight=t.copyHeight||e.cell[this.source].sourceHeight}else if(this.imageType==="animation"){var n=e.anim[this.animSheet].getData();this.width=t.width||n.copyWidth;this.height=t.height||n.copyHeight;this.copyX=t.copyX||n.copyX;this.copyY=t.copyY||n.copyY;this.copyWidth=t.copyWidth||n.copyWidth;this.copyHeight=t.copyHeight||n.copyHeight}}e.sprite[this.name]=this;e.spritenames.pushUnique(this.name);e.group[this.group].addSpritesToGroup(this.name);return this}}function y(t){h.call(this,t);t=e.isa(t,"obj")?t:{};this.dataSet=e.xt(this.data)?this.buildDataSet(this.data):false;this.startX=t.startX||0;this.startY=t.startY||0;this.handleX=t.handleX||"left";this.handleY=t.handleY||"top";this.method=t.method||"draw";e.sprite[this.name]=this;e.spritenames.pushUnique(this.name);e.group[this.group].addSpritesToGroup(this.name);return this}function b(t){h.call(this,t);t=e.isa(t,"obj")?t:{};this.firstPoint=t.firstPoint||false;this.collisionPoints=e.xt(t.collisionPoints)?t.collisionPoints:[];this.closed=e.isa(t.closed,"bool")?t.closed:true;this.line=e.isa(t.line,"bool")?t.line:false;this.radius=t.radius||false;this.linkList=[];this.linkDurations=[];this.pointList=[];this.perimeterLength=false;this.markStart=t.markStart||t.mark||false;this.markMid=t.markMid||t.mark||false;this.markEnd=t.markEnd||t.mark||false;this.handleX=t.handleX||"center";this.handleY=t.handleY||"center";this.width=t.width||0;this.height=t.height||0;e.sprite[this.name]=this;e.spritenames.pushUnique(this.name);e.group[this.group].addSpritesToGroup(this.name);return this}function w(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.sprite=n.sprite||false;this.distance=n.distance||false;this.angle=n.angle||false;this.startLink=n.startLink||false;this.currentX=n.currentX||0;this.currentY=n.currentY||0;this.visibility=e.isa(n.visibility,"bool")?n.visibility:true;this.fixed=e.isa(n.fixed,"bool")?n.fixed:false;e.point[this.name]=this;e.pointnames.pushUnique(this.name);if(this.sprite&&e.sprite[this.sprite].type==="Shape"){e.sprite[this.sprite].pointList.pushUnique(this.name)}return this}function E(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.species=n.species||false;this.startPoint=n.startPoint||false;this.sprite=e.xt(e.point[this.startPoint])?e.point[this.startPoint].sprite:false;this.endPoint=n.endPoint||false;this.controlPoint1=n.controlPoint1||false;this.controlPoint2=n.controlPoint2||false;this.action=n.action||"add";e.link[this.name]=this;e.linknames.pushUnique(this.name);this.length=e.isa(n.length,"bool")&&n.length?this.getLength():false;this.precision=e.isa(n.precision,"num")?n.precision:100;this.positions=e.isa(n.positions,"bool")&&n.positions?this.setPositions(this.precision):false;if(this.startPoint&&this.sprite&&this.action==="add"){e.sprite[this.sprite].linkList.pushUnique(this.name)}return this}function S(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.color=n.color||[{color:"black",stop:0},{color:"white",stop:.999999}];this.setToSprite=e.isa(n.setToSprite,"bool")?n.setToSprite:false;this.roll=n.roll||0;this.cell=n.cell||e.pad[e.currentPad].current;this.startX=n.startX||0;this.startY=n.startY||0;this.endX=n.endX||0;this.endY=n.endY||0;this.handleX=n.handleX||0;this.handleY=n.handleY||0;this.startHandleX=n.startHandleX||0;this.startHandleY=n.startHandleY||0;this.endHandleX=n.endHandleX||0;this.endHandleY=n.endHandleY||0;this.startRangeX=n.startRangeX||0;this.startRangeY=n.startRangeY||0;this.endRangeX=e.isa(n.endRangeX,"num")?n.endRangeX:1;this.endRangeY=e.isa(n.endRangeY,"num")?n.endRangeY:0;this.autoUpdate=e.isa(n.autoUpdate,"bool")?n.autoUpdate:false;return this}function x(t){S.call(this,t);t=e.isa(t,"obj")?t:{};e.design[this.name]=this;e.designnames.pushUnique(this.name);this.update();return this}function T(t){S.call(this,t);t=e.isa(t,"obj")?t:{};this.startRadius=t.startRadius||0;this.endRadius=t.endRadius||0;this.startRangeRadius=e.isa(t.startRangeRadius,"num")?t.startRangeRadius:.5;this.endRangeRadius=t.endRangeRadius||0;e.design[this.name]=this;e.designnames.pushUnique(this.name);this.update();return this}function N(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.repeat=n.repeat||"repeat";e.design[this.name]=this;e.designnames.pushUnique(this.name);this.setImage(n.source||n.imageData||e.image[n.image]||false,this.name);return this}function C(n){t.call(this,n);n=e.isa(n,"obj")?n:{};this.r=n.r||0;this.g=n.g||0;this.b=n.b||0;this.a=n.a||1;this.rShift=n.rShift||0;this.gShift=n.gShift||0;this.bShift=n.bShift||0;this.aShift=n.aShift||0;this.rMax=n.rMax||255;this.gMax=n.gMax||255;this.bMax=n.bMax||255;this.aMax=n.aMax||1;this.rMin=n.rMin||0;this.gMin=n.gMin||0;this.bMin=n.bMin||0;this.aMin=n.aMin||0;this.rBounce=e.isa(n.rBounce,"bool")?n.rBounce:false;this.gBounce=e.isa(n.gBounce,"bool")?n.gBounce:false;this.bBounce=e.isa(n.bBounce,"bool")?n.bBounce:false;this.aBounce=e.isa(n.aBounce,"bool")?n.aBounce:false;this.autoUpdate=e.isa(n.autoUpdate,"bool")?n.autoUpdate:false;if(e.xt(n.color)){this.convert(n.color)}if(n.random){this.generateRandomColor(n)}this.checkValues();e.design[this.name]=this;e.designnames.pushUnique(this.name);return this}var e={type:"Library",version:"1.01",object:{},objectnames:[],pad:{},padnames:[],currentPad:null,cell:{},canvas:{},context:{},cellnames:[],ctx:{},ctxnames:[],image:{},imageData:{},img:{},imagenames:[],group:{},groupnames:[],design:{},dsn:{},designnames:[],sprite:{},spritenames:[],point:{},pointnames:[],link:{},linknames:[],anim:{},animnames:[],text:{},textnames:[],stack:{},stk:{},stacknames:[],element:{},elm:{},elementnames:[],nameslist:["objectnames","padnames","cellnames","imagenames","groupnames","designnames","spritenames","pointnames","linknames","ctxnames","animnames","textnames","stacknames","elementnames"],radian:Math.PI/180,mouseX:0,mouseY:0,newPad:function(e){return new o(e)},newStack:function(e){return new i(e)},newElement:function(e){return new s(e)},newCell:function(e){return new u(e)},newImage:function(e){return new f(e)},newGroup:function(e){return new c(e)},newPhrase:function(e){return new p(e)},newBlock:function(e){return new v(e)},newWheel:function(e){return new m(e)},newPicture:function(e){return new g(e)},newOutline:function(e){return new y(e)},newShape:function(e){return new b(e)},newPoint:function(e){return new w(e)},newLink:function(e){return new E(e)},newAnimSheet:function(e){return new l(e)},newGradient:function(e){return new x(e)},newRadialGradient:function(e){return new T(e)},newColor:function(e){return new C(e)},newPattern:function(e){return new N(e)},isa:function(e,t){if(this.xta([e,t])){var n=t.toLowerCase();switch(n){case"bool":case"boolean":return typeof e==="boolean"?true:false;break;case"num":case"number":return typeof e==="number"?true:false;break;case"str":case"string":return typeof e==="string"?true:false;break;case"fn":case"func":case"function":return typeof e==="function"?true:false;break;case"arr":case"array":return Object.prototype.toString.call(e)==="[object Array]"?true:false;break;case"date":return Object.prototype.toString.call(e)==="[object Date]"?true:false;break;case"obj":case"object":return Object.prototype.toString.call(e)==="[object Object]"?true:false;break;default:return false}}return false},xt:function(e){return typeof e!=="undefined"?true:false},xta:function(e){var t=[].concat(e);if(t.length>0){for(var n=0,r=t.length;n<r;n++){if(typeof t[n]==="undefined"){return false}}return true}return false},xto:function(e){var t=[].concat(e);if(t.length>0){for(var n=0,r=t.length;n<r;n++){if(typeof t[n]!=="undefined"){return true}}}return false},makeName:function(e){e=this.isa(e,"obj")?e:{};var t={name:this.isa(e.name,"str")?e.name:null,type:this.isa(e.type,"str")?e.type:null,target:this.isa(e.target,"str")?e.target:null};if(this.nameslist.contains(t.target)){var n=t.name||t.type||"default";var r=n.split("~£!");var i=this[t.target].contains(r[0])?r[0]+"~£!"+Math.floor(Math.random()*1e8):r[0];return i}return false},loadNative:function(e){e=this.isa(e,"str")?[e]:e;if(this.isa(e,"arr")){var t;for(var n=0,r=e.length;n<r;n++){t=JSON.parse(e[n]);for(var i=0,s=t.length;i<s;i++){switch(t[i].type){case"Group":if(this.groupnames.contains(t[i].name)){this.group[t[i].name].setToDefaults().set(t[i])}else{this.newGroup(t[i])}break;case"AnimSheet":if(this.animnames.contains(t[i].name)){this.anim[t[i].name].setToDefaults().set(t[i])}else{this.newAnimSheet(t[i])}break;case"ScrawlImage":if(this.imagenames.contains(t[i].name)){this.image[t[i].name].setToDefaults().set(t[i])}else{if(this.xt(e.element)){e.element=document.getElementById(e.element)}this.newImage(t[i])}break;case"Gradient":if(this.designnames.contains(t[i].name)){this.design[t[i].name].setToDefaults().set(t[i])}else{this.newGradient(t[i])}break;case"RadialGradient":if(this.designnames.contains(t[i].name)){this.design[t[i].name].setToDefaults().set(t[i])}else{this.newRadialGradient(t[i])}break;case"Pattern":if(this.designnames.contains(t[i].name)){this.design[t[i].name].setToDefaults().set(t[i])}else{this.newPattern(t[i])}break;case"Color":if(this.designnames.contains(t[i].name)){this.design[t[i].name].setToDefaults().set(t[i])}else{this.newColor(t[i])}break;case"Phrase":if(this.spritenames.contains(t[i].name)){this.sprite[t[i].name].setToDefaults().set(t[i])}else{this.newPhrase(t[i])}break;case"Block":if(this.spritenames.contains(t[i].name)){this.sprite[t[i].name].setToDefaults().set(t[i])}else{this.newBlock(t[i])}break;case"Wheel":if(this.spritenames.contains(t[i].name)){this.sprite[t[i].name].setToDefaults().set(t[i])}else{this.newWheel(t[i])}break;case"Picture":var o;if(this.spritenames.contains(t[i].name)){o=this.sprite[t[i].name];o.setToDefaults().set(t[i])}else{o=this.newPicture(t[i])}if(t[i].checkHitUsingImageData){o.getImageData()}break;case"Outline":if(this.spritenames.contains(t[i].name)){this.sprite[t[i].name].setToDefaults().set(t[i])}else{this.newOutline(t[i])}break;case"Shape":if(this.spritenames.contains(t[i].name)){this.sprite[t[i].name].setToDefaults().set(t[i])}else{this.newShape(t[i])}break;case"Point":if(this.pointnames.contains(t[i].name)){this.point[t[i].name].setToDefaults().set(t[i])}else{this.newPoint(t[i])}break;case"Link":if(this.linknames.contains(t[i].name)){this.link[t[i].name].setToDefaults().set(t[i])}else{this.newLink(t[i])}break}}}}return},getImagesByClass:function(t){if(t){var n=[];var r=document.getElementsByClassName(t);if(r.length>0){for(var i,s=0,o=r.length;s<o;s++){i=e.newImage({element:r[s]});n.push(i.name)}return n}}console.log('scrawl.getImagesByClass() failed to find any <img> elements of class="'+t+'" on the page');return false},clear:function(t,n){var r=this.xt(n)?[].concat(n):this.padnames;if(r.length>0){for(var i=0,s=r.length;i<s;i++){e.pad[r[i]].clear(t)}return true}return false},stampBackground:function(t,n){var r=this.xt(n)?[].concat(n):this.padnames;if(r.length>0){for(var i=0,s=r.length;i<s;i++){e.pad[r[i]].stampBackground(t)}return true}return false},compile:function(t,n){var r=this.xt(n)?[].concat(n):this.padnames;if(r.length>0){for(var i=0,s=r.length;i<s;i++){e.pad[r[i]].compile(t)}return true}return false},show:function(t,n){var r=this.xt(n)?[].concat(n):this.padnames;if(r.length>0){for(var i=0,s=r.length;i<s;i++){e.pad[r[i]].show(t)}return true}return false},render:function(t,n){var r=this.xt(n)?[].concat(n):this.padnames;if(r.length>0){for(var i=0,s=r.length;i<s;i++){e.pad[r[i]].render(t)}return true}return false},reset:function(){this.objectnames=[];this.stack={};this.stk={};this.stacknames=[];this.element={};this.elm={};this.elementnames=[];this.pad={};this.padnames=[];this.currentPad=null;this.cell={};this.canvas={};this.context={};this.cellnames=[];this.ctx={};this.ctxnames=[];this.image={};this.imageData={};this.img={};this.imagenames=[];this.group={};this.groupnames=[];this.design={};this.dsn={};this.designnames=[];this.sprite={};this.spritenames=[];this.point={};this.pointnames=[];this.link={};this.linknames=[];this.anim={};this.animnames=[];this.text={};this.textnames=[];this.initialize();return true},addNewCell:function(t,n){var r=this.isa(n,"str")?n:this.currentPad;return e.pad[r].addNewCell(t)},deleteCells:function(t){if(this.xt(t)){var n=[].concat(t);for(var r=0,i=n.length;r<i;r++){for(var s=0,o=this.padnames.length;s<o;s++){this.pad[this.padnames[s]].deleteCell(n[r])}delete this.group[n[r]];delete this.group[n[r]+"_field"];delete this.group[n[r]+"_fence"];this.groupnames.removeItem(n[r]);this.groupnames.removeItem(n[r]+"_field");this.groupnames.removeItem(n[r]+"_fence");delete this.context[n[r]];delete this.canvas[n[r]];delete this.ctx[e.cell[n[r]].context];this.ctxnames.removeItem(e.cell[n[r]].context);delete this.cell[n[r]];this.cellnames.removeItem(n[r])}return true}return false},setDrawOrder:function(e,t){var n=this.xt(t)?[].concat(t):[this.currentPad];for(var r=0,i=n.length;r<i;r++){this.pad[n[r]].setDrawOrder(e)}return true},makeCartesianPoints:function(e){e=this.isa(e,"obj")?e:{};if(this.isa(e.pointLabel,"str")&&this.isa(e.sprite,"str")&&this.isa(e.data,"arr")){var t=[],n;var r=this.isa(e.visibility,"bool")?e.visibility:true;var i=this.xt(e.linkLabel)?e.linkLabel:e.pointLabel+"_link";for(var s=0,o=e.data.length;s<o;s++){n=new w({name:e.pointLabel+s,sprite:e.sprite,currentX:e.data[s][0]||0,currentY:e.data[s][1]||0,visibility:r,startLink:i+s});t.push(n.name)}}return t},makePolarPoints:function(e){e=this.isa(e,"obj")?e:{};if(this.isa(e.pointLabel,"str")&&this.isa(e.sprite,"str")&&this.isa(e.data,"arr")){var t=[],n;var r=this.isa(e.visibility,"bool")?e.visibility:true;var i=this.xt(e.linkLabel)?e.linkLabel:e.pointLabel+"_link";for(var s=0,o=e.data.length;s<o;s++){n=new w({name:e.pointLabel+s,sprite:e.sprite,distance:e.data[s][0]||0,angle:e.data[s][1]||0,visibility:r,startLink:i+s});t.push(n.name)}}return t},makePath:function(t){t=this.isa(t,"obj")?t:{};t.scaleX=t.scaleX||1;t.scaleY=t.scaleY||1;t.startX=t.startX||0;t.startY=t.startY||0;t.handleX=t.handleX||"left";t.handleY=t.handleY||"top";var n=999999,r=999999,i=-999999,s=-999999;var o=function(e,t){n=n>e?e:n;r=r>t?t:r;i=i<e?e:i;s=s<t?t:s};var u=function(e){var t=e.match(/(-?[0-9.]+\b)/g);if(t){for(var n=0,r=t.length;n<r;n++){t[n]=parseFloat(t[n])}return t}return false};var a=function(e,t,n,r,i,s,o,u,a){new w({name:e+"_p"+t,sprite:n,currentX:r*u,currentY:i*a,visibility:s,startLink:e+"_l"+o})};var f=function(t,n,r,i,s,o,u,a,f){u=e.xt(u)?u:{};a=e.xt(a)?a:{};f=e.xt(f)?f:{};new E({name:t+"_l"+n,sprite:r,species:i,startPoint:o.name,endPoint:u.name||false,controlPoint1:a.name||false,controlPoint2:f.name||false,precision:false,action:s})};if(this.xt(t.data)){var l=this.newShape(t);var c=l.name;var h=c.replace("~","_","g");var p=e.point;var d=t.scaleX;var v=t.scaleY;if(l){var m=t.data.match(/([A-Za-z][0-9. ,\-]*)/g);var g,y,b;var S=0,x=0;var T=l.startX,N=l.startY;a(h,x,c,T,N,false,S,d,v);x++;for(var C=0,k=m.length;C<k;C++){y=m[C][0];g=u(m[C]);switch(y){case"M":if(C===0&&t.dataFile){l.startX=g[0];l.startY=g[1];o(T,N)}else{T=g[0],N=g[1];o(T,N);a(h,x,c,T,N,true,S+1,d,v);x++;f(h,S,c,false,"move",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++}for(var L=2,A=g.length;L<A;L+=2){a(h,x,c,g[L],g[L+1],true,S+1,d,v);x++;f(h,S,c,"line","add",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;T=g[L],N=g[L+1];o(T,N)}break;case"m":T+=g[0],N+=g[1];o(T,N);a(h,x,c,T,N,true,S+1,d,v);x++;f(h,S,c,false,"move",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;for(var L=2,A=g.length;L<A;L+=2){a(h,x,c,T+g[L],N+g[L+1],true,S+1,d,v);x++;f(h,S,c,"line","add",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;T+=g[L],N+=g[L+1];o(T,N)}break;case"Z":case"z":a(h,x,c,l.startX,l.startY,false,S+1,d,v);x++;f(h,S,c,false,"close",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;break;case"L":for(var L=0,A=g.length;L<A;L+=2){a(h,x,c,g[L],g[L+1],true,S+1,d,v);x++;f(h,S,c,"line","add",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;T=g[L],N=g[L+1];o(T,N)}break;case"l":for(var L=0,A=g.length;L<A;L+=2){a(h,x,c,T+g[L],N+g[L+1],true,S+1,d,v);x++;f(h,S,c,"line","add",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;T+=g[L],N+=g[L+1];o(T,N)}break;case"H":for(var L=0,A=g.length;L<A;L++){a(h,x,c,g[L],N,true,S+1,d,v);x++;f(h,S,c,"line","add",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;T=g[L];o(T,N)}break;case"h":for(var L=0,A=g.length;L<A;L++){a(h,x,c,T+g[L],N,true,S+1,d,v);x++;f(h,S,c,"line","add",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;T+=g[L];o(T,N)}break;case"V":for(var L=0,A=g.length;L<A;L++){a(h,x,c,T,g[L],true,S+1,d,v);x++;f(h,S,c,"line","add",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;N=g[L];o(T,N)}break;case"v":for(var L=0,A=g.length;L<A;L++){a(h,x,c,T,N+g[L],true,S+1,d,v);x++;f(h,S,c,"line","add",p[h+"_p"+(x-2)],p[h+"_p"+(x-1)]);S++;N+=g[L];o(T,N)}break;case"C":for(var L=0,A=g.length;L<A;L+=6){a(h,x,c,g[L],g[L+1],false,S+1,d,v);x++;a(h,x,c,g[L+2],g[L+3],false,S+1,d,v);x++;a(h,x,c,g[L+4],g[L+5],true,S+1,d,v);x++;f(h,S,c,"bezier","add",p[h+"_p"+(x-4)],p[h+"_p"+(x-1)],p[h+"_p"+(x-3)],p[h+"_p"+(x-2)]);S++;T=g[L+4],N=g[L+5];o(T,N)}break;case"c":for(var L=0,A=g.length;L<A;L+=6){a(h,x,c,T+g[L],N+g[L+1],false,S+1,d,v);x++;a(h,x,c,T+g[L+2],N+g[L+3],false,S+1,d,v);x++;a(h,x,c,T+g[L+4],N+g[L+5],true,S+1,d,v);x++;f(h,S,c,"bezier","add",p[h+"_p"+(x-4)],p[h+"_p"+(x-1)],p[h+"_p"+(x-3)],p[h+"_p"+(x-2)]);S++;T+=g[L+4],N+=g[L+5];o(T,N)}break;case"S":for(var L=0,A=g.length;L<A;L+=4){if(C>0&&["C","c","S","s"].contains(m[C-1][0])){p[h+"_p"+(x-2)].clone({name:h+"_p"+x,currentX:T+(T-p[h+"_p"+(x-2)].currentX),currentY:N+(N-p[h+"_p"+(x-2)].currentY)}),x++}else{a(h,x,c,T,N,false,S+1,d,v);x++}a(h,x,c,g[L],g[L+1],false,S+1,d,v);x++;a(h,x,c,g[L+2],g[L+3],true,S+1,d,v);x++;f(h,S,c,"bezier","add",p[h+"_p"+(x-4)],p[h+"_p"+(x-1)],p[h+"_p"+(x-3)],p[h+"_p"+(x-2)]);S++;T=g[L+2],N=g[L+3];o(T,N)}break;case"s":for(var L=0,A=g.length;L<A;L+=4){if(C>0&&["C","c","S","s"].contains(m[C-1][0])){p[h+"_p"+(x-2)].clone({name:h+"_p"+x,currentX:T+(T-p[h+"_p"+(x-2)].currentX),currentY:N+(N-p[h+"_p"+(x-2)].currentY)}),x++}else{a(h,x,c,T,N,false,S+1,d,v);x++}a(h,x,c,g[L],g[L+1],false,S+1,d,v);x++;a(h,x,c,g[L+2],g[L+3],true,S+1,d,v);x++;f(h,S,c,"bezier","add",p[h+"_p"+(x-4)],p[h+"_p"+(x-1)],p[h+"_p"+(x-3)],p[h+"_p"+(x-2)]);S++;T+=g[L+2],N+=g[L+3];o(T,N)}break;case"Q":for(var L=0,A=g.length;L<A;L+=4){a(h,x,c,g[L],g[L+1],false,S+1,d,v);x++;a(h,x,c,g[L+2],g[L+3],true,S+1,d,v);x++;f(h,S,c,"quadratic","add",p[h+"_p"+(x-3)],p[h+"_p"+(x-1)],p[h+"_p"+(x-2)]);S++;T=g[L+2],N=g[L+3];o(T,N)}break;case"q":for(var L=0,A=g.length;L<A;L+=4){a(h,x,c,T+g[L],N+g[L+1],false,S+1,d,v);x++;a(h,x,c,T+g[L+2],N+g[L+3],true,S+1,d,v);x++;f(h,S,c,"quadratic","add",p[h+"_p"+(x-3)],p[h+"_p"+(x-1)],p[h+"_p"+(x-2)]);S++;T+=g[L+2],N+=g[L+3];o(T,N)}break;case"T":for(var L=0,A=g.length;L<A;L+=2){if(C>0&&["Q","q","T","t"].contains(m[C-1][0])){p[h+"_p"+(x-2)].clone({name:h+"_p"+x,currentX:T+(T-p[h+"_p"+(x-2)].currentX),currentY:N+(N-p[h+"_p"+(x-2)].currentY)}),x++}else{a(h,x,c,T,N,false,S+1,d,v);x++}a(h,x,c,g[L],g[L+1],false,S+1,d,v);x++;f(h,S,c,"quadratic","add",p[h+"_p"+(x-3)],p[h+"_p"+(x-1)],p[h+"_p"+(x-2)]);S++;T=g[L],N=g[L+1];o(T,N)}break;case"t":for(var L=0,A=g.length;L<A;L+=2){if(C>0&&["Q","q","T","t"].contains(m[C-1][0])){p[h+"_p"+(x-2)].clone({name:h+"_p"+x,currentX:T+(T-p[h+"_p"+(x-2)].currentX),currentY:N+(N-p[h+"_p"+(x-2)].currentY)}),x++}else{a(h,x,c,T,N,false,S+1,d,v);x++}a(h,x,c,g[L],g[L+1],true,S+1,d,v);x++;f(h,S,c,"quadratic","add",p[h+"_p"+(x-3)],p[h+"_p"+(x-1)],p[h+"_p"+(x-2)]);S++;T+=g[L],N+=g[L+1];o(T,N)}break;default:}}f(h,S,c,false,"end",p[h+"_p"+(x-1)],p[h+"_p"+x]);l.firstPoint=h+"_p0";l.width=(i-n)*t.scaleX;l.height=(s-r)*t.scaleY;this.point[h+"_p0"].fixed=l.name;if(t.path){l.path=false;l.forceStamp("none");l.path=t.path}else{l.forceStamp("none")}l.handleX=t.handleX||"center";l.handleY=t.handleY||"center";return l}}return false},makeEllipse:function(e){e=this.isa(e,"obj")?e:{};e.startX=e.startX||0;e.startY=e.startY||0;e.radiusX=e.radiusX||0;e.radiusY=e.radiusY||0;e.closed=true;var t="m";var n=e.startX;var r=e.startY;var i=e.startX;var s=e.startY-e.radiusY;t+=n-i+","+(r-s);n=i,r=s;i=e.startX+e.radiusX*.55;s=e.startY-e.radiusY;t+="c"+(n-i)+","+(r-s);i=e.startX+e.radiusX;s=e.startY-e.radiusY*.55;t+=" "+(n-i)+","+(r-s);i=e.startX+e.radiusX;s=e.startY;t+=" "+(n-i)+","+(r-s);n=i,r=s;i=e.startX+e.radiusX;s=e.startY+e.radiusY*.55;t+="c"+(n-i)+","+(r-s);i=e.startX+e.radiusX*.55;s=e.startY+e.radiusY;t+=" "+(n-i)+","+(r-s);i=e.startX;s=e.startY+e.radiusY;t+=" "+(n-i)+","+(r-s);n=i,r=s;i=e.startX-e.radiusX*.55;s=e.startY+e.radiusY;t+="c"+(n-i)+","+(r-s);i=e.startX-e.radiusX;s=e.startY+e.radiusY*.55;t+=" "+(n-i)+","+(r-s);i=e.startX-e.radiusX;s=e.startY;t+=" "+(n-i)+","+(r-s);n=i,r=s;i=e.startX-e.radiusX;s=e.startY-e.radiusY*.55;t+="c"+(n-i)+","+(r-s);i=e.startX-e.radiusX*.55;s=e.startY-e.radiusY;t+=" "+(n-i)+","+(r-s);i=e.startX;s=e.startY-e.radiusY;t+=" "+(n-i)+","+(r-s);t+="z";e.data=t;var o;if(e.outline){e.data="M"+e.startX+","+e.startY+e.data;e.handleX=e.handleX||"left";e.handleY=e.handleY||"top";o=this.newOutline(e)}else{e.handleX=e.handleX||"center";e.handleY=e.handleY||"center";o=this.makePath(e)}return o},makeRectangle:function(e){e=this.isa(e,"obj")?e:{};e.startX=e.startX||0;e.startY=e.startY||0;e.width=e.width||0;e.height=e.height||0;e.radius=e.radius||0;e.closed=true;var t=e.radiusTopLeftX||e.radiusTopLeft||e.radiusTopX||e.radiusLeftX||e.radiusTop||e.radiusLeft||e.radiusX||e.radius||0;var n=e.radiusTopLeftY||e.radiusTopLeft||e.radiusTopY||e.radiusLeftY||e.radiusTop||e.radiusLeft||e.radiusY||e.radius||0;var r=e.radiusTopRightX||e.radiusTopRight||e.radiusTopX||e.radiusRightX||e.radiusTop||e.radiusRight||e.radiusX||e.radius||0;var i=e.radiusTopRightY||e.radiusTopRight||e.radiusTopY||e.radiusRightY||e.radiusTop||e.radiusRight||e.radiusY||e.radius||0;var s=e.radiusBottomRightX||e.radiusBottomRight||e.radiusBottomX||e.radiusRightX||e.radiusBottom||e.radiusRight||e.radiusX||e.radius||0;var o=e.radiusBottomRightY||e.radiusBottomRight||e.radiusBottomY||e.radiusRightY||e.radiusBottom||e.radiusRight||e.radiusY||e.radius||0;var u=e.radiusBottomLeftX||e.radiusBottomLeft||e.radiusBottomX||e.radiusLeftX||e.radiusBottom||e.radiusLeft||e.radiusX||e.radius||0;var a=e.radiusBottomLeftY||e.radiusBottomLeft||e.radiusBottomY||e.radiusLeftY||e.radiusBottom||e.radiusLeft||e.radiusY||e.radius||0;var f=e.width/2;var l=e.height/2;var c="m";var h=e.startX;var p=e.startY;var d=e.startX-f+t;var v=e.startY-l;c+=h-d+","+(p-v);h=d,p=v;d=e.startX+f-r;v=e.startY-l;c+="l"+(h-d)+","+(p-v);h=d,p=v;d=e.startX+f-r+r*.55;v=e.startY-l;c+="c"+(h-d)+","+(p-v);d=e.startX+f;v=e.startY-l+i-i*.55;c+=" "+(h-d)+","+(p-v);d=e.startX+f;v=e.startY-l+i;c+=" "+(h-d)+","+(p-v);h=d,p=v;d=e.startX+f;v=e.startY+l-o;c+="l"+(h-d)+","+(p-v);h=d,p=v;d=e.startX+f;v=e.startY+l-o+o*.55;c+="c"+(h-d)+","+(p-v);d=e.startX+f-s+s*.55;v=e.startY+l;c+=" "+(h-d)+","+(p-v);d=e.startX+f-s;v=e.startY+l;c+=" "+(h-d)+","+(p-v);h=d,p=v;d=e.startX-f+u;v=e.startY+l;c+="l"+(h-d)+","+(p-v);h=d,p=v;d=e.startX-f+u-u*.55;v=e.startY+l;c+="c"+(h-d)+","+(p-v);d=e.startX-f;v=e.startY+l-a+a*.55;c+=" "+(h-d)+","+(p-v);d=e.startX-f;v=e.startY+l-a;c+=" "+(h-d)+","+(p-v);h=d,p=v;d=e.startX-f;v=e.startY-l+n;c+="l"+(h-d)+","+(p-v);h=d,p=v;d=e.startX-f;v=e.startY-l+n-n*.55;c+="c"+(h-d)+","+(p-v);d=e.startX-f+t-t*.55;v=e.startY-l;c+=" "+(h-d)+","+(p-v);d=e.startX-f+t;v=e.startY-l;c+=" "+(h-d)+","+(p-v);c+="z";e.data=c;var m;if(e.outline){e.data="M"+e.startX+","+e.startY+e.data;e.handleX=e.handleX||"left";e.handleY=e.handleY||"top";m=this.newOutline(e)}else{e.handleX=e.handleX||"center";e.handleY=e.handleY||"center";m=this.makePath(e)}return m},makeBezier:function(e){e=this.isa(e,"obj")?e:{};e.startX=e.startX||0;e.startY=e.startY||0;e.startControlX=e.startControlX||0;e.startControlY=e.startControlY||0;e.endControlX=e.endControlX||0;e.endControlY=e.endControlY||0;e.endX=e.endX||0;e.endY=e.endY||0;e.closed=false;e.handleX=e.handleX||"left";e.handleY=e.handleY||"top";var t=e.fixed||"none";e.fixed=false;e.data="m0,0"+"c"+(e.startControlX-e.startX)+","+(e.startControlY-e.startY)+" "+(e.endControlX-e.startX)+","+(e.endControlY-e.startY)+" "+(e.endX-e.startX)+","+(e.endY-e.startY);var n;if(e.outline){e.data="M"+e.startX+","+e.startY+e.data;n=this.newOutline(e)}else{e.line=true;n=this.makePath(e);var r=n.name.replace("~","_","g");switch(t){case"all":this.point[r+"_p1"].fixed=true;this.point[r+"_p2"].fixed=true;this.point[r+"_p3"].fixed=true;this.point[r+"_p4"].fixed=true;break;case"both":this.point[r+"_p1"].fixed=true;this.point[r+"_p4"].fixed=true;break;case"start":this.point[r+"_p1"].fixed=true;break;case"startControl":this.point[r+"_p2"].fixed=true;break;case"endControl":this.point[r+"_p3"].fixed=true;break;case"end":this.point[r+"_p4"].fixed=true;break;default:this.point[r+"_p0"].fixed=n.name}}return n},makeQuadratic:function(e){e=this.isa(e,"obj")?e:{};e.startX=e.startX||0;e.startY=e.startY||0;e.controlX=e.controlX||0;e.controlY=e.controlY||0;e.endX=e.endX||0;e.endY=e.endY||0;e.closed=false;e.handleX=e.handleX||"left";e.handleY=e.handleY||"top";var t=e.fixed||"none";e.fixed=false;e.data="m0,0"+"q"+(e.controlX-e.startX)+","+(e.controlY-e.startY)+" "+(e.endX-e.startX)+","+(e.endY-e.startY);var n;if(e.outline){e.data="M"+e.startX+","+e.startY+e.data;n=this.newOutline(e)}else{e.line=true;n=this.makePath(e);var r=n.name.replace("~","_","g");switch(t){case"all":this.point[r+"_p1"].fixed=true;this.point[r+"_p2"].fixed=true;this.point[r+"_p3"].fixed=true;break;case"both":this.point[r+"_p1"].fixed=true;this.point[r+"_p3"].fixed=true;break;case"start":this.point[r+"_p1"].fixed=true;break;case"control":this.point[r+"_p2"].fixed=true;break;case"end":this.point[r+"_p3"].fixed=true;break;default:this.point[r+"_p0"].fixed=n.name}}return n},makeLine:function(e){e=this.isa(e,"obj")?e:{};e.startX=e.startX||0;e.startY=e.startY||0;e.endX=e.endX||0;e.endY=e.endY||0;e.closed=false;var t=e.fixed||"none";e.fixed=false;e.handleX=e.handleX||"left";e.handleY=e.handleY||"top";e.data="m0,0 "+(e.endX-e.startX)+","+(e.endY-e.startY);var n;if(e.outline){e.data="M"+e.startX+","+e.startY+e.data;n=this.newOutline(e)}else{e.line=true;n=this.makePath(e);var r=n.name.replace("~","_","g");switch(t){case"both":this.point[r+"_p1"].fixed=true;this.point[r+"_p2"].fixed=true;break;case"start":this.point[r+"_p1"].fixed=true;break;case"end":this.point[r+"_p2"].fixed=true;break;default:this.point[r+"_p0"].fixed=n.name}}return n},makeRegularShape:function(e){e=this.isa(e,"obj")?e:{};if(this.xto([e.sides,e.angle])){e.startX=e.startX||0;e.startY=e.startY||0;e.radius=this.isa(e.radius,"num")?e.radius:20;e.closed=true;var t=e.sides?360/e.sides:e.angle;var n=0,r=t;while(r>1e-6&&n<360){n++;r+=t;r=r%360}n++;var i=t;var s="m",o,u,a=0,f=0;for(var l=0;l<=n;l++){o=e.radius*Math.cos(i*this.radian);u=e.radius*Math.sin(i*this.radian);s+=(o-a).toFixed(3)+","+(u-f).toFixed(3)+" ";a=o,f=u;i+=t;i=i%360}s+="z";e.data=s;var c;if(e.outline){e.data="M"+e.startX+","+e.startY+e.data;e.handleX=e.handleX||"left";e.handleY=e.handleY||"top";c=this.newOutline(e)}else{e.handleX=e.handleX||"center";e.handleY=e.handleY||"center";var c=this.makePath(e);c.width=c.radius*2;c.height=c.width}return c}return false},deleteSprite:function(e){var t=[].concat(e);for(var n=0,r=t.length;n<r;n++){if(this.spritenames.contains(t[n])){if(this.sprite[t[n]].type==="Shape"){var i=[this.sprite[t[n]].firstPoint];var s=this.point[this.sprite[t[n]].firstPoint].getData();var o=[s.startLink];var u=this.link[s.startLink];while(u.action&&["move","add"].contains(u.action)){if(u.controlPoint1){i.push(u.controlPoint1)}if(u.controlPoint2){i.push(u.controlPoint2)}if(u.endPoint){i.push(u.endPoint);o.push(this.point[u.endPoint].startLink);u=this.link[this.point[u.endPoint].startLink]}else{break}}for(var a=0,f=i.length;a<f;a++){this.pointnames.removeItem(i[a]);delete this.point[i[a]]}for(var a=0,f=o.length;a<f;a++){this.linknames.removeItem(o[a]);delete this.link[o[a]]}}this.ctxnames.removeItem(t[n]);delete this.ctx[t[n]];this.spritenames.removeItem(t[n]);delete this.sprite[t[n]];for(var l=0,c=this.groupnames.length;l<c;l++){this.group[this.groupnames[l]].sprites.removeItem(t[n])}}}return true},addSpritesToGroups:function(e,t){if(this.xta([e,t])){var n=[].concat(e);var r=[].concat(t);for(var i=0,s=n.length;i<s;i++){if(this.groupnames.contains(n[i])){this.group[n[i]].addSpritesToGroup(r)}}return true}return false},removeSpritesFromGroups:function(e,t){if(this.xta([e,t])){var n=[].concat(e);var r=[].concat(t);for(var i=0,s=n.length;i<s;i++){if(this.groupnames.contains(n[i])){this.group[n[i]].removeSpritesFromGroup(r)}}return true}return false},buildFields:function(e){var t=this.xt(e)?[].concat(e):[this.pad[this.currentPad].current];if(e==="all"){t=this.cellnames}for(var n=0,r=t.length;n<r;n++){this.cell[t[n]].buildField()}return true},initialize:function(){this.getStacks();this.getCanvases();this.getElements();this.setDisplayOffsets("all");return true},getStacks:function(){var t=document.getElementsByClassName("scrawlstack");var n=[];var r;if(t.length>0){for(var i=0,s=t.length;i<s;i++){n.push(t[i])}for(var i=0,s=t.length;i<s;i++){r=e.newStack({stackElement:n[i]});for(var o=0,u=e.stk[r.name].children.length;o<u;o++){e.stk[r.name].children[o].style.position="absolute";if(e.stk[r.name].children[o].tagName!=="CANVAS"){e.newElement({domElement:e.stk[r.name].children[o],stack:r.name})}}if(this.elementnames.contains(r.name)){r.stack=this.element[r.name].stack;delete this.element[r.name];delete this.elm[r.name];this.elementnames.removeItem(r.name)}}return true}console.log('scrawl.getStacks() failed to find any elements with class="scrawlstack" on the page');return false},getCanvases:function(){var t=document.getElementsByTagName("canvas");var n,r,i,s;var o=[];if(t.length>0){for(var u=0,a=t.length;u<a;u++){o.push(t[u])}for(var u=0,a=t.length;u<a;u++){if(o[u].className.indexOf("stack:")!==-1){r=o[u].className.match(/stack:(\w+)/);if(e.stacknames.contains(r[1])){e.stk[r[1]].appendChild(o[u])}else{i=document.createElement("div");i.id=r[1];o[u].parentElement.appendChild(i);i.appendChild(o[u]);s=e.newStack({stackElement:document.getElementById(r[1])})}}n=e.newPad({canvasElement:o[u]});if(e.stacknames.contains(o[u].parentElement.id)){n.stack=o[u].parentElement.id;o[u].style.position="absolute";n.initialize3d()}if(u===0){e.currentPad=n.name}}return true}console.log("scrawl.getCanvases() failed to find any <canvas> elements on the page");return false},getElements:function(){var t=document.getElementsByClassName("scrawl");var n=[];var r,i;if(t.length>0){for(var s=0,o=t.length;s<o;s++){n.push(t[s])}for(var s=0,o=t.length;s<o;s++){r=n.id||n.name||false;if(!e.elementnames.contains(r)){if(n[s].className.indexOf("stack:")!==-1){i=n[s].className.match(/stack:(\w+)/);if(e.stacknames.contains(i[1])){e.stk[i[1]].appendChild(n[s]);e.newElement({domElement:n[s],stack:i[1]})}}}}return true}console.log('scrawl.getElements() failed to find any elements with class="scrawl" on the page');return false},addCanvasToPage:function(t){t=this.isa(t,"obj")?t:{};var n=false;if(this.xt(t.stackName)){n=document.getElementById(t.stackName)||false;if(!n){n=this.addStackToPage({stackName:t.stackName,width:t.width,height:t.height,parentElement:document.getElementById(t.parentElement)||document.body})}t.stack=n.id}var r=n||document.getElementById(t.parentElement)||document.body;var i=e.makeName({name:t.canvasName||false,type:"Pad",target:"padnames"});var s=document.createElement("canvas");s.id=i;r.appendChild(s);var o=document.getElementById(i);o.width=t.width;o.height=t.height;var u=e.newPad({canvasElement:o});if(this.xt(t.position)||n){t.position=t.position||"absolute"}u.set(t);u.setDisplayOffsets();return u},addStackToPage:function(t){if(this.isa(t.stackName,"str")&&this.xt(t.parentElement)){var n=document.createElement("div");n.id=t.stackName;t.parentElement.appendChild(n);t["stackElement"]=document.getElementById(t.stackName);t["stack"]=e.stacknames.contains(t.parentElement.id)?t.parentElement.id:false;var r=new i(t);return e.stk[r.name]}return false},setDisplayOffsets:function(t){var n=t||"all";if(n==="stacks"||n==="all"){for(var r=0,i=e.stacknames.length;r<i;r++){e.stack[e.stacknames[r]].setDisplayOffsets()}}if(n==="pads"||n==="all"){for(var r=0,i=e.padnames.length;r<i;r++){e.pad[e.padnames[r]].setDisplayOffsets()}}if(n==="elements"||n==="all"){for(var r=0,i=e.elementnames.length;r<i;r++){e.element[e.elementnames[r]].setDisplayOffsets()}}return true},handleMouseMove:function(t){if(!t)var t=window.event;if(t.pageX||t.pageY){e.mouseX=t.pageX;e.mouseY=t.pageY}else if(t.clientX||t.clientY){e.mouseX=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;e.mouseY=t.clientY+document.body.scrollTop+document.documentElement.scrollTop}return true},getImageDataValue:function(t){if(this.xta([t.table,t.channel])&&this.isa(t.x,"num")&&this.isa(t.y,"num")){var n=e.imageData[t.table];if(n){if(t.y.isBetween(-1,n.height)){if(t.x.isBetween(-1,n.width)){var r=(t.y*n.width+t.x)*4;var i;if(t.channel==="color"){i="rgba("+n.data[r]+","+n.data[r+1]+","+n.data[r+2]+","+n.data[r+3]+")"}else{var s;switch(t.channel){case"red":s=0;break;case"blue":s=1;break;case"green":s=2;break;case"alpha":s=3;break}i=n.data[r+s]}return i}}}}return false}};t.prototype.type="Scrawl";t.prototype.classname="objectnames";t.prototype.get=function(e){return this[e]};t.prototype.set=function(t){for(var n in t){if(e.xt(this[n])&&e.xt(t[n])){this[n]=t[n]}}return this};t.prototype.clone=function(t){var n;var r=JSON.parse(JSON.stringify(this));t=e.isa(t,"obj")?t:{};r.name=t.name||r.name;switch(this.type){case"Phrase":n=new p(r);break;case"Block":n=new v(r);break;case"Wheel":n=new m(r);break;case"Picture":n=new g(r);break;case"Outline":n=new y(r);break;case"Shape":n=new b(r);break;case"Gradient":n=new x(r);break;case"RadialGradient":n=new T(r);break;case"Pattern":n=new N(r);break;case"Color":n=new C(r);break;case"Point":n=new w(r);break;case"Link":n=new E(r);break;case"Context":n=new a(r);break;case"AnimSheet":n=new l(r);break}n.set(t);return n};t.prototype.toString=function(){return JSON.stringify(this)};n.prototype=Object.create(t.prototype);n.prototype.type="SubScrawl";n.prototype.classname="objectnames";n.prototype.moveStart=function(t){switch(t){case"x":this.startX+=this.moveStartX;break;case"y":this.startY+=this.moveStartY;break;case"path":this.pathPosition+=this.movePathPosition;if(this.pathPosition>1){this.pathPosition-=1}if(this.pathPosition<0){this.pathPosition+=1}break;default:this.startX+=this.moveStartX;this.startY+=this.moveStartY;this.pathPosition+=this.movePathPosition;if(this.pathPosition>1){this.pathPosition-=1}if(this.pathPosition<0){this.pathPosition+=1}}if(["Block","Phrase","Wheel","Outline","Shape","Picture"].contains(this.type)){this.setCurrentParameters(e.group[this.group].getOverride(this.name,"none"))}return this};n.prototype.unmoveStart=function(t){switch(t){case"x":this.startX-=this.moveStartX;break;case"y":this.startY-=this.moveStartY;break;case"path":this.pathPosition-=this.movePathPosition;if(this.pathPosition>1){this.pathPosition-=1}if(this.pathPosition<0){this.pathPosition+=1}break;default:this.startX-=this.moveStartX;this.startY-=this.moveStartY;this.pathPosition-=this.movePathPosition;if(this.pathPosition>1){this.pathPosition-=1}if(this.pathPosition<0){this.pathPosition+=1}}if(["Block","Phrase","Wheel","Outline","Shape","Picture"].contains(this.type)){this.setCurrentParameters(e.group[this.group].getOverride(this.name,"none"))}return this};n.prototype.exchange=function(t,n){if(e.isa(t,"obj")){var r;switch(n){case"start":r=this.startX;this.startX=t.startX;t.startX=r;r=this.startY;this.startY=t.startY;t.startY=r;break;case"moveStart":r=this.moveStartX;this.moveStartX=t.moveStartX;t.moveStartX=r;r=this.moveStartY;this.moveStartY=t.moveStartY;t.moveStartY=r;break;case"handle":r=this.handleX;this.handleX=t.handleX;t.handleX=r;r=this.handleY;this.handleY=t.handleY;t.handleY=r;break;case"moveHandle":r=this.moveHandleX;this.moveHandleX=t.moveHandleX;t.moveHandleX=r;r=this.moveHandleY;this.moveHandleY=t.moveHandleY;t.moveHandleY=r;break;default:if(e.xt(this[n])&&e.xt(t[n])){r=this[n];this[n]=t[n];t[n]=r}}}return this};n.prototype.moveHandle=function(t){switch(t){case"x":this.handleX+=this.moveHandleX;break;case"y":this.handleY+=this.moveHandleY;break;default:this.handleX+=this.moveHandleX;this.handleY+=this.moveHandleY}if(["Block","Phrase","Wheel","Outline","Shape","Picture"].contains(this.type)){this.setCurrentParameters(e.group[this.group].getOverride(this.name,"none"))}return this};n.prototype.reverse=function(e){switch(e){case"moveStartX":this.moveStartX=-this.moveStartX;break;case"moveStartY":this.moveStartY=-this.moveStartY;break;case"moveStart":this.moveStartX=-this.moveStartX;this.moveStartY=-this.moveStartY;break;case"moveHandleX":this.moveHandleX=-this.moveHandleX;break;case"moveHandleY":this.moveHandleY=-this.moveHandleY;break;case"moveHandle":this.moveHandleX=-this.moveHandleX;this.moveHandleY=-this.moveHandleY;break;case"movePath":this.movePathPosition=-this.movePathPosition;break}return this};n.prototype.getPivotOffset=function(t,n){if(e.xt(t)){n=e.isa(n,"bool")?n:false;var r;if(e.isa(t,"str")&&!["left","center","right","top","bottom"].contains(t)){r=n?parseFloat(t)/100*this.height:parseFloat(t)/100*this.width}else{switch(t){case"left":r=0;break;case"center":n?r=this.height/2:r=this.width/2;break;case"right":r=this.width;break;case"top":r=0;break;case"bottom":r=this.height;break;default:r=t}}return r}return 0};n.prototype.getStartX=function(t){t=e.isa(t,"obj")?t:{};var n,r;var i=this.currentScale||this.scale||1;if(this.flipReverse){n=this.getPivotOffset(this.handleX,false);r=this.startX+n*i;return e.xt(t.x)?r-t.x:r}else{n=this.getPivotOffset(this.handleX,false);r=this.startX-n*i;return e.xt(t.x)?r+t.x:r}};n.prototype.getStartY=function(t){t=e.isa(t,"obj")?t:{};var n,r;var i=this.currentScale||this.scale||1;if(this.flipUpend){n=this.getPivotOffset(this.handleY,true);r=this.startY+n*i;return e.xt(t.y)?r-t.y:r}else{n=this.getPivotOffset(this.handleY,true);r=this.startY-n*i;return e.xt(t.y)?r+t.y:r}};r.prototype=Object.create(n.prototype);r.prototype.type="Scrawl3d";r.prototype.classname="objectnames";r.prototype.initialize2d=function(t){t=e.isa(t,"obj")?t:{};this.stack=t.stack||false;this.setTitle(t.title||this.getTitle()||"");this.setComment(t.comment||this.getComment()||"");this.setOverflow(t.overflow||this.getOverflow()||(this.type==="Stack"?"hidden":"visible"));this.setZIndex(t.order||t.zIndex||this.getZIndex()||0);this.setWidth(t.width||this.getWidth()||300);this.setHeight(t.height||this.getHeight()||150);this.setLeft(t.startX||t.left||this.getLeft()||0);this.setTop(t.startY||t.top||this.getTop()||0);this.setDisplayOffsets();return this};r.prototype.initialize3d=function(t){t=e.isa(t,"obj")?t:{};this.setPerspectiveOrigin({perspectiveOriginX:t.perspectiveOriginX,perspectiveOriginY:t.perspectiveOriginY}||t.perspectiveOrigin||this.getPerspectiveOrigin()||false);this.setPerspective(t.perspective||this.getPerspective());this.setTransformOrigin({transformOriginX:t.transformOriginX,transformOriginY:t.transformOriginY}||t.transformOrigin||this.getTransformOrigin()||false);this.setTransformStyle(t.transformStyle||this.getTransformStyle()||"preserve-3d");this.setBackfaceVisibility(t.backfaceVisibility||this.getBackfaceVisibility()||"visible");this.setPitch(t.rotateX||t.pitch||0);this.setYaw(t.rotateY||t.yaw||0);this.setRoll(t.rotateZ||t.rotate||t.roll||0);this.setTranslateX(t.translateX||0);this.setTranslateY(t.translateY||0);this.setTranslateZ(t.translateZ||0);this.setRotateFirst(t.rotateFirst||false);this.setTransform();this.setDisplayOffsets();return this};r.prototype.set=function(n){t.prototype.set.call(this,n);n=e.isa(n,"obj")?n:{};if(e.xt(n.title)){this.setTitle(n.title)}if(e.xt(n.comment)){this.setComment(n.comment)}if(e.xt(n.overflow)){this.setOverflow(n.overflow)}if(e.xto([n.order,n.zIndex])){this.setZIndex(n.order||n.zIndex||0)}if(e.xt(n.width)){this.setWidth(n.width)}if(e.xt(n.height)){this.setHeight(n.height)}if(e.xt(n.position)){this.setPosition(n.position)}if(e.xto([n.startX,n.left])){this.setLeft(n.startX||n.left||0)}if(e.xto([n.startY,n.top])){this.setTop(n.startY||n.top||0)}if(e.xt(n.perspective)){this.setPerspective(n.perspective)}if(e.xto([n.perspectiveOriginX,n.perspectiveOriginY])){this.setPerspectiveOrigin({perspectiveOriginX:n.perspectiveOriginX||this.perspectiveOriginX,perspectiveOriginY:n.perspectiveOriginY||this.perspectiveOriginY})}else if(e.xt(n.perspectiveOrigin)){this.setPerspectiveOrigin(n.perspectiveOrigin)}if(e.xto([n.transformOriginX,n.transformOriginY])){this.setTransformOrigin({transformOriginX:n.transformOriginX||this.transformOriginX,transformOriginY:n.transformOriginY||this.transformOriginY})}else if(e.xt(n.transformOrigin)){this.setTransformOrigin(n.transformOrigin)}if(e.xt(n.transformStyle)){this.setTransformStyle(n.transformStyle)}if(e.xt(n.backfaceVisibility)){this.setBackfaceVisibility(n.backfaceVisibility)}if(e.xto([n.rotateX,n.pitch])){this.setPitch(n.rotateX||n.pitch||0)}if(e.xto([n.rotateY,n.yaw])){this.setYaw(n.rotateY||n.yaw||0)}if(e.xto([n.rotateZ,n.rotate,n.roll])){this.setRoll(n.rotateZ||n.rotate||n.roll||0)}if(e.xt(n.translateX)){this.setTranslateX(n.translateX)}if(e.xt(n.translateY)){this.setTranslateY(n.translateY)}if(e.xt(n.translateZ)){this.setTranslateZ(n.translateZ)}if(e.xto([n.rotateX,n.pitch,n.rotateY,n.yaw,n.rotateZ,n.rotate,n.roll,n.translateX,n.translateY,n.translateZ])){this.setTransform()}if(e.xto([n.startX,n.left,n.startY,n.top])){this.setDisplayOffsets()}return this};r.prototype.setDelta=function(t){t=e.isa(t,"obj")?t:{};if(e.xt(t.width)){this.setWidth(this.width+t.width)}if(e.xt(t.height)){this.setHeight(this.height+t.height)}if(e.xto([t.startX,t.left])){this.setLeft(this.startX+t.startX||this.startX+t.left||this.startX)}if(e.xto([t.startY,t.top])){this.setTop(this.startY+t.startY||this.startY+t.top||this.startY)}if(e.xto([t.rotateX,t.pitch])){this.setPitch(this.pitch+t.rotateX||this.pitch+t.pitch||this.pitch)}if(e.xto([t.rotateY,t.yaw])){this.setYaw(this.yaw+t.rotateY||this.yaw+t.yaw||this.yaw)}if(e.xto([t.rotateZ,t.rotate,t.roll])){this.setRoll(this.roll+t.rotateZ||this.roll+t.rotate||this.roll+t.roll||this.roll)}if(e.xt(t.translateX)){this.setTranslateX(this.translateX+t.translateX)}if(e.xt(t.translateY)){this.setTranslateY(this.translateY+t.translateY)}if(e.xt(t.translateZ)){this.setTranslateZ(this.translateZ+t.translateZ)}if(e.xto([t.rotateX,t.pitch,t.rotateY,t.yaw,t.rotateZ,t.rotate,t.roll,t.translateX,t.translateY,t.translateZ])){this.setTransform()}if(e.xto([t.startX,t.left,t.startY,t.top])){this.setDisplayOffsets()}return this};r.prototype.setDisplayOffsets=function(){this.displayOffsetX=0;this.displayOffsetY=0;var e=this.getElement();if(e.offsetParent){do{this.displayOffsetX+=e.offsetLeft;this.displayOffsetY+=e.offsetTop}while(e=e.offsetParent)}return this};r.prototype.getPosition=function(){var e=this.getElement();return e.style.position||false};r.prototype.setPosition=function(t){this.position=e.xt(t)?t:this.position;var n=this.getElement();n.style.position=this.position;return this};r.prototype.getTitle=function(){var e=this.getElement();return e.title||false};r.prototype.setTitle=function(t){this.title=e.xt(t)?t:this.title;var n=this.getElement();n.title=this.title;return this};r.prototype.getComment=function(){var e=this.getElement();return e.getAttribute("data-comment")||false};r.prototype.setComment=function(t){this.comment=e.xt(t)?t:this.comment;var n=this.getElement();n.setAttribute("data-comment",this.comment);return this};r.prototype.getOverflow=function(){var e=this.getElement();return e.style.overflow||false};r.prototype.setOverflow=function(t){this.overflow=e.xt(t)?t:this.overflow;var n=this.getElement();n.style.overflow=this.overflow;return this};r.prototype.getZIndex=function(){var e=this.getElement();return e.style.zIndex||false};r.prototype.setZIndex=function(e){this.zIndex=e||this.zIndex||0;var t=this.getElement();t.style.zIndex=this.zIndex;return this};r.prototype.getWidth=function(){var e=this.getElement();return e.width||e.clientWidth||parseFloat(e.style.width)||false};r.prototype.setWidth=function(t){this.width=e.xt(t)?t:this.width;var n=this.getElement();if(this.type==="Pad"){n.width=this.width*this.scale}else{n.style.width=this.width*this.scale+"px"}return this};r.prototype.getHeight=function(){var e=this.getElement();return e.height||e.clientHeight||parseFloat(e.style.height)||false};r.prototype.setHeight=function(t){this.height=e.xt(t)?t:this.height;var n=this.getElement();if(this.type==="Pad"){n.height=this.height*this.scale}else{n.style.height=this.height*this.scale+"px"}return this};r.prototype.getStartX=function(){return this.getLeft()};r.prototype.setStartX=function(e,t){return this.setLeft(e,t)};r.prototype.getLeft=function(){var e=this.getElement();return parseFloat(e.style.left)||false};r.prototype.setLeft=function(t,n){this.startX=e.xt(t)?t:this.startX;var r=this.getElement();r.style.left=this.startX*this.scale+"px";if(e.xt(n)&&n){this.setDisplayOffsets()}return this};r.prototype.getStartY=function(){return this.getTop()};r.prototype.setStartY=function(e,t){return this.setTop(e,t)};r.prototype.getTop=function(){var e=this.getElement();return parseFloat(e.style.top)||false};r.prototype.setTop=function(t,n){this.startY=e.xt(t)?t:this.startY;var r=this.getElement();r.style.top=this.startY*this.scale+"px";if(e.xt(n)&&n){this.setDisplayOffsets()}return this};r.prototype.getPerspective=function(){var e=this.getElement();return parseFloat(e.style.webkitPerspective)||parseFloat(e.style.MozPerspective)||parseFloat(e.style.perspective)||false};r.prototype.setPerspective=function(t){if(this.isIE&&this.type==="Stack"){for(var n=0,r=e.stacknames.length;n<r;n++){if(e.stack[e.stacknames[n]].stack===this.name){e.stack[e.stacknames[n]].setPerspective(t)}}}this.perspective=e.xt(t)?t:this.perspective;var i=this.getElement();if(e.xt(i.style.webkitPerspective)){i.style.webkitPerspective=this.perspective*this.scale+"px"}else if(e.xt(i.style.MozPerspective)){i.style.MozPerspective=this.perspective*this.scale+"px"}else{i.style.perspective=this.perspective*this.scale+"px"}return this};r.prototype.getPerspectiveOrigin=function(){var e=this.getElement();return e.style.webkitPerspectiveOrigin||e.style.MozPerspectiveOrigin||e.style.perspectiveOrigin||false};r.prototype.setPerspectiveOrigin=function(t){if(this.isIE&&this.type==="Stack"){for(var n=0,r=e.stacknames.length;n<r;n++){if(e.stack[e.stacknames[n]].stack===this.name){e.stack[e.stacknames[n]].setPerspectiveOrigin(t)}}}if(e.isa(t,"str")){var i=t.split(" ");this.perspectiveOriginX=i[0]||"50%";this.perspectiveOriginY=i[1]||"50%"}else{t=e.isa(t,"obj")?t:{};this.perspectiveOriginX=t.perspectiveOriginX||this.perspectiveOriginX||"50%";this.perspectiveOriginY=t.perspectiveOriginY||this.perspectiveOriginY||"50%"}var s=this.getElement();if(e.xt(s.style.webkitPerspectiveOrigin)){s.style.webkitPerspectiveOrigin=this.perspectiveOriginX+" "+this.perspectiveOriginY}else if(e.xt(s.style.MozPerspectiveOrigin)){s.style.MozPerspectiveOrigin=this.perspectiveOriginX+" "+this.perspectiveOriginY}else{s.style.perspectiveOrigin=this.perspectiveOriginX+" "+this.perspectiveOriginY}return this};r.prototype.getTransformOrigin=function(){var e=this.getElement();return e.style.webkitTransformOrigin||e.style.MozTransformOrigin||e.style.transformOrigin||false};r.prototype.setTransformOrigin=function(t){if(e.isa(t,"str")){var n=t.split(" ");this.transformOriginX=n[0]||"50%";this.transformOriginY=n[1]||"50%"}else{t=e.isa(t,"obj")?t:{};this.transformOriginX=t.transformOriginX||this.transformOriginX||"50%";this.transformOriginY=t.transformOriginY||this.transformOriginY||"50%"}var r=this.getElement();if(e.xt(r.style.webkitTransformOrigin)){r.style.webkitTransformOrigin=this.transformOriginX+" "+this.transformOriginY}else if(e.xt(r.style.MozTransformOrigin)){r.style.MozTransformOrigin=this.transformOriginX+" "+this.transformOriginY}else{r.style.transformOrigin=this.transformOriginX+" "+this.transformOriginY}return this};r.prototype.getTransformStyle=function(){var e=this.getElement();return e.style.WebkitTransformStyle||e.style.MozTransformStyle||e.style.transformStyle||false};r.prototype.setTransformStyle=function(t){this.transformStyle=e.xt(t)?t:this.transformStyle;var n=this.getElement();if(e.xt(n.style.WebkitTransformStyle)){n.style.WebkitTransformStyle=this.transformStyle}else if(e.xt(n.style.MozTransformStyle)){n.style.MozTransformStyle=this.transformStyle}else{n.style.transformStyle=this.transformStyle}return this};r.prototype.getRotateX=function(){return this.getPitch()};r.prototype.getPitch=function(){return this.pitch||false};r.prototype.getRotateY=function(){return this.getYaw()};r.prototype.getYaw=function(){return this.yaw||false};r.prototype.getRotateZ=function(){return this.getRoll()};r.prototype.getRotate=function(){return this.getRoll()};r.prototype.getRoll=function(){return this.roll||false};r.prototype.setRotateX=function(e){return this.setPitch(e)};r.prototype.setPitch=function(e){this.pitch=e||this.pitch||0;return this};r.prototype.setRotateY=function(e){return this.setYaw(e)};r.prototype.setYaw=function(e){this.yaw=e||this.yaw||0;return this};r.prototype.setRotateZ=function(e){return this.setRoll(e)};r.prototype.setRotate=function(e){return this.setRoll(e)};r.prototype.setRoll=function(e){this.roll=e||this.roll||0;return this};r.prototype.getTranslateX=function(){return this.translateX||false};r.prototype.setTranslateX=function(e){this.translateX=e||this.translateX||0;return this};r.prototype.getTranslateY=function(){return this.translateY||false};r.prototype.setTranslateY=function(e){this.translateY=e||this.translateY||0;return this};r.prototype.getTranslateZ=function(){return this.translateZ||false};r.prototype.setTranslateZ=function(e){this.translateZ=e||this.translateZ||0;return this};r.prototype.setRotateFirst=function(t){this.rotateFirst=e.isa(t,"bool")?t:false;return this};r.prototype.getTransform=function(){if(this.rotateFirst){return"rotateX("+this.pitch+"deg) rotateY("+this.yaw+"deg) rotateZ("+this.roll+"deg) translateX("+this.translateX*this.scale+"px) translateY("+this.translateY*this.scale+"px) translateZ("+this.translateZ*this.scale+"px)"}else{return"translateX("+this.translateX*this.scale+"px) translateY("+this.translateY*this.scale+"px) translateZ("+this.translateZ*this.scale+"px) rotateX("+this.pitch+"deg) rotateY("+this.yaw+"deg) rotateZ("+this.roll+"deg)"}};r.prototype.setTransform=function(t){t=e.isa(t,"obj")?t:{};this.setPitch(t.pitch||t.rotateX||false);this.setYaw(t.yaw||t.rotateY||false);this.setRoll(t.roll||t.rotateZ||t.rotate||false);this.setTranslateX(t.translateX||false);this.setTranslateY(t.translateY||false);this.setTranslateZ(t.translateZ||false);var n=this.getElement();if(e.xt(n.style.webkitTransform)){n.style.webkitTransform=this.getTransform()}else if(e.xt(n.style.MozTransform)){n.style.MozTransform=this.getTransform()}else{if(this.isIE&&this.type==="Stack"){n.style.transform=this.getTransform();for(var r=0,i=e.stacknames.length;r<i;r++){if(e.stack[e.stacknames[r]].stack===this.name){e.stack[e.stacknames[r]].setTransform()}}for(var r=0,i=e.elementnames.length;r<i;r++){if(e.element[e.elementnames[r]].stack===this.name){e.element[e.elementnames[r]].setTransform()}}for(var r=0,i=e.padnames.length;r<i;r++){if(e.pad[e.padnames[r]].stack===this.name){e.pad[e.padnames[r]].setTransform()}}}else{n.style.transform=this.getTransform()}}return this};r.prototype.getBackfaceVisibility=function(){var e=this.getElement();return e.style.webkitBackfaceVisibility||e.style.MozBackfaceVisibility||e.style.backfaceVisibility||false};r.prototype.setBackfaceVisibility=function(t){this.backfaceVisibility=e.xt(t)?t:this.backfaceVisibility;var n=this.getElement();if(e.xt(n.style.webkitBackfaceVisibility)){n.style.webkitBackfaceVisibility=this.backfaceVisibility}else if(e.xt(n.style.MozBackfaceVisibility)){n.style.MozBackfaceVisibility=this.backfaceVisibility}else{n.style.backfaceVisibility=this.backfaceVisibility}return this};r.prototype.shiftPosition=function(){this.shiftLeft();this.shiftTop();this.setDisplayOffsets();return this};r.prototype.shiftLeft=function(t){this.moveStart("x");this.setLeft();if(e.xt(t)&&t){this.setDisplayOffsets()}return this};r.prototype.shiftTop=function(t,n){this.moveStart("y");this.setTop();if(e.xt(n)&&n){this.setDisplayOffsets()}return this};r.prototype.scaleStack=function(t){if(this.type==="Stack"){for(var n=0,r=e.stacknames.length;n<r;n++){if(e.stack[e.stacknames[n]].stack===this.name){e.stack[e.stacknames[n]].scaleStack(t)}}for(var n=0,r=e.elementnames.length;n<r;n++){if(e.element[e.elementnames[n]].stack===this.name){e.element[e.elementnames[n]].scaleDimensions(t)}}for(var n=0,r=e.padnames.length;n<r;n++){if(e.pad[e.padnames[n]].stack===this.name){e.pad[e.padnames[n]].scaleDimensions(t)}}this.scaleDimensions(t)}return this};r.prototype.scaleDimensions=function(t){this.scale=t||this.scale;this.setWidth();this.setHeight();this.setTop();this.setLeft();this.setPerspectiveOrigin();this.setPerspective();this.setTransformOrigin();this.setTransform();this.setDisplayOffsets();if(this.type==="Pad"){e.cell[this.display].scale=this.scale}return this};i.prototype=Object.create(r.prototype);i.prototype.type="Stack";i.prototype.classname="stacknames";i.prototype.getElement=function(){return e.stk[this.name]};i.prototype.addElementById=function(t){if(e.isa(t,"str")){var n=e.newElement({domElement:document.getElementById(t),stack:this.name});e.stk[this.name].appendChild(e.elm[n.name]);e.elm[n.name]=document.getElementById(n.name);e.setDisplayOffsets("all");return n}return false};i.prototype.addElementsByClassName=function(t){if(e.isa(t,"str")){var n=[];var r=document.getElementsByClassName(t);var i,s,o;for(var u=0,a=r.length;u<a;u++){o=r[u];if(o.nodeName!=="CANVAS"){i=e.newElement({domElement:o,stack:this.name});n.push(i)}}for(var u=0,a=n.length;u<a;u++){e.stk[this.name].appendChild(e.elm[n[u].name]);e.elm[n[u].name]=document.getElementById(n[u].name)}e.setDisplayOffsets("all");return n}return false};s.prototype=Object.create(r.prototype);s.prototype.type="Element";s.prototype.classname="elementnames";s.prototype.getElement=function(){return e.elm[this.name]};o.prototype=Object.create(r.prototype);o.prototype.type="Pad";o.prototype.classname="padnames";o.prototype.getElement=function(){return e.canvas[this.display]};o.prototype.set=function(t){r.prototype.set.call(this,t);e.cell[this.display].set(t);e.cell[this.base].set(t);t=e.isa(t,"obj")?t:{};this.setDrawOrder(t.drawOrder||[]);if(e.isa(t.scale,"num")){e.cell[this.display].scale=t.scale;this.scale=t.scale}return this};o.prototype.setDrawOrder=function(t){this.drawOrder=e.xt(t)?[].concat(t):[];return this};o.prototype.getMouse=function(){if(!window.onmousemove){window.onmousemove=e.handleMouseMove}if(e.mouseX.isBetween(this.displayOffsetX,this.displayOffsetX+this.width*this.scale,true)&&e.mouseY.isBetween(this.displayOffsetY,this.displayOffsetY+this.height*this.scale,true)){this.mouseX=(e.mouseX-this.displayOffsetX)*(1/this.scale);this.mouseY=(e.mouseY-this.displayOffsetY)*(1/this.scale);this.mouseOverPad=true}else{this.mouseX=0;this.mouseY=0;this.mouseOverPad=false}return{x:this.mouseX,y:this.mouseY,active:this.mouseOverPad}};o.prototype.getCellsForDisplayAction=function(t){var n=[];if(e.isa(t,"arr")){n=t}else{for(var r=0,i=this.cells.length;r<i;r++){n.push(this.cells[r])}switch(t){case"all":break;case"display":n=[this.display];break;case"base":n=[this.base];break;case"non-base":n.removeItem(this.base);break;case"current":n=[this.current];break;case"non-current":n.removeItem(this.current);break;case"additionals":n.removeItem(this.display);n.removeItem(this.base);break;case"non-additionals":n=[this.display,this.base];break;case"none":n=[];break;default:n.removeItem(this.display);break}}return n};o.prototype.clear=function(t){var n=this.getCellsForDisplayAction(t);for(var r=0,i=n.length;r<i;r++){e.cell[n[r]].clear()}return this};o.prototype.compile=function(t){var n=this.getCellsForDisplayAction(t);for(var r=0,i=n.length;r<i;r++){e.cell[n[r]].compile()}return this};o.prototype.stampBackground=function(t){var n=this.getCellsForDisplayAction(t);for(var r=0,i=n.length;r<i;r++){e.cell[n[r]].stampBackground()}return this};o.prototype.show=function(t){switch(t){case"wipe-base":e.cell[this.base].clear();break;case"wipe-both":e.cell[this.base].clear();e.cell[this.display].clear();break;default:e.cell[this.display].clear();break}if(this.drawOrder.length>0){for(var n=0,r=this.drawOrder.length;n<r;n++){e.cell[this.base].copyCellToSelf(e.cell[this.drawOrder[n]])}}e.cell[this.display].copyCellToSelf(e.cell[this.base]);return this};o.prototype.render=function(t){t=e.isa(t,"obj")?t:{};t.clear=e.xt(t.clear)?t.clear:null;t.compile=e.xt(t.compile)?t.compile:null;t.show=e.xt(t.show)?t.show:null;this.clear(t.clear);this.compile(t.compile);this.show(t.show);return this};o.prototype.addNewCell=function(t){t=e.isa(t,"obj")?t:{};if(e.xta([t.width,t.height])&&e.isa(t.name,"str")){t.width=parseFloat(t.width.toFixed());t.height=parseFloat(t.height.toFixed());var n=document.createElement("canvas");n.setAttribute("id",t.name);n.setAttribute("height",t.height);n.setAttribute("width",t.width);t["pad"]=this.name;t["canvas"]=n;var r=new u(t);this.cells.pushUnique(r.name);return r}return false};o.prototype.addCells=function(t){t=[].concat(t);for(var n=0,r=t.length;n<r;n++){if(e.cellnames.contains(t[n])){this.cells.push(t[n]);this.drawOrder.push(t[n])}}return this};o.prototype.deleteCell=function(t){if(e.isa(t,"str")){this.cells.removeItem(t);if(this.display===t){this.display=false}if(this.current===t){this.current=false}if(this.base===t){this.base=false}return this}return false};o.prototype.makeCurrent=function(){e.currentPad=this.name;return this};o.prototype.buildFields=function(){for(var t=0,n=this.cells.length;t<n;t++){e.cell[this.cells[t]].buildField()}return this};u.prototype=Object.create(n.prototype);u.prototype.type="Cell";u.prototype.classname="cellnames";u.prototype.set=function(n){t.prototype.set.call(this,n);e.ctx[this.context].set(n);if(e.xt(n)){if(e.xto([n.width,n.height,n.actualWidth,n.actualHeight])){this.setDimensions(n)}if(e.xto([n.cellY,n.roll,n.scaleX,n.scaleY,n.shearX,n.shearY,n.cellX])){this.transformCell()}}return this};u.prototype.setDelta=function(t){if(e.xt(t)){if(e.xt(t.sourceX)){this.sourceX+=t.sourceX}if(e.xt(t.sourceY)){this.sourceY+=t.sourceY}if(e.xt(t.sourceWidth)){this.sourceWidth+=t.sourceWidth}if(e.xt(t.sourceHeight)){this.sourceHeight+=t.sourceHeight}if(e.xt(t.targetX)){this.targetX+=t.targetX}if(e.xt(t.targetY)){this.targetY+=t.targetY}if(e.xt(t.targetWidth)){this.targetWidth+=t.targetWidth}if(e.xt(t.targetHeight)){this.targetHeight+=t.targetHeight}}return this};u.prototype.getPadWidth=function(){return e.pad[this.pad].getWidth()};u.prototype.getPadHeight=function(){return e.pad[this.pad].getHeight()};u.prototype.buildField=function(){var t,n,r,i,s;var o=(new v({width:this.actualWidth,height:this.actualHeight,group:this.name})).stamp();e.deleteSprite(o.name);t=e.group[this.name+"_field"].sprites;for(var u=0,a=t.length;u<a;u++){r=e.sprite[t[u]];i=e.ctx[r.context].fillStyle;s=e.ctx[r.context].strokeStyle;e.ctx[r.context].fillStyle="rgba(255,255,255,1)";e.ctx[r.context].strokeStyle="rgba(255,255,255,1)";r.forceStamp("fillDraw",this.name);e.ctx[r.context].fillStyle=i;e.ctx[r.context].strokeStyle=s}n=e.group[this.name+"_fence"].sprites;for(var u=0,a=n.length;u<a;u++){r=e.sprite[n[u]];i=e.ctx[r.context].fillStyle;s=e.ctx[r.context].strokeStyle;e.ctx[r.context].fillStyle="rgba(0,0,0,1)";e.ctx[r.context].strokeStyle="rgba(0,0,0,1)";r.forceStamp("fillDraw",this.name);e.ctx[r.context].fillStyle=i;e.ctx[r.context].strokeStyle=s}this.fieldLabel=this.getImageData({name:"field"});return this};u.prototype.checkFieldAt=function(t){t=e.isa(t,"obj")?t:false;if(e.xt(t.coordinates)||e.xta([t.x,t.y])){var n=t.channel||"anycolor";var r=t.test||0;var i,s,o,u;if(!e.xt(t.coordinates)){o=[{x:t.x||0,y:t.y||0}]}else{o=t.coordinates}var a=e.imageData[this.fieldLabel];var f;for(var l=0,c=o.length;l<c;l++){i=parseFloat(o[l].x.toFixed());s=parseFloat(o[l].y.toFixed());if(!i.isBetween(0,a.width,true)||!s.isBetween(0,a.height,true)){return false;break}else{f=false;u=(s*a.width+i)*4;switch(n){case"red":if(a.data[u]<=r){return l+1}break;case"green":if(a.data[u+1]<=r){return l+1}break;case"blue":if(a.data[u+2]<=r){return l+1}break;case"alpha":if(a.data[u+3]<=r){return l+1}break;case"anycolor":if(a.data[u]<=r||a.data[u+1]<=r||a.data[u+2]<=r){return l+1}break}}}return-1}return false};u.prototype.setEngine=function(t){var n=e.ctx[this.context];var r=e.ctx[t.context];var i=r.getChanges(n,t.scale,t.scaleOutline);var s=e.context[this.name];for(var o in i){switch(o){case"name":break;case"fillStyle":if(e.xt(e.dsn[i[o]])){var u=e.design[i[o]];if(u.setToSprite){if(e.xta([t.currentX,t.currentWidth,u.startRangeX,t.currentY,t.currentHeight,u.startRangeY,u.endRangeX,u.endRangeY])){if(u.type==="Gradient"){switch(t.type){case"Wheel":case"Shape":u.set({startX:t.currentX-t.currentWidth/2,startY:t.currentY-t.currentHeight/2,endX:t.currentX+t.currentWidth/2,endY:t.currentY+t.currentHeight/2}).update();break;default:u.set({startX:t.currentX+t.currentWidth*u.startRangeX,startY:t.currentY+t.currentHeight*u.startRangeY,endX:t.currentX+t.currentWidth*u.endRangeX,endY:t.currentY+t.currentHeight*u.endRangeY}).update()}}else{switch(t.type){case"Wheel":case"Shape":u.set({startX:t.currentX,startY:t.currentY,startRadius:t.currentWidth/2,endX:t.currentX,endY:t.currentY,endRadius:0}).update();break;default:u.set({startX:t.currentX+t.currentWidth*u.startRangeX,startY:t.currentY+t.currentHeight*u.startRangeY,startRadius:(t.currentWidth+t.currentHeight)/2*u.startRangeRadius,endX:t.currentX+t.currentWidth*u.endRangeX,endY:t.currentY+t.currentHeight*u.endRangeY,endRadius:0}).update()}}}}s.fillStyle=e.dsn[i[o]]}else if(e.xt(e.design[i[o]])){s.fillStyle=e.design[i[o]].get()}else if(e.isa(i[o],"str")){s.fillStyle=i[o]}break;case"winding":s.mozFillRule=i[o];s.msFillRule=i[o];break;case"strokeStyle":if(e.xt(e.dsn[i[o]])){var u=e.design[i[o]];if(u.setToSprite){if(e.xta([t.currentX,t.currentWidth,u.startRangeX,t.currentY,t.currentHeight,u.startRangeY,u.endRangeX,u.endRangeY])){if(u.type==="Gradient"){switch(t.type){case"Wheel":case"Shape":u.set({startX:t.currentX-t.currentWidth/2,startY:t.currentY-t.currentHeight/2,endX:t.currentX+t.currentWidth/2,endY:t.currentY+t.currentHeight/2}).update();break;default:u.set({startX:t.currentX+t.currentWidth*u.startRangeX,startY:t.currentY+t.currentHeight*u.startRangeY,endX:t.currentX+t.currentWidth*u.endRangeX,endY:t.currentY+t.currentHeight*u.endRangeY}).update()}}else{switch(t.type){case"Wheel":case"Shape":u.set({startX:t.currentX,startY:t.currentY,startRadius:t.currentWidth/2,endX:t.currentX,endY:t.currentY,endRadius:0}).update();break;default:u.set({startX:t.currentX+t.currentWidth*u.startRangeX,startY:t.currentY+t.currentHeight*u.startRangeY,startRadius:(t.currentWidth+t.currentHeight)/2*u.startRangeRadius,endX:t.currentX+t.currentWidth*u.endRangeX,endY:t.currentY+t.currentHeight*u.endRangeY,endRadius:0}).update()}}}}s.strokeStyle=e.dsn[i[o]]}else if(e.xt(e.design[i[o]])){s.strokeStyle=e.design[i[o]].get()}else if(e.isa(i[o],"str")){s.strokeStyle=i[o]}break;case"lineDash":s.mozDash=i[o];s.lineDash=i[o];try{s.setLineDash(i[o])}catch(a){}break;case"lineDashOffset":s.mozDashOffset=i[o];s.lineDashOffset=i[o];break;case"globalAlpha":s.globalAlpha=i[o];break;case"globalCompositeOperation":s.globalCompositeOperation=i[o];break;case"lineWidth":s.lineWidth=i[o];break;case"lineCap":s.lineCap=i[o];break;case"lineJoin":s.lineJoin=i[o];break;case"miterLimit":s.miterLimit=i[o];break;case"shadowOffsetX":s.shadowOffsetX=i[o];break;case"shadowOffsetY":s.shadowOffsetY=i[o];break;case"shadowBlur":s.shadowBlur=i[o];break;case"shadowColor":s.shadowColor=i[o];break;case"font":s.font=i[o];break;case"textAlign":s.textAlign=i[o];break;case"textBaseline":s.textBaseline=i[o];break}if(o!=="name"){n[o]=i[o]}}return s};u.prototype.clear=function(){var t=e.context[this.name];t.clearRect(this.actualX-this.cellX,this.actualY-this.cellY,this.actualWidth*this.scale,this.actualHeight*this.scale);return this};u.prototype.compile=function(){if(this.backgroundColor!=="rgba(0,0,0,0)"){this.stampBackground()}this.groups.sort(function(t,n){return e.group[t].order-e.group[n].order});for(var t=0,n=this.groups.length;t<n;t++){if(e.group[this.groups[t]].visibility){e.group[this.groups[t]].stamp(false,this.name)}}return this};u.prototype.stampBackground=function(){var t=e.context[this.name];var n=t.fillStyle;t.fillStyle=this.backgroundColor;t.fillRect(this.actualX-this.cellX,this.actualY-this.cellY,this.actualWidth,this.actualHeight);t.fillStyle=n;return this};u.prototype.copyCellToSelf=function(t){if(e.xt(t)){var n=e.context[this.name];var r=t.usePadDimensions?e.pad[t.pad].width:t.sourceWidth;var i=t.usePadDimensions?e.pad[t.pad].height:t.sourceHeight;var s=t.usePadDimensions?e.pad[t.pad].width*this.scale:t.targetWidth*this.scale;var o=t.usePadDimensions?e.pad[t.pad].height*this.scale:t.targetHeight*this.scale;n.drawImage(e.canvas[t.name],t.sourceX,t.sourceY,r,i,(t.targetX-t.handleX)*this.scale,(t.targetY-t.handleY)*this.scale,s,o)}return this};u.prototype.getCopyScaling=function(t){t=e.isa(t,"str")?e.cell[t]:t;if(e.xt(t)){var n=t.usePadDimensions?e.pad[t.pad].width:t.sourceWidth;var r=t.usePadDimensions?e.pad[t.pad].height:t.sourceHeight;var i=t.usePadDimensions?e.pad[t.pad].width*this.scale:t.targetWidth*this.scale;var s=t.usePadDimensions?e.pad[t.pad].height*this.scale:t.targetHeight*this.scale;return{w:i/n,h:s/r}}return false};u.prototype.clearShadow=function(){var t=e.context[this.name];var n=e.ctx[this.context];t.shadowOffsetX=0;n.shadowOffsetX=0;t.shadowOffsetY=0;n.shadowOffsetY=0;t.shadowBlur=0;n.shadowBlur=0;t.shadowColor="rgba(0, 0, 0, 0)";n.shadowColor="rgba(0, 0, 0, 0)";return this};u.prototype.restoreShadow=function(t){var n=e.context[this.name];var r=e.ctx[this.context];var i=e.ctx[t];n.shadowOffsetX=i.shadowOffsetX;r.shadowOffsetX=i.shadowOffsetX;n.shadowOffsetY=i.shadowOffsetY;r.shadowOffsetY=i.shadowOffsetY;n.shadowBlur=i.shadowBlur;r.shadowBlur=i.shadowBlur;n.shadowColor=i.shadowColor;r.shadowColor=i.shadowColor;return this};u.prototype.setToClearShape=function(){var t=e.context[this.name];var n=e.ctx[this.context];t.fillStyle="rgba(0, 0, 0, 0)";n.fillStyle="rgba(0, 0, 0, 0)";t.strokeStyle="rgba(0, 0, 0, 0)";n.strokeStyle="rgba(0, 0, 0, 0)";t.shadowColor="rgba(0, 0, 0, 0)";n.shadowColor="rgba(0, 0, 0, 0)";return this};u.prototype.setDimensions=function(t){var n,r;if(e.xt(t)&&!this.usePadDimensions){n=t.width||t.actualWidth||this.actualWidth;r=t.height||t.actualHeight||this.actualHeight}else{n=this.getPadWidth();r=this.getPadHeight()}e.canvas[this.name].width=n;e.canvas[this.name].height=r;this.actualWidth=n;this.actualHeight=r;return this};u.prototype.scaleCell=function(t){t=e.isa(t,"obj")?t:{};if(e.isa(t.x,"num")){this.scaleX=t.x}if(e.isa(t.y,"num")){this.scaleY=t.y}if(e.isa(t.scaleX,"num")){this.scaleX=t.scaleX}if(e.isa(t.scaleY,"num")){this.scaleY=t.scaleY}e.context[this.name].scale(this.scaleX,this.scaleY);return this};u.prototype.translateCell=function(t){t=e.isa(t,"obj")?t:{};if(e.isa(t.x,"num")){this.cellX=t.x}if(e.isa(t.y,"num")){this.cellY=t.y}if(e.isa(t.cellX,"num")){this.cellX=t.cellX}if(e.isa(t.cellY,"num")){this.cellY=t.cellY}e.context[this.name].translate(this.cellX,this.cellY);return this};u.prototype.rotateCell=function(t){if(e.isa(t,"num")){var n=(t-this.roll)*e.radian;if(n!==0){e.context[this.name].rotate(n)}this.roll=t}return this};u.prototype.resetRotation=function(){e.context[this.name].rotate(-this.roll*e.radian);this.roll=0;return this};u.prototype.transformCell=function(t,n){t=e.isa(t,"obj")?t:{};var r=e.isa(n,"bool")?n:false;this.scaleX=t.scaleX||this.scaleX;this.scaleY=t.scaleY||this.scaleY;this.shearX=t.shearX||this.shearX;this.shearY=t.shearY||this.shearY;this.cellX=t.cellX||this.cellX;this.cellY=t.cellY||this.cellY;t["roll"]=t.roll||this.roll||0;this.rollDegree=e.isa(t.rollDegree,"bool")?t.rollDegree:this.rollDegree;if(r){this.rotateCell(t.roll);e.context[this.name].setTransform(this.scaleX,this.shearX,this.shearY,this.scaleY,this.cellX,this.cellY)}else{e.context[this.name].setTransform(this.scaleX,this.shearX,this.shearY,this.scaleY,this.cellX,this.cellY);this.rotateCell(t.roll)}return this};u.prototype.saveContext=function(){e.context[this.name].save();return this};u.prototype.restoreContext=function(){e.context[this.name].restore();return this};u.prototype.getImageData=function(t){var n,r,i,s,o;t=e.isa(t,"obj")?t:{};r=e.isa(t.x,"num")?t.x:this.actualX;i=e.isa(t.y,"num")?t.y:this.actualY;s=e.isa(t.width,"num")?t.width:this.actualWidth;o=e.isa(t.height,"num")?t.height:this.actualHeight;n=e.isa(t.name,"str")?this.name+"_"+t.name:this.name+"_imageData";e.imageData[n]=e.context[this.name].getImageData(r,i,s,o);return n};u.prototype.spliceCell=function(t){t=e.isa(t,"obj")?t:{};if(["horizontal","vertical","top","bottom","left","right"].contains(t.edge)){var n,r,i,s,o;var u=e.context[this.name];switch(t.edge){case"horizontal":n=r=this.actualWidth/2;i="left";break;case"vertical":n=r=this.actualHeight/2;i="top";break;case"top":case"bottom":n=t.strip||20;r=this.actualHeight-n;i=t.edge;break;case"left":case"right":n=t.strip||20;r=this.actualWidth-n;i=t.edge;break}switch(i){case"top":s=u.getImageData(0,0,this.actualWidth,n);o=u.getImageData(0,n,this.actualWidth,r);u.clearRect(0,0,this.actualWidth,this.actualHeight);u.putImageData(o,0,0);u.putImageData(s,0,r);break;case"bottom":o=u.getImageData(0,0,this.actualWidth,r);s=u.getImageData(0,r,this.actualWidth,n);u.clearRect(0,0,this.actualWidth,this.actualHeight);u.putImageData(s,0,0);u.putImageData(o,0,n);break;case"left":s=u.getImageData(0,0,n,this.actualHeight);o=u.getImageData(n,0,r,this.actualHeight);u.clearRect(0,0,this.actualWidth,this.actualHeight);u.putImageData(o,0,0);u.putImageData(s,r,0);break;case"right":o=u.getImageData(0,0,r,this.actualHeight);s=u.getImageData(r,0,n,this.actualHeight);u.clearRect(0,0,this.actualWidth,this.actualHeight);u.putImageData(s,0,0);u.putImageData(o,n,0);break}}return this};a.prototype=Object.create(t.prototype);a.prototype.type="Context";a.prototype.classname="ctxnames";a.prototype.getContextFromEngine=function(e){var t=["fillStyle","strokeStyle","globalAlpha","globalCompositeOperation","lineWidth","lineCap","lineJoin","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","font","textAlign","textBaseline"];for(var n=0,r=t.length;n<r;n++){this[t[n]]=e[t[n]]}t.winding=e.mozFillRule||e.msFillRule||"nonzero";t.lineDash=[];t.lineDashOffset=e.mozDashOffset||e.lineDashOffset;return this};a.prototype.getChanges=function(t,n,r){var i={};for(var s in this){if(r&&["lineWidth","shadowOffsetX","shadowOffsetY","shadowBlur"].contains(s)){if(this[s]*n!==t[s]){i[s]=this[s]*n}}else if(["fillStyle","strokeStyle"].contains(s)){if(e.designnames.contains(this[s])){if(e.design[this[s]].type==="Color"&&e.design[this[s]].autoUpdate){e.design[this[s]].update();i[s]=this[s]}else if(["Gradient","RadialGradient"].contains(e.design[this[s]].type)&&(e.design[this[s]].roll||e.design[this[s]].autoUpdate)){e.design[this[s]].update();i[s]=this[s]}else if(this[s]!==t[s]){i[s]=this[s]}}else if(this[s]!==t[s]){i[s]=this[s]}}else{if(this[s]!==t[s]){i[s]=this[s]}}}return i};a.prototype.swapStyles=function(){var e=this.fillStyle;this.fillStyle=this.strokeStyle;this.strokeStyle=e};f.prototype=Object.create(t.prototype);f.prototype.type="Image";f.prototype.classname="imagenames";f.prototype.prepareForExport=function(){var t;return{name:this.name,comment:this.comment!==""?this.comment:t,title:this.title!==""?this.title:t,timestamp:this.timestamp,type:this.type,width:this.width!==0?this.width:t,height:this.height!==0?this.height:t,imageData:e.xt(e.imageData[this.name])?e.imageData[this.name]:t,source:this.source?this.source:t,element:e.xt(e.img[this.name])?e.img[this.name].id:t,copyX:this.copyX!==0?this.copyX:t,copyY:this.copyY!==0?this.copyY:t,copyWidth:this.copyWidth!==0?this.copyWidth:t,copyHeight:this.copyHeight!==0?this.copyHeight:t}};f.prototype.setToDefaults=function(){this.set({comment:"",title:"",width:0,height:0,copyX:0,copyY:0,copyWidth:0,copyHeight:0});return this};f.prototype.getImageData=function(){var t=document.createElement("canvas");t.width=this.width;t.height=this.height;var n=t.getContext("2d");n.drawImage(e.img[this.name],0,0);return t.toDataURL()};l.prototype=Object.create(t.prototype);l.prototype.type="AnimSheet";l.prototype.classname="animnames";l.prototype.prepareForExport=function(){var e;return{name:this.name,comment:this.comment!==""?this.comment:e,title:this.title!==""?this.title:e,timestamp:this.timestamp,type:this.type,sheet:this.sheet?this.sheet:e,frames:this.frames.length>0?this.frames:e,currentFrame:this.currentFrame!==0?this.currentFrame:e,speed:this.speed!==1?this.speed:e,loop:this.loop!=="end"?this.loop:e,running:this.running!=="complete"?this.running:e,lastCalled:this.lastCalled?this.lastCalled:e}};l.prototype.setToDefaults=function(){this.set({comment:"",title:"",sheet:false,frames:[],currentFrame:0,speed:1,loop:"end",running:"complete",lastCalled:false});return this};l.prototype.set=function(n){n=e.isa(n,"obj")?n:{};var r=this.loop==="pause"?true:false;t.prototype.set.call(this,n);if(e.xt(n.running)){switch(n.running){case"forward":this.running="forward";if(!r){this.currentFrame=0}break;case"backward":this.running="backward";if(!r){this.currentFrame=this.frames.length-1}break;default:this.running="complete";this.currentFrame=0;break}}};l.prototype.getData=function(){if(this.speed>0){var e=this.frames[this.currentFrame].d/this.speed;var t=this.lastCalled+e<Date.now()?true:false;switch(this.running){case"complete":this.lastCalled=Date.now();break;case"forward":if(t){switch(this.loop){case"pause":break;case"end":this.running=this.currentFrame+1>=this.frames.length?"complete":this.running;this.currentFrame=this.currentFrame+1>=this.frames.length?this.currentFrame:this.currentFrame+1;break;case"loop":this.currentFrame=this.currentFrame+1>=this.frames.length?0:this.currentFrame+1;break;case"reverse":this.running=this.currentFrame+1>=this.frames.length?"backward":"forward";this.currentFrame=this.currentFrame+1>=this.frames.length?this.currentFrame:this.currentFrame+1;break}this.lastCalled=Date.now()}break;case"backward":if(t){switch(this.loop){case"pause":break;case"end":this.running=this.currentFrame-1<=0?"complete":this.running;this.currentFrame=this.currentFrame-1<=0?this.currentFrame:this.currentFrame-1;break;case"loop":this.currentFrame=this.currentFrame-1<=0?this.frames.length-1:this.currentFrame-1;break;case"reverse":this.running=this.currentFrame-1<=0?"forward":"backward";this.currentFrame=this.currentFrame-1<=0?this.currentFrame:this.currentFrame-1;break}this.lastCalled=Date.now()}break}}return{copyX:this.frames[this.currentFrame].x,copyY:this.frames[this.currentFrame].y,copyWidth:this.frames[this.currentFrame].w,copyHeight:this.frames[this.currentFrame].h}};c.prototype=Object.create(n.prototype);c.prototype.type="Group";c.prototype.classname="groupnames";c.prototype.exportNative=function(t){t=e.xt(t)?t:{string:true};var n={includeDesigns:t.includeDesigns||true,includeImages:t.includeImages||false,string:false};var r=[],i;r.push(this.prepareForExport());for(var s=0,o=this.groups.length;s<o;s++){if(this.groups[s]!==this.name){i=e.group[this.groups[s]].exportNative(n);for(var u=0,a=i.length;u<a;u++){r.pushUnique(i[u])}}}for(var s=0,o=this.sprites.length;s<o;s++){i=e.sprite[this.sprites[s]].exportNative(n);for(var u=0,a=i.length;u<a;u++){r.pushUnique(i[u])}}var f=[];var l=[];for(var s=0,o=r.length;s<o;s++){if(!l.contains(r[s].name)){f.push(r[s]);l.push(r[s].name)}}return t.string?JSON.stringify(f):f};c.prototype.prepareForExport=function(){var e;return{name:this.name,comment:this.comment!==""?this.comment:e,title:this.title!==""?this.title:e,timestamp:this.timestamp,type:this.type,startX:this.startX!==0?this.startX:e,startY:this.startY!==0?this.startY:e,handleX:this.handleX!==0?this.handleX:e,handleY:this.handleY!==0?this.handleY:e,moveStartX:this.moveStartX!==0?this.moveStartX:e,moveStartY:this.moveStartY!==0?this.moveStartY:e,moveHandleX:this.moveHandleX!==0?this.moveHandleX:e,moveHandleY:this.moveHandleY!==0?this.moveHandleY:e,pivot:this.pivot?this.pivot:e,path:this.path?this.path:e,pathPosition:this.pathPosition!==0?this.pathPosition:e,movePathPosition:this.movePathPosition!==0?this.movePathPosition:e,pathSpeedConstant:!this.pathSpeedConstant?this.pathSpeedConstant:e,pathRoll:this.pathRoll!==0?this.pathRoll:e,addPathRoll:this.addPathRoll?this.addPathRoll:e,scale:this.scale!==1?this.scale:e,groups:this.groups.length>0?this.groups:e,cells:this.cells.length>0?this.cells:e,order:this.order!==0?this.order:e,visibility:!this.visibility?this.visibility:e,isSprite:this.isSprite?this.isSprite:e,isMarker:this.isMarker?this.isMarker:e,isDefinition:this.isDefinition?this.isDefinition:e,method:this.method?this.method:e,fieldTest:this.fieldTest!==0?this.fieldTest:e,fieldChannel:this.fieldChannel!=="anycolor"?this.fieldChannel:e,roll:this.roll!==0?this.roll:e}};c.prototype.setToDefaults=function(){this.set({comment:"",title:"",startX:0,startY:0,handleX:0,handleY:0,moveStartX:0,moveStartY:0,moveHandleX:0,moveHandleY:0,pivot:false,path:false,pathPosition:0,movePathPosition:0,pathSpeedConstant:true,pathRoll:0,addPathRoll:false,scale:1,groups:[],cells:[],order:0,visibility:true,isSprite:false,isMarker:false,isDefinition:false,fieldTest:0,fieldChannel:"anycolor",roll:0});return this};c.prototype.sortSprites=function(){this.sprites.sort(function(t,n){return e.sprite[t].order-e.sprite[n].order})};c.prototype.sortGroups=function(){this.groups.sort(function(t,n){return e.group[t].order-e.group[n].order})};c.prototype.getOverride=function(t,n,r){n=e.xt(n)?n:this.method;r=e.xt(r)?r:this.cells;if(!e.xt(t)||e.sprite[t].pivot!==this.name){return{x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale,method:n,cells:r}}else{return{x:0,y:0,r:this.roll,s:this.scale,method:n,cells:r}}};c.prototype.forceStamp=function(e,t){var n=this.visibility;this.visibility=true;this.stamp(e,t);this.visibility=n;return this};c.prototype.stamp=function(t,n){this.sortSprites();var r=e.isa(t,"str")?t:this.method;var i=e.xt(n)?[].concat(n):this.cells;for(var s=0,o=this.sprites.length;s<o;s++){e.sprite[this.sprites[s]].stamp(this.getOverride(this.sprites[s],r,i))}if(this.groups.length>0){this.sortGroups();for(var s=0,o=this.groups.length;s<o;s++){if(e.group[this.groups[s]].name!==this.name){e.group[this.groups[s]].forceStamp(t,n)}}}return this};c.prototype.getSpriteAt=function(t){this.sortSprites();t=e.isa(t,"obj")?t:{};if(e.xta([t.x,t.y])){t.pad=e.xt(t.pad)?t.pad:e.pad[e.cell[this.cells[0]].pad].name;for(var n=this.sprites.length-1;n>=0;n--){if(e.sprite[this.sprites[n]].checkHit(t,{x:this.getStartX(),y:this.getStartY()})){return e.sprite[this.sprites[n]]}}}return false};c.prototype.getInGroupSpriteHits=function(){var t=[],n;var r={x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale};var i={x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale,pad:e.pad[e.cell[this.cells[0]].pad].name};for(var s=0,o=this.sprites.length;s<o;s++){if(e.sprite[this.sprites[s]].visibility){for(var u=s+1,a=this.sprites.length;u<a;u++){if(e.sprite[this.sprites[u]].visibility){n=false;if(e.sprite[this.sprites[u]].checkHit({tests:e.sprite[this.sprites[s]].getCollisionPoints(r)},i)){t.push([this.sprites[s],this.sprites[u]]);n=true;break}if(!n){if(e.sprite[this.sprites[s]].checkHit({tests:e.sprite[this.sprites[u]].getCollisionPoints(r)},i)){t.push([this.sprites[s],this.sprites[u]]);break}}}}}}return t};c.prototype.getBetweenGroupSpriteHits=function(t){if(e.xt(t)){if(e.isa(t,"str")){if(e.groupnames.contains(t)){t=e.group[t]}else{return false}}else{if(!e.xt(t.type)||t.type!=="Group"){return false}}var n=[],r;var i={x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale,pad:e.pad[e.cell[this.cells[0]].pad].name};var s={x:t.getStartX(),y:t.getStartY(),r:this.roll,s:this.scale,pad:e.pad[e.cell[t.cells[0]].pad].name};for(var o=0,u=this.sprites.length;o<u;o++){if(e.sprite[this.sprites[o]].visibility){for(var a=0,f=t.sprites.length;a<f;a++){if(e.sprite[t.sprites[a]].visibility){r=false;if(e.sprite[t.sprites[a]].checkHit({tests:e.sprite[this.sprites[o]].getCollisionPoints(i)},s)){n.push([this.sprites[o],t.sprites[a]]);r=true}if(!r){if(e.sprite[this.sprites[o]].checkHit({tests:e.sprite[t.sprites[a]].getCollisionPoints(s)},i)){n.push([this.sprites[o],t.sprites[a]])}}}}}}return n}return false};c.prototype.getFieldSpriteHits=function(t){var n={},r,i;t=e.xt(t)?[].concat(t):[this.cells[0]];var s={x:this.getStartX(),y:this.getStartY(),r:this.roll,s:this.scale};for(var o=0,u=t.length;o<u;o++){r=[];for(var a=0,f=this.sprites.length;a<f;a++){i=e.sprite[this.sprites[a]].checkField(t[o],s);if(e.isa(i,"obj")){r.push([this.sprites[a],i])}}n[t[o]]=r}return t.length===1?n[t[0]]:n};c.prototype.checkField=function(t){var n=e.xt(t)&&e.cellnames.contains(t)?e.cell[t]:e.cell[this.cells[0]]||e.cell[e.pad[e.currentPad].current];var r={x:this.startX,y:this.startY};var i=n.checkFieldAt({coordinates:[r],test:this.fieldTest,channel:this.fieldChannel});return i>0?r:i?true:false};c.prototype.setDelta=function(t){t=e.isa(t,"obj")?t:{};if(e.xt(t.startX)){this.startX+=t.startX}if(e.xt(t.startY)){this.startY+=t.startY}if(e.xt(t.handleX)){this.handleX+=t.handleX}if(e.xt(t.handleY)){this.handleY+=t.handleY}if(e.xt(t.roll)){this.roll+=t.roll}if(e.xt(t.scale)){this.scale+=t.scale}if(e.xt(t.pathPosition)){this.pathPosition+=t.pathPosition}return this};c.prototype.addSpritesToGroup=function(t){t=e.xt(t)?[].concat(t):[];for(var n=0,r=t.length;n<r;n++){this.sprites.pushUnique(t[n])}return this};c.prototype.removeSpritesFromGroup=function(t){t=e.xt(t)?[].concat(t):[];for(var n=0,r=t.length;n<r;n++){this.sprites.removeItem(t[n])}return this};c.prototype.moveSpriteStart=function(t){for(var n=0,r=this.sprites.length;n<r;n++){e.sprite[this.sprites[n]].moveStart(t)}return this};c.prototype.setGroupDimensions=function(t){t=e.xt(t)?t:{x:this.startX,y:this.startY};var n=-9999,r=9999,i=-9999,s=9999,o,u,a,f,l,c,h;for(var p=0,d=this.groups.length;p<v;p++){l=e.group[this.groups[p]];if(!l.isMarker&&!l.isDefinition){l.setGroupDimensions();n=l.startX+l.width>n?l.startX+l.width:n;r=l.startX<r?l.startX:r;i=l.startY+l.height>i?l.startY+l.height:i;s=l.startY<s?l.startY:s}}for(var p=0,v=this.sprites.length;p<v;p++){l=e.sprite[this.sprites[p]];if(!l.pivot||!l.path){switch(l.type){case"Block":case"Outline":case"Picture":case"Phrase":o=l.startX+l.width*l.scale;u=l.startX;a=l.startY+l.height*l.scale;f=l.startY;break;case"Wheel":o=l.startX+l.radius*l.scale;u=l.startX-l.radius*l.scale;a=l.startY+l.radius*l.scale;f=l.startY-l.radius*l.scale;break;case"Shape":o=-9999,a=-9999,u=9999,f=9999;for(var m=0,g=l.pointList.length;m<g;m++){c=e.point[l.pointList[m]].currentX;h=e.point[l.pointList[m]].currentY;o=c>o?c:o;u=c<u?c:u;a=h>a?h:a;f=h<f?h:f}break}n=o>n?o:n;r=u<r?u:r;i=a>i?a:i;s=f<s?f:s}}this.startX=t.x||r;this.startY=t.y||s;this.width=n-r;this.height=i-s;this.setSpritesToGroupHandle();return this};c.prototype.setSpritesToGroupHandle=function(){var t=this.getPivotOffset(this.handleX,false);var n=this.getPivotOffset(this.handleY,true);var r,i,s;for(var o=0,u=this.sprites.length;o<u;o++){r=e.sprite[this.sprites[o]];if(e.spritenames.contains(r.name)&&r.pivot===this.name){i=r.getPivotOffset(r.handleX,false);s=r.getPivotOffset(r.handleY,true);r.set({handleX:i+t,handleY:s+n})}}return this};h.prototype=Object.create(n.prototype);h.prototype.type="Sprite";h.prototype.classname="spritenames";h.prototype.targetGroup=function(t){this.pivot=this.group;this.handleX=e.group[this.group].startX-this.startX;this.handleY=e.group[this.group].startY-this.startY;return this};h.prototype.exportNative=function(t){t=e.xt(t)?t:{includeDesigns:true,includeImages:false,string:true};var n=[];if(t.includeDesigns){var r=t.designs||[];if(e.xt(this.context)&&e.designnames.contains(e.ctx[this.context].fillStyle)&&!r.contains(e.ctx[this.context].fillStyle)){n.push(e.design[e.ctx[this.context].fillStyle].prepareForExport());r.push(e.ctx[this.context].fillStyle)}if(e.xt(this.context)&&e.designnames.contains(e.ctx[this.context].strokeStyle)&&!r.contains(e.ctx[this.context].strokeStyle)){n.push(e.design[e.ctx[this.context].strokeStyle].prepareForExport());r.push(e.ctx[this.context].strokeStyle)}}if(t.includeImages){if(e.xt(this.imageData)&&this.imageData&&e.xt(e.imageData[this.imageData])){n.push(e.imageData[this.imageData])}}if(e.xt(this.animSheet)&&this.animSheet&&e.animnames.contains(this.animSheet)){n.push(e.anim[this.animSheet].prepareForExport())}n.push(this.prepareForExport());return t.string?JSON.stringify(n):n};h.prototype.prepareForExport=function(){var t;return{name:this.name,comment:this.comment!==""?this.comment:t,title:this.title!==""?this.title:t,timestamp:this.timestamp,type:this.type,startX:this.startX!==0?this.startX:t,startY:this.startY!==0?this.startY:t,handleX:this.handleX!==0?this.handleX:t,handleY:this.handleY!==0?this.handleY:t,moveStartX:this.moveStartX!==0?this.moveStartX:t,moveStartY:this.moveStartY!==0?this.moveStartY:t,moveHandleX:this.moveHandleX!==0?this.moveHandleX:t,moveHandleY:this.moveHandleY!==0?this.moveHandleY:t,pivot:this.pivot?this.pivot:t,path:this.path?this.path:t,pathPosition:this.pathPosition!==0?this.pathPosition:t,movePathPosition:this.movePathPosition!==0?this.movePathPosition:t,pathSpeedConstant:!this.pathSpeedConstant?this.pathSpeedConstant:t,pathRoll:this.pathRoll!==0?this.pathRoll:t,addPathRoll:this.addPathRoll?this.addPathRoll:t,scale:this.scale!==1?this.scale:t,order:this.order!==0?this.order:t,visibility:!this.visibility?this.visibility:t,method:this.method,collisionPoints:e.xt(this.collisionPoints)&&this.collisionPoints.length>0?this.collisionPoints:t,rollable:!this.rollable?this.rollable:t,roll:this.roll!==0?this.roll:t,data:this.data?this.data:t,flipReverse:this.flipReverse?this.flipReverse:t,flipUpend:this.flipUpend?this.flipUpend:t,scaleOutline:!this.scaleOutline?this.scaleOutline:t,group:this.group,fieldChannel:this.fieldChannel!=="anycolor"?this.fieldChannel:t,fieldTest:this.fieldTest!==0?this.fieldTest:t,text:e.xt(this.text)&&this.text!==""?this.text:t,style:e.xt(this.style)&&this.style!=="normal"?this.style:t,variant:e.xt(this.variant)&&this.variant!=="normal"?this.variant:t,weight:e.xt(this.weight)&&this.weight!=="normal"?this.weight:t,size:e.xt(this.size)&&this.size!==12?this.size:t,metrics:e.xt(this.metrics)&&this.metrics!=="pt"?this.metrics:t,family:e.xt(this.family)&&this.family!=="sans-serif"?this.family:t,lineHeight:e.xt(this.lineHeight)&&this.lineHeight!==1.5?this.lineHeight:t,backgroundColor:e.xt(this.backgroundColor)&&this.backgroundColor?this.backgroundColor:t,backgroundMargin:e.xt(this.backgroundMargin)&&this.backgroundMargin!==0?this.backgroundMargin:t,textAlongPath:e.xt(this.textAlongPath)&&this.textAlongPath!=="phrase"?this.textAlongPath:t,fixedWidth:e.xt(this.fixedWidth)&&this.fixedWidth?this.fixedWidth:t,width:e.xt(this.width)&&this.width!==0?this.width:t,height:e.xt(this.height)&&this.height!==0?this.height:t,radius:e.xt(this.radius)&&this.radius!==0?this.radius:t,startAngle:e.xt(this.startAngle)&&this.startAngle!==0?this.startAngle:t,endAngle:e.xt(this.endAngle)&&this.endAngle!==360?this.endAngle:t,clockwise:e.xt(this.clockwise)&&this.clockwise?this.clockwise:t,closed:e.xt(this.closed)?this.closed:t,includeCenter:e.xt(this.includeCenter)&&this.includeCenter?this.includeCenter:t,checkHitUsingRadius:e.xt(this.checkHitUsingRadius)&&!this.checkHitUsingRadius?this.checkHitUsingRadius:t,source:e.xt(this.source)&&this.source?this.source:t,imageData:e.xt(this.imageData)&&this.imageData?this.imageData:t,imageDataChannel:e.xt(this.imageDataChannel)&&this.imageDataChannel!=="alpha"?this.imageDataChannel:t,animSheet:e.xt(this.animSheet)&&this.animSheet?this.animSheet:t,imageType:e.xt(this.imageType)&&this.imageType?this.imageType:t,checkHitUsingImageData:e.xt(this.checkHitUsingImageData)&&this.checkHitUsingImageData?this.checkHitUsingImageData:t,copyX:e.xt(this.copyX)?this.copyX:t,copyY:e.xt(this.copyY)?this.copyY:t,copyWidth:e.xt(this.copyWidth)?this.copyWidth:t,copyHeight:e.xt(this.copyHeight)?this.copyHeight:t,firstPoint:e.xt(this.firstPoint)&&this.firstPoint?this.firstPoint:t,line:e.xt(this.line)&&this.line?this.line:t,linkDurations:e.xt(this.linkDurations)&&this.linkDurations.length>0?this.linkDurations:t,markStart:e.xt(this.markStart)&&this.markStart?this.markStart:t,markMid:e.xt(this.markMid)&&this.markMid?this.markMid:t,markEnd:e.xt(this.markEnd)&&this.markEnd?this.markEnd:t,fillStyle:e.ctx[this.context].fillStyle!=="#000000"?e.ctx[this.context].fillStyle:t,winding:e.ctx[this.context].winding!=="nonzero"?e.ctx[this.context].winding:t,strokeStyle:e.ctx[this.context].strokeStyle!=="#000000"?e.ctx[this.context].strokeStyle:t,globalAlpha:e.ctx[this.context].globalAlpha!==1?e.ctx[this.context].globalAlpha:t,globalCompositeOperation:e.ctx[this.context].globalCompositeOperation!=="source-over"?e.ctx[this.context].globalCompositeOperation:t,lineWidth:e.ctx[this.context].lineWidth!==1?e.ctx[this.context].lineWidth:t,lineCap:e.ctx[this.context].lineCap!=="butt"?e.ctx[this.context].lineCap:t,lineJoin:e.ctx[this.context].lineJoin!=="miter"?e.ctx[this.context].lineJoin:t,lineDash:e.ctx[this.context].lineDash.length>0?e.ctx[this.context].lineDash:t,lineDashOffset:e.ctx[this.context].lineDashOffset!==0?e.ctx[this.context].lineDashOffset:t,miterLimit:e.ctx[this.context].miterLimit!==10?e.ctx[this.context].miterLimit:t,shadowOffsetX:e.ctx[this.context].shadowOffsetX!==0?e.ctx[this.context].shadowOffsetX:t,shadowOffsetY:e.ctx[this.context].shadowOffsetY!==0?e.ctx[this.context].shadowOffsetY:t,shadowBlur:e.ctx[this.context].shadowBlur!==0?e.ctx[this.context].shadowBlur:t,shadowColor:e.ctx[this.context].shadowColor!=="rgba(0,0,0,0)"?e.ctx[this.context].shadowColor:t,font:e.ctx[this.context].font!=="10pt sans-serif"?e.ctx[this.context].font:t,textAlign:e.ctx[this.context].textAlign!=="start"?e.ctx[this.context].textAlign:t,textBaseline:e.ctx[this.context].textBaseline!=="alphabetic"?e.ctx[this.context].textBaseline:t}};h.prototype.setToDefaults=function(){var t;this.set({comment:"",title:"",startX:0,startY:0,handleX:0,handleY:0,moveStartX:0,moveStartY:0,moveHandleX:0,moveHandleY:0,pivot:false,path:false,pathPosition:0,movePathPosition:0,pathSpeedConstant:true,pathRoll:0,addPathRoll:false,scale:1,order:0,visibility:true,collisionPoints:[],rollable:true,roll:0,data:false,flipReverse:false,flipUpend:false,scaleOutline:true,group:false,fieldChannel:"anycolor",fieldTest:0,text:e.xt(this.text)?"":t,style:e.xt(this.style)?"normal":t,variant:e.xt(this.variant)?"normal":t,weight:e.xt(this.weight)?"normal":t,size:e.xt(this.size)?12:t,metrics:e.xt(this.metrics)?"pt":t,family:e.xt(this.family)?"sans-serif":t,lineHeight:e.xt(this.lineHeight)?1.5:t,backgroundColor:e.xt(this.backgroundColor)?false:t,backgroundMargin:e.xt(this.backgroundMargin)?0:t,textAlongPath:e.xt(this.textAlongPath)?"phrase":t,fixedWidth:e.xt(this.fixedWidth)?false:t,width:e.xt(this.width)?0:t,height:e.xt(this.height)?0:t,radius:e.xt(this.radius)?0:t,startAngle:e.xt(this.startAngle)?0:t,endAngle:e.xt(this.endAngle)?360:t,clockwise:e.xt(this.clockwise)?false:t,closed:e.xt(this.closed)?false:t,includeCenter:e.xt(this.includeCenter)?false:t,checkHitUsingRadius:e.xt(this.checkHitUsingRadius)?true:t,imageData:e.xt(this.imageData)?false:t,imageDataChannel:e.xt(this.imageDataChannel)?"alpha":t,animSheet:e.xt(this.animSheet)?false:t,checkHitUsingImageData:e.xt(this.checkHitUsingImageData)?false:t,copyX:e.xt(this.copyX)?false:t,copyY:e.xt(this.copyY)?false:t,copyWidth:e.xt(this.copyWidth)?false:t,copyHeight:e.xt(this.copyHeight)?false:t,firstPoint:e.xt(this.firstPoint)?false:t,line:e.xt(this.line)?false:t,markStart:e.xt(this.markStart)?false:t,markMid:e.xt(this.markMid)?false:t,markEnd:e.xt(this.markEnd)?false:t,fillStyle:"#000000",winding:"nonzero",strokeStyle:"#000000",globalAlpha:1,globalCompositeOperation:"source-over",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",font:"10pt sans-serif",textAlign:"start",textBaseline:"alphabetic"});return this};h.prototype.pickupSprite=function(t){t=e.isa(t,"obj")?t:{};if(e.xta([t.x,t.y])){this.mouseX=t.x||0;this.mouseY=t.y||0;this.realPivot=this.pivot;this.pivot="mouse";this.order+=9999}return this};h.prototype.dropSprite=function(e){this.pivot=e||this.realPivot||false;this.order-=this.order>=9999?9999:0;delete this.realPivot;delete this.mouseX;delete this.mouseY;return this};h.prototype.clone=function(n){n=e.isa(n,"obj")?n:{};var r=t.prototype.clone.call(this,n);var i=e.ctx[r.context];var s=JSON.parse(JSON.stringify(e.ctx[this.context]));delete s.name;i.set(s);delete n.name;i.set(n);if(e.designnames.contains(i.fillStyle)){if(e.design[i.fillStyle].type!=="Pattern"){var o=e.design[i.fillStyle].clone();i.fillStyle=o.name}else{i.fillStyle=n.fillStyle||e.ctx[this.context].fillStyle}}if(e.designnames.contains(i.strokeStyle)){if(e.design[i.fillStyle].type!=="Pattern"){var u=e.design[i.strokeStyle].clone();i.strokeStyle=u.name}else{i.strokeStyle=n.strokeStyle||e.ctx[this.context].strokeStyle}}if(n.field){r.addSpriteToCellFields()}if(n.fence){r.addSpriteToCellFences()}if(n.group||n.target){e.group[this.group].removeSpritesFromGroup(r.name);r.group=this.getGroup(n);e.group[r.group].addSpritesToGroup(r.name);if(e.xt(n.target)){r.targetGroup(n)}}return r};h.prototype.addSpriteToCellFields=function(t){var t=e.xt(t)?[].concat(t):[e.pad[e.currentPad].current];for(var n=0,r=t.length;n<r;n++){if(e.cellnames.contains(t[n])){e.group[t[n]+"_field"].addSpritesToGroup(this.name)}}return this};h.prototype.addSpriteToCellFences=function(t){t=e.xt(t)?[].concat(t):[e.pad[e.currentPad].current];for(var n=0,r=t.length;n<r;n++){if(e.cellnames.contains(t[n])){e.group[t[n]+"_fence"].addSpritesToGroup(this.name)}}return this};h.prototype.removeSpriteFromCellFields=function(t){t=e.xt(t)?[].concat(t):[e.pad[e.currentPad].current];for(var n=0,r=t.length;n<r;n++){if(e.cellnames.contains(t[n])){e.group[t[n]+"_field"].removeSpritesFromGroup(this.name)}}return this};h.prototype.removeSpriteFromCellFences=function(t){t=e.xt(t)?[].concat(t):[e.pad[e.currentPad].current];for(var n=0,r=t.length;n<r;n++){if(e.cellnames.contains(t[n])){e.group[t[n]+"_fence"].removeSpritesFromGroup(this.name)}}return this};h.prototype.set=function(n){t.prototype.set.call(this,n);e.ctx[this.context].set(n);n=e.isa(n,"obj")?n:{};if(e.xt(n.collisionPoints)){this.collisionPoints=this.parseCollisionPoints(n.collisionPoints)}if(e.xt(n.field)){this.addSpriteToCellFields()}if(e.xt(n.fence)){this.addSpriteToCellFences()}if(e.xto([n.startX,n.handleX,n.startY,n.handleY])){this.setCurrentParameters()}if(e.xto([n.group,n.target])){e.group[this.group].removeSpritesFromGroup(this.name);this.group=this.getGroup(n);e.group[this.group].addSpritesToGroup(this.name);if(e.xt(n.target)){this.targetGroup(n)}}return this};h.prototype.get=function(t){if(["globalAlpha","globalCompositeOperation","lineWidth","lineCap","lineJoin","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","font","textAlign","textBaseline","winding","lineDash","lineDashOffset","fillStyle","strokeStyle"].contains(t)){return e.ctx[this.context].get(t)}else{return this[t]}};h.prototype.swap=function(){e.ctx[this.context].swapStyles();return this};h.prototype.getGroup=function(t){t=e.isa(t,"obj")?t:{};if(e.xt(t.target)&&e.groupnames.contains(t.target)){return t.target}else if(e.xt(t.group)&&e.groupnames.contains(t.group)){return t.group}else{return e.pad[e.currentPad].current}};h.prototype.forceStamp=function(e,t){var n=this.visibility;this.visibility=true;this.stamp(e,t);this.visibility=n;return this};h.prototype.prepareStamp=function(t){t=e.xt(t)?t:{x:0,y:0};return{x:this.flipReverse?this.currentX-t.x*2:this.currentX,y:this.flipUpend?this.currentY-t.y*2:this.currentY}};h.prototype.prepareItemForStamp=function(t,n){var r;if(e.xt(t)){r=e.isa(t,"str")?e.group[this.group].getOverride(this.name,t):t}else{r=e.group[this.group].getOverride(this.name,this.method)}if(e.xt(n)&&e.cellnames.contains(n)){r.cells=[n]}return r};h.prototype.setStampUsingPivot=function(t,n){var r,i;if(e.pointnames.contains(this.pivot)){this.startX=e.point[this.pivot].currentX;this.startY=e.point[this.pivot].currentY}else if(e.spritenames.contains(this.pivot)){this.startX=e.sprite[this.pivot].startX;this.startY=e.sprite[this.pivot].startY}else if(this.pivot==="mouse"){i=e.cell[n];r=e.pad[i.pad].getMouse();if(!e.xta([this.mouseX,this.mouseY])){this.mouseX=this.startX;this.mouseY=this.startY}if(r.active){this.startX+=r.x-this.mouseX;this.startY+=r.y-this.mouseY;this.mouseX=r.x;this.mouseY=r.y}}else if(e.groupnames.contains(this.pivot)){this.startX=e.group[this.pivot].startX;this.startY=e.group[this.pivot].startY}return this};h.prototype.setCurrentParameters=function(t){t=e.xt(t)?t:{x:0,y:0,r:0,s:1};this.currentScale=this.scale*t.s;this.currentX=this.getStartX(t);this.currentY=this.getStartY(t);this.currentWidth=this.width*this.currentScale;this.currentHeight=this.height*this.currentScale;if(e.xt(this.radius)){this.currentRadius=this.radius*this.currentScale}this.currentRoll=this.roll+t.r;return this};h.prototype.stamp=function(t,n){if(this.visibility){var r,i,s,o;var u=this.prepareItemForStamp(t,n);o=u.method||this.method;for(var a=0,f=u.cells.length;a<f;a++){r=e.cell[u.cells[a]];i=e.context[r.name];s=e.cell[u.cells[a]].name;var l;if(this.pivot){this.setStampUsingPivot(u,s)}else if(e.spritenames.contains(this.path)&&e.sprite[this.path].type==="Shape"){l=e.sprite[this.path].getPerimeterPosition(this.pathPosition,this.pathSpeedConstant,this.addPathRoll);this.startX=l.x;this.startY=l.y;this.pathRoll=l.r||0}this.setCurrentParameters(u);this.callMethod(i,s,u,o)}}return this};h.prototype.flipCanvas=function(t,n){var r=e.cell[n];var i=r.actualWidth,s=r.actualHeight;if(this.flipReverse&&this.flipUpend){t.translate(i,s);t.scale(-1,-1);this.currentX=i-this.currentX;this.currentY=s-this.currentY}else if(this.flipReverse){t.translate(i,0);t.scale(-1,1);this.currentX=i-this.currentX}else if(this.flipUpend){t.translate(0,s);t.scale(1,-1);this.currentY=s-this.currentY}return this};h.prototype.callMethod=function(e,t,n,r){this.flipCanvas(e,t);switch(r){case"clear":this.clear(e,t,n);break;case"clearWithBackground":this.clearWithBackground(e,t,n);break;case"draw":this.draw(e,t,n);break;case"fill":this.fill(e,t,n);break;case"drawFill":this.drawFill(e,t,n);break;case"fillDraw":this.fillDraw(e,t,n);break;case"sinkInto":this.sinkInto(e,t,n);break;case"floatOver":this.floatOver(e,t,n);break;case"clip":this.clip(e,t,n);break;case"none":this.none(e,t,n);break}this.flipCanvas(e,t);return this};h.prototype.rotateCell=function(t,n,r){if(e.xta([t,n])&&(this.rollable||this.addPathRoll)){if(this.currentRoll!==e.cell[n].roll||this.currentRoll+this.pathRoll!==e.cell[n].roll){var i=this.addPathRoll?(this.currentRoll+this.pathRoll-e.cell[n].roll)*e.radian:(this.currentRoll-e.cell[n].roll)*e.radian;this.completeRotation(t,n,r,i)}}return this};h.prototype.getRotationPoint=function(t,n){var r,i,s,o;t=e.xt(t)?t:{x:0,y:0};if(this.flipReverse){s=this.currentX+this.getPivotOffset(this.handleX)*this.currentScale-t.x*2}else{s=this.currentX+this.getPivotOffset(this.handleX)*this.currentScale}if(this.flipUpend){o=this.currentY+this.getPivotOffset(this.handleY,true)*this.currentScale-t.y*2}else{o=this.currentY+this.getPivotOffset(this.handleY,true)*this.currentScale}return{x:s,y:o}};h.prototype.completeRotation=function(e,t,n,r){var i=this.getRotationPoint(n,t);e.translate(i.x,i.y);e.rotate(r);e.translate(-i.x,-i.y);return this};h.prototype.unrotateCell=function(t,n,r){if(e.xta([t,n])&&(this.rollable||this.addPathRoll)){if(this.currentRoll!==e.cell[n].roll||this.currentRoll+this.pathRoll!==e.cell[n].roll){var i=this.addPathRoll?(e.cell[n].roll-(this.currentRoll+this.pathRoll))*e.radian:(e.cell[n].roll-this.currentRoll)*e.radian;this.completeRotation(t,n,r,i)}}return this};h.prototype.clear=function(e,t,n){return this};h.prototype.clearWithBackground=function(e,t,n){return this};h.prototype.draw=function(e,t,n){return this};h.prototype.fill=function(e,t,n){return this};h.prototype.drawFill=function(e,t,n){return this};h.prototype.fillDraw=function(e,t,n){return this};h.prototype.sinkInto=function(e,t,n){return this};h.prototype.floatOver=function(e,t,n){return this};h.prototype.clip=function(e,t,n){return this};h.prototype.none=function(e,t,n){return this};h.prototype.setDelta=function(t){t=e.isa(t,"obj")?t:{};if(e.xt(t.startX)){this.startX+=t.startX}if(e.xt(t.startY)){this.startY+=t.startY}if(e.xt(t.handleX)){this.handleX+=t.handleX}if(e.xt(t.handleY)){this.handleY+=t.handleY}if(e.xt(t.width)){this.width+=t.width}if(e.xt(t.height)){this.height+=t.height}if(e.xt(t.radius)){this.radius+=t.radius}if(e.xt(t.scale)){this.scale+=t.scale}if(e.xt(t.roll)){this.roll+=t.roll}if(e.xt(t.startAngle)){this.startAngle+=t.startAngle}if(e.xt(t.endAngle)){this.endAngle+=t.endAngle}if(e.xt(t.copyX)){this.copyX+=t.copyX}if(e.xt(t.copyY)){this.copyY+=t.copyY}if(e.xt(t.copyWidth)){this.copyWidth+=t.copyWidth}if(e.xt(t.copyHeight)){this.copyHeight+=t.copyHeight}if(e.xt(t.pathPosition)){this.pathPosition+=t.pathPosition}if(e.xt(t.lineDashOffset)){e.ctx[this.context].lineDashOffset+=t.lineDashOffset}return this};h.prototype.getAngle=function(t){return this.addPathRoll?(t+this.currentRoll+this.pathRoll)*e.radian:(t+this.currentRoll)*e.radian};h.prototype.checkHit=function(t,n){var r=e.pad[t.pad]||e.pad[n.pad];var i=e.cell[r.current].name;var s=e.context[r.current];var o=e.xt(t.tests)?t.tests:[{x:t.x||false,y:t.y||false}];this.flipCanvas(s,i);this.rotateCell(s,i,n);var u=this.prepareStamp(n);s.beginPath();s.rect(u.x,u.y,this.currentWidth,this.currentHeight);var a=false;for(var f=0,l=o.length;f<l;f++){a=s.isPointInPath(o[f].x,o[f].y);if(a){break}}this.unrotateCell(s,i,n);this.flipCanvas(s,i);return a?o[f]:false};h.prototype.checkField=function(t,n){var r=e.xt(t)&&e.cellnames.contains(t)?e.cell[t]:e.cell[e.group[this.group].cells[0]]||e.cell[e.pad[e.currentPad].current];var i=this.getCollisionPoints(n);var s=r.checkFieldAt({coordinates:i,test:this.fieldTest,channel:this.fieldChannel});return s>0?i[s-1]:s?true:false};h.prototype.clearShadow=function(t,n){e.cell[n].clearShadow()};h.prototype.restoreShadow=function(t,n){e.cell[n].restoreShadow(this.context)};h.prototype.getCollisionPoints=function(t){t=e.xt(t)?t:{x:0,y:0};var n=[],r,i,s,o,u;var a=this.flipReverse?-(this.startX-this.currentX-(t.x||0)):this.startX-this.currentX+(t.x||0);var f=this.flipUpend?-(this.startY-this.currentY-(t.y||0)):this.startY-this.currentY+(t.y||0);s=this.currentRoll*e.radian;o=this.flipReverse?this.startX+(t.x||0):this.startX+(t.x||0);u=this.flipUpend?this.startY+(t.y||0):this.startY+(t.y||0);for(var l=0,c=this.collisionPoints.length;l<c;l++){switch(this.collisionPoints[l]){case"start":n.push({x:this.currentX,y:this.currentY});break;case"N":i=this.currentWidth/2-a;r=0-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;case"NE":i=this.currentWidth-a;r=0-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;case"E":i=this.currentWidth-a;r=this.currentHeight/2-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;case"SE":i=this.currentWidth-a;r=this.currentHeight-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;case"S":i=this.currentWidth/2-a;r=this.currentHeight-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;case"SW":i=0-a;r=this.currentHeight-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;case"W":i=0-a;r=this.currentHeight/2-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;case"NW":i=0-a;r=0-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;case"center":i=this.currentWidth/2-a;r=this.currentHeight/2-f;n.push(this.getRotatedCoordinates(o,u,Math.sqrt(r*r+i*i),s+Math.atan2(r,i)));break;default:if(e.pointnames.contains(this.collisionPoints[l])){var h=e.point[this.collisionPoints[l]];if(h.visibility){n.push({x:h.currentX,y:h.currentY})}}}}return n};h.prototype.getRotatedCoordinates=function(t,n,r,i){i=this.flipReverse?180*e.radian-i:i;i=this.flipUpend?-i:i;return{x:t+r*Math.cos(i),y:n+r*Math.sin(i)}};h.prototype.parseCollisionPoints=function(t){var n=e.xt(t)?[].concat(t):this.collisionPoints;var r=[];for(var i=0,s=n.length;i<s;i++){switch(n[i].toLowerCase()){case"all":r.pushUnique("N");r.pushUnique("NE");r.pushUnique("E");r.pushUnique("SE");r.pushUnique("S");r.pushUnique("SW");r.pushUnique("W");r.pushUnique("NW");r.pushUnique("start");r.pushUnique("center");break;case"corners":r.pushUnique("NE");r.pushUnique("SE");r.pushUnique("SW");r.pushUnique("NW");break;case"edges":r.pushUnique("N");r.pushUnique("E");r.pushUnique("S");r.pushUnique("W");break;case"perimeter":r.pushUnique("N");r.pushUnique("NE");r.pushUnique("E");r.pushUnique("SE");r.pushUnique("S");r.pushUnique("SW");r.pushUnique("W");r.pushUnique("NW");break;case"north":case"n":r.pushUnique("N");break;case"northeast":case"ne":r.pushUnique("NE");break;case"east":case"e":r.pushUnique("E");break;case"southeast":case"se":r.pushUnique("SE");break;case"south":case"s":r.pushUnique("S");break;case"southwest":case"sw":r.pushUnique("SW");break;case"west":case"w":r.pushUnique("W");break;case"northwest":case"nw":r.pushUnique("NW");break;case"start":r.pushUnique("start");break;case"center":r.pushUnique("center");break}}return r};p.prototype=Object.create(h.prototype);p.prototype.type="Phrase";p.prototype.classname="spritenames";p.prototype.multiline=function(t){for(var n=0,r=this.texts.length;n<r;n++){delete e.text[this.texts[n]];e.textnames.removeItem(this.texts[n])}this.texts=[];this.text=t.text||this.text;var i=this.text.split("\n");t.phrase=this.name;var s;for(var n=0,r=i.length;n<r;n++){t.name=this.name+"_"+n;t.text=i[n];if(t.text.length>0){s=new d(t)}}this.getMetrics();return this};p.prototype.set=function(t){h.prototype.set.call(this,t);t=e.isa(t,"obj")?t:{};if(t.font){this.checkFont(t.font)}if(e.xto([t.style,t.variant,t.weight,t.size,t.metrics,t.family,t.scale])){this.constructFont()}this.getMetrics();this.multiline(t);return this};p.prototype.setDelta=function(t){h.prototype.setDelta.call(this,t);if(e.xto([t.size,t.scale])){this.constructFont()}this.getMetrics();return this};p.prototype.clone=function(t){t=e.xt(t)?t:{};t.textAlongPath=t.textAlongPath||this.textAlongPath;return h.prototype.clone.call(this,t)};p.prototype.checkFont=function(t){if(e.xt(t)){this.deconstructFont()}this.constructFont();return this};p.prototype.deconstructFont=function(){var t=e.ctx[this.context].font;var n;if(/italic/i.test(t)){this.style="italic"}else if(/oblique/i.test(t)){this.style="oblique"}else{this.style="normal"}if(/small-caps/i.test(t)){this.variant="small-caps"}else{this.variant="normal"}if(/bold/i.test(t)){this.weight="bold"}else if(/bolder/i.test(t)){this.weight="bolder"}else if(/lighter/i.test(t)){this.weight="lighter"}else if(/([1-9]00)/i.test(t)){n=t.match(/([1-9]00)/i);this.weight=n[1]}else{this.weight="normal"}if(/(\d+)(%|in|cm|mm|em|ex|pt|pc|ex)?/i.test(t)){n=t.match(/(\d+)(%|in|cm|mm|em|ex|pt|pc|ex|px)?/i);this.size=parseFloat(n[1]);this.metrics=n[2]}else if(/xx-small/i.test(t)){this.size=3;this.metrics="pt"}else if(/x-small/i.test(t)){this.size=6;this.metrics="pt"}else if(/small/i.test(t)){this.size=9;this.metrics="pt"}else if(/medium/i.test(t)){this.size=12;this.metrics="pt"}else if(/large/i.test(t)){this.size=15;this.metrics="pt"}else if(/x-large/i.test(t)){this.size=18;this.metrics="pt"}else if(/xx-large/i.test(t)){this.size=21;this.metrics="pt"}else{this.size=12;this.metrics="pt"}var r="",i=t.split(" ");var s=[100,200,300,400,500,600,700,800,900,"italic","oblique","small-caps","bold","bolder","lighter","xx-small","x-small","small","medium","large","x-large","xx-large"];for(var o=0,u=i.length;o<u;o++){if(!s.contains(i[o])){if(!i[o].match(/[^\/](\d)+(%|in|cm|mm|em|ex|pt|pc|ex)?/i)){r+=i[o]+" "}}}if(!r){r="Verdana, Geneva, sans-serif"}this.family=r;return this};p.prototype.constructFont=function(){var t="";if(this.style!=="normal"){t+=this.style+" "}if(this.variant!=="normal"){t+=this.variant+" "}if(this.weight!=="normal"){t+=this.weight+" "}if(!e.xt(this.currentScalse)){this.currentScale=this.scale*e.group[this.group].scale}t+=this.size*this.currentScale+this.metrics+" ";t+=this.family;e.ctx[this.context].font=t;return this};p.prototype.stamp=function(t,n){if(this.visibility){var r=e.spritenames.contains(this.path)&&e.sprite[this.path].type==="Shape";if(this.pivot||!r||this.textAlongPath==="phrase"){h.prototype.stamp.call(this,t)}else{e.text[this.texts[0]].stampAlongPath(t,n)}}return this};p.prototype.clear=function(t,n,r){var i;var s=this.getOffset();this.rotateCell(t,n,r);t.globalCompositeOperation="destination-out";var o=this.prepareStamp(r);for(var u=0,a=this.texts.length;u<a;u++){i=o.y+this.size*this.lineHeight*this.currentScale*u+s.y;e.text[this.texts[u]].clear(t,n,r,o.x+s.x,i)}t.globalCompositeOperation=e.ctx[n].globalCompositeOperation;this.unrotateCell(t,n,r);return this};p.prototype.clearWithBackground=function(t,n,r){var i;var s=this.getOffset();this.rotateCell(t,n,r);var o=this.prepareStamp(r);for(var u=0,a=this.texts.length;u<a;u++){i=o.y+this.size*this.lineHeight*this.currentScale*u+s.y;e.text[this.texts[u]].clearWithBackground(t,n,r,o.x+s.x,i)}this.unrotateCell(t,n,r);return this};p.prototype.draw=function(t,n,r){var i;var s=this.getOffset();this.rotateCell(t,n,r);e.cell[n].setEngine(this);if(this.backgroundColor){this.addBackgroundColor(t,n,r)}var o=this.prepareStamp(r);for(var u=0,a=this.texts.length;u<a;u++){i=o.y+this.size*this.lineHeight*this.currentScale*u+s.y;e.text[this.texts[u]].draw(t,n,r,o.x+s.x,i)}this.unrotateCell(t,n,r);return this};p.prototype.fill=function(t,n,r){var i;var s=this.getOffset();this.rotateCell(t,n,r);e.cell[n].setEngine(this);if(this.backgroundColor){this.addBackgroundColor(t,n,r)}var o=this.prepareStamp(r);for(var u=0,a=this.texts.length;u<a;u++){i=o.y+this.size*this.lineHeight*this.currentScale*u+s.y;e.text[this.texts[u]].fill(t,n,r,o.x+s.x,i)}this.unrotateCell(t,n,r);return this};p.prototype.drawFill=function(t,n,r){var i;var s=this.getOffset();this.rotateCell(t,n,r);e.cell[n].setEngine(this);if(this.backgroundColor){this.addBackgroundColor(t,n,r)}var o=this.prepareStamp(r);for(var u=0,a=this.texts.length;u<a;u++){i=o.y+this.size*this.lineHeight*this.currentScale*u+s.y;e.text[this.texts[u]].drawFill(t,n,r,o.x+s.x,i)}this.unrotateCell(t,n,r);return this};p.prototype.fillDraw=function(t,n,r){var i;var s=this.getOffset();this.rotateCell(t,n,r);e.cell[n].setEngine(this);if(this.backgroundColor){this.addBackgroundColor(t,n,r)}var o=this.prepareStamp(r);for(var u=0,a=this.texts.length;u<a;u++){i=o.y+this.size*this.lineHeight*this.currentScale*u+s.y;e.text[this.texts[u]].fillDraw(t,n,r,o.x+s.x,i)}this.unrotateCell(t,n,r);return this};p.prototype.sinkInto=function(t,n,r){var i;var s=this.getOffset();this.rotateCell(t,n,r);e.cell[n].setEngine(this);if(this.backgroundColor){this.addBackgroundColor(t,n,r)}var o=this.prepareStamp(r);for(var u=0,a=this.texts.length;u<a;u++){i=o.y+this.size*this.lineHeight*this.currentScale*u+s.y;e.text[this.texts[u]].sinkInto(t,n,r,o.x+s.x,i)}this.unrotateCell(t,n,r);return this};p.prototype.floatOver=function(t,n,r){var i;var s=this.getOffset();this.rotateCell(t,n,r);e.cell[n].setEngine(this);if(this.backgroundColor){this.addBackgroundColor(t,n,r)}var o=this.prepareStamp(r);for(var u=0,a=this.texts.length;u<a;u++){i=o.y+this.size*this.lineHeight*this.currentScale*u+s.y;e.text[this.texts[u]].floatOver(t,n,r,o.x+s.x,i)}this.unrotateCell(t,n,r);return this};p.prototype.clip=function(e,t,n){return this};p.prototype.getMetrics=function(t){var n=0,r=0;for(var i=0,s=this.texts.length;i<s;i++){r=e.text[this.texts[i]].width>r?e.text[this.texts[i]].width:r;n+=e.text[this.texts[i]].height}this.width=r;this.height=n;return this};p.prototype.addBackgroundColor=function(t,n,r){var i=this.prepareStamp(r);var s=this.backgroundMargin;var o=this.backgroundMargin;var u=i.x-this.backgroundMargin;var a=i.y-this.backgroundMargin;var f=this.currentWidth+this.backgroundMargin*2;var l=this.currentHeight+this.backgroundMargin*2;t.fillStyle=this.backgroundColor;t.fillRect(u,a,f,l);t.fillStyle=e.ctx[this.context].fillStyle;return this};p.prototype.getOffset=function(){var t=e.ctx[this.context];var n=0,r=0;switch(t.textAlign){case"start":case"left":n=0;break;case"center":n=this.width/2*this.currentScale;break;case"right":case"end":n=this.width*this.currentScale;break}switch(t.textBaseline){case"top":r=0;break;case"hanging":r=this.size*this.lineHeight*this.currentScale*.1;break;case"middle":r=this.size*this.lineHeight*this.currentScale*.5;break;case"bottom":r=this.size*this.lineHeight*this.currentScale;break;default:r=this.size*this.lineHeight*this.currentScale*.85}return{x:n,y:r}};d.prototype=Object.create(t.prototype);d.prototype.type="Text";d.prototype.classname="textnames";d.prototype.stampAlongPath=function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g;if(!e.xt(this.glyphs)){this.getMetrics()}n=e.sprite[this.phrase];s=n.prepareItemForStamp(t);u=s.method||n.method;l=e.sprite[n.path].getPerimeterLength();c=this.width*n.scale;f=c/l;d=this.text;for(var y=0,b=s.cells.length;y<b;y++){r=e.cell[s.cells[y]];r.setEngine(n);i=e.context[r.name];o=e.cell[s.cells[y]].name;h=n.pathPosition;this.flipCanvas(i,o,n);for(var w=0,E=this.glyphs.length;w<E;w++){if(e.xt(this.glyphs[w])){this.text=this.glyphs[w];p=h+this.glyphWidths[w]/2/c*f;if(!p.isBetween(0,1,true)){p+=p>.5?-1:1}a=e.sprite[n.path].getPerimeterPosition(p,n.pathSpeedConstant,true);v=a.x;m=a.y;g=a.r*e.radian;i.translate(v,m);i.rotate(g);i.translate(-v,-m);switch(u){case"draw":this.draw(i,o,s,v,m);break;case"fill":this.fill(i,o,s,v,m);break;case"drawFill":this.drawFill(i,o,s,v,m);break;case"fillDraw":this.fillDraw(i,o,s,v,m);break;case"sinkInto":this.sinkInto(i,o,s,v,m);break;case"floatOver":this.floatOver(i,o,s,v,m);break;case"clear":case"clearWithBackground":case"clip":case"none":default:}h+=this.glyphWidths[w]/c*f;if(!h.isBetween(0,1,true)){h+=h>.5?-1:1}i.translate(v,m);i.rotate(-g);i.translate(-v,-m)}}this.flipCanvas(i,o,n)}this.text=d;return this};d.prototype.flipCanvas=function(t,n,r){var i=e.cell[n];var s=i.actualWidth,o=i.actualHeight;if(r.flipReverse&&r.flipUpend){t.translate(s,o);t.scale(-1,-1)}else if(r.flipReverse){t.translate(s,0);t.scale(-1,1)}else if(r.flipUpend){t.translate(0,o);t.scale(1,-1)}return this};d.prototype.clear=function(e,t,n,r,i){e.fillText(this.text,r,i);return this};d.prototype.clearWithBackground=function(t,n,r,i,s){t.fillStyle=e.cell[n].backgroundColor;t.globalAlpha=1;t.fillText(this.text,i,s);t.fillStyle=e.ctx[n].fillStyle;t.globalAlpha=e.ctx[n].globalAlpha;return this};d.prototype.draw=function(e,t,n,r,i){e.strokeText(this.text,r,i);return this};d.prototype.fill=function(e,t,n,r,i){e.fillText(this.text,r,i);return this};d.prototype.drawFill=function(t,n,r,i,s){var o=e.sprite[this.phrase];t.strokeText(this.text,i,s);o.clearShadow(t,n);t.fillText(this.text,i,s);o.restoreShadow(t,n);return this};d.prototype.fillDraw=function(t,n,r,i,s){var o=e.sprite[this.phrase];t.fillText(this.text,i,s);o.clearShadow(t,n);t.strokeText(this.text,i,s);o.restoreShadow(t,n);return this};d.prototype.sinkInto=function(e,t,n,r,i){e.fillText(this.text,r,i);e.strokeText(this.text,r,i);return this};d.prototype.floatOver=function(e,t,n,r,i){e.strokeText(this.text,r,i);e.fillText(this.text,r,i);return this};d.prototype.clip=function(e,t,n){return this};d.prototype.getMetrics=function(){var t=e.sprite[this.phrase];var n=e.context[e.pad[e.currentPad].current];var r=e.ctx[this.context];var i=n.font;var s=n.textBaseline;var o=n.textAlign;n.font=r.font;n.textBaseline=r.textBaseline;n.textAlign=r.textAlign;this.width=n.measureText(this.text).width/t.scale;this.height=t.size*1.5;if(t.path){this.glyphs=[];this.glyphWidths=[];var u=this.text,a;if(this.textAlongPath==="word"){a=this.text.split(" ");for(var f=0,l=a.length;f<l;f++){this.glyphs.push(a[f]);this.glyphWidths.push(n.measureText(a[f]).width);if(e.xt(a[f+1])){this.glyphs.push(" ");this.glyphWidths.push(n.measureText(" ").width)}}}else{var c=n.measureText(u).width;if(this.fixedWidth){for(var f=0,l=u.length;f<l;f++){this.glyphs.push(u[f]);this.glyphWidths.push(c/l)}}else{for(var f=1,l=u.length;f<=l;f++){this.glyphs.push(u[f-1]);a=u.substr(0,f-1)+u.substr(f);this.glyphWidths.push(c-n.measureText(a).width)}}}}n.font=i;n.textBaseline=s;n.textAlign=o;return this};v.prototype=Object.create(h.prototype);v.prototype.type="Block";v.prototype.classname="spritenames";v.prototype.clip=function(e,t,n){e.save();this.rotateCell(e,t,n);var r=this.prepareStamp(n);e.rect(r.x,r.y,this.currentWidth,this.currentHeight);e.clip();this.unrotateCell(e,t,n);return this};v.prototype.clear=function(t,n,r){e.cell[n].setToClearShape();this.rotateCell(t,n,r);var i=this.prepareStamp(r);t.clearRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r);return this};v.prototype.clearWithBackground=function(t,n,r){this.rotateCell(t,n,r);t.fillStyle=e.cell[n].backgroundColor;t.strokeStyle=e.cell[n].backgroundColor;t.globalAlpha=1;var i=this.prepareStamp(r);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);t.fillRect(i.x,i.y,this.currentWidth,this.currentHeight);t.fillStyle=e.ctx[n].fillStyle;t.strokeStyle=e.ctx[n].strokeStyle;t.globalAlpha=e.ctx[n].globalAlpha;this.unrotateCell(t,n,r);return this};v.prototype.draw=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r);return this};v.prototype.fill=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.fillRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r);return this};v.prototype.drawFill=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);this.clearShadow(t,n);t.fillRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r);return this};v.prototype.fillDraw=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.fillRect(i.x,i.y,this.currentWidth,this.currentHeight);this.clearShadow(t,n);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r);return this};v.prototype.sinkInto=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.fillRect(i.x,i.y,this.currentWidth,this.currentHeight);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r);return this};v.prototype.floatOver=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);t.fillRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r);return this};m.prototype=Object.create(h.prototype);m.prototype.type="Wheel";m.prototype.classname="spritenames";m.prototype.checkHit=function(t,n){t=e.isa(t,"obj")?t:{};var r=e.xt(t.tests)?t.tests:[{x:t.x||false,y:t.y||false}];var i=this.prepareStamp(n);var s=false;if(this.checkHitUsingRadius){var o=t.test||0;var u=o?o:this.currentRadius;for(var a=0,f=r.length;a<f;a++){var l=(r[a].x-i.x)*(r[a].x-i.x);var c=(r[a].y-i.y)*(r[a].y-i.y);var h=Math.sqrt(l+c);s=h<=u?true:false;if(s){break}}}else{var p=e.pad[t.pad]||e.pad[n.pad];var d=e.cell[p.current].name;var v=e.context[p.current];this.flipCanvas(v,d);this.buildPath(v,n);for(var a=0,f=r.length;a<f;a++){s=v.isPointInPath(r[a].x,r[a].y);if(s){break}}this.flipCanvas(v,d)}return s?r[a]:false};m.prototype.getPivotOffset=function(t,n){if(e.xt(t)){var r;if(e.isa(t,"str")&&!["left","center","right","top","bottom"].contains(t)){r=parseFloat(t)/100*this.width-this.radius}else{switch(t){case"left":r=-this.radius;break;case"center":r=0;break;case"right":r=this.radius;break;case"top":r=-this.radius;break;case"bottom":r=this.radius;break;default:r=t}}return r}return 0};m.prototype.buildPath=function(e,t,n){var r=this.prepareStamp(n);e.beginPath();e.arc(r.x,r.y,this.currentRadius,this.getAngle(this.startAngle),this.getAngle(this.endAngle),this.clockwise);if(this.includeCenter){e.lineTo(r.x,r.y)}if(this.closed){e.closePath()}return this};m.prototype.clip=function(e,t,n){this.buildPath(e,t,n);e.clip();return this};m.prototype.clear=function(t,n,r){this.buildPath(t,n,r);t.globalCompositeOperation="destination-out";t.stroke();t.fill(e.ctx[this.context].winding);t.globalCompositeOperation=e.ctx[n].globalCompositeOperation;return this};m.prototype.clearWithBackground=function(t,n,r){this.buildPath(t,n,r);t.fillStyle=e.cell[n].backgroundColor;t.strokeStyle=e.cell[n].backgroundColor;t.globalAlpha=1;t.stroke();t.fill(e.ctx[this.context].winding);t.fillStyle=e.ctx[n].fillStyle;t.strokeStyle=e.ctx[n].strokeStyle;t.globalAlpha=e.ctx[n].globalAlpha;return this};m.prototype.draw=function(t,n,r){e.cell[n].setEngine(this);this.buildPath(t,n,r);t.stroke();return this};m.prototype.fill=function(t,n,r){e.cell[n].setEngine(this);this.buildPath(t,n,r);t.fill(e.ctx[this.context].winding);return this};m.prototype.drawFill=function(t,n,r){e.cell[n].setEngine(this);this.buildPath(t,n,r);t.stroke();this.clearShadow(t,n);t.fill(e.ctx[this.context].winding);return this};m.prototype.fillDraw=function(t,n,r){e.cell[n].setEngine(this);this.buildPath(t,n,r);t.fill(e.ctx[this.context].winding);this.clearShadow(t,n);t.stroke();return this};m.prototype.sinkInto=function(t,n,r){e.cell[n].setEngine(this);this.buildPath(t,n,r);t.fill(e.ctx[this.context].winding);t.stroke();return this};m.prototype.floatOver=function(t,n,r){e.cell[n].setEngine(this);this.buildPath(t,n,r);t.stroke();t.fill(e.ctx[this.context].winding);return this};m.prototype.getCollisionPoints=function(t){var n,r=[];var i={x:this.flipReverse?this.currentX+t.x*2:this.currentX,y:this.flipUpend?this.currentY+t.y*2:this.currentY};n=this.currentRoll*e.radian;for(var s=0,o=this.collisionPoints.length;s<o;s++){switch(this.collisionPoints[s]){case"start":r.push({x:i.x,y:i.y});break;case"N":r.push(this.getRotatedCoordinates(i.x,i.y,this.currentRadius,n+270*e.radian));break;case"NE":r.push(this.getRotatedCoordinates(i.x,i.y,this.currentRadius,n+315*e.radian));break;case"E":r.push(this.getRotatedCoordinates(i.x,i.y,this.currentRadius,n));break;case"SE":r.push(this.getRotatedCoordinates(i.x,i.y,this.currentRadius,n+45*e.radian));break;case"S":r.push(this.getRotatedCoordinates(i.x,i.y,this.currentRadius,n+90*e.radian));break;case"SW":r.push(this.getRotatedCoordinates(i.x,i.y,this.currentRadius,n+135*e.radian));break;case"W":r.push(this.getRotatedCoordinates(i.x,i.y,this.currentRadius,n+180*e.radian));break;case"NW":r.push(this.getRotatedCoordinates(i.x,i.y,this.currentRadius,n+225*e.radian));break;case"center":r.push({x:i.x,y:i.y});break;default:if(e.pointnames.contains(this.collisionPoints[s])){var u=e.point[this.collisionPoints[s]];if(u.visibility){r.push({x:u.currentX,y:u.currentY})}}}}return r};g.prototype=Object.create(h.prototype);g.prototype.type="Picture";g.prototype.classname="spritenames";g.prototype.importImage=function(t){if(e.isa(t,"obj")&&e.xt(t.url)){var n=new Image;n.id=t.name||"image"+Math.floor(Math.random()*1e8);n.onload=function(){try{var r=e.newImage({name:n.id,element:n});delete t.url;t.source=n.id;return e.newPicture(t)}catch(i){console.log("Image <"+url+"> failed to load - "+i.name+" error: "+i.message);return false}};n.src=t.url}else{console.log("Picture.importImage() failed - no url supplied");return false}};g.prototype.clone=function(t){var n=h.prototype.clone.call(this,t);t=e.isa(t,"obj")?t:{};if(!t.keepCopyDimensions){n.fitToImageSize()}return n};g.prototype.fitToImageSize=function(){if(this.imageType==="img"){this.copyWidth=e.image[this.source].copyWidth;this.copyHeight=e.image[this.source].copyHeight;this.copyX=e.image[this.source].copyX;this.copyY=e.image[this.source].copyY}return this};g.prototype.sourceImage=function(){if(this.animSheet&&e.imagenames.contains(this.source)){return"animation"}if(e.imagenames.contains(this.source)){return"img"}if(e.cellnames.contains(this.source)){return"canvas"}return false};g.prototype.clip=function(e,t,n){e.save();this.rotateCell(e,t,n);var r=this.prepareStamp(n);e.rect(r.x,r.y,this.currentWidth,this.currentHeight);e.clip();this.unrotateCell(e,t,n);return this};g.prototype.clear=function(e,t,n){this.rotateCell(e,t,n);var r=this.prepareStamp(n);e.clearRect(r.x,r.y,this.currentWidth,this.currentHeight);this.unrotateCell(e,t,n);return this};g.prototype.clearWithBackground=function(t,n,r){this.rotateCell(t,n,r);t.fillStyle=e.cell[n].backgroundColor;t.strokeStyle=e.cell[n].backgroundColor;t.globalAlpha=1;var i=this.prepareStamp(r);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);t.fillRect(i.x,i.y,this.currentWidth,this.currentHeight);t.fillStyle=e.ctx[n].fillStyle;t.strokeStyle=e.ctx[n].strokeStyle;t.globalAlpha=e.ctx[n].globalAlpha;this.unrotateCell(t,n,r);return this};g.prototype.draw=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r);return this};g.prototype.fill=function(t,n,r){if(this.imageType){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);try{t.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,i.x,i.y,this.currentWidth,this.currentHeight)}catch(s){}this.unrotateCell(t,n,r)}return this};g.prototype.drawFill=function(t,n,r){if(this.imageType){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);this.clearShadow(t,n);try{t.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,i.x,i.y,this.currentWidth,this.currentHeight)}catch(s){}this.unrotateCell(t,n,r)}return this};g.prototype.fillDraw=function(t,n,r){if(this.imageType){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);try{t.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,i.x,i.y,this.currentWidth,this.currentHeight)}catch(s){}this.clearShadow(t,n);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r)}return this};g.prototype.sinkInto=function(t,n,r){if(this.imageType){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);try{t.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,i.x,i.y,this.currentWidth,this.currentHeight)}catch(s){}t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);this.unrotateCell(t,n,r)}return this};g.prototype.floatOver=function(t,n,r){if(this.imageType){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.strokeRect(i.x,i.y,this.currentWidth,this.currentHeight);try{t.drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,i.x,i.y,this.currentWidth,this.currentHeight)}catch(s){}this.unrotateCell(t,n,r)}return this};g.prototype.getImageData=function(){var t,n;if(this.imageType==="animation"&&e.image[this.source]){n=e.image[this.source];t=e.addNewCell({name:this.name,height:n.height,width:n.width});e.context[t.name].drawImage(e.img[this.source],0,0)}else{t=e.addNewCell({name:this.name,height:this.copyHeight,width:this.copyWidth});try{e.context[t.name].drawImage(this.getImage(),this.copyX,this.copyY,this.copyWidth,this.copyHeight,0,0,this.copyWidth,this.copyHeight)}catch(r){}}this.imageData=t.getImageData({name:"data"});e.deleteCells([t.name]);return this};g.prototype.getImageDataValue=function(t,n){t=e.isa(t,"obj")?t:{x:0,y:0};n=e.isa(n,"obj")?n:{x:0,y:0};var r=e.pad[t.pad]||e.pad[n.pad]||e.pad[e.cell[e.group[this.group].cells[0]].pad];var i=e.cell[r.current].name;var s=e.context[r.current];var o=e.imageData[this.imageData];this.flipCanvas(s,i);this.rotateCell(s,i,n);var u=this.prepareStamp(n);var a=false;var f=this.getLocalRotatedPoint(n,i,r,t,u);var l=(parseFloat((f.y*o.width).toFixed())+parseFloat(f.x.toFixed()))*4;if(f.x.isBetween(0,o.width-1,true)&&f.y.isBetween(0,o.height-1,true)){switch(t.channel||this.imageDataChannel){case"red":a=e.xt(o.data[l])?o.data[l]:false;break;case"blue":a=e.xt(o.data[l+1])?o.data[l+1]:false;break;case"green":a=e.xt(o.data[l+2])?o.data[l+2]:false;break;case"alpha":a=e.xt(o.data[l+3])?o.data[l+3]:false;break;case"color":a=e.xta([o.data[l],o.data[l+1],o.data[l+2],o.data[l+3]])?"rgba("+o.data[l]+","+o.data[l+1]+","+o.data[l+2]+","+o.data[l+3]+")":false;break;default:a=false}}this.unrotateCell(s,i,n);this.flipCanvas(s,i);return a};g.prototype.getImage=function(){if(this.imageType==="animation"){var t=e.anim[this.animSheet].getData();this.copyX=t.copyX;this.copyY=t.copyY;this.copyWidth=t.copyWidth;this.copyHeight=t.copyHeight;return e.img[this.source]}else{return e[this.imageType][this.source]}};g.prototype.set=function(t){h.prototype.set.call(this,t);if(e.xto([t.sheet,t.frames,t.currentFrame,t.speed,t.loop,t.running,t.lastCalled])){e.anim[this.animSheet].set(t)}return this};g.prototype.get=function(t){if(["sheet","frames","currentFrame","speed","loop","running","lastCalled"].contains(t)){return e.anim[this.animSheet].get(t)}else{return h.prototype.get.call(this,t)}};g.prototype.checkHit=function(t,n){t=e.isa(t,"obj")?t:{};if(this.checkHitUsingImageData){var r=e.pad[t.pad]||e.pad[n.pad];var i=e.cell[r.current].name;var s=e.context[r.current];var o=e.xt(t.tests)?t.tests:[{x:t.x||0,y:t.y||0}];var u=e.imageData[this.imageData];var a=e.isa(t.test,"num")?t.test:0;this.flipCanvas(s,i);this.rotateCell(s,i,n);var f=this.prepareStamp(n);s.beginPath();s.rect(f.x,f.y,this.currentWidth,this.currentHeight);var l=false;for(var c=0,p=o.length;c<p;c++){l=s.isPointInPath(o[c].x,o[c].y);if(l){var d=this.getLocalRotatedPoint(n,i,r,o[c],f);var v=(parseFloat((d.y*u.width).toFixed())+parseFloat(d.x.toFixed()))*4;var m;switch(t.channel||this.imageDataChannel){case"red":m=0;break;case"blue":m=1;break;case"green":m=2;break;case"alpha":m=3;break}l=u.data[v+m]>a?true:false;if(l){break}}}this.unrotateCell(s,i,n);this.flipCanvas(s,i);return l?o[c]:false}else{return h.prototype.checkHit.call(this,t,n)}};g.prototype.getLocalRotatedCoordinates=function(e,t,n,r){return{x:e+n*Math.cos(r),y:t+n*Math.sin(r)}};g.prototype.getLocalRotatedPoint=function(t,n,r,i,s){var o=this.getRotationPoint(t,n);var u,a,f,l,c;a=this.flipReverse?r.width-i.x-o.x:i.x-o.x;f=this.flipUpend?r.height-i.y-o.y:i.y-o.y;u=this.getLocalRotatedCoordinates(o.x,o.y,Math.sqrt(a*a+f*f),Math.atan2(f,a)-this.currentRoll*e.radian);l=(u.x-o.x+(o.x-s.x))/this.currentScale*(this.copyWidth/this.width);c=(u.y-o.y+(o.y-s.y))/this.currentScale*(this.copyHeight/this.height);if(this.imageType==="animation"){l+=this.copyX;c+=this.copyY}l=parseFloat(l.toFixed());c=parseFloat(c.toFixed());return{x:l,y:c}};y.prototype=Object.create(h.prototype);y.prototype.type="Outline";y.prototype.classname="spritenames";y.prototype.set=function(t){h.prototype.set.call(this,t);t=e.isa(t,"obj")?t:{};if(e.xt(t.data)){this.dataSet=this.buildDataSet(this.data)}return this};y.prototype.buildDataSet=function(e){var t=[];var n,r,i=999999,s=999999,o=-999999,u=-999999,a=this.startX,f=this.startY;var l=function(e,t){i=i>e?e:i;s=s>t?t:s;o=o<e?e:o;u=u<t?t:u};var c=e.match(/([A-Za-z][0-9. ,\-]*)/g);for(var h=0,p=c.length;h<p;h++){n=c[h][0];r=c[h].match(/(-?[0-9.]+\b)/g);if(r){for(var d=0,v=r.length;d<v;d++){r[d]=parseFloat(r[d])}switch(n){case"H":for(var d=0,v=r.length;d<v;d++){a=r[d];l(a,f)}break;case"V":for(var d=0,v=r.length;d<v;d++){f=r[d];l(a,f)}break;case"M":for(var d=0,v=r.length;d<v;d+=2){a=r[d];f=r[d+1];l(a,f)};case"L":case"T":for(var d=0,v=r.length;d<v;d+=2){a=r[d];f=r[d+1];l(a,f)}break;case"Q":case"S":for(var d=0,v=r.length;d<v;d+=4){a=r[d+2];f=r[d+3];l(a,f)}break;case"C":for(var d=0,v=r.length;d<v;d+=6){a=r[d+4];f=r[d+5];l(a,f)}break;case"h":for(var d=0,v=r.length;d<v;d++){a+=r[d];l(a,f)}break;case"v":for(var d=0,v=r.length;d<v;d++){f+=r[d];l(a,f)}break;case"m":case"l":case"t":for(var d=0,v=r.length;d<v;d+=2){a+=r[d];f+=r[d+1];l(a,f)}break;case"q":case"s":for(var d=0,v=r.length;d<v;d+=4){a+=r[d+2];f+=r[d+3];l(a,f)}break;case"c":for(var d=0,v=r.length;d<v;d+=6){a+=r[d+4];f+=r[d+5];l(a,f)}break}}t.push({c:n,p:r})}this.width=o-i;this.height=u-s;for(var h=0,p=t.length;h<p;h++){if(["M","L","C","Q","S","T"].contains(t[h].c)){for(var d=0,v=t[h].p.length;d<v;d+=2){t[h].p[d]-=i;t[h].p[d+1]-=s}}if(t[h].c==="H"){for(var d=0,v=t[h].p.length;d<v;d++){t[h].p[d]-=i}}if(t[h].c==="V"){for(var d=0,v=t[h].p.length;d<v;d++){t[h].p[d]-=s}}}this.compiledData=false;return t};y.prototype.doOutline=function(e,t){if(!this.dataSet&&this.data){this.buildDataSet(this.data)}if(this.dataSet){var n=this.prepareStamp(t);var r=n.x,i=n.y;var s=n.x,o=n.y;var u,a,f;e.beginPath();if(!["M","m"].contains(this.dataSet[0].c)){r=0,i=0;s=r,o=i;e.moveTo(0,0)}for(var l=0,c=this.dataSet.length;l<c;l++){u=this.dataSet[l];switch(u.c){case"M":r=u.p[0],i=u.p[1];s=r,o=i;e.moveTo(r*this.scale,i*this.scale);for(var h=2,p=u.p.length;h<p;h+=2){r=u.p[h],i=u.p[h+1];s=r,o=i;e.lineTo(r*this.scale,i*this.scale)}break;case"m":r+=u.p[0],i+=u.p[1];s=r,o=i;e.moveTo(r*this.scale,i*this.scale);for(var h=2,p=u.p.length;h<p;h+=2){r+=u.p[h],i+=u.p[h+1];s=r,o=i;e.lineTo(r*this.scale,i*this.scale)}break;case"Z":case"z":e.closePath();break;case"L":for(var h=0,p=u.p.length;h<p;h+=2){r=u.p[h],i=u.p[h+1];s=r,o=i;e.lineTo(r*this.scale,i*this.scale)}break;case"l":for(var h=0,p=u.p.length;h<p;h+=2){r+=u.p[h],i+=u.p[h+1];s=r,o=i;e.lineTo(r*this.scale,i*this.scale)}break;case"H":for(var h=0,p=u.p.length;h<p;h++){r=u.p[h];s=r;e.lineTo(r*this.scale,i*this.scale)}break;case"h":for(var h=0,p=u.p.length;h<p;h++){r+=u.p[h];s=r;e.lineTo(r*this.scale,i*this.scale)}break;case"V":for(var h=0,p=u.p.length;h<p;h++){i=u.p[h];o=i;e.lineTo(r*this.scale,i*this.scale)}break;case"v":for(var h=0,p=u.p.length;h<p;h++){i+=u.p[h];o=i;e.lineTo(r*this.scale,i*this.scale)}break;case"C":for(var h=0,p=u.p.length;h<p;h+=6){e.bezierCurveTo(u.p[h]*this.scale,u.p[h+1]*this.scale,u.p[h+2]*this.scale,u.p[h+3]*this.scale,u.p[h+4]*this.scale,u.p[h+5]*this.scale);s=u.p[h+2],o=u.p[h+3];r=u.p[h+4],i=u.p[h+5]}break;case"c":for(var h=0,p=u.p.length;h<p;h+=6){e.bezierCurveTo((r+u.p[h])*this.scale,(i+u.p[h+1])*this.scale,(r+u.p[h+2])*this.scale,(i+u.p[h+3])*this.scale,(r+u.p[h+4])*this.scale,(i+u.p[h+5])*this.scale);s=r+u.p[h+2];o=i+u.p[h+3];r+=u.p[h+4],i+=u.p[h+5]}break;case"S":for(var h=0,p=u.p.length;h<p;h+=4){if(l>0&&["C","c","S","s"].contains(this.dataSet[l-1].c)){a=r+(r-s);f=i+(i-o)}else{a=r;f=i}e.bezierCurveTo(a*this.scale,f*this.scale,u.p[h]*this.scale,u.p[h+1]*this.scale,u.p[h+2]*this.scale,u.p[h+3]*this.scale);s=u.p[h],o=u.p[h+1];r=u.p[h+2],i=u.p[h+3]}break;case"s":for(var h=0,p=u.p.length;h<p;h+=4){if(l>0&&["C","c","S","s"].contains(this.dataSet[l-1].c)){a=r+(r-s);f=i+(i-o)}else{a=r;f=i}e.bezierCurveTo(a*this.scale,f*this.scale,(r+u.p[h])*this.scale,(i+u.p[h+1])*this.scale,(r+u.p[h+2])*this.scale,(i+u.p[h+3])*this.scale);s=r+u.p[h],o=i+u.p[h+1];r+=u.p[h+2],i+=u.p[h+3]}break;case"Q":for(var h=0,p=u.p.length;h<p;h+=4){e.quadraticCurveTo(u.p[h]*this.scale,u.p[h+1]*this.scale,u.p[h+2]*this.scale,u.p[h+3]*this.scale);s=u.p[h],o=u.p[h+1];r=u.p[h+2],i=u.p[h+3]}break;case"q":for(var h=0,p=u.p.length;h<p;h+=4){e.quadraticCurveTo((r+u.p[h])*this.scale,(i+u.p[h+1])*this.scale,(r+u.p[h+2])*this.scale,(i+u.p[h+3])*this.scale);s=r+u.p[h];o=i+u.p[h+1];r+=u.p[h+2],i+=u.p[h+3]}break;case"T":for(var h=0,p=u.p.length;h<p;h+=2){if(l>0&&["Q","q","T","t"].contains(this.dataSet[l-1].c)){a=r+(r-s);f=i+(i-o)}else{a=r;f=i}e.quadraticCurveTo(a*this.scale,f*this.scale,u.p[h]*this.scale,u.p[h+1]*this.scale);s=a,o=f;r=u.p[h],i=u.p[h+1]}break;case"t":for(var h=0,p=u.p.length;h<p;h+=2){if(l>0&&["Q","q","T","t"].contains(this.dataSet[l-1].c)){a=r+(r-s);f=i+(i-o)}else{a=r;f=i}e.quadraticCurveTo(a*this.scale,f*this.scale,(r+u.p[h])*this.scale,(i+u.p[h+1])*this.scale);s=a,o=f;r+=u.p[h],i+=u.p[h+1]}break}}}return this};y.prototype.clip=function(e,t,n){e.save();this.rotateCell(e,t,n);var r=this.prepareStamp(n);e.translate(r.x,r.y);this.doOutline(e,n);e.clip();e.translate(-r.x,-r.y);this.unrotateCell(e,t,n);return this};y.prototype.clear=function(t,n,r){e.cell[n].setToClearShape();this.rotateCell(t,n,r);var i=this.prepareStamp(r);t.translate(i.x,i.y);this.doOutline(t,r);t.globalCompositeOperation="destination-out";t.fill(e.ctx[this.context].winding);t.globalCompositeOperation=e.ctx[n].globalCompositeOperation;t.translate(-i.x,-i.y);this.unrotateCell(t,n,r);return this};y.prototype.clearWithBackground=function(t,n,r){this.rotateCell(t,n,r);var i=this.prepareStamp(r);t.translate(i.x,i.y);t.fillStyle=e.cell[n].backgroundColor;t.strokeStyle=e.cell[n].backgroundColor;t.globalAlpha=1;this.doOutline(t,r);t.fill(e.ctx[this.context].winding);t.stroke();t.fillStyle=e.ctx[n].fillStyle;t.strokeStyle=e.ctx[n].strokeStyle;t.globalAlpha=e.ctx[n].globalAlpha;t.translate(-i.x,-i.y);this.unrotateCell(t,n,r);return this};y.prototype.draw=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.translate(i.x,i.y);this.doOutline(t,r);t.stroke();t.translate(-i.x,-i.y);this.unrotateCell(t,n,r);return this};y.prototype.fill=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.translate(i.x,i.y);this.doOutline(t,r);t.fill(e.ctx[this.context].winding);t.translate(-i.x,-i.y);this.unrotateCell(t,n,r);return this};y.prototype.drawFill=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.translate(i.x,i.y);this.doOutline(t,r);t.stroke();this.clearShadow(t,n);t.fill(e.ctx[this.context].winding);t.translate(-i.x,-i.y);this.unrotateCell(t,n,r);return this};y.prototype.fillDraw=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.translate(i.x,i.y);this.doOutline(t,r);t.fill(e.ctx[this.context].winding);this.clearShadow(t,n);t.stroke();t.translate(-i.x,-i.y);this.unrotateCell(t,n,r);return this};y.prototype.sinkInto=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.translate(i.x,i.y);this.doOutline(t,r);t.fill(e.ctx[this.context].winding);t.stroke();t.translate(-i.x,-i.y);this.unrotateCell(t,n,r);return this};y.prototype.floatOver=function(t,n,r){this.rotateCell(t,n,r);e.cell[n].setEngine(this);var i=this.prepareStamp(r);t.translate(i.x,i.y);this.doOutline(t,r);t.stroke();t.fill(e.ctx[this.context].winding);t.translate(-i.x,-i.y);this.unrotateCell(t,n,r);return this};y.prototype.checkHit=function(t,n){t=e.isa(t,"obj")?t:{};var r=e.pad[t.pad]||e.pad[n.pad];var i=e.cell[r.current].name;var s=e.context[r.current];var o=e.xt(t.tests)?t.tests:[{x:t.x||false,y:t.y||false}];this.flipCanvas(s,i);this.rotateCell(s,i,n);var u=this.prepareStamp(n);s.translate(u.x,u.y);this.doOutline(s,n);var a=false;for(var f=0,l=o.length;f<l;f++){a=s.isPointInPath(o[f].x,o[f].y);if(a){break}}s.translate(-u.x,-u.y);this.unrotateCell(s,i,n);this.flipCanvas(s,i);return a?o[f]:false};b.prototype=Object.create(h.prototype);b.prototype.type="Shape";b.prototype.classname="spritenames";b.prototype.exportNative=function(t){var n=h.prototype.exportNative.call(this,t);var r=this.getFullPointList();for(var i=0,s=r.length;i<s;i++){n.push(e.point[r[i]].prepareForExport(t));if(e.xt(e.point[r[i]].startLink)&&e.linknames.contains(e.point[r[i]].startLink)){n.push(e.link[e.point[r[i]].startLink].prepareForExport(t))}}return n};b.prototype.getRadius=function(){var t=0;for(var n=0,r=this.pointList.length;n<r;n++){t=e.point[this.pointList[n]].distance>t?e.point[this.pointList[n]].distance:t}this.radius=t;return this.radius};b.prototype.set=function(e){h.prototype.set.call(this,e);if(this.linkDurations.length>0||this.perimeterLength){this.buildPositions()}return this};b.prototype.setDelta=function(e){h.prototype.setDelta.call(this,e);if(this.linkDurations.length>0||this.perimeterLength){this.buildPositions()}return this};b.prototype.parseCollisionPoints=function(e){return this.collisionPoints};b.prototype.prepareShape=function(t,n,r){if(this.firstPoint){var i=e.point[this.firstPoint].getData(r);t.beginPath();e.link[i.startLink].sketch(t,r)}return this};b.prototype.getPivotOffset=function(t,n){if(e.xt(t)){var r;if(e.isa(t,"str")&&!["left","center","right","top","bottom"].contains(t)){r=n?parseFloat(t)/100*this.height-this.height/2:parseFloat(t)/100*this.width-this.width/2}else{switch(t){case"left":r=-(this.width/2);break;case"center":r=0;break;case"right":r=this.width/2;break;case"top":r=-(this.height/2);break;case"bottom":r=this.height/2;break;default:r=t}}if(this.line){r+=n?this.height/2:this.width/2}return r}return 0};b.prototype.stampMark=function(e,t,n,r,i){var s=e.path;var o=e.pathPosition;var u=e.group;e.set({path:this.name,pathPosition:t,group:r}).forceStamp();e.set({path:s,pathPosition:o,group:u})};b.prototype.addMarks=function(t,n,r){if(this.markStart&&(e.spritenames.contains(this.markStart)||e.groupnames.contains(this.markStart))){if(e.groupnames.contains(this.markStart)){for(var i=0,s=e.group[this.markStart].sprites.length;i<s;i++){this.stampMark(e.sprite[e.group[this.markStart].sprites[i]],0,t,n,r)}}else{this.stampMark(e.sprite[this.markStart],0,t,n,r)}}if(this.markMid&&(e.spritenames.contains(this.markMid)||e.groupnames.contains(this.markMid))){if(this.linkDurations.length===0||!this.perimeterLength){this.buildPositions()}for(var o=0,u=this.linkDurations.length-1;o<u;o++){if(e.groupnames.contains(this.markMid)){for(var i=0,s=e.group[this.markMid].sprites.length;i<s;i++){this.stampMark(e.sprite[e.group[this.markMid].sprites[i]],this.linkDurations[o],t,n,r)}}else{this.stampMark(e.sprite[this.markMid],this.linkDurations[o],t,n,r)}}}if(this.markEnd&&(e.spritenames.contains(this.markEnd)||e.groupnames.contains(this.markEnd))){if(e.groupnames.contains(this.markEnd)){for(var i=0,s=e.group[this.markEnd].sprites.length;i<s;i++){this.stampMark(e.sprite[e.group[this.markEnd].sprites[i]],1,t,n,r)}}else{this.stampMark(e.sprite[this.markEnd],1,t,n,r)}}return false};b.prototype.clip=function(e,t,n){if(this.closed){this.prepareShape(e,t,n);e.clip()}return this};b.prototype.clear=function(t,n,r){this.prepareShape(t,n,r);t.globalCompositeOperation="destination-out";t.stroke();t.fill(e.ctx[this.context].winding);t.globalCompositeOperation=e.ctx[n].globalCompositeOperation;return this};b.prototype.clearWithBackground=function(t,n,r){this.prepareShape(t,n,r);t.fillStyle=e.cell[n].backgroundColor;t.strokeStyle=e.cell[n].backgroundColor;t.globalAlpha=1;t.stroke();t.fill(e.ctx[this.context].winding);t.fillStyle=e.ctx[n].fillStyle;t.strokeStyle=e.ctx[n].strokeStyle;t.globalAlpha=e.ctx[n].globalAlpha;return this};b.prototype.fill=function(t,n,r){if(this.closed){this.prepareShape(t,n,r);e.cell[n].setEngine(this);t.fill(e.ctx[this.context].winding);if(this.markStart||this.markMid||this.markEnd){this.addMarks(t,n,r)}}return this};b.prototype.draw=function(t,n,r){e.cell[n].setEngine(this);this.prepareShape(t,n,r);t.stroke();if(this.markStart||this.markMid||this.markEnd){this.addMarks(t,n,r)}return this};b.prototype.drawFill=function(t,n,r){e.cell[n].setEngine(this);this.prepareShape(t,n,r);t.stroke();if(this.closed){this.clearShadow(t,n);t.fill(e.ctx[this.context].winding)}return this};b.prototype.fillDraw=function(t,n,r){e.cell[n].setEngine(this);this.prepareShape(t,n,r);if(this.closed){t.fill(e.ctx[this.context].winding);this.clearShadow(t,n)}t.stroke();if(this.markStart||this.markMid||this.markEnd){this.addMarks(t,n,r)}return this};b.prototype.sinkInto=function(t,n,r){e.cell[n].setEngine(this);this.prepareShape(t,n,r);if(this.closed){t.fill(e.ctx[this.context].winding)}t.stroke();if(this.markStart||this.markMid||this.markEnd){this.addMarks(t,n,r)}return this};b.prototype.floatOver=function(t,n,r){e.cell[n].setEngine(this);this.prepareShape(t,n,r);t.stroke();if(this.closed){t.fill(e.ctx[this.context].winding)}if(this.markStart||this.markMid||this.markEnd){this.addMarks(t,n,r)}return this};b.prototype.none=function(e,t,n){this.prepareShape(e,t,n);return this};b.prototype.getFullPointList=function(){var t=[this.firstPoint];var n=e.point[this.firstPoint].getData();var r=e.link[n.startLink];while(r.action&&["move","add"].contains(r.action)){if(r.controlPoint1){t.push(r.controlPoint1)}if(r.controlPoint2){t.push(r.controlPoint2)}if(r.endPoint){t.push(r.endPoint);r=e.link[e.point[r.endPoint].startLink]}else{break}}return t};b.prototype.setRotationPointTo=function(t){t=e.xt(t)?t:{};var n=e.xt(t.x)?this.getPivotOffset(t.x,false):this.getPivotOffset("center",false);var r=e.xt(t.y)?this.getPivotOffset(t.y,true):this.getPivotOffset("center",true);var i=this.path;var s=this.roll;this.path=false;this.roll=0;var o=this.getFullPointList();var u=this.startX,a=this.startY;this.startX+=n;this.startY+=r;for(var f=0,l=o.length;f<l;f++){if(o[f]){e.point[o[f]].setPolar()}}this.forceStamp("none");this.startX=u,this.startY=a;this.path=i;this.roll=s;return this};b.prototype.checkHit=function(t,n){t=e.isa(t,"obj")?t:{};var r=e.pad[t.pad]||e.pad[n.pad];var i=e.cell[r.current].name;var s=e.context[r.current];var o=e.xt(t.tests)?t.tests:[{x:t.x||false,y:t.y||false}];this.flipCanvas(s,i);if(this.closed){}this.prepareShape(s,n);var u=false;for(var a=0,f=o.length;a<f;a++){u=s.isPointInPath(o[a].x,o[a].y);if(u){break}}if(this.closed){}this.flipCanvas(s,i);return u?o[a]:false};b.prototype.getCollisionPoints=function(t){if(e.isa(this.collisionPoints,"num")){var n=0;var r=1/this.collisionPoints;var i,s=[],o;var u=e.cell[e.group[this.group].cells[0]];o=this.currentRoll*e.radian;for(var a=0;a<this.collisionPoints;a++){i=this.getPerimeterPosition(n,true,o);i.x=this.flipReverse?u.actualWidth-i.x:i.x;i.y=this.flipUpend?u.actualHeight-i.y:i.y;s.push(i);n+=r}return s}else{var f=this.prepareStamp(t);return[{x:f.x,y:f.y}]}};b.prototype.getPerimeterLength=function(e){if(e||!this.perimeterLength||this.linkDurations.length===0){this.buildPositions()}return this.perimeterLength};b.prototype.buildPositions=function(){for(var t=0,n=this.linkList.length;t<n;t++){e.link[this.linkList[t]].setPositions()}this.linkDurations=[];var r=0,i,s;for(var t=0,n=this.linkList.length;t<n;t++){s=e.link[this.linkList[t]];i=s.positions[s.precision].cumulativeLength;r+=i;this.linkDurations.push(r)}this.perimeterLength=r;for(var t=0,n=this.linkList.length;t<n;t++){this.linkDurations[t]=this.linkDurations[t]/this.perimeterLength}return this};b.prototype.getPerimeterPosition=function(t,n,r){this.getPerimeterLength();t=e.isa(t,"num")?t:1;var i,s;for(var o=0,u=this.linkList.length;o<u;o++){i=e.link[this.linkList[o]];if(this.linkDurations[o]>=t){if(o===0){s=t/this.linkDurations[o]}else{s=(t-this.linkDurations[o-1])/(this.linkDurations[o]-this.linkDurations[o-1])}s=s<0?0:s>1?1:s;if(n){if(r){var a=i.getSteadyPositionOnLink(s-1e-7<0?0:s-1e-7);var f=i.getSteadyPositionOnLink(s+1e-7>1?1:s+1e-7);var l=i.getSteadyPositionOnLink(s);var c=Math.atan2(f.y-a.y,f.x-a.x)/e.radian;return{x:l.x,y:l.y,r:c}}else{return i.getSteadyPositionOnLink(s)}}else{if(r){var a=i.getPositionOnLink(s-1e-7<0?0:s-1e-7);var f=i.getPositionOnLink(s+1e-7>1?1:s+1e-7);var l=i.getPositionOnLink(s);var c=Math.atan2(f.y-a.y,f.x-a.x)/e.radian;return{x:l.x,y:l.y,r:c}}else{return i.getPositionOnLink(s)}}}}return false};b.prototype.clone=function(t){t=e.isa(t,"obj")?t:{};var n=JSON.parse(JSON.stringify(this));n.name=t.name||this.name;n.data=t.data||this.data;n.startX=t.startX||this.startX;n.startY=t.startY||this.startY;n.handleX=t.handleX||this.handleX;n.handleY=t.handleY||this.handleY;var r=e.makePath(n);var i=JSON.parse(JSON.stringify(e.ctx[this.context]));delete i.name;r.set(i);delete t.name||this.name;delete t.data||this.data;delete t.startX||this.startX,delete t.startY||this.startY,delete t.handleX||this.handleX,delete t.handleY||this.handleY,r.set(t);return r};w.prototype=Object.create(t.prototype);w.prototype.type="Point";w.prototype.classname="pointnames";w.prototype.prepareForExport=function(){var e;return{name:this.name,comment:this.comment!==""?this.comment:e,title:this.title!==""?this.title:e,timestamp:this.timestamp,type:this.type,sprite:this.sprite,distance:this.distance?this.distance:e,angle:this.angle?this.angle:e,startLink:this.startLink?this.startLink:e,currentX:this.currentX!==0?this.currentX:e,currentY:this.currentY!==0?this.currentY:e,visibility:!this.visibility?this.visibility:e,fixed:this.fixed?this.fixed:e}};w.prototype.setToDefaults=function(){this.set({comment:"",title:"",sprite:false,distance:false,angle:false,startLink:false,currentX:0,currentY:0,visibility:false,fixed:false});return this};w.prototype.getData=function(t){if(!e.isa(this.distance,"num")&&!e.isa(this.angle,"num")){this.setPolar()}this.recalculate(t);return{name:this.name,currentX:this.currentX,currentY:this.currentY,startLink:this.startLink}};w.prototype.set=function(n){var r=this.sprite;t.prototype.set.call(this,n);n=e.isa(n,"obj")?n:{};if(e.xto([n.currentX,n.currentY])){this.setPolar()}if(e.isa(n.sprite,"str")){try{e.sprite[this.sprite].pointList.removeItem(this.name)}catch(i){}try{e.sprite[n.sprite].pointList.pushUnique(this.name)}catch(i){}this.sprite=n.sprite}return this};w.prototype.setDelta=function(t){t=e.isa(t,"obj")?t:{};if(t.distance){this.distance+=t.distance}if(t.angle){this.angle+=t.angle}var n=t.override?t.override:{x:0,y:0};this.recalculate(n);return this};w.prototype.recalculate=function(t){var t=t?t:{x:0,y:0};if(e.isa(this.fixed,"str")&&(e.spritenames.contains(this.fixed)||e.pointnames.contains(this.fixed))){var n=e.sprite[this.fixed]||e.point[this.fixed];if(n.type==="Point"){this.currentX=n.currentX+t.x;this.currentY=n.currentY+t.y}else{this.currentX=n.startX;this.currentY=n.startY}}else if(!this.fixed){var r,i,s,o;r=e.sprite[this.sprite];o=r.prepareStamp(t);if(r.type==="Shape"){if(r.addPathRoll){i=(this.angle+r.currentRoll+r.pathRoll)*e.radian}else{i=(this.angle+r.currentRoll)*e.radian}s=this.distance*r.scale}else{i=this.angle*e.radian;s=this.distance}this.currentX=o.x+s*Math.cos(i);this.currentY=o.y+s*Math.sin(i)}return this};w.prototype.setPolar=function(){var t=e.sprite[this.sprite];var n=this.currentX-t.startX;var r=this.currentY-t.startY;this.angle=Math.atan2(r,n)/e.radian;this.distance=Math.sqrt(n*n+r*r);return this};E.prototype=Object.create(t.prototype);E.prototype.type="Link";E.prototype.classname="linknames";E.prototype.prepareForExport=function(){var e;return{name:this.name,comment:this.comment!==""?this.comment:e,title:this.title!==""?this.title:e,timestamp:this.timestamp,type:this.type,species:this.species?this.species:e,startPoint:this.startPoint?this.startPoint:e,sprite:this.sprite?this.sprite:e,endPoint:this.endPoint?this.endPoint:e,controlPoint1:this.controlPoint1?this.controlPoint1:e,controlPoint2:this.controlPoint2?this.controlPoint2:e,action:this.action!=="add"?this.action:e,precision:this.precision!==100?this.precision:e,positions:this.positions?true:e}};E.prototype.setToDefaults=function(){this.set({comment:"",title:"",species:false,startPoint:false,sprite:false,endPoint:false,controlPoint1:false,controlPoint2:false,action:false,precision:100,positions:false});return this};E.prototype.set=function(n){var r=this.sprite;t.prototype.set.call(this,n);n=e.isa(n,"obj")?n:{};if(e.isa(n.sprite,"str")&&n.sprite!==r&&r){e.sprite[r].linkList.removeItem(this.name)}if(e.isa(n.action,"str")&&this.sprite&&e.spritenames.contains(this.sprite)){if(n.action==="add"){e.sprite[this.sprite].linkList.pushUnique(this.name)}else{e.sprite[this.sprite].linkList.removeItem(this.name)}}return this};E.prototype.pointOnLine=function(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}};E.prototype.getPointCoordinates=function(){if(!e.point[this.startPoint].currentX){e.sprite[this.sprite].forceStamp("empty")}var t={x:e.point[this.startPoint].currentX,y:e.point[this.startPoint].currentY};var n={x:e.point[this.endPoint].currentX,y:e.point[this.endPoint].currentY};var r=["quadratic","bezier"].contains(this.species)?{x:e.point[this.controlPoint1].currentX,y:e.point[this.controlPoint1].currentY}:false;var i=this.species==="bezier"?{x:e.point[this.controlPoint2].currentX,y:e.point[this.controlPoint2].currentY}:false;return{start:t,end:n,control1:r,control2:i}};E.prototype.getPositionOnLink=function(t){t=e.isa(t,"num")?t:1;var n=this.getPointCoordinates();switch(this.species){case"line":return this.pointOnLine(n.start,n.end,t);break;case"quadratic":var r=this.pointOnLine(n.start,n.control1,t);var i=this.pointOnLine(n.control1,n.end,t);return this.pointOnLine(r,i,t);break;case"bezier":var s=this.pointOnLine(n.start,n.control1,t);var o=this.pointOnLine(n.control1,n.control2,t);var u=this.pointOnLine(n.control2,n.end,t);var a=this.pointOnLine(s,o,t);var f=this.pointOnLine(o,u,t);return this.pointOnLine(a,f,t);break}return false};E.prototype.getSteadyPositionOnLink=function(t){t=e.isa(t,"num")?t:1;if(this.positions.length===0){this.setPositions()}var n=this.length*t;n=n>this.positions[this.precision].cumulativeLength?this.positions[this.precision].cumulativeLength:n<0?0:n;var r,i,s,o,u,a;for(var f=1;f<=this.precision;f++){if(n<=this.positions[f].cumulativeLength){r=this.positions[f-1].x;i=this.positions[f-1].y;s=this.positions[f].x-r;o=this.positions[f].y-i;u=(n-this.positions[f-1].cumulativeLength)/this.positions[f].length;a={x:r+s*u,y:i+o*u};return a}}return false};E.prototype.getLength=function(){var e=this.getPointCoordinates();this.setPositions(this.precision);return this.length};E.prototype.setPositions=function(t){var n=this.getPointCoordinates();this.precision=e.isa(t,"num")&&t>0?t:this.precision||100;this.positions=[];var r=1/this.precision,i,s,o,u,a;var f=0,l=n.start.x,c=n.start.y;this.positions.push({x:l,y:c,length:0,cumulativeLength:f});for(var h=0;h<this.precision;h++){i=r*(h+1);s=this.getPositionOnLink(i);u=s.x-l;a=s.y-c;l=s.x;c=s.y;o=Math.sqrt(u*u+a*a);f+=o;this.positions.push({x:l,y:c,length:o,cumulativeLength:f})}this.length=this.positions[this.precision].cumulativeLength;return this};E.prototype.sketch=function(t,n){var r,i,s;var o;switch(this.action){case"close":t.closePath();break;case"move":try{r=e.point[this.endPoint].getData(n);t.moveTo(r.currentX,r.currentY)}catch(u){return true}break;case"add":try{switch(this.species){case"line":r=e.point[this.endPoint].getData(n);t.lineTo(r.currentX,r.currentY);break;case"quadratic":i=e.point[this.controlPoint1].getData(n);r=e.point[this.endPoint].getData(n);t.quadraticCurveTo(i.currentX,i.currentY,r.currentX,r.currentY);break;case"bezier":i=e.point[this.controlPoint1].getData(n);s=e.point[this.controlPoint2].getData(n);r=e.point[this.endPoint].getData(n);t.bezierCurveTo(i.currentX,i.currentY,s.currentX,s.currentY,r.currentX,r.currentY);break;default:return true}}catch(u){return true}break;default:return true;break}try{o=e.link[e.point[this.endPoint].startLink].sketch(t,n)}catch(u){return true}return true};S.prototype=Object.create(t.prototype);S.prototype.type="Design";S.prototype.classname="designnames";S.prototype.prepareForExport=function(){var t;return{name:this.name,comment:this.comment!==""?this.comment:t,title:this.title!==""?this.title:t,timestamp:this.timestamp,type:this.type,color:this.color?this.color:t,setToSprite:this.setToSprite?this.setToSprite:t,roll:this.roll!==0?this.roll:t,cell:this.cell?this.cell:t,startX:this.startX!==0?this.startX:t,startY:this.startY!==0?this.startY:t,endX:this.endX!==0?this.endX:t,endY:this.endY!==0?this.endY:t,handleX:this.handleX!==0?this.handleX:t,handleY:this.handleY!==0?this.handleY:t,startHandleX:this.startHandleX!==0?this.startHandleX:t,startHandleY:this.startHandleY!==0?this.startHandleY:t,endHandleX:this.endHandleX!==0?this.endHandleX:t,endHandleY:this.endHandleY!==0?this.endHandleY:t,startRangeX:this.startRangeX!==0?this.startRangeX:t,startRangeY:this.startRangeY!==0?this.startRangeY:t,endRangeX:this.endRangeX!==1?this.endRangeX:t,endRangeY:this.endRangeY!==1?this.endRangeY:t,autoUpdate:this.autoUpdate?this.autoUpdate:t,startRadius:e.xt(this.startRadius)&&this.startRadius!==0?this.startRadius:t,endRadius:e.xt(this.endRadius)&&this.endRadius!==0?this.endRadius:t,startRangeRadius:e.xt(this.startRangeRadius)&&this.startRangeRadius!==.5?this.startRangeRadius:t,endRangeRadius:e.xt(this.endRangeRadius)&&this.endRangeRadius!==0?this.endRangeRadius:t}};S.prototype.setToDefaults=function(){var t;this.set({comment:"",title:"",setToSprite:false,roll:0,startX:0,startY:0,endX:0,endY:0,handleX:0,handleY:0,startHandleX:0,startHandleY:0,endHandleX:0,endHandleY:0,startRangeX:0,startRangeY:0,endRangeX:1,endRangeY:1,autoUpdate:false,startRadius:e.xt(this.startRadius)?0:t,endRadius:e.xt(this.endRadius)?0:t,startRangeRadius:e.xt(this.startRangeRadius)?.5:t,endRangeRadius:e.xt(this.endRangeRadius)?0:t});return this};S.prototype.setDelta=function(t){t=e.isa(t,"obj")?t:{};if(t.roll){this.roll+=t.roll}if(t.startX){this.startX+=t.startX}if(t.startY){this.startY+=t.startY}if(t.startRadius){this.startRadius+=t.startRadius}if(t.endX){this.endX+=t.endX}if(t.endY){this.endY+=t.endY}if(t.endRadius){this.endRadius+=t.endRadius}if(t.startRangeRadius){this.startRangeRadius+=t.startRangeRadius}if(t.endRangeRadius){this.endRangeRadius+=t.endRangeRadius}if(t.handleX){this.handleX+=t.handleX}if(t.handleY){this.handleY+=t.handleY}if(t.startHandleX){this.startHandleX+=t.startHandleX}if(t.startHandleY){this.startHandleY+=t.startHandleY}if(t.endHandleX){this.endHandleX+=t.endHandleX}if(t.endHandleY){this.endHandleY+=t.endHandleY}if(t.startRangeX){this.startRangeX+=t.startRangeX}if(t.startRangeY){this.startRangeY+=t.startRangeY}if(t.endRangeX){this.endRangeX+=t.endRangeX}if(t.endRangeY){this.endRangeY+=t.endRangeY}this.update();return this};S.prototype.set=function(e){t.prototype.set.call(this,e);this.update();return this};S.prototype.update=function(){this.makeGradient();this.sortStops();this.applyStops();return this};S.prototype.makeGradient=function(){var t=e.context[this.cell];var n;switch(this.type){case"Gradient":n=t.createLinearGradient(this.startX+this.startHandleX+this.handleX,this.startY+this.startHandleY+this.handleY,this.endX+this.endHandleX+this.handleX,this.endY+this.endHandleY+this.handleY);break;case"RadialGradient":n=t.createRadialGradient(this.startX+this.startHandleX+this.handleX,this.startY+this.startHandleY+this.handleY,this.startRadius,this.endX+this.endHandleX+this.handleX,this.endY+this.endHandleY+this.handleY,this.endRadius);break;default:n=false}e.dsn[this.name]=n;return this};S.prototype.sortStops=function(){for(var e=0,t=this.color.length;e<t;e++){this.color[e].stop+=this.roll;if(!this.color[e].stop.isBetween(0,1,true)){this.color[e].stop=this.color[e].stop>.5?this.color[e].stop-1:this.color[e].stop+1}if(this.color[e].stop<=0){this.color[e].stop=1e-6}else if(this.color[e].stop>=1){this.color[e].stop=.999999}}this.color.sort(function(e,t){return e.stop-t.stop})};S.prototype.applyStops=function(){if(e.dsn[this.name]){for(var t=0,n=this.color.length;t<n;t++){e.dsn[this.name].addColorStop(this.color[t].stop,this.color[t].color)}}return this};x.prototype=Object.create(S.prototype);x.prototype.type="Gradient";x.prototype.classname="designnames";x.prototype.swap=function(){var e=this.startX;this.startX=this.endX;this.endX=e;var t=this.startY;this.startY=this.endY;this.endY=t;this.update();return this};T.prototype=Object.create(S.prototype);T.prototype.type="RadialGradient";T.prototype.classname="designnames";T.prototype.swap=function(){var e=this.startX;this.startX=this.endX;this.endX=e;var t=this.startY;this.startY=this.endY;this.endY=t;var n=this.startRadius;this.startRadius=this.endRadius;this.endRadius=t;this.update();return this};N.prototype=Object.create(t.prototype);N.prototype.type="Pattern";N.prototype.classname="designnames";N.prototype.prepareForExport=function(){var e;return{name:this.name,comment:this.comment!==""?this.comment:e,title:this.title!==""?this.title:e,timestamp:this.timestamp,type:this.type,repeat:this.repeat!=="repeat"?this.repeat:e,image:this.image?this.image:e,source:this.source?this.source:e}};N.prototype.setToDefaults=function(){this.set({comment:"",title:"",repeat:"repeat"});return this};N.prototype.setImage=function(t,n,r){if(e.isa(t,"str")){var i=new Image;i.id=n;i.onload=function(r){try{var s=e.newImage({name:n,element:i});e.design[n].image=s.name;e.design[n].source=t;e.design[n].makeDesign();if(e.isa(r,"fn")){r()}}catch(o){console.log("Pattern "+[this.name]+" - setImage() failed - "+o.name+" error: "+o.message);return this}};i.src=t}else if(e.isa(t,"obj")){this.image=t.name;this.source=t.source;this.makeDesign();if(e.isa(r,"fn")){r()}}else{console.log("Pattern "+[this.name]+" - setImage() failed - source not a string or an object")}return this};N.prototype.set=function(e){t.prototype.set.call(this,e);this.setImage();return this};N.prototype.get=function(){return e.xt(e.dsn[this.name])?e.dsn[this.name]:"rgba(0,0,0,0)"};N.prototype.makeDesign=function(t){var n=e.xt(t)?e.context[t]:e.context[e.pad[e.currentPad].current];try{if(this.image){if(e.img[this.image]){e.dsn[this.name]=n.createPattern(e.img[this.image],this.repeat);return this}return this}return this}catch(r){return this}};N.prototype.clone=function(t){var n=e.newPattern(t);return n};C.prototype=Object.create(t.prototype);C.prototype.type="Color";C.prototype.classname="designnames";C.prototype.prepareForExport=function(){var e;return{name:this.name,comment:this.comment!==""?this.comment:e,title:this.title!==""?this.title:e,timestamp:this.timestamp,type:this.type,r:this.r!==0?this.r:e,g:this.g!==0?this.g:e,b:this.b!==0?this.b:e,a:this.a!==1?this.a:e,rShift:this.rShift!==0?this.rShift:e,gShift:this.gShift!==0?this.gShift:e,bShift:this.bShift!==0?this.bShift:e,aShift:this.aShift!==0?this.aShift:e,rMax:this.rMax!==255?this.rMax:e,gMax:this.gMax!==255?this.gMax:e,bMax:this.bMax!==255?this.bMax:e,aMax:this.aMax!==1?this.aMax:e,rMin:this.rMin!==0?this.rMin:e,gMin:this.gMin!==0?this.gMin:e,bMin:this.bMin!==0?this.bMin:e,aMin:this.aMin!==0?this.aMin:e,rBounce:this.rBounce?this.rBounce:e,gBounce:this.gBounce?this.gBounce:e,bBounce:this.bBounce?this.bBounce:e,aBounce:this.aBounce?this.aBounce:e,autoUpdate:this.autoUpdate?this.autoUpdate:e}};C.prototype.setToDefaults=function(){this.set({comment:"",title:"",r:0,g:0,b:0,a:1,rShift:0,gShift:0,bShift:0,aShift:0,rMax:255,gMax:255,bMax:255,aMax:1,rMin:0,gMin:0,bMin:0,aMin:0,rBounce:false,gBounce:false,bBounce:false,aBounce:false,autoUpdate:false});return this};C.prototype.get=function(){this.checkValues();return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"};C.prototype.generateRandomColor=function(t){t=e.isa(t,"obj")?t:{};this.r=t.r||parseInt((Math.random()*(this.rMax-this.rMin)+this.rMin).toFixed());this.g=t.g||parseInt((Math.random()*(this.gMax-this.gMin)+this.gMin).toFixed());this.b=t.b||parseInt((Math.random()*(this.bMax-this.bMin)+this.bMin).toFixed());this.a=t.a||parseFloat((Math.random()*(this.aMax-this.aMin)+this.aMin).toFixed(6));this.checkValues();return this};C.prototype.checkValues=function(){this.r=this.r>255?255:this.r<0?0:this.r;this.g=this.g>255?255:this.g<0?0:this.g;this.b=this.b>255?255:this.b<0?0:this.b;this.a=this.a>1?1:this.a<0?0:this.a;return this};C.prototype.set=function(n){t.prototype.set.call(this,n);n=e.isa(n,"obj")?n:{};if(n.random){this.generateRandomColor(n)}this.checkValues();return this};C.prototype.update=function(){var e=["r","g","b","a"];for(var t=0,n=e.length;t<n;t++){if(!(this[e[t]]+this[e[t]+"Shift"]).isBetween(this[e[t]+"Max"],this[e[t]+"Min"],true)){if(this[e[t]+"Bounce"]){this[e[t]+"Shift"]=-this[e[t]+"Shift"]}else{this[e[t]]=this[e[t]]>(this[e[t]+"Max"]+this[e[t]+"Min"])/2?this[e[t]+"Max"]:this[e[t]+"Min"];this[e[t]+"Shift"]=0}}this[e[t]]+=this[e[t]+"Shift"]}return this};C.prototype.setDelta=function(t){t=e.isa(t,"obj")?t:{};this.r+=t.r||0;this.g+=t.g||0;this.b+=t.b||0;this.a+=t.a||0;this.checkValues();return this};C.prototype.convert=function(t){t=e.isa(t,"str")?t:"";if(t.length>0){t.toLowerCase();var n;if(t[0]==="#"){if(t.length<5){this.r=this.toDecimal(t[1]+t[1]);this.g=this.toDecimal(t[2]+t[2]);this.b=this.toDecimal(t[3]+t[3])}else if(t.length<8){this.r=this.toDecimal(t[1]+t[2]);this.g=this.toDecimal(t[3]+t[4]);this.b=this.toDecimal(t[5]+t[6])}}else if(/rgb\(/.test(t)){n=t.match(/([0-9.]+\b)/g);if(/%/.test(t)){this.r=parseInt(n[0]/100*255,10);this.g=parseInt(n[1]/100*255,10);this.b=parseInt(n[2]/100*255,10)}else{this.r=parseInt(n[0],10);this.g=parseInt(n[1],10);this.b=parseInt(n[2],10)}}else if(/rgba\(/.test(t)){n=t.match(/([0-9.]+\b)/g);this.r=n[0];this.g=n[1];this.b=n[2];this.a=n[3]}else{switch(t){case"green":this.r=0;this.g=128;this.b=0;break;case"silver":this.r=192;this.g=192;this.b=192;break;case"lime":this.r=0;this.g=255;this.b=0;break;case"gray":this.r=128;this.g=128;this.b=128;break;case"grey":this.r=128;this.g=128;this.b=128;break;case"olive":this.r=128;this.g=128;this.b=0;break;case"white":this.r=255;this.g=255;this.b=255;break;case"yellow":this.r=255;this.g=255;this.b=0;break;case"maroon":this.r=128;this.g=0;this.b=0;break;case"navy":this.r=0;this.g=0;this.b=128;break;case"red":this.r=255;this.g=0;this.b=0;break;case"blue":this.r=0;this.g=0;this.b=255;break;case"purple":this.r=128;this.g=0;this.b=128;break;case"teal":this.r=0;this.g=128;this.b=128;break;case"fuchsia":this.r=255;this.g=0;this.b=255;break;case"aqua":this.r=0;this.g=255;this.b=255;break;default:this.r=0;this.g=0;this.b=0;break}}}this.checkValues();return this};C.prototype.toDecimal=function(e){return parseInt(e,16)};C.prototype.toHex=function(e){return e.toString(16)};e.initialize();return e}()