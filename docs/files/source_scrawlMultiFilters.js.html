<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>source\scrawlMultiFilters.js - scrawl-canvas</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="scrawl-canvas"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 7.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Action.html">Action</a></li>
            
                <li><a href="../classes/Animation.html">Animation</a></li>
            
                <li><a href="../classes/Base.html">Base</a></li>
            
                <li><a href="../classes/Block.html">Block</a></li>
            
                <li><a href="../classes/Cell.html">Cell</a></li>
            
                <li><a href="../classes/Color.html">Color</a></li>
            
                <li><a href="../classes/Context.html">Context</a></li>
            
                <li><a href="../classes/Device.html">Device</a></li>
            
                <li><a href="../classes/Element.html">Element</a></li>
            
                <li><a href="../classes/ElementGroup.html">ElementGroup</a></li>
            
                <li><a href="../classes/Entity.html">Entity</a></li>
            
                <li><a href="../classes/Filter.html">Filter</a></li>
            
                <li><a href="../classes/Force.html">Force</a></li>
            
                <li><a href="../classes/Frame.html">Frame</a></li>
            
                <li><a href="../classes/FramePoint.html">FramePoint</a></li>
            
                <li><a href="../classes/Gradient.html">Gradient</a></li>
            
                <li><a href="../classes/Group.html">Group</a></li>
            
                <li><a href="../classes/Image.html">Image</a></li>
            
                <li><a href="../classes/Link.html">Link</a></li>
            
                <li><a href="../classes/Multifilter.html">Multifilter</a></li>
            
                <li><a href="../classes/Pad.html">Pad</a></li>
            
                <li><a href="../classes/PageElement.html">PageElement</a></li>
            
                <li><a href="../classes/Particle.html">Particle</a></li>
            
                <li><a href="../classes/Path.html">Path</a></li>
            
                <li><a href="../classes/Pattern.html">Pattern</a></li>
            
                <li><a href="../classes/Phrase.html">Phrase</a></li>
            
                <li><a href="../classes/Picture.html">Picture</a></li>
            
                <li><a href="../classes/Point.html">Point</a></li>
            
                <li><a href="../classes/Position.html">Position</a></li>
            
                <li><a href="../classes/Quaternion.html">Quaternion</a></li>
            
                <li><a href="../classes/RadialGradient.html">RadialGradient</a></li>
            
                <li><a href="../classes/Shape.html">Shape</a></li>
            
                <li><a href="../classes/Spring.html">Spring</a></li>
            
                <li><a href="../classes/SpriteAnimation.html">SpriteAnimation</a></li>
            
                <li><a href="../classes/Stack.html">Stack</a></li>
            
                <li><a href="../classes/Styles.html">Styles</a></li>
            
                <li><a href="../classes/Text.html">Text</a></li>
            
                <li><a href="../classes/Ticker.html">Ticker</a></li>
            
                <li><a href="../classes/Tween.html">Tween</a></li>
            
                <li><a href="../classes/Vector.html">Vector</a></li>
            
                <li><a href="../classes/Video.html">Video</a></li>
            
                <li><a href="../classes/Wheel.html">Wheel</a></li>
            
                <li><a href="../classes/window.scrawl.html">window.scrawl</a></li>
            
                <li><a href="../classes/window.scrawl_Animation.html">window.scrawl_Animation</a></li>
            
                <li><a href="../classes/window.scrawl_Block.html">window.scrawl_Block</a></li>
            
                <li><a href="../classes/window.scrawl_Collisions.html">window.scrawl_Collisions</a></li>
            
                <li><a href="../classes/window.scrawl_Color.html">window.scrawl_Color</a></li>
            
                <li><a href="../classes/window.scrawl_Factories.html">window.scrawl_Factories</a></li>
            
                <li><a href="../classes/window.scrawl_Frame.html">window.scrawl_Frame</a></li>
            
                <li><a href="../classes/window.scrawl_Images.html">window.scrawl_Images</a></li>
            
                <li><a href="../classes/window.scrawl_MultiFilters.html">window.scrawl_MultiFilters</a></li>
            
                <li><a href="../classes/window.scrawl_Path.html">window.scrawl_Path</a></li>
            
                <li><a href="../classes/window.scrawl_Phrase.html">window.scrawl_Phrase</a></li>
            
                <li><a href="../classes/window.scrawl_Physics.html">window.scrawl_Physics</a></li>
            
                <li><a href="../classes/window.scrawl_SaveLoad.html">window.scrawl_SaveLoad</a></li>
            
                <li><a href="../classes/window.scrawl_Shape.html">window.scrawl_Shape</a></li>
            
                <li><a href="../classes/window.scrawl_Stacks.html">window.scrawl_Stacks</a></li>
            
                <li><a href="../classes/window.scrawl_Wheel.html">window.scrawl_Wheel</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/scrawlAnimation.html">scrawlAnimation</a></li>
            
                <li><a href="../modules/scrawlBlock.html">scrawlBlock</a></li>
            
                <li><a href="../modules/scrawlCollisions.html">scrawlCollisions</a></li>
            
                <li><a href="../modules/scrawlColor.html">scrawlColor</a></li>
            
                <li><a href="../modules/scrawlCore.html">scrawlCore</a></li>
            
                <li><a href="../modules/scrawlFrame.html">scrawlFrame</a></li>
            
                <li><a href="../modules/scrawlImages.html">scrawlImages</a></li>
            
                <li><a href="../modules/scrawlMultiFilters.html">scrawlMultiFilters</a></li>
            
                <li><a href="../modules/scrawlPath.html">scrawlPath</a></li>
            
                <li><a href="../modules/scrawlPathFactories.html">scrawlPathFactories</a></li>
            
                <li><a href="../modules/scrawlPhrase.html">scrawlPhrase</a></li>
            
                <li><a href="../modules/scrawlPhysics.html">scrawlPhysics</a></li>
            
                <li><a href="../modules/scrawlSaveLoad.html">scrawlSaveLoad</a></li>
            
                <li><a href="../modules/scrawlShape.html">scrawlShape</a></li>
            
                <li><a href="../modules/scrawlStacks.html">scrawlStacks</a></li>
            
                <li><a href="../modules/scrawlWheel.html">scrawlWheel</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: source\scrawlMultiFilters.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//---------------------------------------------------------------------------------
// The MIT License (MIT)
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the &quot;Software&quot;), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
//---------------------------------------------------------------------------------


/**
# scrawlMultiFilters

## Purpose and features

The MultiFilters extension adds a set of filter algorithms to the scrawl-canvas library.

@module scrawlMultiFilters
**/

if (window.scrawl &amp;&amp; window.scrawl.work.extensions &amp;&amp; !window.scrawl.contains(window.scrawl.work.extensions, &#x27;multifilters&#x27;)) {
	var scrawl = (function(my) {
		&#x27;use strict&#x27;;

		// polyfill
		if (!Uint8ClampedArray.prototype.slice) {
			Object.defineProperty(Uint8ClampedArray.prototype, &#x27;slice&#x27;, {
				value: Array.prototype.slice
			});
		}

		/**
# window.scrawl

scrawlMultiFilters extension adaptions to the scrawl-canvas library object

## New library sections

* scrawl.multifilter - for multifilter objects

### Hidden canvas

makes use of the default hidden canvases:
my.work.cv = my.canvas.defaultHiddenCanvasElement_base;
my.work.cvx = my.context.defaultHiddenCanvasElement_base;
my.work.cvmodel = my.ctx.defaultHiddenCanvasElement_base;
my.work.cvwrapper = my.cell.defaultHiddenCanvasElement_base;
my.work.cvcontroller = my.pad.defaultHiddenCanvasElement;
my.work.cv2 = my.canvas.defaultHiddenCanvasElement;
my.work.cvx2 = my.context.defaultHiddenCanvasElement;
my.work.cvmodel2 = my.ctx.defaultHiddenCanvasElement;
my.work.cvwrapper2 = my.cell.defaultHiddenCanvasElement;



@class window.scrawl_MultiFilters
**/
		my.pushUnique(my.work.sectionlist, &#x27;multifilter&#x27;);
		my.pushUnique(my.work.nameslist, &#x27;multifilternames&#x27;);
		my.work.multiFilterActiveFlag = false;

		/**
A __factory__ function to generate new Filter objects
@method makeFilter
@param {Object} items Key:value Object argument for setting attributes
@return Multifilter object
**/
		my.makeFilter = function(items) {
			return new my.Filter(items);
		};
		/**
A __factory__ function to generate new Multifilter objects
@method makeMultiFilter
@param {Object} items Key:value Object argument for setting attributes
@return Multifilter object
**/
		my.makeMultiFilter = function(items) {
			return new my.MultiFilter(items);
		};
		/**
MULTIFILTERNAME String, to be applied to this entity
@property Entity.multiFilter
@type String
@default &#x27;&#x27;
**/
		my.Entity.prototype.defs.multiFilter = &#x27;&#x27;;
		if (my.xt(my.Block)) {
			my.mergeInto(my.Block.prototype.defs, my.Entity.prototype.defs);
		}
		if (my.xt(my.Shape)) {
			my.mergeInto(my.Shape.prototype.defs, my.Entity.prototype.defs);
		}
		if (my.xt(my.Wheel)) {
			my.mergeInto(my.Wheel.prototype.defs, my.Entity.prototype.defs);
		}
		if (my.xt(my.Picture)) {
			my.mergeInto(my.Picture.prototype.defs, my.Entity.prototype.defs);
		}
		if (my.xt(my.Phrase)) {
			my.mergeInto(my.Phrase.prototype.defs, my.Entity.prototype.defs);
		}
		if (my.xt(my.Path)) {
			my.mergeInto(my.Path.prototype.defs, my.Entity.prototype.defs);
		}
		/**
Group constructor hook function - modified by multiFilter module

Adds the multiFilter, filterOnStroke and filterLevel attributes to Group objects
@method multifiltersGroupInit
@private
**/
		my.Group.prototype.multifiltersGroupInit = function(items) {
			items = my.safeObject(items);
			this.multiFilter = (my.xt(items.multiFilter)) ? items.multiFilter : &#x27;&#x27;;
		};
		/**
Entity constructor hook function - modified by multiFilter module

Adds the multiFilter, filterOnStroke and filterLevel attributes to Entity objects
@method multifiltersEntityInit
@private
**/
		my.Entity.prototype.multifiltersEntityInit = function(items) {
			items = my.safeObject(items);
			this.multiFilter = (my.xt(items.multiFilter)) ? items.multiFilter : &#x27;&#x27;;
		};
		/**
Group.stamp hook function - modified by multifilters extension
@method stampMultifilter
@private
**/
		my.Group.prototype.stampMultifilter = function(engine, cell) {
			var filter = my.multifilter[this.multiFilter],
				work = my.work,
				hostCanvas = work.cv,
				hostCell = work.cvwrapper,
				hostCtx = my.work.cvmodel,
				hostEngine = my.work.cvx;

			if (filter.stencil) {
				hostEngine.globalCompositeOperation = &#x27;source-in&#x27;;
				hostCell.copyCellToSelf(cell);
				hostEngine.globalCompositeOperation = &#x27;source-over&#x27;;
			}

			filter.apply(my.work.cv, my.work.cvx);
			engine.setTransform(1, 0, 0, 1, 0, 0);
			engine.drawImage(hostCanvas, 0, 0);
		};
		/**
Entity.stamp hook function - modified by multifilters extension
@method stampMultifilter
@private
**/
		my.Entity.prototype.stampMultifilter = function(engine, cell) {
			var filter = my.multifilter[this.multiFilter],
				work = my.work,
				hostCanvas = work.cv2,
				hostCell = work.cvwrapper2,
				hostCtx = my.work.cvmodel2,
				hostEngine = my.work.cvx2,
				gco,
				ctx = my.ctx[this.name];

			if (filter.stencil) {
				hostEngine.globalCompositeOperation = &#x27;source-in&#x27;;
				hostCell.copyCellToSelf(cell);
				hostEngine.globalCompositeOperation = &#x27;source-over&#x27;;
			}

			filter.apply(my.work.cv2, my.work.cvx2);
			gco = engine.globalCompositeOperation;
			engine.setTransform(1, 0, 0, 1, 0, 0);
			engine.globalCompositeOperation = ctx.globalCompositeOperation;
			engine.drawImage(hostCanvas, 0, 0);
			engine.globalCompositeOperation = gco;
		};

		/**
# Filter

## Instantiation

* scrawl.makeFilter()

## Purpose

* Defines a filter effect, for use in a MultiFilter definitions Array attribute

## Access

* not stored in Scrawl library, accessible via MultiFilter.definitions

@class Filter
@constructor
@extends Base
@param {Object} [items] Key:value Object argument for setting attributes
**/
		my.Filter = function Filter(items) {
			var get = my.xtGet;
			items = my.safeObject(items);
			this.name = get(items.name, &#x27;generic&#x27;);
			this.multiFilter = get(items.multiFilter, &#x27;&#x27;);
			this.species = get(items.species, &#x27;undefined&#x27;);
			this.level = get(items.level, 0);
			this.red = get(items.red, 0);
			this.green = get(items.green, 0);
			this.blue = get(items.blue, 0);
			this.redInRed = get(items.redInRed, 0);
			this.redInGreen = get(items.redInGreen, 0);
			this.redInBlue = get(items.redInBlue, 0);
			this.greenInRed = get(items.greenInRed, 0);
			this.greenInGreen = get(items.greenInGreen, 0);
			this.greenInBlue = get(items.greenInBlue, 0);
			this.blueInRed = get(items.blueInRed, 0);
			this.blueInGreen = get(items.blueInGreen, 0);
			this.blueInBlue = get(items.blueInBlue, 0);
			this.offsetX = get(items.offsetX, 0);
			this.offsetY = get(items.offsetY, 0);
			this.blockWidth = get(items.blockWidth, 0);
			this.blockHeight = get(items.blockHeight, 0);
			this.weights = get(items.weights, []);
			this.normalize = get(items.normalize, false);
			this.radius = get(items.radius, 0);
			this.step = get(items.step, 1);
			this.wrap = get(items.wrap, false);
			if (items.ranges) {
				this.setRanges(items.ranges);
			}
			this.cacheAction = get(items.cacheAction, false);
			this.action = get(items.action, false);
			return this;
		};
		my.Filter.prototype = Object.create(Object.prototype);
		/**
@property type
@type String
@default &#x27;Filter&#x27;
@final
**/
		my.Filter.prototype.type = &#x27;Filter&#x27;;
		my.Filter.prototype.defs = {
			multiFilter: &#x27;&#x27;,
			species: &#x27;&#x27;,
			level: 0,
			red: 0,
			green: 0,
			blue: 0,
			redInRed: 0,
			redInGreen: 0,
			redInBlue: 0,
			greenInRed: 0,
			greenInGreen: 0,
			greenInBlue: 0,
			blueInRed: 0,
			blueInGreen: 0,
			blueInBlue: 0,
			offsetX: 0,
			offsetY: 0,
			blockWidth: 0,
			blockHeight: 0,
			weights: [],
			normalize: false,
			wrap: false,
			step: 1,
			radius: 0,
			ranges: [],
			action: false,
			cacheAction: false
		};


		my.Filter.prototype.set = function(items) {
			var d = this.defs,
				xt = my.xt;
			for (var i in items) {
				if (i === &#x27;ranges&#x27;) {
					this.setRanges(items[i]);
				}
				else if (xt(d[i])) {
					this[i] = items[i];
				}
			}
			return this;
		};
		my.Filter.prototype.setRanges = function(item) {
			var result = [],
				range, i, iz;
			if (Array.isArray(item)) {
				for (var i = 0, iz = item.length; i &lt; iz; i++) {
					range = item[i];
					if (range.length === 6) {
						result.push(new Uint8ClampedArray(range));
					}
				}
			}
			this.ranges = [];
			if (result.length) {
				this.ranges = result;
			}
			return this;
		};


		my.Filter.prototype.clone = function(items) {
			var merged = my.mergeOver(JSON.parse(JSON.stringify(this)), my.safeObject(items));
			return new my.Filter(merged);
		};


		my.Filter.prototype.update = function() {
			var m = my.multifilter[this.multiFilter];
			if (m) {
				this.width = m.currentWidth;
				this.height = m.currentHeight;
				this.area = m.currentArea;
				this.cache = false;
			}
		};


		my.Filter.prototype.prepare = function() {
			if (this.checkCache[this.species]) {
				this.checkCache[this.species].call(this);
			}
			if (this.cacheAction) {
				this.cacheAction();
			}
		};


		my.Filter.prototype.do = function(data) {
			if (this.f[this.species]) {
				this.f[this.species].call(this, data);
			}
			if (this.action) {
				this.action(data);
			}
		};



		/**
An object containing pre-defined filter functionality.
**/
		my.Filter.prototype.checkCache = {
			pixelate: function() {
				var cache = this.cache,
					rows, h, cols, w, ceil,
					segment,
					x, y,
					multi, get, res, c,
					i, j, x1, x2, y1, y2;

				if (!cache) {
					multi = my.multifilter[this.multiFilter];
					if (multi) {
						w = this.blockWidth || 1;
						h = this.blockHeight || 1;
						ceil = Math.ceil;
						cols = ceil(multi.currentWidth / w);
						rows = ceil(multi.currentHeight / h);

						x = this.offsetX || 0;
						x = (x &gt; w) ? 0 : x;
						y = this.offsetY || 0;
						y = (y &gt; h) ? 0 : y;

						segment = this.segment = w * h;

						cache = new Uint32Array((cols + 1) * (rows + 1) * segment);
						c = 0;
						get = multi.getIndexes;

						for (i = -1; i &lt; rows; i++) {
							for (j = -1; j &lt; cols; j++) {
								y1 = (i * h) + y;
								x1 = (j * w) + x;
								y2 = y1 + h;
								x2 = x1 + w;
								res = get.call(multi, x1, y1, x2, y2);
								cache.set(res, c);
								c += segment;
							}
						}
						this.cache = cache;
					}
				}
			},
			matrix: function() {
				var cache = this.cache,
					multi, get, c, wrap,
					w, cw, h, ch, x, y,
					i, j, x1, x2, y1, y2;

				if (!cache) {
					multi = my.multifilter[this.multiFilter];
					if (multi) {
						w = this.blockWidth || 1;
						h = this.blockHeight || 1;
						x = this.offsetX || 0;
						y = this.offsetY || 0;
						wrap = this.wrap || false;
						cw = multi.currentWidth;
						ch = multi.currentHeight;

						cache = [];
						c = 0;
						get = (wrap) ? multi.getWrappedIndexes : multi.getIndexes;

						for (i = 0; i &lt; ch; i++) {
							for (j = 0; j &lt; cw; j++) {
								y1 = i + y;
								x1 = j + x;
								y2 = y1 + h;
								x2 = x1 + w;
								cache[c] = get.call(multi, x1, y1, x2, y2);
								c++;
							}
						}
						this.cache = cache;
					}
				}
			},
			blur: function() {
				var cache = this.cache,
					multi, get, c, wrap,
					w, cw, h, ch, x, y, r,
					i, j, x1, x2, y1, y2;

				if (!cache) {
					multi = my.multifilter[this.multiFilter];
					if (multi) {
						r = this.radius || 0;
						wrap = this.wrap || false;
						cw = multi.currentWidth;
						ch = multi.currentHeight;

						cache = [];
						cache[0] = [];
						cache[1] = [];
						get = (wrap) ? multi.getWrappedIndexes : multi.getIndexes;

						// horizontal sweep
						c = 0;
						w = (r * 2) + 1;
						h = 1;
						x = -r;
						y = 0;
						for (i = 0; i &lt; ch; i++) {
							for (j = 0; j &lt; cw; j++) {
								y1 = i + y;
								x1 = j + x;
								y2 = y1 + h;
								x2 = x1 + w;
								cache[0][c] = get.call(multi, x1, y1, x2, y2);
								c++;
							}
						}

						// vertical sweep
						c = 0;
						w = 1;
						h = (r * 2) + 1;
						x = 0;
						y = -r;
						for (i = 0; i &lt; ch; i++) {
							for (j = 0; j &lt; cw; j++) {
								y1 = i + y;
								x1 = j + x;
								y2 = y1 + h;
								x2 = x1 + w;
								cache[1][c] = get.call(multi, x1, y1, x2, y2);
								c++;
							}
						}
						this.cache = cache;
					}
				}
			},
		};


		my.Filter.prototype.f = {
			default: function(data) {},
			grayscale: function(data) {
				var len, posR, posG, posB, posA, gray;
				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						gray = (0.2126 * data[posR]) + (0.7152 * data[posG]) + (0.0722 * data[posB]);
						data[posR] = gray;
						data[posG] = gray;
						data[posB] = gray;
					}
				}
			},
			sepia: function(data) {
				var len, posR, posG, posB, posA,
					r, g, b, red, green, blue;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						r = data[posR];
						g = data[posG];
						b = data[posB];
						red = (r * 0.393) + (g * 0.769) + (b * 0.189);
						green = (r * 0.349) + (g * 0.686) + (b * 0.168);
						blue = (r * 0.272) + (g * 0.534) + (b * 0.131);
						data[posR] = red;
						data[posG] = green;
						data[posB] = blue;
					}
				}
			},
			invert: function(data) {
				var len, posR, posG, posB, posA;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						data[posR] = 256 - data[posR];
						data[posG] = 256 - data[posG];
						data[posB] = 256 - data[posB];
					}
				}
			},
			red: function(data) {
				var len, posG, posB, posA;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posG = posA - 2;
						posB = posA - 1;
						data[posG] = 0;
						data[posB] = 0;
					}
				}
			},
			green: function(data) {
				var len, posR, posB, posA;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posB = posA - 1;
						data[posR] = 0;
						data[posB] = 0;
					}
				}
			},
			blue: function(data) {
				var len, posR, posG, posA;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						data[posR] = 0;
						data[posG] = 0;
					}
				}
			},
			notred: function(data) {
				var len, posR;

				for (posR = 0, len = data.length; posR &lt; len; posR += 4) {
					data[posR] = 0;
				}
			},
			notgreen: function(data) {
				var len, posG;

				for (posG = 1, len = data.length; posG &lt; len; posG += 4) {
					data[posG] = 0;
				}
			},
			notblue: function(data) {
				var len, posB;

				for (posB = 2, len = data.length; posB &lt; len; posB += 4) {
					data[posB] = 0;
				}
			},
			cyan: function(data) {
				var len, posR, posG, posB, posA, gray;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						gray = (data[posG] + data[posB]) / 2;
						data[posR] = 0;
						data[posG] = gray;
						data[posB] = gray;
					}
				}
			},
			magenta: function(data) {
				var len, posR, posG, posB, posA, gray;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						gray = (data[posR] + data[posB]) / 2;
						data[posR] = gray;
						data[posG] = 0;
						data[posB] = gray;
					}
				}
			},
			yellow: function(data) {
				var len, posR, posG, posB, posA, gray;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						gray = (data[posG] + data[posR]) / 2;
						data[posR] = gray;
						data[posG] = gray;
						data[posB] = 0;
					}
				}
			},
			brightness: function(data) {
				var len, posR, posG, posB, posA,
					level = this.level || 0;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						data[posR] *= level;
						data[posG] *= level;
						data[posB] *= level;
					}
				}
			},
			saturation: function(data) {
				var len, posR, posG, posB, posA,
					level = this.level || 0;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						data[posR] = 127 + ((data[posR] - 127) * level);
						data[posG] = 127 + ((data[posG] - 127) * level);
						data[posB] = 127 + ((data[posB] - 127) * level);
					}
				}
			},
			threshold: function(data) {
				var len, posR, posG, posB, posA, gray,
					level = this.level || 0;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						gray = (0.2126 * data[posR]) + (0.7152 * data[posG]) + (0.0722 * data[posB]);
						gray = (gray &gt; level) ? 255 : 0;
						data[posR] = gray;
						data[posG] = gray;
						data[posB] = gray;
					}
				}
			},
			channels: function(data) {
				var len, posR, posG, posB, posA,
					red = this.red || 0,
					green = this.green || 0,
					blue = this.blue || 0;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						data[posR] *= red;
						data[posG] *= green;
						data[posB] *= blue;
					}
				}
			},
			channelstep: function(data) {
				var len, posR, posG, posB, posA,
					red = this.red || 1,
					green = this.green || 1,
					blue = this.blue || 1,
					floor = Math.floor;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						data[posR] = floor(data[posR] / red) * red;
						data[posG] = floor(data[posG] / green) * green;
						data[posB] = floor(data[posB] / blue) * blue;
					}
				}
			},
			tint: function(data) {
				var len, posR, posG, posB, posA, r, g, b,
					redInRed = this.redInRed || 0,
					redInGreen = this.redInGreen || 0,
					redInBlue = this.redInBlue || 0,
					greenInRed = this.greenInRed || 0,
					greenInGreen = this.greenInGreen || 0,
					greenInBlue = this.greenInBlue || 0,
					blueInRed = this.blueInRed || 0,
					blueInGreen = this.blueInGreen || 0,
					blueInBlue = this.blueInBlue || 0;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						posR = posA - 3;
						posG = posA - 2;
						posB = posA - 1;
						r = data[posR];
						g = data[posG];
						b = data[posB];
						data[posR] = (r * redInRed) + (g * greenInRed) + (b * blueInRed);
						data[posG] = (r * redInGreen) + (g * greenInGreen) + (b * blueInGreen);
						data[posB] = (r * redInBlue) + (g * greenInBlue) + (b * blueInBlue);
					}
				}
			},
			pixelate: function(data) {
				var cache = this.cache,
					segment = this.segment,
					blocks = cache.length / segment,
					red, green, blue,
					pos, alphas, counter, k, c;

				for (c = 0; c &lt; blocks; c++) {
					pos = c * segment;
					alphas = cache.slice(pos, pos + segment);
					red = green = blue = counter = 0;

					for (k = 0; k &lt; segment; k++) {
						pos = alphas[k];
						if (!pos) {
							break;
						}
						if (data[pos]) {
							counter++;
							pos -= 3;
							red += data[pos++];
							green += data[pos++];
							blue += data[pos];
						}
					}
					if (counter &gt; 0) {
						red /= counter;
						green /= counter;
						blue /= counter;
						for (k = 0; k &lt; segment; k++) {
							pos = alphas[k];
							if (!pos) {
								break;
							}
							if (data[pos]) {
								pos -= 3
								data[pos++] = red;
								data[pos++] = green;
								data[pos] = blue;
							}
						}
					}
				}
			},
			matrix: function(data) {
				var cache = this.cache,
					datalen = data.length,
					red, green, blue,
					posR, posG, posB, posA, localA,
					alphas, len,
					weights = this.weights,
					norm = this.normalize || false,
					wt, k, c, total, temp;

				if (weights.length) {
					temp = data.slice();
					for (posA = 3, c = 0; posA &lt; datalen; posA += 4, c++) {
						if (data[posA]) {
							alphas = cache[c];
							len = alphas.length;
							red = green = blue = total = 0;

							for (k = 0; k &lt; len; k++) {
								localA = alphas[k];
								if (weights[k] &amp;&amp; temp[localA]) {
									wt = weights[k]
									posR = localA - 3;
									posG = localA - 2;
									posB = localA - 1;
									red += temp[posR] * wt;
									green += temp[posG] * wt;
									blue += temp[posB] * wt;
									total += wt;
								}
							}
							if (norm &amp;&amp; total) {
								red /= total;
								green /= total;
								blue /= total;
							}
							posR = posA - 3;
							posG = posA - 2;
							posB = posA - 1;
							data[posR] = red;
							data[posG] = green;
							data[posB] = blue;
						}
					}
				}
			},
			blur: function(data) {
				var cache,
					datalen = data.length,
					red, green, blue,
					posR, posG, posB, posA, localA,
					alphas, len,
					step = this.step || 1,
					k, c, counter, temp;

				cache = this.cache[0],
				temp = data.slice();
				for (posA = 3, c = 0; posA &lt; datalen; posA += 4, c++) {
					if (data[posA]) {
						alphas = cache[c];
						len = alphas.length;
						red = green = blue = counter = 0;

						for (k = 0; k &lt; len; k += step) {
							localA = alphas[k];
							if (temp[localA]) {
								posR = localA - 3;
								posG = localA - 2;
								posB = localA - 1;
								red += temp[posR];
								green += temp[posG];
								blue += temp[posB];
								counter++;
							}
						}
						if (counter) {
							red /= counter;
							green /= counter;
							blue /= counter;
							posR = posA - 3;
							posG = posA - 2;
							posB = posA - 1;
							data[posR] = red;
							data[posG] = green;
							data[posB] = blue;
						}
					}
				}

				cache = this.cache[1],
				temp = data.slice();
				for (posA = 3, c = 0; posA &lt; datalen; posA += 4, c++) {
					if (data[posA]) {
						alphas = cache[c];
						len = alphas.length;
						red = green = blue = counter = 0;

						for (k = 0; k &lt; len; k += step) {
							localA = alphas[k];
							if (temp[localA]) {
								posR = localA - 3;
								posG = localA - 2;
								posB = localA - 1;
								red += temp[posR];
								green += temp[posG];
								blue += temp[posB];
								counter++;
							}
						}
						if (counter) {
							red /= counter;
							green /= counter;
							blue /= counter;
							posR = posA - 3;
							posG = posA - 2;
							posB = posA - 1;
							data[posR] = red;
							data[posG] = green;
							data[posB] = blue;
						}
					}
				}
			},
			chroma: function(data) {
				var pos, posA, len,
					ranges = this.ranges,
					range, min, max, val,
					i, iz, flag;

				for (posA = 3, len = data.length; posA &lt; len; posA += 4) {
					if (data[posA]) {
						flag = false;
						for (i = 0, iz = ranges.length; i &lt; iz; i++) {
							range = ranges[i];
							min = range[2];
							pos = posA - 1;
							val = data[pos];
							if (val &gt;= min) {
								max = range[5];
								if (val &lt;= max) {
									min = range[1];
									pos--;
									val = data[pos];
									if (val &gt;= min) {
										max = range[4];
										if (val &lt;= max) {
											min = range[0];
											pos--;
											val = data[pos];
											if (val &gt;= min) {
												max = range[3];
												if (val &lt;= max) {
													flag = true;
													break;
												}
											}
										}
									}
								}
							}
						}
						if (flag) {
							data[posA] = 0;
						}
					}
				}
			},
		};


		/**
# Multifilter

## Instantiation

* scrawl.makeMultifilter()

## Purpose

* Adds a filter effect to an Entity or cell

## Access

* scrawl.multifilter.MULTIFILTERNAME - for the Multifilter object

@class Multifilter
@constructor
@extends Base
@param {Object} [items] Key:value Object argument for setting attributes
**/
		my.MultiFilter = function MultiFilter(items) {
			var get = my.xtGet;
			items = my.safeObject(items);
			my.Base.call(this, items);
			this.stencil = get(items.stencil, false);
			this.filters = [].concat(get(items.filters, []));
			this.currentWidth = 0;
			this.currentHeight = 0;
			this.currentArea = 0;
			this.currentGrid = [];
			my.multifilter[this.name] = this;
			my.pushUnique(my.multifilternames, this.name);
			return this;
		};
		my.MultiFilter.prototype = Object.create(my.Base.prototype);
		/**
@property type
@type String
@default &#x27;MultiFilter&#x27;
@final
**/
		my.MultiFilter.prototype.type = &#x27;MultiFilter&#x27;;
		my.MultiFilter.prototype.lib = &#x27;multifilter&#x27;;
		my.MultiFilter.prototype.libName = &#x27;multifilternames&#x27;;
		my.MultiFilter.prototype.defs = {
			/**
Whether to treat the entity or cell being filtered as a stencil (true) in which case the background behind the stencil is filtered, or just filter the entity itself (the default setting)
@property stencil
@type Boolean
@default false
**/
			stencil: false,
			/**
An array of arrays representing the index values for all alpha channel pixels in the canvas
@property currentGrid
@type Array
@private
@default []
**/
			currentGrid: [],
			/**
Latest canvas width
@property currentWidth
@type Number
@private
@default 0
**/
			currentWidth: 0,
			/**
Latest canvas height
@property currentHeight
@type Number
@private
@default 0
**/
			currentHeight: 0,
			/**
Latest canvas area
@property currentArea
@type Number
@private
@default 0
**/
			currentArea: 0,
			/**
An Array of filter definition Objects - each type of filter definition object must include a __filter__ String attribute (eg: &#x27;grayscale&#x27;), alongside any specific attributes required by that particular filter. Filters are processed in array order, first to last.
@property filters
@type Array
@default []
**/
			filters: []
		};
		my.mergeInto(my.MultiFilter.prototype.defs, my.Base.prototype.defs);
		/**
multifilter main function:
- prepare data from my.canvas.defaultHiddenCanvasElement
- sort filters (if required)
- iterate through filters, applying algorithms to data
- recreate filtered data in my.canvas.defaultHiddenCanvasElement

@method apply
@private
@return always true
**/
		my.MultiFilter.prototype.apply = function(canvas, cvx) {
			var img, def, filter, buff, data, width, height, j, jz;

			if (this.filters.length) {
				width = canvas.width;
				height = canvas.height;

				if (width !== this.currentWidth || height !== this.currentHeight) {
					this.currentWidth = width;
					this.currentHeight = height;
					this.currentArea = width * height;
					this.prepareGrid();
					this.updateFilters();
				}

				img = cvx.getImageData(0, 0, canvas.width, canvas.height);
				buff = img.data.buffer;
				data = new Uint8ClampedArray(buff);

				for (j = 0, jz = this.filters.length; j &lt; jz; j++) {
					filter = this.filters[j];
					filter.prepare()
					filter.do(data);
				}
				cvx.putImageData(img, 0, 0);
			}
		};
		/**
Create a reference grid, for use by certain filters:

@method prepareGrid
@private
@return always true
**/
		my.MultiFilter.prototype.prepareGrid = function() {
			var counter = 3,
				height = this.currentHeight,
				width = this.currentWidth,
				grid = [],
				row, i, j;

			for (i = 0; i &lt; height; i++) {
				row = [];
				for (j = 0; j &lt; width; j++) {
					row[j] = counter;
					counter += 4;
				}
				grid[i] = row;
			}

			this.currentGrid = grid;
			return true;
		};
		/**
Augments Base.set

@method set
@return this
**/
		my.MultiFilter.prototype.set = function(items) {
			var xt = my.xt;
			items = my.safeObject(items);
			my.Base.prototype.set.call(this, items);
			if (xt(items.filters)) {
				this.filters = [].concat(items.filters);
				this.updateFilters();
			}
		};
		/**
Force filters to update:

@method updateFilters
@private
@return always true
**/
		my.MultiFilter.prototype.updateFilters = function() {
			for (var i = 0, iz = this.filters.length; i &lt; iz; i++) {
				this.filters[i].update();
			}
			return true;
		};
		/**
Extract data from the current grid

@method getIndexes
@private
@return Array of Numbers
**/
		my.MultiFilter.prototype.getIndexes = function(col1, row1, col2, row2) {
			var result,
				w = this.currentWidth,
				h = this.currentHeight,
				grid = this.currentGrid,
				i, j, temp, lw, lh, r, c;

			if (row1 &gt; row2) {
				temp = row1;
				row1 = row2;
				row2 = temp;
			}
			if (col1 &gt; col2) {
				temp = col1;
				col1 = col2;
				col2 = temp;
			}
			row1 = (row1 &lt; 0) ? 0 : row1;
			col1 = (col1 &lt; 0) ? 0 : col1;
			row2 = (row2 &gt;= h) ? h - 1 : row2;
			col2 = (col2 &gt;= w) ? w - 1 : col2;

			if (row2 &lt; 0 || col2 &lt; 0 || row1 &gt;= h || col1 &gt;= w) {
				return [];
			}

			lw = col2 - col1;
			lh = row2 - row1;
			result = [];

			for (i = 0; i &lt; lh; i++) {
				for (j = 0; j &lt; lw; j++) {
					r = row1 + i;
					c = col1 + j;
					temp = (i * lw) + j;
					result[temp] = grid[r][c];
				}
			}

			return result;
		};
		/**
Extract data from the current grid

@method getWrappedIndexes
@private
@return Array of Numbers
**/
		my.MultiFilter.prototype.getWrappedIndexes = function(col1, row1, col2, row2) {
			var result,
				w = this.currentWidth,
				h = this.currentHeight,
				grid = this.currentGrid,
				i, j, temp, lw, lh, r, c;

			if (row1 &gt; row2) {
				temp = row1;
				row1 = row2;
				row2 = temp;
			}
			if (col1 &gt; col2) {
				temp = col1;
				col1 = col2;
				col2 = temp;
			}

			if (row2 &lt; 0 || col2 &lt; 0 || row1 &gt;= h || col1 &gt;= w) {
				return [];
			}

			lw = col2 - col1;
			lh = row2 - row1;
			result = [];

			for (i = 0; i &lt; lh; i++) {
				for (j = 0; j &lt; lw; j++) {
					r = row1 + i;
					c = col1 + j;
					if (r &lt; 0 || r &gt;= h) {
						r = (r &lt; 0) ? r + h : r - h;
					}
					if (c &lt; 0 || c &gt;= w) {
						c = (c &lt; 0) ? c + w : c - w;
					}
					temp = (i * lw) + j;
					result[temp] = grid[r][c];
				}
			}

			return result;
		};

		return my;
	}(scrawl));
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
