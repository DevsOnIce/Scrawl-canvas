<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>source\scrawlSaveLoad.js - scrawl-canvas</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="scrawl-canvas"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 6.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Action.html">Action</a></li>
            
                <li><a href="../classes/Animation.html">Animation</a></li>
            
                <li><a href="../classes/Base.html">Base</a></li>
            
                <li><a href="../classes/Block.html">Block</a></li>
            
                <li><a href="../classes/BlurFilter.html">BlurFilter</a></li>
            
                <li><a href="../classes/BrightnessFilter.html">BrightnessFilter</a></li>
            
                <li><a href="../classes/Cell.html">Cell</a></li>
            
                <li><a href="../classes/ChannelsFilter.html">ChannelsFilter</a></li>
            
                <li><a href="../classes/ChannelStepFilter.html">ChannelStepFilter</a></li>
            
                <li><a href="../classes/Color.html">Color</a></li>
            
                <li><a href="../classes/Context.html">Context</a></li>
            
                <li><a href="../classes/Design.html">Design</a></li>
            
                <li><a href="../classes/Device.html">Device</a></li>
            
                <li><a href="../classes/Element.html">Element</a></li>
            
                <li><a href="../classes/ElementGroup.html">ElementGroup</a></li>
            
                <li><a href="../classes/Entity.html">Entity</a></li>
            
                <li><a href="../classes/Filter.html">Filter</a></li>
            
                <li><a href="../classes/Force.html">Force</a></li>
            
                <li><a href="../classes/Frame.html">Frame</a></li>
            
                <li><a href="../classes/FramePoint.html">FramePoint</a></li>
            
                <li><a href="../classes/Gradient.html">Gradient</a></li>
            
                <li><a href="../classes/GreyscaleFilter.html">GreyscaleFilter</a></li>
            
                <li><a href="../classes/Group.html">Group</a></li>
            
                <li><a href="../classes/Image.html">Image</a></li>
            
                <li><a href="../classes/InvertFilter.html">InvertFilter</a></li>
            
                <li><a href="../classes/LeachFilter.html">LeachFilter</a></li>
            
                <li><a href="../classes/Link.html">Link</a></li>
            
                <li><a href="../classes/MatrixFilter.html">MatrixFilter</a></li>
            
                <li><a href="../classes/NoiseFilter.html">NoiseFilter</a></li>
            
                <li><a href="../classes/Pad.html">Pad</a></li>
            
                <li><a href="../classes/PageElement.html">PageElement</a></li>
            
                <li><a href="../classes/Particle.html">Particle</a></li>
            
                <li><a href="../classes/Path.html">Path</a></li>
            
                <li><a href="../classes/Pattern.html">Pattern</a></li>
            
                <li><a href="../classes/Phrase.html">Phrase</a></li>
            
                <li><a href="../classes/Picture.html">Picture</a></li>
            
                <li><a href="../classes/PixelateFilter.html">PixelateFilter</a></li>
            
                <li><a href="../classes/Point.html">Point</a></li>
            
                <li><a href="../classes/Position.html">Position</a></li>
            
                <li><a href="../classes/Quaternion.html">Quaternion</a></li>
            
                <li><a href="../classes/RadialGradient.html">RadialGradient</a></li>
            
                <li><a href="../classes/SaturationFilter.html">SaturationFilter</a></li>
            
                <li><a href="../classes/SeparateFilter.html">SeparateFilter</a></li>
            
                <li><a href="../classes/Shape.html">Shape</a></li>
            
                <li><a href="../classes/Spring.html">Spring</a></li>
            
                <li><a href="../classes/SpriteAnimation.html">SpriteAnimation</a></li>
            
                <li><a href="../classes/Stack.html">Stack</a></li>
            
                <li><a href="../classes/Text.html">Text</a></li>
            
                <li><a href="../classes/ThresholdFilter.html">ThresholdFilter</a></li>
            
                <li><a href="../classes/Ticker.html">Ticker</a></li>
            
                <li><a href="../classes/TintFilter.html">TintFilter</a></li>
            
                <li><a href="../classes/Tween.html">Tween</a></li>
            
                <li><a href="../classes/Vector.html">Vector</a></li>
            
                <li><a href="../classes/Video.html">Video</a></li>
            
                <li><a href="../classes/Wheel.html">Wheel</a></li>
            
                <li><a href="../classes/window.scrawl.html">window.scrawl</a></li>
            
                <li><a href="../classes/window.scrawl_Animation.html">window.scrawl_Animation</a></li>
            
                <li><a href="../classes/window.scrawl_Block.html">window.scrawl_Block</a></li>
            
                <li><a href="../classes/window.scrawl_Collisions.html">window.scrawl_Collisions</a></li>
            
                <li><a href="../classes/window.scrawl_Color.html">window.scrawl_Color</a></li>
            
                <li><a href="../classes/window.scrawl_Factories.html">window.scrawl_Factories</a></li>
            
                <li><a href="../classes/window.scrawl_Filters.html">window.scrawl_Filters</a></li>
            
                <li><a href="../classes/window.scrawl_Frame.html">window.scrawl_Frame</a></li>
            
                <li><a href="../classes/window.scrawl_Images.html">window.scrawl_Images</a></li>
            
                <li><a href="../classes/window.scrawl_Path.html">window.scrawl_Path</a></li>
            
                <li><a href="../classes/window.scrawl_Phrase.html">window.scrawl_Phrase</a></li>
            
                <li><a href="../classes/window.scrawl_Physics.html">window.scrawl_Physics</a></li>
            
                <li><a href="../classes/window.scrawl_SaveLoad.html">window.scrawl_SaveLoad</a></li>
            
                <li><a href="../classes/window.scrawl_Shape.html">window.scrawl_Shape</a></li>
            
                <li><a href="../classes/window.scrawl_Stacks.html">window.scrawl_Stacks</a></li>
            
                <li><a href="../classes/window.scrawl_Wheel.html">window.scrawl_Wheel</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/scrawlAnimation.html">scrawlAnimation</a></li>
            
                <li><a href="../modules/scrawlBlock.html">scrawlBlock</a></li>
            
                <li><a href="../modules/scrawlCollisions.html">scrawlCollisions</a></li>
            
                <li><a href="../modules/scrawlColor.html">scrawlColor</a></li>
            
                <li><a href="../modules/scrawlCore.html">scrawlCore</a></li>
            
                <li><a href="../modules/scrawlFilters.html">scrawlFilters</a></li>
            
                <li><a href="../modules/scrawlFrame.html">scrawlFrame</a></li>
            
                <li><a href="../modules/scrawlImages.html">scrawlImages</a></li>
            
                <li><a href="../modules/scrawlPath.html">scrawlPath</a></li>
            
                <li><a href="../modules/scrawlPathFactories.html">scrawlPathFactories</a></li>
            
                <li><a href="../modules/scrawlPhrase.html">scrawlPhrase</a></li>
            
                <li><a href="../modules/scrawlPhysics.html">scrawlPhysics</a></li>
            
                <li><a href="../modules/scrawlSaveLoad.html">scrawlSaveLoad</a></li>
            
                <li><a href="../modules/scrawlShape.html">scrawlShape</a></li>
            
                <li><a href="../modules/scrawlStacks.html">scrawlStacks</a></li>
            
                <li><a href="../modules/scrawlWheel.html">scrawlWheel</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: source\scrawlSaveLoad.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
//---------------------------------------------------------------------------------
// The MIT License (MIT)
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the &quot;Software&quot;), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in
// all copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
// THE SOFTWARE.
//---------------------------------------------------------------------------------

/**
# scrawlSaveLoad

## Purpose and features

Adds the ability to save and load Scrawl objects and scenes as JSON strings

_This extension is experimental and thus likely to change significantly as scrawl-canvas evolves_

@module scrawlSaveLoad
**/

if (window.scrawl &amp;&amp; window.scrawl.work.extensions &amp;&amp; !window.scrawl.contains(window.scrawl.work.extensions, &#x27;saveload&#x27;)) {
	var scrawl = (function(my) {
		&#x27;use strict&#x27;;

		/**
# window.scrawl

scrawlSaveLoad extension adaptions to the scrawl-canvas library object

@class window.scrawl_SaveLoad
**/

		/**
A __load__ function

Argument should be a JSON String, or an Array of JSON Strings, of objects to be loaded or updated
@method load
@param {Array} item Array of JSON Strings; alternatively, a JSON String
@return Always true
**/
		my.load = function(item) {
			var a, //object from item
				type,
				b, //existing object settings
				c, //defaults
				k; //a keys
			if (item.substring) {
				item = [item];
			}
			for (var i = 0, z = item.length; i &lt; z; i++) {
				if (item[i].substring) {
					a = JSON.parse(item[i]);
					if (my.xt(a.type)) {
						type = a.type.toLowerCase();
						if (my.contains(my[a.classname], a.name)) {
							//update
							b = my[type][a.name].parse();
							c = my.work.d[a.type];
							k = Object.keys(b);
							for (var j = 0, w = k.length; j &lt; w; j++) {
								if (!my.xt(a[k])) {
									a[k] = c[k];
								}
							}
							my[type][a.name].set(a);
						}
						else {
							//create
							switch (type) {
								case &#x27;pad&#x27;:
									my.addCanvasToPage(a);
									my.work.currentPad = a.name;
									break;
								case &#x27;cell&#x27;:
									if (my.xt(a.pad) &amp;&amp; my.contains(my.padnames, a.pad) &amp;&amp; !my.contains(my.pad[a.pad].cells, a.name)) {
										my.pad[a.pad].addNewCell(a);
									}
									break;
								case &#x27;group&#x27;:
									my.makeGroup(a);
									break;
								case &#x27;path&#x27;:
									my.makePath(a);
									break;
								case &#x27;gradient&#x27;:
									my.makeGradient(a);
									break;
								case &#x27;radialgradient&#x27;:
									my.makeRadialGradient(a);
									break;
								default:
									new my[a.type](a);
							}
						}
					}
				}
			}
			return true;
		};
		/**
A __save__ function

Argument should be a String literal: &#x27;pads&#x27;, &#x27;cells&#x27;, &#x27;groups&#x27;, &#x27;entitys&#x27;, &#x27;designs&#x27;, &#x27;spriteanimations&#x27;, &#x27;springs&#x27;

_Note: this function does not check for duplicate objects_
@method save
@param {string} item A String literal
@return Array of saved data
**/
		my.save = function(item) {
			var results = [],
				i, iz;
			switch (item) {
				case &#x27;pads&#x27;:
					for (i = 0, iz = my.padnames.length; i &lt; iz; i++) {
						results = results.concat(my.pad[my.padnames[i]].toString());
					}
					break;
				case &#x27;cells&#x27;:
					for (i = 0, iz = my.cellnames.length; i &lt; iz; i++) {
						results = results.concat(my.cell[my.cellnames[i]].toString());
					}
					break;
				case &#x27;groups&#x27;:
					for (i = 0, iz = my.groupnames.length; i &lt; iz; i++) {
						results = results.concat(my.group[my.groupnames[i]].toString());
					}
					break;
				case &#x27;entitys&#x27;:
					for (i = 0, iz = my.entitynames.length; i &lt; iz; i++) {
						results = results.concat(my.entity[my.entitynames[i]].toString());
					}
					break;
				case &#x27;designs&#x27;:
					for (i = 0, iz = my.designnames.length; i &lt; iz; i++) {
						results = results.concat(my.design[my.designnames[i]].toString());
					}
					break;
				case &#x27;spriteanimations&#x27;:
					if (my.xt(my.spriteanimationnames)) {
						for (i = 0, iz = my.spriteanimationnames.length; i &lt; iz; i++) {
							results = results.concat(my.spriteanimation[my.spriteanimationnames[i]].toString());
						}
					}
					break;
				case &#x27;springs&#x27;:
					if (my.xt(my.springnames)) {
						for (i = 0, iz = my.springnames.length; i &lt; iz; i++) {
							results = results.concat(my.spring[my.springnames[i]].toString());
						}
					}
					break;
			}
			return results;
		};

		/**
Turn the object into a JSON String
@method Base.toString
@return JSON string of non-default value attributes
**/
		my.Base.prototype.toString = function() {
			var keys = Object.keys(my.work.d[this.type]),
				result = {};
			result.type = this.type;
			result.classname = this.classname;
			result.name = this.name;
			for (var i = 0, z = keys.length; i &lt; z; i++) {
				if (my.xt(this[keys[i]]) &amp;&amp; this[keys[i]] !== my.work.d[this.type][keys[i]]) {
					result[keys[i]] = this[keys[i]];
				}
			}
			return JSON.stringify(result);
		};

		/**
Turn the object into a JSON String
@method Position.toString
@return JSON string of non-default value attributes
**/
		my.Position.prototype.toString = function() {
			var keys = Object.keys(my.work.d[this.type]),
				result = {},
				blacklist = [];
			result.type = this.type;
			result.classname = this.classname;
			result.name = this.name;
			for (var i = 0, z = keys.length; i &lt; z; i++) {
				if (my.contains([&#x27;start&#x27;, &#x27;delta&#x27;, &#x27;handle&#x27;], keys[i])) {
					if (!this[keys[i]].isLike(my.work.d[this.type][keys[i]])) {
						result[keys[i]] = this[keys[i]];
					}
				}
				else if (my.xt(this[keys[i]]) &amp;&amp; this[keys[i]] !== my.work.d[this.type][keys[i]]) {
					result[keys[i]] = this[keys[i]];
				}
			}
			return JSON.stringify(result);
		};

		/**
Turn the object into a JSON String
@method PageElement.toString
@return JSON string of non-default value attributes
**/
		my.PageElement.prototype.toString = function() {
			var keys = Object.keys(my.work.d[this.type]),
				result = {},
				temp;
			result.type = this.type;
			result.classname = this.classname;
			result.name = this.name;
			for (var i = 0, z = keys.length; i &lt; z; i++) {
				if (my.contains([&#x27;start&#x27;, &#x27;delta&#x27;, &#x27;handle&#x27;, &#x27;perspective&#x27;, &#x27;translate&#x27;], keys[i])) {
					if (!this[keys[i]].isLike(my.work.d[this.type][keys[i]])) {
						result[keys[i]] = this[keys[i]];
					}
				}
				if (keys[i] === &#x27;rotation&#x27;) {
					temp = this.rotation.getEulerAngles();
					if (temp.pitch !== 0) {
						result.pitch = temp.pitch;
					}
					if (temp.yaw !== 0) {
						result.yaw = temp.yaw;
					}
					if (temp.roll !== 0) {
						result.roll = temp.roll;
					}
				}
				if (keys[i] === &#x27;deltaRotation&#x27;) {
					temp = this.rotation.getEulerAngles();
					if (temp.pitch !== 0) {
						result.deltaPitch = temp.pitch;
					}
					if (temp.yaw !== 0) {
						result.deltaYaw = temp.yaw;
					}
					if (temp.roll !== 0) {
						result.deltaRoll = temp.roll;
					}
				}
				else if (my.xt(this[keys[i]]) &amp;&amp; this[keys[i]] !== my.work.d[this.type][keys[i]]) {
					result[keys[i]] = this[keys[i]];
				}
			}
			return JSON.stringify(result);
		};

		/**
Turn the object into a JSON String
@method Pad.toString
@param {Boolean} [noexternalobjects] True to exclude external objects such as entitys, designs and groups
@return Array of JSON strings of non-default value attributes
**/
		my.Pad.prototype.toString = function(noexternalobjects) {
			var keys = Object.keys(my.work.d[this.type]),
				result = {},
				resarray = [],
				groups = [],
				entitys = [],
				ctx,
				designs = [],
				blacklist = [&#x27;localWidth&#x27;, &#x27;localHeight&#x27;, &#x27;mouse&#x27;, &#x27;displayOffsetX&#x27;, &#x27;displayOffsetY&#x27;],
				i, iz, j, jz;
			result.type = this.type;
			result.classname = this.classname;
			result.name = this.name;
			result.parentElement = my.canvas[this.name].parentElement.id;
			for (i = 0, iz = keys.length; i &lt; iz; i++) {
				if (my.contains([&#x27;start&#x27;, &#x27;delta&#x27;, &#x27;handle&#x27;], keys[i])) {
					if (!this[keys[i]].isLike(my.work.d[this.type][keys[i]])) {
						result[keys[i]] = this[keys[i]];
					}
				}
				else if (my.contains(blacklist, keys[i])) {
					//do nothing
				}
				else if (my.xt(this[keys[i]]) &amp;&amp; this[keys[i]] !== my.work.d[this.type][keys[i]]) {
					result[keys[i]] = this[keys[i]];
				}
			}
			resarray.push(JSON.stringify(result));
			if (!noexternalobjects) {
				for (i = 0, iz = this.cells.length; i &lt; iz; i++) {
					for (j = 0, jz = my.cell[this.cells[i]].groups.length; j &lt; jz; j++) {
						my.pushUnique(groups, my.cell[this.cells[i]].groups[j]);
					}
					resarray.push(my.cell[this.cells[i]].toString(true));
				}
				for (i = 0, iz = groups.length; i &lt; iz; i++) {
					for (j = 0, jz = my.group[groups[i]].entitys.length; j &lt; jz; j++) {
						my.pushUnique(entitys, my.group[groups[i]].entitys[j]);
					}
					resarray.push(my.group[groups[i]].toString(true));
				}
				for (i = 0, iz = entitys.length; i &lt; iz; i++) {
					ctx = my.ctx[my.entity[entitys[i]].context];
					if (my.contains(my.designnames, ctx.fillStyle)) {
						my.pushUnique(designs, ctx.fillStyle);
					}
					if (my.contains(my.designnames, ctx.strokeStyle)) {
						my.pushUnique(designs, ctx.strokeStyle);
					}
					if (my.contains(my.designnames, ctx.shadowColor)) {
						my.pushUnique(designs, ctx.shadowColor);
					}
				}
				for (i = 0, iz = designs.length; i &lt; iz; i++) {
					resarray.push(my.design[designs[i]].toString());
				}
				for (i = 0, iz = entitys.length; i &lt; iz; i++) {
					resarray.push(my.entity[entitys[i]].toString(true));
				}
			}
			return resarray;
		};

		/**
Turn the object into a JSON String
@method Cell.toString
@param {Boolean} [noexternalobjects] True to exclude external objects such as entitys, designs and groups
@return Array of JSON strings of non-default value attributes
**/
		my.Cell.prototype.toString = function(noexternalobjects) {
			var keys = Object.keys(my.work.d[this.type]),
				result = {},
				resarray = [],
				entitys = [],
				ctx,
				designs = [],
				blacklist = [&#x27;copyData&#x27;, &#x27;pasteData&#x27;, &#x27;actualWidth&#x27;, &#x27;actualHeight&#x27;],
				i, iz, j, jz;
			result.type = this.type;
			result.classname = this.classname;
			result.name = this.name;
			for (i = 0, iz = keys.length; i &lt; iz; i++) {
				if (my.contains([&#x27;start&#x27;, &#x27;delta&#x27;, &#x27;handle&#x27;, &#x27;copy&#x27;, &#x27;copyDelta&#x27;], keys[i])) {
					if (!this[keys[i]].isLike(my.work.d[this.type][keys[i]])) {
						result[keys[i]] = {
							x: this[keys[i]].x,
							y: this[keys[i]].y
						};
					}
				}
				else if (my.contains(blacklist, keys[i])) {
					//do nothing
				}
				else if (my.xt(this[keys[i]]) &amp;&amp; this[keys[i]] !== my.work.d[this.type][keys[i]]) {
					result[keys[i]] = this[keys[i]];
				}
			}
			resarray.push(JSON.stringify(result));
			if (!noexternalobjects) {
				for (i = 0, iz = this.groups.length; i &lt; iz; i++) {
					for (j = 0, jz = my.group[this.groups[i]].entitys.length; j &lt; jz; j++) {
						my.pushUnique(entitys, my.group[this.groups[i]].entitys[j]);
					}
					resarray.push(my.group[this.groups[i]].toString(true));
				}
				for (i = 0, iz = entitys.length; i &lt; iz; i++) {
					ctx = my.ctx[my.entity[entitys[i]].context];
					if (my.contains(my.designnames, ctx.fillStyle)) {
						my.pushUnique(designs, ctx.fillStyle);
					}
					if (my.contains(my.designnames, ctx.strokeStyle)) {
						my.pushUnique(designs, ctx.strokeStyle);
					}
					if (my.contains(my.designnames, ctx.shadowColor)) {
						my.pushUnique(designs, ctx.shadowColor);
					}
				}
				for (i = 0, iz = designs.length; i &lt; iz; i++) {
					resarray.push(my.design[designs[i]].toString());
				}
				for (i = 0, iz = entitys.length; i &lt; iz; i++) {
					resarray.push(my.entity[entitys[i]].toString(true));
				}
			}
			return resarray;
		};
		/**
Turn the object into a JSON String; doesn&#x27;t include name and type attributes
@method Context.toString
@return JSON string of non-default value attributes
**/
		my.Context.prototype.toString = function() {
			var result = {};
			for (var i = 0, z = my.work.contextKeys.length; i &lt; z; i++) {
				if (my.work.contextKeys[i] === &#x27;lineDash&#x27;) {
					if (my.xt(this.lineDash) &amp;&amp; this.lineDash.length &gt; 0) {
						result.lineDash = this.lineDash;
					}
				}
				else if (my.xt(this[my.work.contextKeys[i]]) &amp;&amp; this[my.work.contextKeys[i]] !== my.work.d.Context[my.work.contextKeys[i]]) {
					result[my.work.contextKeys[i]] = this[my.work.contextKeys[i]];
				}
			}
			return JSON.stringify(result);
		};
		/**
Turn the object into a JSON String

Automatically removes the entitys attribute from the result; when loading, existing entitys need to be re-added to the group
@method Group.toString
@param {Boolean} [noentitys] True to exclude the entitys attribute; false will return an array containing this and each of the entitys in the entitys array
@return Array of JSON strings of non-default value attributes
**/
		my.Group.prototype.toString = function(noentitys) {
			var keys = Object.keys(my.work.d[this.type]),
				result = {},
				resarray = [],
				ctx,
				designs = [],
				i, iz;
			result.type = this.type;
			result.classname = this.classname;
			result.name = this.name;
			for (i = 0, iz = keys.length; i &lt; iz; i++) {
				if (my.xt(this[keys[i]]) &amp;&amp; this[keys[i]] !== my.work.d[this.type][keys[i]]) {
					result[keys[i]] = this[keys[i]];
				}
			}
			delete result.entitys;
			resarray.push(JSON.stringify(result));
			if (!noentitys) {
				for (i = 0, iz = this.entitys.length; i &lt; iz; i++) {
					ctx = my.ctx[my.entity[this.entitys[i]].context];
					if (my.contains(my.designnames, ctx.fillStyle)) {
						my.pushUnique(designs, ctx.fillStyle);
					}
					if (my.contains(my.designnames, ctx.strokeStyle)) {
						my.pushUnique(designs, ctx.strokeStyle);
					}
					if (my.contains(my.designnames, ctx.shadowColor)) {
						my.pushUnique(designs, ctx.shadowColor);
					}
				}
				for (i = 0, iz = designs.length; i &lt; iz; i++) {
					resarray.push(my.design[designs[i]].toString());
				}
				for (i = 0, iz = this.entitys.length; i &lt; iz; i++) {
					resarray.push(my.entity[this.entitys[i]].toString(true));
				}
			}
			return resarray;
		};

		/**
Turn the object into a JSON String

Retains the entitys attribute Array; does not include any other objects in the return Array
@method Group.save
@return Array of JSON Strings
**/
		my.Group.prototype.save = function() {
			var keys = Object.keys(my.work.d[this.type]),
				result = {};
			result.type = this.type;
			result.classname = this.classname;
			result.name = this.name;
			for (var i = 0, z = keys.length; i &lt; z; i++) {
				if (my.xt(this[keys[i]]) &amp;&amp; this[keys[i]] !== my.work.d[this.type][keys[i]]) {
					result[keys[i]] = this[keys[i]];
				}
			}
			return [JSON.stringify(result)];
		};

		/**
Turn the object into a JSON String
@method Entity.toString
@return JSON string of non-default value attributes, including non-default context values
**/
		my.Entity.prototype.toString = function(noexternalobjects) {
			noexternalobjects = (my.xt(noexternalobjects)) ? noexternalobjects : false;
			var keys = Object.keys(my.work.d[this.type]),
				result = {},
				ctx = my.ctx[this.context],
				ctxArray,
				designs = [],
				resarray = [],
				vectorslist = [&#x27;start&#x27;, &#x27;delta&#x27;, &#x27;handle&#x27;, &#x27;copy&#x27;],
				blacklist = [&#x27;collisionVectors&#x27;, &#x27;dataSet&#x27;, &#x27;pointList&#x27;, &#x27;firstPoint&#x27;, &#x27;linkList&#x27;, &#x27;linkDurations&#x27;, &#x27;perimeterLength&#x27;, &#x27;style&#x27;, &#x27;variant&#x27;, &#x27;weight&#x27;, &#x27;size&#x27;, &#x27;metrics&#x27;, &#x27;family&#x27;, &#x27;texts&#x27;, &#x27;copyData&#x27;, &#x27;pasteData&#x27;, &#x27;localHeight&#x27;, &#x27;localWidth&#x27;];
			result.type = this.type;
			result.classname = this.classname;
			result.name = this.name;
			if (!noexternalobjects) {
				if (ctx &amp;&amp; ctx.fillStyle &amp;&amp; my.contains(my.designnames, ctx.fillStyle)) {
					my.pushUnique(designs, ctx.fillStyle);
				}
				if (ctx &amp;&amp; ctx.strokeStyle &amp;&amp; my.contains(my.designnames, ctx.strokeStyle)) {
					my.pushUnique(designs, ctx.strokeStyle);
				}
				if (ctx &amp;&amp; ctx.shadowColor &amp;&amp; my.contains(my.designnames, ctx.shadowColor)) {
					my.pushUnique(designs, ctx.shadowColor);
				}
				for (var k = 0, kz = designs.length; k &lt; kz; k++) {
					resarray.push(my.design[designs[k]].toString());
				}
			}
			for (var i = 0, iz = keys.length; i &lt; iz; i++) {
				if (my.contains(vectorslist, keys[i])) {
					if (!this[keys[i]].isLike(my.work.d[this.type][keys[i]])) {
						result[keys[i]] = {
							x: this[keys[i]].x,
							y: this[keys[i]].y
						};
					}
				}
				else if (keys[i] === &#x27;context&#x27; &amp;&amp; my.xt(my.ctx[this.context])) {
					ctx = JSON.parse(my.ctx[this.context].toString());
					ctxArray = Object.keys(ctx);
					for (var j = 0, jz = ctxArray.length; j &lt; jz; j++) {
						result[ctxArray[j]] = ctx[ctxArray[j]];
					}
				}
				else if (my.contains(blacklist, keys[i])) {
					//do nothing
				}
				else if (my.xt(this[keys[i]]) &amp;&amp; this[keys[i]] !== my.work.d[this.type][keys[i]]) {
					result[keys[i]] = this[keys[i]];
				}
			}
			if (this.type === &#x27;Picture&#x27;) {
				result.url = my.image[this.source].source;
			}
			resarray.push(JSON.stringify(result).replace(&#x27;\\n&#x27;, &#x27;\\\\n&#x27;)); //replace required for multiline Phrase entitys
			return resarray;
		};

		return my;
	}(scrawl));
}

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
