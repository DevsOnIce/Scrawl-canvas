/*! scrawl-canvas 2014-11-01 */
if(window.scrawl&&!window.scrawl.makeEllipse)var scrawl=function(a){"use strict";return a.makeEllipse=function(b){b=a.safeObject(b),b.closed=!0;var c=a.Entity.prototype.getEntityCell(b),d=a.isa(b.startX,"str")?a.convertPercentage(b.startX,c,!0):b.startX||0,e=a.isa(b.startY,"str")?a.convertPercentage(b.startY,c,!1):b.startY||0,f=a.isa(b.radiusX,"str")?a.convertPercentage(b.radiusX,c,!0):b.radiusX||0,g=a.isa(b.radiusY,"str")?a.convertPercentage(b.radiusY,c,!1):b.radiusY||0,h="m",i=d,j=e,k=d,l=e-g;return h+=i-k+","+(j-l),i=k,j=l,k=d+.55*f,l=e-g,h+="c"+(i-k)+","+(j-l),k=d+f,l=e-.55*g,h+=" "+(i-k)+","+(j-l),k=d+f,l=e,h+=" "+(i-k)+","+(j-l),i=k,j=l,k=d+f,l=e+.55*g,h+="c"+(i-k)+","+(j-l),k=d+.55*f,l=e+g,h+=" "+(i-k)+","+(j-l),k=d,l=e+g,h+=" "+(i-k)+","+(j-l),i=k,j=l,k=d-.55*f,l=e+g,h+="c"+(i-k)+","+(j-l),k=d-f,l=e+.55*g,h+=" "+(i-k)+","+(j-l),k=d-f,l=e,h+=" "+(i-k)+","+(j-l),i=k,j=l,k=d-f,l=e-.55*g,h+="c"+(i-k)+","+(j-l),k=d-.55*f,l=e-g,h+=" "+(i-k)+","+(j-l),k=d,l=e-g,h+=" "+(i-k)+","+(j-l),h+="z",b.isLine=!1,b.data=h,b.shape?a.newShape(b):a.makePath(b)},a.makeRectangle=function(b){b=a.safeObject(b),b.closed=!0;var c=a.Entity.prototype.getEntityCell(b),d=a.isa(b.startX,"str")?a.convertPercentage(b.startX,c,!0):b.startX||0,e=a.isa(b.startY,"str")?a.convertPercentage(b.startY,c,!1):b.startY||0,f=a.isa(b.width,"str")?a.convertPercentage(b.width,c,!0):b.width||0,g=a.isa(b.height,"str")?a.convertPercentage(b.height,c,!1):b.height||0,h=(b.radius||0,a.xtGet([b.radiusTopLeftX,b.radiusTopLeft,b.radiusTopX,b.radiusLeftX,b.radiusTop,b.radiusLeft,b.radiusX,b.radius,0])),i=a.xtGet([b.radiusTopLeftY,b.radiusTopLeft,b.radiusTopY,b.radiusLeftY,b.radiusTop,b.radiusLeft,b.radiusY,b.radius,0]),j=a.xtGet([b.radiusTopRightX,b.radiusTopRight,b.radiusTopX,b.radiusRightX,b.radiusTop,b.radiusRight,b.radiusX,b.radius,0]),k=a.xtGet([b.radiusTopRightY,b.radiusTopRight,b.radiusTopY,b.radiusRightY,b.radiusTop,b.radiusRight,b.radiusY,b.radius,0]),l=a.xtGet([b.radiusBottomRightX,b.radiusBottomRight,b.radiusBottomX,b.radiusRightX,b.radiusBottom,b.radiusRight,b.radiusX,b.radius,0]),m=a.xtGet([b.radiusBottomRightY,b.radiusBottomRight,b.radiusBottomY,b.radiusRightY,b.radiusBottom,b.radiusRight,b.radiusY,b.radius,0]),n=a.xtGet([b.radiusBottomLeftX,b.radiusBottomLeft,b.radiusBottomX,b.radiusLeftX,b.radiusBottom,b.radiusLeft,b.radiusX,b.radius,0]),o=a.xtGet([b.radiusBottomLeftY,b.radiusBottomLeft,b.radiusBottomY,b.radiusLeftY,b.radiusBottom,b.radiusLeft,b.radiusY,b.radius,0]),p=f/2,q=g/2,r="m",s=d,t=e,u=d-p+l,v=e-q;return r+=s-u+","+(t-v),s=u,t=v,u=d+p-n,v=e-q,r+="l"+(s-u)+","+(t-v),s=u,t=v,u=d+p-n+.55*n,v=e-q,r+="c"+(s-u)+","+(t-v),u=d+p,v=e-q+o-.55*o,r+=" "+(s-u)+","+(t-v),u=d+p,v=e-q+o,r+=" "+(s-u)+","+(t-v),s=u,t=v,u=d+p,v=e+q-i,r+="l"+(s-u)+","+(t-v),s=u,t=v,u=d+p,v=e+q-i+.55*i,r+="c"+(s-u)+","+(t-v),u=d+p-h+.55*h,v=e+q,r+=" "+(s-u)+","+(t-v),u=d+p-h,v=e+q,r+=" "+(s-u)+","+(t-v),s=u,t=v,u=d-p+j,v=e+q,r+="l"+(s-u)+","+(t-v),s=u,t=v,u=d-p+j-.55*j,v=e+q,r+="c"+(s-u)+","+(t-v),u=d-p,v=e+q-k+.55*k,r+=" "+(s-u)+","+(t-v),u=d-p,v=e+q-k,r+=" "+(s-u)+","+(t-v),s=u,t=v,u=d-p,v=e-q+m,r+="l"+(s-u)+","+(t-v),s=u,t=v,u=d-p,v=e-q+m-.55*m,r+="c"+(s-u)+","+(t-v),u=d-p+l-.55*l,v=e-q,r+=" "+(s-u)+","+(t-v),u=d-p+l,v=e-q,r+=" "+(s-u)+","+(t-v),r+="z",b.isLine=!1,b.data=r,b.shape?a.newShape(b):a.makePath(b)},a.makeBezier=function(b){b=a.safeObject(b),b.closed=!1,b.handleX=b.handleX||"left",b.handleY=b.handleY||"top",b.isLine=!0;var c,d,e,f=a.Entity.prototype.getEntityCell(b),g=a.isa(b.startX,"str")?a.convertPercentage(b.startX,f,!0):b.startX||0,h=a.isa(b.startY,"str")?a.convertPercentage(b.startY,f,!1):b.startY||0,i=a.isa(b.startControlX,"str")?a.convertPercentage(b.startControlX,f,!0):b.startControlX||0,j=a.isa(b.startControlY,"str")?a.convertPercentage(b.startControlY,f,!1):b.startControlY||0,k=a.isa(b.endControlX,"str")?a.convertPercentage(b.endControlX,f,!0):b.endControlX||0,l=a.isa(b.endControlY,"str")?a.convertPercentage(b.endControlY,f,!1):b.endControlY||0,m=a.isa(b.endX,"str")?a.convertPercentage(b.endX,f,!0):b.endX||0,n=a.isa(b.endY,"str")?a.convertPercentage(b.endY,f,!1):b.endY||0,o=b.fixed||"none";if(b.fixed=!1,d="m0,0c"+(i-g)+","+(j-h)+" "+(k-g)+","+(l-h)+" "+(m-g)+","+(n-h),b.data=d,b.shape)c=a.newShape(b);else switch(c=a.makePath(b),e=c.name.replace("~","_","g"),o){case"all":a.point[e+"_p1"].setToFixed(g,h),a.point[e+"_p2"].setToFixed(i,j),a.point[e+"_p3"].setToFixed(k,l),a.point[e+"_p4"].setToFixed(m,n);break;case"both":a.point[e+"_p1"].setToFixed(g,h),a.point[e+"_p4"].setToFixed(m,n);break;case"start":a.point[e+"_p1"].setToFixed(g,h);break;case"startControl":a.point[e+"_p2"].setToFixed(i,j);break;case"endControl":a.point[e+"_p3"].setToFixed(k,l);break;case"end":a.point[e+"_p4"].setToFixed(m,n)}return c},a.makeQuadratic=function(b){b=a.safeObject(b),b.closed=!1,b.handleX=b.handleX||"left",b.handleY=b.handleY||"top",b.isLine=!0;var c,d,e,f=a.Entity.prototype.getEntityCell(b),g=a.isa(b.startX,"str")?a.convertPercentage(b.startX,f,!0):b.startX||0,h=a.isa(b.startY,"str")?a.convertPercentage(b.startY,f,!1):b.startY||0,i=a.isa(b.controlX,"str")?a.convertPercentage(b.controlX,f,!0):b.controlX||0,j=a.isa(b.controlY,"str")?a.convertPercentage(b.controlY,f,!1):b.controlY||0,k=a.isa(b.endX,"str")?a.convertPercentage(b.endX,f,!0):b.endX||0,l=a.isa(b.endY,"str")?a.convertPercentage(b.endY,f,!1):b.endY||0,m=b.fixed||"none";if(c="m0,0q"+(i-g)+","+(j-h)+" "+(k-g)+","+(l-h),b.fixed=!1,b.data=c,b.shape)d=a.newShape(b);else switch(d=a.makePath(b),e=d.name.replace("~","_","g"),m){case"all":a.point[e+"_p1"].setToFixed(g,h),a.point[e+"_p2"].setToFixed(i,j),a.point[e+"_p3"].setToFixed(k,l);break;case"both":a.point[e+"_p1"].setToFixed(g,h),a.point[e+"_p3"].setToFixed(k,l);break;case"start":a.point[e+"_p1"].setToFixed(g,h);break;case"control":a.point[e+"_p2"].setToFixed(i,j);break;case"end":a.point[e+"_p3"].setToFixed(k,l)}return d},a.makeLine=function(b){b=a.safeObject(b),b.isLine=!0,b.closed=!1,b.handleX=b.handleX||"left",b.handleY=b.handleY||"top";var c,d,e,f=a.Entity.prototype.getEntityCell(b),g=a.isa(b.startX,"str")?a.convertPercentage(b.startX,f,!0):b.startX||0,h=a.isa(b.startY,"str")?a.convertPercentage(b.startY,f,!1):b.startY||0,i=a.isa(b.endX,"str")?a.convertPercentage(b.endX,f,!0):b.endX||0,j=a.isa(b.endY,"str")?a.convertPercentage(b.endY,f,!1):b.endY||0,k=b.fixed||"none";if(c="m0,0 "+(i-g)+","+(j-h),b.fixed=!1,b.data=c,b.shape)d=a.newShape(b);else switch(d=a.makePath(b),e=d.name.replace("~","_","g"),k){case"both":a.point[e+"_p1"].setToFixed(g,h),a.point[e+"_p2"].setToFixed(i,j);break;case"start":a.point[e+"_p1"].setToFixed(g,h);break;case"end":a.point[e+"_p2"].setToFixed(i,j)}return d},a.makeRegularShape=function(b){b=a.safeObject(b);var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=a.Entity.prototype.getEntityCell(b);if(a.xto([b.sides,b.angle])){b.closed=!0,b.isLine=!1,c=a.isa(b.startX,"str")?a.convertPercentage(b.startX,t,!0):b.startX||0,d=a.isa(b.startY,"str")?a.convertPercentage(b.startY,t,!1):b.startY||0,n=a.xtGet([b.startControlX,b.controlX,0]),o=a.xtGet([b.startControlY,b.controlY,0]),p=b.endControlX||0,q=b.endControlY||0,n=a.isa(n,"str")?a.convertPercentage(n,t,!0):n,o=a.isa(o,"str")?a.convertPercentage(o,t,!1):o,p=a.isa(p,"str")?a.convertPercentage(p,t,!0):p,q=a.isa(q,"str")?a.convertPercentage(q,t,!1):q,m=a.contains(["c","s","q","t","l"],b.lineType)?b.lineType:"l",e=b.radius||20,f=a.isa(b.sides,"num")&&b.sides>1?360/b.sides:a.isa(b.angle,"num")&&b.angle>0?b.angle:4,g=0,h=0,i=a.worklink.v1.set({x:e,y:0,z:0}),j=a.worklink.v2.set(i),r=a.worklink.control1.set({x:n,y:o,z:0}),s=a.worklink.control2.set({x:p,y:q,z:0}),l="m"+i.x.toFixed(4)+" "+i.y.toFixed(4),l+=a.contains(["s","t"],m)?"q":m;do h++,g+=f,g%=360,k=g.toFixed(0),i.rotate(f),r.rotate(f),s.rotate(f),a.contains(["c","s","q","t"],m)&&(1===h&&a.contains(["s","t"],m)?l+=r.x.toFixed(4)+","+r.y.toFixed(4)+" ":"s"===m?l+=s.x.toFixed(4)+","+s.y.toFixed(4)+" ":a.contains(["q","c"],m)&&(l+=r.x.toFixed(4)+","+r.y.toFixed(4)+" ")),"c"===m&&(l+=s.x.toFixed(4)+","+s.y.toFixed(4)+" "),l+=(i.x-j.x).toFixed(4)+","+(i.y-j.y).toFixed(4)+" ",1===h&&a.contains(["s","t"],m)&&(l+="t"),j.set(i);while("0"!==k&&1e3>h);return l+="z",b.data=l,b.shape?a.newShape(b):a.makePath(b)}return!1},a.xt(a.worklink)||(a.worklink={start:a.newVector({name:"scrawl.worklink.start"}),end:a.newVector({name:"scrawl.worklink.end"}),control1:a.newVector({name:"scrawl.worklink.control1"}),control2:a.newVector({name:"scrawl.worklink.control2"}),v1:a.newVector({name:"scrawl.worklink.v1"}),v2:a.newVector({name:"scrawl.worklink.v2"}),v3:a.newVector({name:"scrawl.worklink.v3"})}),a.convertPercentage=function(a,b,c){return c?parseFloat(a)/100*b.actualWidth:parseFloat(a)/100*b.actualHeight},a}(scrawl);