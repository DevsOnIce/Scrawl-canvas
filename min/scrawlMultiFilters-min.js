/*! scrawl-canvas 2017-06-26 */
if(window.scrawl&&window.scrawl.work.extensions&&!window.scrawl.contains(window.scrawl.work.extensions,"multifilters"))var scrawl=function(a){"use strict";return Uint8ClampedArray.prototype.slice||Object.defineProperty(Uint8ClampedArray.prototype,"slice",{value:Array.prototype.slice}),a.pushUnique(a.work.sectionlist,"multifilter"),a.pushUnique(a.work.nameslist,"multifilternames"),a.work.multiFilterActiveFlag=!1,a.makeFilter=function(b){return new a.Filter(b)},a.makeMultiFilter=function(b){return new a.MultiFilter(b)},a.Entity.prototype.defs.multiFilter="",a.xt(a.Block)&&a.mergeInto(a.Block.prototype.defs,a.Entity.prototype.defs),a.xt(a.Shape)&&a.mergeInto(a.Shape.prototype.defs,a.Entity.prototype.defs),a.xt(a.Wheel)&&a.mergeInto(a.Wheel.prototype.defs,a.Entity.prototype.defs),a.xt(a.Picture)&&a.mergeInto(a.Picture.prototype.defs,a.Entity.prototype.defs),a.xt(a.Phrase)&&a.mergeInto(a.Phrase.prototype.defs,a.Entity.prototype.defs),a.xt(a.Path)&&a.mergeInto(a.Path.prototype.defs,a.Entity.prototype.defs),a.Group.prototype.multifiltersGroupInit=function(b){b=a.safeObject(b),this.multiFilter=a.xt(b.multiFilter)?b.multiFilter:""},a.Entity.prototype.multifiltersEntityInit=function(b){b=a.safeObject(b),this.multiFilter=a.xt(b.multiFilter)?b.multiFilter:""},a.Group.prototype.stampMultifilter=function(b,c){var d=a.multifilter[this.multiFilter],e=a.work,f=e.cv,g=e.cvwrapper,h=(a.work.cvmodel,a.work.cvx);d.stencil&&(h.globalCompositeOperation="source-in",g.copyCellToSelf(c),h.globalCompositeOperation="source-over"),d.apply(a.work.cv,a.work.cvx),b.setTransform(1,0,0,1,0,0),b.drawImage(f,0,0)},a.Entity.prototype.stampMultifilter=function(b,c){var d,e=a.multifilter[this.multiFilter],f=a.work,g=f.cv2,h=f.cvwrapper2,i=(a.work.cvmodel2,a.work.cvx2),j=a.ctx[this.name];e.stencil&&(i.globalCompositeOperation="source-in",h.copyCellToSelf(c),i.globalCompositeOperation="source-over"),e.apply(a.work.cv2,a.work.cvx2),d=b.globalCompositeOperation,b.setTransform(1,0,0,1,0,0),b.globalCompositeOperation=j.globalCompositeOperation,b.drawImage(g,0,0),b.globalCompositeOperation=d},a.Filter=function(b){var c=a.xtGet;return b=a.safeObject(b),this.name=c(b.name,"generic"),this.multiFilter=c(b.multiFilter,""),this.species=c(b.species,"undefined"),this.level=c(b.level,0),this.red=c(b.red,0),this.green=c(b.green,0),this.blue=c(b.blue,0),this.redInRed=c(b.redInRed,0),this.redInGreen=c(b.redInGreen,0),this.redInBlue=c(b.redInBlue,0),this.greenInRed=c(b.greenInRed,0),this.greenInGreen=c(b.greenInGreen,0),this.greenInBlue=c(b.greenInBlue,0),this.blueInRed=c(b.blueInRed,0),this.blueInGreen=c(b.blueInGreen,0),this.blueInBlue=c(b.blueInBlue,0),this.offsetX=c(b.offsetX,0),this.offsetY=c(b.offsetY,0),this.blockWidth=c(b.blockWidth,0),this.blockHeight=c(b.blockHeight,0),this.weights=c(b.weights,[]),this.normalize=c(b.normalize,!1),this.radius=c(b.radius,0),this.step=c(b.step,1),this.wrap=c(b.wrap,!1),b.ranges&&this.setRanges(b.ranges),this.cacheAction=c(b.cacheAction,!1),this.action=c(b.action,!1),this},a.Filter.prototype=Object.create(Object.prototype),a.Filter.prototype.type="Filter",a.Filter.prototype.defs={multiFilter:"",species:"",level:0,red:0,green:0,blue:0,redInRed:0,redInGreen:0,redInBlue:0,greenInRed:0,greenInGreen:0,greenInBlue:0,blueInRed:0,blueInGreen:0,blueInBlue:0,offsetX:0,offsetY:0,blockWidth:0,blockHeight:0,weights:[],normalize:!1,wrap:!1,step:1,radius:0,ranges:[],action:!1,cacheAction:!1},a.Filter.prototype.set=function(b){var c=this.defs,d=a.xt;for(var e in b)"ranges"===e?this.setRanges(b[e]):d(c[e])&&(this[e]=b[e]);return this},a.Filter.prototype.setRanges=function(a){var b,c,d,e=[];if(Array.isArray(a))for(var c=0,d=a.length;d>c;c++)b=a[c],6===b.length&&e.push(new Uint8ClampedArray(b));return this.ranges=[],e.length&&(this.ranges=e),this},a.Filter.prototype.clone=function(b){var c=a.mergeOver(JSON.parse(JSON.stringify(this)),a.safeObject(b));return new a.Filter(c)},a.Filter.prototype.update=function(){var b=a.multifilter[this.multiFilter];b&&(this.width=b.currentWidth,this.height=b.currentHeight,this.area=b.currentArea,this.cache=!1)},a.Filter.prototype.prepare=function(){this.checkCache[this.species]&&this.checkCache[this.species].call(this),this.cacheAction&&this.cacheAction()},a.Filter.prototype.do=function(a){this.f[this.species]&&this.f[this.species].call(this,a),this.action&&this.action(a)},a.Filter.prototype.checkCache={pixelate:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=this.cache;if(!t&&(j=a.multifilter[this.multiFilter])){for(e=this.blockWidth||1,c=this.blockHeight||1,f=Math.ceil,d=f(j.currentWidth/e),b=f(j.currentHeight/c),h=this.offsetX||0,h=h>e?0:h,i=this.offsetY||0,i=i>c?0:i,g=this.segment=e*c,t=new Uint32Array((d+1)*(b+1)*g),m=0,k=j.getIndexes,n=-1;b>n;n++)for(o=-1;d>o;o++)r=n*c+i,p=o*e+h,s=r+c,q=p+e,l=k.call(j,p,r,q,s),t.set(l,m),m+=g;this.cache=t}},matrix:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=this.cache;if(!r&&(b=a.multifilter[this.multiFilter])){for(f=this.blockWidth||1,h=this.blockHeight||1,j=this.offsetX||0,k=this.offsetY||0,e=this.wrap||!1,g=b.currentWidth,i=b.currentHeight,r=[],d=0,c=e?b.getWrappedIndexes:b.getIndexes,l=0;i>l;l++)for(m=0;g>m;m++)p=l+k,n=m+j,q=p+h,o=n+f,r[d]=c.call(b,n,p,o,q),d++;this.cache=r}},blur:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=this.cache;if(!s&&(b=a.multifilter[this.multiFilter])){for(l=this.radius||0,e=this.wrap||!1,g=b.currentWidth,i=b.currentHeight,s=[],s[0]=[],s[1]=[],c=e?b.getWrappedIndexes:b.getIndexes,d=0,f=2*l+1,h=1,j=-l,k=0,m=0;i>m;m++)for(n=0;g>n;n++)q=m+k,o=n+j,r=q+h,p=o+f,s[0][d]=c.call(b,o,q,p,r),d++;for(d=0,f=1,h=2*l+1,j=0,k=-l,m=0;i>m;m++)for(n=0;g>n;n++)q=m+k,o=n+j,r=q+h,p=o+f,s[1][d]=c.call(b,o,q,p,r),d++;this.cache=s}}},a.Filter.prototype.f={"default":function(){},grayscale:function(a){var b,c,d,e,f,g;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,g=.2126*a[c]+.7152*a[d]+.0722*a[e],a[c]=g,a[d]=g,a[e]=g)},sepia:function(a){var b,c,d,e,f,g,h,i,j,k,l;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,g=a[c],h=a[d],i=a[e],j=.393*g+.769*h+.189*i,k=.349*g+.686*h+.168*i,l=.272*g+.534*h+.131*i,a[c]=j,a[d]=k,a[e]=l)},invert:function(a){var b,c,d,e,f;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,a[c]=256-a[c],a[d]=256-a[d],a[e]=256-a[e])},red:function(a){var b,c,d,e;for(e=3,b=a.length;b>e;e+=4)a[e]&&(c=e-2,d=e-1,a[c]=0,a[d]=0)},green:function(a){var b,c,d,e;for(e=3,b=a.length;b>e;e+=4)a[e]&&(c=e-3,d=e-1,a[c]=0,a[d]=0)},blue:function(a){var b,c,d,e;for(e=3,b=a.length;b>e;e+=4)a[e]&&(c=e-3,d=e-2,a[c]=0,a[d]=0)},notred:function(a){var b,c;for(c=0,b=a.length;b>c;c+=4)a[c]=0},notgreen:function(a){var b,c;for(c=1,b=a.length;b>c;c+=4)a[c]=0},notblue:function(a){var b,c;for(c=2,b=a.length;b>c;c+=4)a[c]=0},cyan:function(a){var b,c,d,e,f,g;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,g=(a[d]+a[e])/2,a[c]=0,a[d]=g,a[e]=g)},magenta:function(a){var b,c,d,e,f,g;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,g=(a[c]+a[e])/2,a[c]=g,a[d]=0,a[e]=g)},yellow:function(a){var b,c,d,e,f,g;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,g=(a[d]+a[c])/2,a[c]=g,a[d]=g,a[e]=0)},brightness:function(a){var b,c,d,e,f,g=this.level||0;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,a[c]*=g,a[d]*=g,a[e]*=g)},saturation:function(a){var b,c,d,e,f,g=this.level||0;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,a[c]=127+(a[c]-127)*g,a[d]=127+(a[d]-127)*g,a[e]=127+(a[e]-127)*g)},threshold:function(a){var b,c,d,e,f,g,h=this.level||0;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,g=.2126*a[c]+.7152*a[d]+.0722*a[e],g=g>h?255:0,a[c]=g,a[d]=g,a[e]=g)},channels:function(a){var b,c,d,e,f,g=this.red||0,h=this.green||0,i=this.blue||0;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,a[c]*=g,a[d]*=h,a[e]*=i)},channelstep:function(a){var b,c,d,e,f,g=this.red||1,h=this.green||1,i=this.blue||1,j=Math.floor;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,a[c]=j(a[c]/g)*g,a[d]=j(a[d]/h)*h,a[e]=j(a[e]/i)*i)},tint:function(a){var b,c,d,e,f,g,h,i,j=this.redInRed||0,k=this.redInGreen||0,l=this.redInBlue||0,m=this.greenInRed||0,n=this.greenInGreen||0,o=this.greenInBlue||0,p=this.blueInRed||0,q=this.blueInGreen||0,r=this.blueInBlue||0;for(f=3,b=a.length;b>f;f+=4)a[f]&&(c=f-3,d=f-2,e=f-1,g=a[c],h=a[d],i=a[e],a[c]=g*j+h*m+i*p,a[d]=g*k+h*n+i*q,a[e]=g*l+h*o+i*r)},pixelate:function(a){var b,c,d,e,f,g,h,i,j=this.cache,k=this.segment,l=j.length/k;for(i=0;l>i;i++){for(e=i*k,f=j.slice(e,e+k),b=c=d=g=0,h=0;k>h&&(e=f[h],e);h++)a[e]&&(g++,e-=3,b+=a[e++],c+=a[e++],d+=a[e]);if(g>0)for(b/=g,c/=g,d/=g,h=0;k>h&&(e=f[h],e);h++)a[e]&&(e-=3,a[e++]=b,a[e++]=c,a[e]=d)}},matrix:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=this.cache,r=a.length,s=this.weights,t=this.normalize||!1;if(s.length)for(p=a.slice(),h=3,n=0;r>h;h+=4,n++)if(a[h]){for(j=q[n],k=j.length,b=c=d=o=0,m=0;k>m;m++)i=j[m],s[m]&&p[i]&&(l=s[m],e=i-3,f=i-2,g=i-1,b+=p[e]*l,c+=p[f]*l,d+=p[g]*l,o+=l);t&&o&&(b/=o,c/=o,d/=o),e=h-3,f=h-2,g=h-1,a[e]=b,a[f]=c,a[g]=d}},blur:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=a.length,r=this.step||1;for(b=this.cache[0],p=a.slice(),i=3,n=0;q>i;i+=4,n++)if(a[i]){for(k=b[n],l=k.length,c=d=e=o=0,m=0;l>m;m+=r)j=k[m],p[j]&&(f=j-3,g=j-2,h=j-1,c+=p[f],d+=p[g],e+=p[h],o++);o&&(c/=o,d/=o,e/=o,f=i-3,g=i-2,h=i-1,a[f]=c,a[g]=d,a[h]=e)}for(b=this.cache[1],p=a.slice(),i=3,n=0;q>i;i+=4,n++)if(a[i]){for(k=b[n],l=k.length,c=d=e=o=0,m=0;l>m;m+=r)j=k[m],p[j]&&(f=j-3,g=j-2,h=j-1,c+=p[f],d+=p[g],e+=p[h],o++);o&&(c/=o,d/=o,e/=o,f=i-3,g=i-2,h=i-1,a[f]=c,a[g]=d,a[h]=e)}},chroma:function(a){var b,c,d,e,f,g,h,i,j,k,l=this.ranges;for(c=3,d=a.length;d>c;c+=4)if(a[c]){for(k=!1,i=0,j=l.length;j>i;i++)if(e=l[i],f=e[2],b=c-1,h=a[b],h>=f&&(g=e[5],g>=h&&(f=e[1],b--,h=a[b],h>=f&&(g=e[4],g>=h&&(f=e[0],b--,h=a[b],h>=f&&(g=e[3],g>=h)))))){k=!0;break}k&&(a[c]=0)}}},a.MultiFilter=function(b){var c=a.xtGet;return b=a.safeObject(b),a.Base.call(this,b),this.stencil=c(b.stencil,!1),this.filters=[].concat(c(b.filters,[])),this.currentWidth=0,this.currentHeight=0,this.currentArea=0,this.currentGrid=[],a.multifilter[this.name]=this,a.pushUnique(a.multifilternames,this.name),this},a.MultiFilter.prototype=Object.create(a.Base.prototype),a.MultiFilter.prototype.type="MultiFilter",a.MultiFilter.prototype.lib="multifilter",a.MultiFilter.prototype.libName="multifilternames",a.MultiFilter.prototype.defs={stencil:!1,currentGrid:[],currentWidth:0,currentHeight:0,currentArea:0,filters:[]},a.mergeInto(a.MultiFilter.prototype.defs,a.Base.prototype.defs),a.MultiFilter.prototype.apply=function(a,b){var c,d,e,f,g,h,i,j;if(this.filters.length){for(g=a.width,h=a.height,(g!==this.currentWidth||h!==this.currentHeight)&&(this.currentWidth=g,this.currentHeight=h,this.currentArea=g*h,this.prepareGrid(),this.updateFilters()),c=b.getImageData(0,0,a.width,a.height),e=c.data.buffer,f=new Uint8ClampedArray(e),i=0,j=this.filters.length;j>i;i++)d=this.filters[i],d.prepare(),d.do(f);b.putImageData(c,0,0)}},a.MultiFilter.prototype.prepareGrid=function(){var a,b,c,d=3,e=this.currentHeight,f=this.currentWidth,g=[];for(b=0;e>b;b++){for(a=[],c=0;f>c;c++)a[c]=d,d+=4;g[b]=a}return this.currentGrid=g,!0},a.MultiFilter.prototype.set=function(b){var c=a.xt;b=a.safeObject(b),a.Base.prototype.set.call(this,b),c(b.filters)&&(this.filters=[].concat(b.filters),this.updateFilters())},a.MultiFilter.prototype.updateFilters=function(){for(var a=0,b=this.filters.length;b>a;a++)this.filters[a].update();return!0},a.MultiFilter.prototype.getIndexes=function(a,b,c,d){var e,f,g,h,i,j,k,l,m=this.currentWidth,n=this.currentHeight,o=this.currentGrid;if(b>d&&(h=b,b=d,d=h),a>c&&(h=a,a=c,c=h),b=0>b?0:b,a=0>a?0:a,d=d>=n?n-1:d,c=c>=m?m-1:c,0>d||0>c||b>=n||a>=m)return[];for(i=c-a,j=d-b,e=[],f=0;j>f;f++)for(g=0;i>g;g++)k=b+f,l=a+g,h=f*i+g,e[h]=o[k][l];return e},a.MultiFilter.prototype.getWrappedIndexes=function(a,b,c,d){var e,f,g,h,i,j,k,l,m=this.currentWidth,n=this.currentHeight,o=this.currentGrid;if(b>d&&(h=b,b=d,d=h),a>c&&(h=a,a=c,c=h),0>d||0>c||b>=n||a>=m)return[];for(i=c-a,j=d-b,e=[],f=0;j>f;f++)for(g=0;i>g;g++)k=b+f,l=a+g,(0>k||k>=n)&&(k=0>k?k+n:k-n),(0>l||l>=m)&&(l=0>l?l+m:l-m),h=f*i+g,e[h]=o[k][l];return e},a}(scrawl);