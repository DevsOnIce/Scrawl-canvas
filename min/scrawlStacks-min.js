/*! scrawl-canvas 2014-08-03 */
var scrawl=function(a){"use strict";return a.pageInit=function(){a.getStacks(),a.getCanvases(),a.getElements()},a.getStacks=function(){var b,c,d,e,f,g=document.getElementsByClassName("scrawlstack"),h=[];if(g.length>0){for(c=0,d=g.length;d>c;c++)h.push(g[c]);for(c=0,d=g.length;d>c;c++){for(b=a.newStack({stackElement:h[c]}),e=0,f=a.stk[b.name].children.length;f>e;e++)a.stk[b.name].children[e].style.position="absolute","CANVAS"!==a.stk[b.name].children[e].tagName&&a.newElement({domElement:a.stk[b.name].children[e],stack:b.name});a.contains(a.elementnames,b.name)&&(b.stack=a.element[b.name].stack,delete a.element[b.name],delete a.elm[b.name],a.removeItem(a.elementnames,b.name))}return!0}return console.log('my.getStacks() failed to find any elements with class="scrawlstack" on the page'),!1},a.getCanvases=function(){var b,c,d,e,f,g,h=document.getElementsByTagName("canvas"),i=[];if(h.length>0){for(f=0,g=h.length;g>f;f++)i.push(h[f]);for(f=0,g=h.length;g>f;f++)-1!==i[f].className.indexOf("stack:")&&(c=i[f].className.match(/stack:(\w+)/),a.contains(a.stacknames,c[1])?a.stk[c[1]].appendChild(i[f]):(d=document.createElement("div"),d.id=c[1],i[f].parentElement.appendChild(d),d.appendChild(i[f]),e=a.newStack({stackElement:document.getElementById(c[1])}))),b=a.newPad({canvasElement:i[f]}),a.contains(a.stacknames,i[f].parentElement.id)&&(b.stack=i[f].parentElement.id,i[f].style.position="absolute"),0===f&&(a.currentPad=b.name);return!0}return console.log("my.getCanvases() failed to find any <canvas> elements on the page"),!1},a.getElements=function(){var b,c,d,e,f=document.getElementsByClassName("scrawl"),g=[];if(f.length>0){for(d=0,e=f.length;e>d;d++)g.push(f[d]);for(d=0,e=f.length;e>d;d++)b=g.id||g.name||!1,a.contains(a.elementnames,b)||-1!==g[d].className.indexOf("stack:")&&(c=g[d].className.match(/stack:(\w+)/),a.contains(a.stacknames,c[1])&&(a.stk[c[1]].appendChild(g[d]),a.newElement({domElement:g[d],stack:c[1]})));return!0}return console.log('my.getElements() failed to find any elements with class="scrawl" on the page'),!1},a.addCanvasToPage=function(b){b=a.isa(b,"obj")?b:{};var c,d,e,f,g,h,i=!1;return a.xt(b.stackName)&&(i=document.getElementById(b.stackName)||!1,i||(h=a.xt(b.parentElement)?a.isa(b.parentElement,"str")?document.getElementById(b.parentElement):b.parentElement:document.body,i=a.addStackToPage({stackName:b.stackName,width:b.width,height:b.height,parentElement:h})),b.stack=i.name),c=a.stk[i.name||i.id]||document.getElementById(b.parentElement)||document.body,d=a.makeName({name:b.canvasName||b.name||!1,type:"Pad",target:"padnames"}),e=document.createElement("canvas"),e.id=d,c.appendChild(e),f=document.getElementById(d),f.width=b.width,f.height=b.height,g=a.newPad({canvasElement:f}),(a.xt(b.position)||i)&&(b.position=b.position||"absolute"),b.stack=b.stackName?b.stackName:"",g.set(b),a.setDisplayOffsets(),g},a.addStackToPage=function(b){if(a.isa(b.stackName,"str")&&a.xt(b.parentElement)){var c,d;return b.parentElement=a.isa(b.parentElement,"str")?document.getElementById(b.parentElement):b.parentElement,c=document.createElement("div"),c.id=b.stackName,b.parentElement.appendChild(c),b.stackElement=document.getElementById(b.stackName),d=a.newStack(b),d.stack=a.contains(a.stacknames,b.parentElement.id)?b.parentElement.id:"",d}return!1},a.setDisplayOffsets=function(b){var c,d;if(b=a.xt(b)?b:"all","stack"===b||"all"===b)for(c=0,d=a.stacknames.length;d>c;c++)a.stack[a.stacknames[c]].setDisplayOffsets();if("pad"===b||"all"===b)for(c=0,d=a.padnames.length;d>c;c++)a.pad[a.padnames[c]].setDisplayOffsets();if("element"===b||"all"===b)for(c=0,d=a.elementnames.length;d>c;c++)a.element[a.elementnames[c]].setDisplayOffsets();return!0},a.renderElements=function(){var b,c;for(b=0,c=a.stacknames.length;c>b;b++)a.stack[a.stacknames[b]].renderElement();for(b=0,c=a.padnames.length;c>b;b++)a.pad[a.padnames[b]].renderElement();for(b=0,c=a.elementnames.length;c>b;b++)a.element[a.elementnames[b]].renderElement();return!0},a.update3d=function(b){b=a.safeObject(b);var c,d,e=b.action||"all";if("stacks"===e||"all"===e)for(c=0,d=a.stacknames.length;d>c;c++)a.stack[a.stacknames[c]].update3d(b);if("pads"===e||"all"===e)for(c=0,d=a.padnames.length;d>c;c++)a.pad[a.padnames[c]].update3d(b);if("elements"===e||"all"===e)for(c=0,d=a.elementnames.length;d>c;c++)a.element[a.elementnames[c]].update3d(b);if(a.isa(e,"arr"))for(c=0,d=e;d>c;c++)a.contains(["Pad","Stack","Element"],e[c].type)&&e[c].update3d(b);return!0},a.d.PageElement.start={x:0,y:0,z:0},a.d.PageElement.delta={x:0,y:0,z:0},a.d.PageElement.translate={x:0,y:0,z:0},a.d.PageElement.deltaTranslate={x:0,y:0,z:0},a.d.PageElement.handle={x:"center",y:"center",z:0},a.d.PageElement.pivot="",a.d.PageElement.stack="",a.d.PageElement.path="",a.d.PageElement.pathPlace=0,a.d.PageElement.deltaPathPlace=0,a.d.PageElement.pathSpeedConstant=!0,a.d.PageElement.pathRoll=0,a.d.PageElement.addPathRoll=!1,a.d.PageElement.lockX=!1,a.d.PageElement.lockY=!1,a.d.PageElement.rotation={n:1,v:{x:0,y:0,z:0}},a.d.PageElement.deltaRotation={n:1,v:{x:0,y:0,z:0}},a.d.PageElement.rotationTolerance=.001,a.d.PageElement.visibility=!0,a.mergeInto(a.d.Pad,a.d.PageElement),a.PageElement.prototype.stacksPageElementConstructor=function(b){var c=a.safeObject(b.start);this.start=a.newVector({name:this.type+"."+this.name+".start",x:a.xt(b.startX)?b.startX:a.xt(c.x)?c.x:0,y:a.xt(b.startY)?b.startY:a.xt(c.y)?c.y:0}),this.work.start=a.newVector({name:this.type+"."+this.name+".work.start"}),c=a.safeObject(b.delta),this.delta=a.newVector({name:this.type+"."+this.name+".delta",x:a.xt(b.deltaX)?b.deltaX:a.xt(c.x)?c.x:0,y:a.xt(b.deltaY)?b.deltaY:a.xt(c.y)?c.y:0}),this.work.delta=a.newVector({name:this.type+"."+this.name+".work.delta"}),c=a.safeObject(b.handle),this.handle=a.newVector({name:this.type+"."+this.name+".handle",x:a.xt(b.handleX)?b.handleX:a.xt(c.x)?c.x:0,y:a.xt(b.handleY)?b.handleY:a.xt(c.y)?c.y:0}),this.work.handle=a.newVector({name:this.type+"."+this.name+".work.handle"}),a.xto([b.handleX,b.handleY,b.handle])&&this.setTransformOrigin(),c=a.safeObject(b.translate),this.translate=a.newVector({name:this.type+"."+this.name+".translate",x:a.xt(b.translateX)?b.translateX:a.xt(c.x)?c.x:0,y:a.xt(b.translateY)?b.translateY:a.xt(c.y)?c.y:0,z:a.xt(b.translateZ)?b.translateZ:a.xt(c.y)?c.y:0}),this.work.translate=a.newVector({name:this.type+"."+this.name+".work.translate"}),c=a.safeObject(b.deltaTranslate),this.deltaTranslate=a.newVector({name:this.type+"."+this.name+".deltaTranslate",x:a.xt(b.translateX)?b.deltaTranslateX:a.xt(c.x)?c.x:0,y:a.xt(b.translateY)?b.deltaTranslateY:a.xt(c.y)?c.y:0,z:a.xt(b.translateZ)?b.deltaTranslateZ:a.xt(c.y)?c.y:0}),this.work.deltaTranslate=a.newVector({name:this.type+"."+this.name+".work.deltaTranslate"}),this.pivot=b.pivot||a.d[this.type].pivot,this.path=b.path||a.d[this.type].path,this.pathRoll=b.pathRoll||a.d[this.type].pathRoll,this.addPathRoll=b.addPathRoll||a.d[this.type].addPathRoll,this.pathSpeedConstant=a.isa(b.pathSpeedConstant,"bool")?b.pathSpeedConstant:a.d[this.type].pathSpeedConstant,this.pathPlace=b.pathPlace||a.d[this.type].pathPlace,this.deltaPathPlace=b.deltaPathPlace||a.d[this.type].deltaPathPlace,this.lockX=b.lockX||a.d[this.type].lockX,this.lockY=b.lockY||a.d[this.type].lockY,this.visibility=a.isa(b.visibility,"bool")?b.visibility:a.d[this.type].visibility,this.rotation=a.newQuaternion({name:this.type+"."+this.name+".rotation"}).setFromEuler({pitch:b.pitch||0,yaw:b.yaw||0,roll:b.roll||0}),this.work.rotation=a.newQuaternion({name:this.type+"."+this.name+".work.rotation"}),this.deltaRotation=a.newQuaternion({name:this.type+"."+this.name+".deltaRotation"}).setFromEuler({pitch:b.deltaPitch||0,yaw:b.deltaYaw||0,roll:b.deltaRoll||0}),this.work.deltaRotation=a.newQuaternion({name:this.type+"."+this.name+".work.deltaRotation"}),this.rotationTolerance=b.rotationTolerance||a.d[this.type].rotationTolerance},a.PageElement.prototype.get=function(b){var c=this.getElement();if(a.contains(["width","height"],b))switch(this.type){case"Pad":if("width"===b)return this.width||parseFloat(c.width)||a.d[this.type].width;if("height"===b)return this.height||parseFloat(c.height)||a.d[this.type].height;break;default:if("width"===b)return this.width||parseFloat(c.style.width)||parseFloat(c.clientWidth)||a.d[this.type].width;if("height"===b)return this.height||parseFloat(c.style.height)||parseFloat(c.clientHeight)||a.d[this.type].height}if(a.contains(["startX","startY","handleX","handleY","deltaX","deltaY","translateX","translateY","translateZ"],b))switch(b){case"startX":return this.start.x;case"startY":return this.start.y;case"handleX":return this.handle.x;case"handleY":return this.handle.y;case"deltaX":return this.delta.x;case"deltaY":return this.delta.y;case"translateX":return this.translate.x;case"translateY":return this.translate.y;case"translateZ":return this.translate.z}return a.xt(c.style[b])?c.style[b]:"position"===b?c.style.position:"overflow"===b?c.style.overflow:"backfaceVisibility"===b?c.style.backfaceVisibility:a.Base.prototype.get.call(this,b)},a.PageElement.prototype.set=function(b){this.getElement();return b=a.safeObject(b),a.Base.prototype.set.call(this,b),this.start.type&&"Vector"===this.start.type||(this.start=a.newVector(b.start||this.start)),a.xto([b.startX,b.startY])&&(this.start.x=a.xt(b.startX)?b.startX:this.start.x,this.start.y=a.xt(b.startY)?b.startY:this.start.y),this.delta.type&&"Vector"===this.delta.type||(this.delta=a.newVector(b.delta||this.delta)),a.xto([b.deltaX,b.deltaY])&&(this.delta.x=a.xt(b.deltaX)?b.deltaX:this.delta.x,this.delta.y=a.xt(b.deltaY)?b.deltaY:this.delta.y),this.translate.type&&"Vector"===this.translate.type||(this.translate=a.newVector(b.translate||this.translate)),a.xto([b.translateX,b.translateY,b.translateZ])&&(this.translate.x=a.xt(b.translateX)?b.translateX:this.translate.x,this.translate.y=a.xt(b.translateY)?b.translateY:this.translate.y,this.translate.z=a.xt(b.translateZ)?b.translateZ:this.translate.z),this.deltaTranslate.type&&"Vector"===this.deltaTranslate.type||(this.deltaTranslate=a.newVector(b.deltaTranslate||this.deltaTranslate)),a.xto([b.deltaTranslateX,b.deltaTranslateY,b.deltaTranslateZ])&&(this.deltaTranslate.x=a.xt(b.deltaTranslateX)?b.deltaTranslateX:this.deltaTranslate.x,this.deltaTranslate.y=a.xt(b.deltaTranslateY)?b.deltaTranslateY:this.deltaTranslate.y,this.deltaTranslate.z=a.xt(b.deltaTranslateZ)?b.deltaTranslateZ:this.deltaTranslate.z),this.handle.type&&"Vector"===this.handle.type||(this.handle=a.newVector(b.handle||this.handle)),a.xto([b.handleX,b.handleY])&&(this.handle.x=a.xt(b.handleX)?b.handleX:this.handle.x,this.handle.y=a.xt(b.handleY)?b.handleY:this.handle.y),a.xto([b.pitch,b.yaw,b.roll])&&this.rotation.setFromEuler({pitch:b.pitch||0,yaw:b.yaw||0,roll:b.roll||0}),a.xto([b.deltaPitch,b.deltaYaw,b.deltaRoll])&&this.deltaRotation.setFromEuler({pitch:b.deltaPitch||0,yaw:b.deltaYaw||0,roll:b.deltaRoll||0}),a.xto([b.width,b.height,b.scale])&&this.setDimensions(),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.scale])&&delete this.offset,a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.scale,b.startX,b.startY,b.start])&&this.setDisplayOffsets(),a.xto([b.handleX,b.handleY,b.handle])&&this.setTransformOrigin(),a.xt(b.position)&&(this.position=b.position),a.xt(b.mouse)&&this.initMouse({mouse:b.mouse}),a.xt(b.pivot)&&(this.pivot=b.pivot,this.pivot||(delete this.oldX,delete this.oldY)),a.xto([b.title,b.comment])&&this.setAccessibility(b),this.setStyles(b),this},a.PageElement.prototype.setStyles=function(b){b=a.xt(b)?b:{};for(var c=this.getElement(),d=Object.keys(b),e=0,f=d.length;f>e;e++)a.contains(["width","height","translate","translateX","translateY","translateZ"],d[e])||("backfaceVisibility"===d[e]?(c.style.webkitBackfaceVisibility=b.backfaceVisibility,c.style.mozBackfaceVisibility=b.backfaceVisibility,c.style.backfaceVisibility=b.backfaceVisibility):"visibility"===d[e]?(this.visibility=a.isa(b.visibility,"str")?a.contains(["hidden","none"],b.visibility)?!1:!0:b.visibility?!0:!1,this.stack?c.style.opacity=this.visibility?1:0:c.style.display=this.visibility?"block":"none"):a.xt(c.style[d[e]])&&(c.style[d[e]]=b[d[e]]));return this},a.PageElement.prototype.setDelta=function(b){var c;return a.Position.prototype.setDelta.call(this,b),b=a.safeObject(b),a.xto([b.translate,b.translateX,b.translateY])&&(c=a.isa(b.translate,"obj")?b.translate:{},this.translate.x+=a.xt(b.translateX)?b.translateX:a.xt(c.x)?c.x:0,this.translate.y+=a.xt(b.translateY)?b.translateY:a.xt(c.y)?c.y:0,this.translate.z+=a.xt(b.translateZ)?b.translateZ:a.xt(c.z)?c.z:0),a.xto([b.deltaTranslate,b.deltaTranslateX,b.deltaTranslateY])&&(c=a.isa(b.deltaTranslate,"obj")?b.deltaTranslate:{},this.deltaTranslate.x+=a.xt(b.deltaTranslateX)?b.deltaTranslateX:a.xt(c.x)?c.x:0,this.deltaTranslate.y+=a.xt(b.deltaTranslateY)?b.deltaTranslateY:a.xt(c.y)?c.y:0,this.deltaTranslate.z+=a.xt(b.deltaTranslateZ)?b.deltaTranslateZ:a.xt(c.z)?c.z:0),a.xto([b.pitch,b.yaw,b.roll])&&(c=a.workquat.q1.setFromEuler({pitch:b.pitch||0,yaw:b.yaw||0,roll:b.roll||0}),this.rotation.quaternionMultiply(c)),a.xto([b.deltaPitch,b.deltaYaw,b.deltaRoll])&&(c=a.workquat.q1.setFromEuler({pitch:b.deltaPitch||0,yaw:b.deltaYaw||0,roll:b.deltaRoll||0}),this.deltaRotation.quaternionMultiply(c)),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.scale])&&delete this.offset,a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.scale,b.startX,b.startY,b.start])&&this.setDisplayOffsets(),a.xto([b.handleX,b.handleY,b.handle])&&this.setTransformOrigin(),a.xto([b.width,b.height,b.scale])&&this.setDimensions(),this},a.PageElement.prototype.updateStart=function(b){switch(b){case"x":a.isa(this.start.x,"num")&&(this.start.x+=this.delta.x||0);break;case"y":a.isa(this.start.y,"num")&&(this.start.y+=this.delta.y||0);break;case"path":this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1);break;default:this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1),a.isa(this.start.x,"num")&&a.isa(this.start.y,"num")&&this.start.vectorAdd(this.delta)}return this.setDisplayOffsets(),this},a.PageElement.prototype.revertStart=function(a){switch(a){case"x":this.start.x-=this.delta.x||0;break;case"y":this.start.y-=this.delta.y||0;break;case"path":this.pathPlace-=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1);break;default:this.pathPlace+=this.deltaPathPlace,this.pathPlace>1&&(this.pathPlace-=1),this.pathPlace<0&&(this.pathPlace+=1),this.start.vectorSubtract(this.delta)}return this.setDisplayOffsets(),this},a.PageElement.prototype.update3d=function(b){return b=a.safeObject(b),a.isa(b.quaternion,"quaternion")?(this.rotation.set(this.deltaRotation),this.rotation.quaternionRotate(b.quaternion),this.translate.zero(),this.translate.vectorAdd(this.deltaTranslate),this.translate.rotate3d(b.quaternion,b.distance)):(this.rotation.quaternionRotate(this.deltaRotation),this.translate.vectorAdd(this.deltaTranslate)),this},a.PageElement.prototype.reverse=function(a){switch(a){case"deltaX":this.delta.x=-this.delta.x;break;case"deltaY":this.delta.y=-this.delta.y;break;case"delta":this.delta.reverse();break;case"deltaPathPlace":this.deltaPathPlace=-this.deltaPathPlace;break;default:this.deltaPathPlace=-this.deltaPathPlace,this.delta.reverse()}return this},a.PageElement.prototype.getPivotOffsetVector=function(){return a.Position.prototype.getPivotOffsetVector.call(this)},a.PageElement.prototype.getStartValues=function(b){b=a.xt(b)?b:!1;var c,d,e;return b?(c=a.v.set(a.element[this.pivot].start),d=a.element[this.pivot].get(d),e=a.element[this.pivot].get(e)):(c=a.v.set(this.start),d=this.stack?a.stack[this.stack].get("height"):this.height||this.get("height"),e=this.stack?a.stack[this.stack].get("width"):this.width||this.get("width")),a.Position.prototype.calculatePOV.call(this,c,e,d,!1)},a.PageElement.prototype.getOffsetStartVector=function(){return a.Position.prototype.getOffsetStartVector.call(this)},a.PageElement.prototype.renderElement=function(){var b=this.getElement(),c="",d=[];a.xt(this.offset)||(this.offset=this.getOffsetStartVector()),this.path?this.setStampUsingPath():this.pivot&&this.setStampUsingPivot(),this.updateStart(),1!==this.rotation.getMagnitude()&&this.rotation.normalize(),d.push(Math.round(this.translate.x*this.scale)),d.push(Math.round(this.translate.y*this.scale)),d.push(Math.round(this.translate.z*this.scale)),d.push(this.rotation.v.x),d.push(this.rotation.v.y),d.push(this.rotation.v.z),d.push(this.rotation.getAngle(!1));for(var e=0,f=d.length;f>e;e++)a.isBetween(d[e],1e-6,-1e-6)&&(d[e]=0);return c+="translate3d("+d[0]+"px,"+d[1]+"px,"+d[2]+"px) rotate3d("+d[3]+","+d[4]+","+d[5]+","+d[6]+"rad)",b.style.webkitTransform=c,b.style.transform=c,b.style.zIndex=d[2],c=this.getStartValues(),b.style.left=c.x*this.scale+this.offset.x+"px",b.style.top=c.y*this.scale+this.offset.y+"px",this},a.PageElement.prototype.setStampUsingPath=function(){var b,c;return a.contains(a.spritenames,this.path)&&"Path"===a.sprite[this.path].type&&(b=a.sprite[this.path].getPerimeterPosition(this.pathPlace,this.pathSpeedConstant,this.addPathRoll),this.start.x=this.lockX?this.start.x:b.x,this.start.y=this.lockY?this.start.y:b.y,this.pathRoll=b.r||0,this.addPathRoll&&this.pathRoll&&(c=this.rotation.getEulerAngles(),this.setDelta({roll:this.pathRoll-c.roll}))),this},a.PageElement.prototype.setStampUsingPivot=function(){var b,c,d,e,f;return a.contains(a.pointnames,this.pivot)?(c=a.point[this.pivot],e=a.sprite[c.sprite],d=c.getCurrentCoordinates().rotate(e.roll).vectorAdd(e.getStartValues()),this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y):a.contains(a.spritenames,this.pivot)?(c=a.sprite[this.pivot],d=c.get("Particle"===c.type?"place":"start"),this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y):a.contains(a.padnames,this.pivot)?(c=a.pad[this.pivot],d=c.getStartValues(),this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y):a.contains(a.elementnames,this.pivot)?(c=a.element[this.pivot],d=c.getStartValues(),this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y):"mouse"===this.pivot&&this.stack&&(b=a.stack[this.stack].getMouse(),f=this.getStartValues(),a.xta([this.mouseX,this.mouseY])||(this.oldX=f.x,this.oldY=f.y),b.active&&(this.start.x=this.lockX?this.start.x:f.x+b.x-this.oldX,this.start.y=this.lockY?this.start.y:f.y+b.y-this.oldY,this.oldX=b.x,this.oldY=b.y)),this},a.PageElement.prototype.setTransformOrigin=function(){var b=this.getElement(),c=a.isa(this.handle.x,"str")?this.handle.x:this.handle.x*this.scale+"px",d=a.isa(this.handle.y,"str")?this.handle.y:this.handle.y*this.scale+"px",e=c+" "+d;return b.style.mozTransformOrigin=e,b.style.webkitTransformOrigin=e,b.style.msTransformOrigin=e,b.style.oTransformOrigin=e,b.style.transformOrigin=e,this},a.PageElement.prototype.setDisplayOffsets=function(){var a=0,b=0,c=this.getElement();if(c.offsetParent)do a+=c.offsetLeft,b+=c.offsetTop,c=c.offsetParent;while(c.offsetParent);return this.offset=this.getOffsetStartVector(),this.displayOffsetX=a,this.displayOffsetY=b,this},a.newStack=function(b){return new a.Stack(b)},a.newElement=function(b){return new a.Element(b)},a.pushUnique(a.sectionlist,"stack"),a.pushUnique(a.sectionlist,"stk"),a.pushUnique(a.nameslist,"stacknames"),a.Stack=function(b){if(b=a.safeObject(b),a.xt(b.stackElement)){var c,d="";return a.xto([b.stackElement.id,b.stackElement.name])&&(d=b.stackElement.id||b.stackElement.name),a.PageElement.call(this,{name:d}),a.stack[this.name]=this,a.stk[this.name]=b.stackElement,a.pushUnique(a.stacknames,this.name),a.stk[this.name].id=this.name,a.stk[this.name].style.position="relative",this.setDisplayOffsets(),c=a.isa(b.perspective,"obj")?b.perspective:{},this.perspective=a.newVector({x:a.xt(b.perspectiveX)?b.perspectiveX:a.xt(c.x)?c.x:"center",y:a.xt(b.perspectiveY)?b.perspectiveY:a.xt(c.y)?c.y:"center",z:a.xt(b.perspectiveZ)?b.perspectiveZ:a.xt(c.z)?c.z:0}),this.work.perspective=a.newVector({name:this.type+"."+this.name+".work.perspective"}),this.width=b.width||this.get("width"),this.height=b.height||this.get("height"),this.scaleText=a.isa(b.scaleText,"bool")?b.scaleText:!1,this.setDimensions(),this.setPerspective(),this.setStyles(b),a.xto([b.title,b.comment])&&this.setAccessibility(b),b.mouse=a.isa(b.mouse,"bool")||a.isa(b.mouse,"vector")?b.mouse:!0,this.initMouse(b),this}return console.log("Failed to generate a Stack wrapper - no DOM element supplied"),!1},a.Stack.prototype=Object.create(a.PageElement.prototype),a.Stack.prototype.type="Stack",a.Stack.prototype.classname="stacknames",a.d.Stack={perspective:{x:"center",y:"center",z:0},scaleText:!1},a.mergeInto(a.d.Stack,a.d.PageElement),a.Stack.prototype.getElement=function(){return a.stk[this.name]},a.Stack.prototype.set=function(b){return b=a.xt(b)?b:{},a.PageElement.prototype.set.call(this,b),a.xto([b.perspective,b.perspectiveX,b.perspectiveY,b.perspectiveZ])&&(a.isa(this.perspective,"Vector")||(this.perspective=a.newVector(b.perspective||this.perspective)),this.perspective.x=a.xt(b.perspectiveX)?b.perspectiveX:this.perspective.x,this.perspective.y=a.xt(b.perspectiveY)?b.perspectiveY:this.perspective.y,this.perspective.z=a.xt(b.perspectiveZ)?b.perspectiveZ:this.perspective.z,this.setPerspective()),a.xt(b.scale)&&this.scaleStack(b.scale),this},a.Stack.prototype.addElementById=function(b){if(a.isa(b,"str")){var c=a.newElement({domElement:document.getElementById(b),stack:this.name});return a.stk[this.name].appendChild(a.elm[c.name]),a.elm[c.name]=document.getElementById(c.name),c}return!1},a.Stack.prototype.addElementsByClassName=function(b){var c,d,e,f,g,h=[];if(a.isa(b,"str")){for(c=document.getElementsByClassName(b),f=0,g=c.length;g>f;f++)e=c[f],"CANVAS"!==e.nodeName&&(d=a.newElement({domElement:e,stack:this.name}),h.push(d));for(f=0,g=h.length;g>f;f++)a.stk[this.name].appendChild(a.elm[h[f].name]),a.elm[h[f].name]=document.getElementById(h[f].name);return h}return!1},a.Stack.prototype.renderElements=function(){var b,c,d;for(c=0,d=a.stacknames.length;d>c;c++)b=a.stack[a.stacknames[c]],b.stack===this.name&&b.renderElement();for(c=0,d=a.padnames.length;d>c;c++)b=a.pad[a.padnames[c]],b.stack===this.name&&b.renderElement();for(c=0,d=a.elementnames.length;d>c;c++)b=a.element[a.elementnames[c]],b.stack===this.name&&b.renderElement();return!0},a.Stack.prototype.parsePerspective=function(){var b=this.work.perspective,c=this.height||this.get("height"),d=this.width||this.get("width");return a.Position.prototype.calculatePOV.call(this,b,d,c,!1)},a.Stack.prototype.setPerspective=function(){this.resetWork();var b=a.isa(this.perspective.x,"str")?this.scale:1,c=a.isa(this.perspective.y,"str")?this.scale:1,d=this.parsePerspective(),e=this.getElement();d.x*=b,d.y*=c,d.z*=b,e.style.mozPerspectiveOrigin=d.x+"px "+d.y+"px",e.style.webkitPerspectiveOrigin=d.x+"px "+d.y+"px",e.style.perspectiveOrigin=d.x+"px "+d.y+"px",e.style.mozPerspective=d.z+"px",e.style.webkitPerspective=d.z+"px",e.style.perspective=d.z+"px"},a.Stack.prototype.scaleStack=function(b,c){var d,e;if(c=a.xt(c)?c:this.scaleText,a.isa(b,"num")&&"Stack"===this.type){for(d=0,e=a.stacknames.length;e>d;d++)a.stack[a.stacknames[d]].stack===this.name&&a.stack[a.stacknames[d]].scaleStack(b);for(d=0,e=a.elementnames.length;e>d;d++)a.element[a.elementnames[d]].stack===this.name&&a.element[a.elementnames[d]].scaleDimensions(b);for(d=0,e=a.padnames.length;e>d;d++)a.pad[a.padnames[d]].stack===this.name&&a.pad[a.padnames[d]].scaleDimensions(b);this.scaleDimensions(b),"Stack"===this.type&&(this.setPerspective(),c&&(a.stk[this.name].style.fontSize=100*b+"%"))}return this},a.pushUnique(a.sectionlist,"element"),a.pushUnique(a.sectionlist,"elm"),a.pushUnique(a.nameslist,"elementnames"),a.Element=function(b){if(b=a.isa(b,"obj")?b:{},a.xt(b.domElement)){var c="";return a.xto([b.domElement.id,b.domElement.name])&&(c=b.domElement.id||b.domElement.name),a.PageElement.call(this,{name:c}),a.element[this.name]=this,a.elm[this.name]=b.domElement,a.pushUnique(a.elementnames,this.name),a.elm[this.name].id=this.name,a.elm[this.name].style.position="absolute",a.elm[this.name].style.visibility="visible",this.stack=b.stack||"",this.width=b.width||this.get("width"),this.height=b.height||this.get("height"),this.setDimensions(),this.setDisplayOffsets(),this.setStyles(b),a.xto([b.title,b.comment])&&this.setAccessibility(b),b.mouse=a.isa(b.mouse,"bool")||a.isa(b.mouse,"vector")?b.mouse:!1,this.initMouse(b),this}return console.log("Failed to generate an Element wrapper - no DOM element supplied"),!1},a.Element.prototype=Object.create(a.PageElement.prototype),a.Element.prototype.type="Element",a.Element.prototype.classname="elementnames",a.d.Element={},a.mergeInto(a.d.Element,a.d.PageElement),a.Element.prototype.getElement=function(){return a.elm[this.name]},a}(scrawl);