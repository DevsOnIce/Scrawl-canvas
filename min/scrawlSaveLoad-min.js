/*! scrawl-canvas 2014-08-18 */
var scrawl=function(a){"use strict";return a.load=function(b){var c,d,e,f,g;a.isa(b,"str")&&(b=[b]);for(var h=0,i=b.length;i>h;h++)if(a.isa(b[h],"str")&&(c=JSON.parse(b[h]),a.xt(c.type)))if(d=c.type.toLowerCase(),a.contains(a[c.classname],c.name)){e=a[d][c.name].parse(),f=a.d[c.type],g=Object.keys(e);for(var j=0,k=g.length;k>j;j++)a.xt(c[g])||(c[g]=f[g]);a[d][c.name].set(c)}else switch(d){case"pad":a.addCanvasToPage(c),a.currentPad=c.name;break;case"cell":a.xt(c.pad)&&a.contains(a.padnames,c.pad)&&!a.contains(a.pad[c.pad].cells,c.name)&&a.pad[c.pad].addNewCell(c);break;case"group":a.newGroup(c);break;case"path":a.makePath(c);break;case"gradient":a.newGradient(c);break;case"radialgradient":a.newRadialGradient(c);break;default:new a[c.type](c)}return!0},a.save=function(b){var c,d,e=[];switch(b){case"pads":for(c=0,d=a.padnames.length;d>c;c++)e=e.concat(a.pad[a.padnames[c]].toString());break;case"cells":for(c=0,d=a.cellnames.length;d>c;c++)e=e.concat(a.cell[a.cellnames[c]].toString());break;case"groups":for(c=0,d=a.groupnames.length;d>c;c++)e=e.concat(a.group[a.groupnames[c]].toString());break;case"sprites":for(c=0,d=a.spritenames.length;d>c;c++)e=e.concat(a.sprite[a.spritenames[c]].toString());break;case"designs":for(c=0,d=a.designnames.length;d>c;c++)e=e.concat(a.design[a.designnames[c]].toString());break;case"animsheets":if(a.xt(a.animnames))for(c=0,d=a.animnames.length;d>c;c++)e=e.concat(a.anim[a.animnames[c]].toString());break;case"springs":if(a.xt(a.springnames))for(c=0,d=a.springnames.length;d>c;c++)e=e.concat(a.spring[a.springnames[c]].toString())}return e},a.Base.prototype.toString=function(){var b=Object.keys(a.d[this.type]),c={};c.type=this.type,c.classname=this.classname,c.name=this.name;for(var d=0,e=b.length;e>d;d++)a.xt(this[b[d]])&&this[b[d]]!==a.d[this.type][b[d]]&&(c[b[d]]=this[b[d]]);return JSON.stringify(c)},a.Position.prototype.toString=function(){var b=Object.keys(a.d[this.type]),c={};c.type=this.type,c.classname=this.classname,c.name=this.name;for(var d=0,e=b.length;e>d;d++)a.contains(["start","delta","handle"],b[d])?this[b[d]].isLike(a.d[this.type][b[d]])||(c[b[d]]=this[b[d]]):a.xt(this[b[d]])&&this[b[d]]!==a.d[this.type][b[d]]&&(c[b[d]]=this[b[d]]);return JSON.stringify(c)},a.PageElement.prototype.toString=function(){var b,c=Object.keys(a.d[this.type]),d={};d.type=this.type,d.classname=this.classname,d.name=this.name;for(var e=0,f=c.length;f>e;e++)a.contains(["start","delta","handle","perspective","translate"],c[e])&&(this[c[e]].isLike(a.d[this.type][c[e]])||(d[c[e]]=this[c[e]])),"rotation"===c[e]&&(b=this.rotation.getEulerAngles(),0!==b.pitch&&(d.pitch=b.pitch),0!==b.yaw&&(d.yaw=b.yaw),0!==b.roll&&(d.roll=b.roll)),"deltaRotation"===c[e]?(b=this.rotation.getEulerAngles(),0!==b.pitch&&(d.deltaPitch=b.pitch),0!==b.yaw&&(d.deltaYaw=b.yaw),0!==b.roll&&(d.deltaRoll=b.roll)):a.xt(this[c[e]])&&this[c[e]]!==a.d[this.type][c[e]]&&(d[c[e]]=this[c[e]]);return JSON.stringify(d)},a.Pad.prototype.toString=function(b){var c,d,e,f,g,h=Object.keys(a.d[this.type]),i={},j=[],k=[],l=[],m=[];for(i.type=this.type,i.classname=this.classname,i.name=this.name,i.parentElement=a.canvas[this.name].parentElement.id,d=0,e=h.length;e>d;d++)a.contains(["start","delta","handle"],h[d])?this[h[d]].isLike(a.d[this.type][h[d]])||(i[h[d]]=this[h[d]]):a.xt(this[h[d]])&&this[h[d]]!==a.d[this.type][h[d]]&&(i[h[d]]=this[h[d]]);if(delete i.displayOffsetX,delete i.displayOffsetY,j.push(JSON.stringify(i)),!b){for(d=0,e=this.cells.length;e>d;d++){for(f=0,g=a.cell[this.cells[d]].groups.length;g>f;f++)a.pushUnique(k,a.cell[this.cells[d]].groups[f]);j.push(a.cell[this.cells[d]].toString(!0))}for(d=0,e=k.length;e>d;d++){for(f=0,g=a.group[k[d]].sprites.length;g>f;f++)a.pushUnique(l,a.group[k[d]].sprites[f]);j.push(a.group[k[d]].toString(!0))}for(d=0,e=l.length;e>d;d++)c=a.ctx[a.sprite[l[d]].context],a.contains(a.designnames,c.fillStyle)&&a.pushUnique(m,c.fillStyle),a.contains(a.designnames,c.strokeStyle)&&a.pushUnique(m,c.strokeStyle),a.contains(a.designnames,c.shadowColor)&&a.pushUnique(m,c.shadowColor);for(d=0,e=m.length;e>d;d++)j.push(a.design[m[d]].toString());for(d=0,e=l.length;e>d;d++)j.push(a.sprite[l[d]].toString(!0))}return j},a.Cell.prototype.toString=function(b){var c,d,e,f,g,h=Object.keys(a.d[this.type]),i={},j=[],k=[],l=[];for(i.type=this.type,i.classname=this.classname,i.name=this.name,d=0,e=h.length;e>d;d++)a.contains(["start","delta","handle","source","sourceDelta"],h[d])?this[h[d]].isLike(a.d[this.type][h[d]])||(i[h[d]]=this[h[d]]):a.xt(this[h[d]])&&this[h[d]]!==a.d[this.type][h[d]]&&(i[h[d]]=this[h[d]]);if(j.push(JSON.stringify(i)),!b){for(d=0,e=this.groups.length;e>d;d++){for(f=0,g=a.group[this.groups[d]].sprites.length;g>f;f++)a.pushUnique(k,a.group[this.groups[d]].sprites[f]);j.push(a.group[this.groups[d]].toString(!0))}for(d=0,e=k.length;e>d;d++)c=a.ctx[a.sprite[k[d]].context],a.contains(a.designnames,c.fillStyle)&&a.pushUnique(l,c.fillStyle),a.contains(a.designnames,c.strokeStyle)&&a.pushUnique(l,c.strokeStyle),a.contains(a.designnames,c.shadowColor)&&a.pushUnique(l,c.shadowColor);for(d=0,e=l.length;e>d;d++)j.push(a.design[l[d]].toString());for(d=0,e=k.length;e>d;d++)j.push(a.sprite[k[d]].toString(!0))}return j},a.Context.prototype.toString=function(){for(var b={},c=0,d=a.contextKeys.length;d>c;c++)"lineDash"===a.contextKeys[c]?a.xt(this.lineDash)&&this.lineDash.length>0&&(b.lineDash=this.lineDash):a.xt(this[a.contextKeys[c]])&&this[a.contextKeys[c]]!==a.d.Context[a.contextKeys[c]]&&(b[a.contextKeys[c]]=this[a.contextKeys[c]]);return JSON.stringify(b)},a.Group.prototype.toString=function(b){var c,d,e,f=Object.keys(a.d[this.type]),g={},h=[],i=[];for(g.type=this.type,g.classname=this.classname,g.name=this.name,d=0,e=f.length;e>d;d++)a.xt(this[f[d]])&&this[f[d]]!==a.d[this.type][f[d]]&&(g[f[d]]=this[f[d]]);if(delete g.sprites,h.push(JSON.stringify(g)),!b){for(d=0,e=this.sprites.length;e>d;d++)c=a.ctx[a.sprite[this.sprites[d]].context],a.contains(a.designnames,c.fillStyle)&&a.pushUnique(i,c.fillStyle),a.contains(a.designnames,c.strokeStyle)&&a.pushUnique(i,c.strokeStyle),a.contains(a.designnames,c.shadowColor)&&a.pushUnique(i,c.shadowColor);for(d=0,e=i.length;e>d;d++)h.push(a.design[i[d]].toString());for(d=0,e=this.sprites.length;e>d;d++)h.push(a.sprite[this.sprites[d]].toString(!0))}return h},a.Group.prototype.save=function(){var b=Object.keys(a.d[this.type]),c={};c.type=this.type,c.classname=this.classname,c.name=this.name;for(var d=0,e=b.length;e>d;d++)a.xt(this[b[d]])&&this[b[d]]!==a.d[this.type][b[d]]&&(c[b[d]]=this[b[d]]);return[JSON.stringify(c)]},a.Sprite.prototype.toString=function(b){b=a.xt(b)?b:!1;var c,d=Object.keys(a.d[this.type]),e={},f=a.ctx[this.context],g=[],h=[];if(e.type=this.type,e.classname=this.classname,e.name=this.name,!b){f&&f.fillStyle&&a.contains(a.designnames,f.fillStyle)&&a.pushUnique(g,f.fillStyle),f&&f.strokeStyle&&a.contains(a.designnames,f.strokeStyle)&&a.pushUnique(g,f.strokeStyle),f&&f.shadowColor&&a.contains(a.designnames,f.shadowColor)&&a.pushUnique(g,f.shadowColor);for(var i=0,j=g.length;j>i;i++)h.push(a.design[g[i]].toString())}for(var k=0,l=d.length;l>k;k++)if(a.contains(["start","delta","handle"],d[k]))this[d[k]].isLike(a.d[this.type][d[k]])||(e[d[k]]=this[d[k]]);else if("context"===d[k]&&a.xt(a.ctx[this.context])){f=JSON.parse(a.ctx[this.context].toString()),c=Object.keys(f);for(var m=0,n=c.length;n>m;m++)e[c[m]]=f[c[m]]}else a.contains(["collisionVectors","dataSet","pointList","firstPoint","linkList","linkDurations","perimeterLength","style","variant","weight","size","metrics","family","texts"],d[k])||a.xt(this[d[k]])&&this[d[k]]!==a.d[this.type][d[k]]&&(e[d[k]]=this[d[k]]);return"Picture"===this.type&&(e.url=a.image[this.source].source),h.push(JSON.stringify(e).replace("\\n","\\\\n")),h},a}(scrawl);