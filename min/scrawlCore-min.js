/*! scrawl-canvas 2015-05-23 */
var scrawl=window.scrawl||function(){"use strict";var a={};return a.version="4.2.1",a.nameslist=["objectnames","padnames","cellnames","ctxnames","groupnames","designnames","entitynames"],a.sectionlist=["object","pad","cell","canvas","context","ctx","imageData","group","design","dsn","entity"],a.radian=Math.PI/180,a.d={},a.v=null,a.o={},a.workquat=null,a.f=document.createDocumentFragment(),a.cv=document.createElement("canvas"),a.cv.id="defaultHiddenCanvasElement",a.f.appendChild(a.cv),a.cvx=a.cv.getContext("2d"),a.loadAlias={block:"scrawlBlock",wheel:"scrawlWheel",phrase:"scrawlPhrase",path:"scrawlPath",shape:"scrawlShape",images:"scrawlImages",frame:"scrawlFrame",animation:"scrawlAnimation",collisions:"scrawlCollisions",factories:"scrawlPathFactories",color:"scrawlColor",filters:"scrawlFilters",physics:"scrawlPhysics",saveload:"scrawlSaveLoad",stacks:"scrawlStacks",quaternion:"scrawlQuaternion",imageload:"scrawlImageLoad"},a.extensions=[],a.modules=a.extensions,a.loadDependencies={block:[],wheel:[],phrase:[],path:[],shape:[],images:["imageload"],frame:["imageload"],animation:[],collisions:[],factories:[],color:[],filters:[],physics:["quaternion"],saveload:[],stacks:["quaternion"],quaternion:[]},a.init=function(){return a.reset(),a.pageInit(),a.setDisplayOffsets("all"),a.animationInit(),a.physicsInit(),a.filtersInit(),a.resizePageListener(),a},a.resizePageListener=function(){window.removeEventListener("resize",a.resizePageEvent,!1),window.addEventListener("resize",a.resizePageEvent,!1)},a.resizePageEvent=function(){a.setDisplayOffsets("all")},a.pageInit=function(){a.getCanvases()},a.animationInit=function(){},a.physicsInit=function(){},a.filtersInit=function(){},a.reset=function(){for(var b=0,c=a.nameslist.length;c>b;b++)a[a.nameslist[b]]=[];for(var d=0,e=a.sectionlist.length;e>d;d++)a[a.sectionlist[d]]={};return a},a.loadExtensions=function(b){b=a.safeObject(b);var c,d,e,f,g=b.path||"",h=[],i=a.isa(b.callback,"fn")?b.callback:function(){},j=a.isa(b.error,"fn")?b.error:function(){},k=a.xtGet(b.minified,!0),l=k?"-min.js":".js",m=[],n=[],o=Date.now(),p=3e4,q=function(b){var c,d=a.loadAlias[b]||b;a.contains(a.extensions,d)||(c=document.createElement("script"),c.type="text/javascript",c.async="true",c.onload=function(){r(b)},c.onerror=function(){r(b,!0)},c.src=/\.js$/.test(d)?g+d:g+d+l,document.body.appendChild(c))},r=function(b,c){a.removeItem(m,b),c||Date.now()>o+p?j():a.pushUnique(a.extensions,b),0===m.length&&i()};for(a.xt(b.extensions)&&(h=h.concat([].concat(b.extensions))),a.xt(b.modules)&&(h=h.concat([].concat(b.modules))),c=0,d=h.length;d>c;c++){for(e=0,f=a.loadDependencies[h[c]].length;f>e;e++)a.pushUnique(n,a.loadDependencies[h[c]][e]);a.pushUnique(n,h[c])}for(m=[].concat(n),c=0,d=n.length;d>c;c++)q(n[c]);return a},a.loadModules=a.loadExtensions,a.mergeInto=function(b,c){for(var d in c)c.hasOwnProperty(d)&&!a.xt(b[d])&&(b[d]=c[d]);return b},a.mergeOver=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.contains=function(a,b){return a.indexOf(b)>=0?!0:!1},a.toInt=function(a){return a.substring&&(a=parseFloat(a)),a.toFixed?0|a:0},a.pushUnique=function(a,b){return a.indexOf(b)<0&&a.push(b),a},a.removeItem=function(a,b){var c;return c=a.indexOf(b),c>=0&&a.splice(c,1),a},a.isBetween=function(a,b,c,d){var e;return b>c&&(e=b,b=c,c=e),d?a>=b&&c>=a?!0:!1:a>b&&c>a||a===b&&a===c?!0:!1},a.addWithinBounds=function(b,c,d){var e,f,g,h,i,j,k;if(d=a.safeObject(d),b=a.xtGet(b,0),c=a.xtGet(c,0),e=a.xtGet(d.min,0),f=a.xtGet(d.max,1),h=a.xtGet(d.action,"stick"),i=a.xtGet(d.operation,"add"),g=20,j=0,k=!1,0===c&&("divide"===i||"/"===i))return!1;switch(i){case"subtract":case"-":j=b-c;break;case"multiply":case"*":j=b*c;break;case"divide":case"/":j=b/c;break;default:j=b+c}for(;!a.isBetween(j,e,f,!0)&&g>0;){switch(k=(e+f)/2>j?!0:!1,h){case"bounce":j=k?e+(-j+e):f+(-j+f);break;case"loop":j=k?f-e+j:e-f+j;break;default:j=k?e:f}g--}return g>0?j:!1},a.isa=function(){var b=Array.prototype.slice.call(arguments);if(2==b.length&&a.xt(b[0])){if("str"==b[1])return b[0].substring?!0:!1;if("fn"==b[1])return"function"==typeof b[0]?!0:!1;if(b.push(b[1][0]),b[2]<"m")if(b[2]<"d")switch(b[1]){case"arr":return Array.isArray(b[0])?!0:!1;case"bool":return"boolean"==typeof b[0]?!0:!1;case"canvas":return"[object HTMLCanvasElement]"===Object.prototype.toString.call(b[0])?!0:!1;default:return!1}else switch(b[1]){case"date":return"[object Date]"===Object.prototype.toString.call(b[0])?!0:!1;case"dom":return b[0].querySelector&&b[0].dispatchEvent?!0:!1;case"event":return b[0].preventDefault&&b[0].initEvent?!0:!1;case"img":return"[object HTMLImageElement]"===Object.prototype.toString.call(b[0])?!0:!1;default:return!1}else if(b[2]<"s")switch(b[1]){case"num":return b[0].toFixed?!0:!1;case"obj":return"[object Object]"===Object.prototype.toString.call(b[0])?!0:!1;case"quaternion":return b[0].type&&"Quaternion"===b[0].type?!0:!1;default:return!1}else switch(b[1]){case"vector":return b[0].type&&"Vector"===b[0].type?!0:!1;case"video":return"[object HTMLVideoElement]"===Object.prototype.toString.call(b[0])?!0:!1;default:return!1}}return!1},a.safeObject=function(b){return"[object Object]"===Object.prototype.toString.call(b)?b:a.o},a.xt=function(a){return"undefined"==typeof a?!1:!0},a.xtGet=function(){var a,b,c;if(a=Array.prototype.slice.call(arguments),a.length>0)for(b=0,c=a.length;c>b;b++)if("undefined"!=typeof a[b])return a[b];return null},a.xtGetTrue=function(){var a,b,c;if(a=Array.prototype.slice.call(arguments),a.length>0)for(b=0,c=a.length;c>b;b++)if(a[b])return a[b];return null},a.xta=function(){var a,b,c;if(a=Array.prototype.slice.call(arguments),Array.isArray(a[0])&&(a=a[0]),a.length>0){for(b=0,c=a.length;c>b;b++)if("undefined"==typeof a[b])return!1;return!0}return!1},a.xto=function(){var a,b,c;if(a=Array.prototype.slice.call(arguments),Array.isArray(a[0])&&(a=a[0]),a.length>0)for(b=0,c=a.length;c>b;b++)if("undefined"!=typeof a[b])return!0;return!1},a.makeName=function(b){var c,d;return b=a.safeObject(b),a.contains(a.nameslist,b.target)?(c=a.xtGetTrue(b.name,b.type,"default"),c=c.replace(/\./g,"_"),c=c.replace(/\//g,"_"),c=c.replace(/ /g,"_"),c=c.replace(/\+/g,"_"),c=c.replace(/\*/g,"_"),c=c.replace(/\[/g,"_"),c=c.replace(/\{/g,"_"),c=c.replace(/\(/g,"_"),c=c.replace(/\)/g,"_"),c=c.replace(/~/g,"_"),c=c.replace(/-/g,"_"),c=c.replace(/#/g,"_"),c=c.replace(/\\/g,"_"),c=c.replace(/\^/g,"_"),c=c.replace(/\$/g,"_"),c=c.replace(/\|/g,"_"),c=c.replace(/\?/g,"_"),d=c.split("___"),a.contains(a[b.target],d[0])?d[0]+"___"+Math.floor(1e8*Math.random()):d[0]):!1},a.setDisplayOffsets=function(){var b,c;for(b=0,c=a.padnames.length;c>b;b++)a.pad[a.padnames[b]].setDisplayOffsets();return a},a.getCanvases=function(){var b,c,d,e;if(b=document.getElementsByTagName("canvas"),b.length>0){for(d=0,e=b.length;e>d;d++)c=a.makePad({canvasElement:b[d]}),0===d&&(a.currentPad=c.name);return!0}return!1},a.addCanvasToPage=function(b){var c,d,e;return b=a.safeObject(b),c=document.getElementById(b.parentElement)||document.body,d=document.createElement("canvas"),c.appendChild(d),b.width=a.xtGet(b.width,300),b.height=a.xtGet(b.height,150),b.canvasElement=d,e=new a.Pad(b),a.setDisplayOffsets(),e},a.clear=function(b){var c,d,e;for(c=a.xt(b)?[].concat(b):a.padnames,d=0,e=c.length;e>d;d++)a.pad[c[d]].clear();return a},a.compile=function(b){var c,d,e;for(c=a.xt(b)?[].concat(b):a.padnames,d=0,e=c.length;e>d;d++)a.pad[c[d]].compile();return a},a.show=function(b){var c,d,e;for(c=a.xt(b)?[].concat(b):a.padnames,d=0,e=c.length;e>d;d++)a.pad[c[d]].show();return a},a.render=function(b){var c,d,e;for(c=a.xt(b)?[].concat(b):a.padnames,d=0,e=c.length;e>d;d++)a.pad[c[d]].render();return a},a.addPercentages=function(a,b){return a=parseFloat(a),b=parseFloat(b),a+b+"%"},a.reversePercentage=function(a){return a=parseFloat(a),a=-a,a+"%"},a.subtractPercentages=function(a,b){return a=parseFloat(a),b=parseFloat(b),a-b+"%"},a.activeListeners=[],window.CustomEvent&&(a.eventAttributes=["altKey","bubbles","cancelBubble","cancelable","charCode","clipboardData","ctrlKey","currentTarget","defaultPrevented","detail","eventPhase","keyCode","layerX","layerY","metaKey","pageX","pageY","returnValue","shiftKey","srcElement","target","timestamp","view","which"],a.touchEventAttributes=["clientX","clientY","force","identifier","pageX","pageY","radiusX","radiusY","screenX","screenY","target","webkitForce","webkitRadiusX","webkitRadiusY","webkitRotationAngle"],a.triggerTouchEnter=function(b,c){a.updateCustomTouch(b,c,new CustomEvent("touchenter",{detail:{},type:"touchenter"}))},a.triggerTouchLeave=function(b,c){a.updateCustomTouch(b,c,new CustomEvent("touchleave",{detail:{},type:"touchenter"}))},a.triggerTouchFollow=function(b,c){a.updateCustomTouch(b,c,new CustomEvent("touchfollow",{detail:{},type:"touchfollow"}))},a.updateCustomTouch=function(b,c,d){var e,f,g,h;for(e=0,f=a.eventAttributes.length;f>e;e++)a.xt(b[a.eventAttributes[e]])&&(d[a.eventAttributes[e]]=b[a.eventAttributes[e]]);if(d.changedTouches=[],a.xt(b.changedTouches))for(e=0,f=b.changedTouches.length;f>e;e++)for(d.changedTouches.push({}),g=0,h=a.touchEventAttributes.length;h>g;g++)a.xt(b.changedTouches[e][a.touchEventAttributes[g]])&&(d.changedTouches[e][a.touchEventAttributes[g]]=b.changedTouches[e][a.touchEventAttributes[g]]);if(a.xt(b.path)&&(d.path=b.path),d.targetTouches=[],a.xt(b.targetTouches))for(e=0,f=b.targetTouches.length;f>e;e++)for(d.targetTouches.push({}),g=0,h=a.touchEventAttributes.length;h>g;g++)a.xt(b.targetTouches[e][a.touchEventAttributes[g]])&&(d.targetTouches[e][a.touchEventAttributes[g]]=b.targetTouches[e][a.touchEventAttributes[g]]);if(d.touches=[],a.xt(b.touches))for(e=0,f=b.touches.length;f>e;e++)for(d.touches.push({}),g=0,h=a.touchEventAttributes.length;h>g;g++)a.xt(b.touches[e][a.touchEventAttributes[g]])&&(d.touches[e][a.touchEventAttributes[g]]=b.touches[e][a.touchEventAttributes[g]]);c.dispatchEvent(d)}),a.addNativeListener=function(b,c,d){var e,f,g,h,i;if(a.removeNativeListener(b,c,d),b=[].concat(b),e=d.substring?document.body.querySelectorAll(d):Array.isArray(d)?d:[d],a.isa(c,"fn"))for(h=0,i=b.length;i>h;h++)for(f=0,g=e.length;g>f;f++)e[f].addEventListener(b[h],c,!1)},a.removeNativeListener=function(b,c,d){var e,f,g,h,i;if(b=[].concat(b),e=d.substring?document.body.querySelectorAll(d):Array.isArray(d)?d:[d],a.isa(c,"fn"))for(h=0,i=b.length;i>h;h++)for(f=0,g=e.length;g>f;f++)e[f].removeEventListener(b[h],c,!1)},a.addListener=function(b,c,d){var e,f,g,h,i,j;if(a.removeListener(b,c,d),j=navigator.pointerEnabled||navigator.msPointerEnabled?!0:!1,b=[].concat(b),e=d.substring?document.body.querySelectorAll(d):Array.isArray(d)?d:[d],a.isa(c,"fn"))for(h=0,i=b.length;i>h;h++)for(f=0,g=e.length;g>f;f++)if(a.isa(e[f],"dom"))switch(b[h]){case"leave":j?e[f].addEventListener("pointerleave",c,!1):(e[f].addEventListener("mouseleave",c,!1),e[f].addEventListener("touchleave",c,!1));break;case"up":j?e[f].addEventListener("pointerup",c,!1):(e[f].addEventListener("mouseup",c,!1),e[f].addEventListener("touchend",c,!1));break;case"enter":j?e[f].addEventListener("pointerenter",c,!1):(e[f].addEventListener("mouseenter",c,!1),e[f].addEventListener("touchenter",c,!1));break;case"down":j?e[f].addEventListener("pointerdown",c,!1):(e[f].addEventListener("mousedown",c,!1),e[f].addEventListener("touchstart",c,!1));break;case"move":j?e[f].addEventListener("pointermove",c,!1):(e[f].addEventListener("mousemove",c,!1),e[f].addEventListener("touchmove",c,!1),e[f].addEventListener("touchfollow",c,!1))}return!0},a.removeListener=function(b,c,d){var e,f,g,h,i,j;if(b=[].concat(b),j=navigator.pointerEnabled||navigator.msPointerEnabled?!0:!1,e=d.substring?document.body.querySelectorAll(d):Array.isArray(d)?d:[d],a.isa(c,"fn"))for(h=0,i=b.length;i>h;h++)for(f=0,g=e.length;g>f;f++)if(a.isa(e[f],"dom"))switch(b[h]){case"leave":j?e[f].removeEventListener("pointerleave",c,!1):(e[f].removeEventListener("mouseleave",c,!1),e[f].removeEventListener("touchleave",c,!1));break;case"up":j?e[f].removeEventListener("pointerup",c,!1):(e[f].removeEventListener("mouseup",c,!1),e[f].removeEventListener("touchend",c,!1));break;case"enter":j?e[f].removeEventListener("pointerenter",c,!1):(e[f].removeEventListener("mouseenter",c,!1),e[f].removeEventListener("touchenter",c,!1));break;case"down":j?e[f].removeEventListener("pointerdown",c,!1):(e[f].removeEventListener("mousedown",c,!1),e[f].removeEventListener("touchstart",c,!1));break;case"move":j?e[f].removeEventListener("pointermove",c,!1):(e[f].removeEventListener("mousemove",c,!1),e[f].removeEventListener("touchmove",c,!1),e[f].removeEventListener("touchfollow",c,!1))}return!0},a.addNewCell=function(b,c){return c=a.isa(c,"str")?c:a.currentPad,a.pad[c].addNewCell(b)},a.deleteCells=function(){var b,d,e,f,g;for(b=Array.prototype.slice.call(arguments),Array.isArray(b[0])&&(b=b[0]),d=0,e=b.length;e>d;d++){for(f=0,g=a.padnames.length;g>f;f++)a.pad[a.padnames[f]].deleteCell(c[d]);delete a.group[b[d]],delete a.group[b[d]+"_field"],delete a.group[b[d]+"_fence"],a.removeItem(a.groupnames,b[d]),a.removeItem(a.groupnames,b[d]+"_field"),a.removeItem(a.groupnames,b[d]+"_fence"),delete a.context[b[d]],delete a.canvas[b[d]],delete a.ctx[a.cell[b[d]].context],a.removeItem(a.ctxnames,a.cell[b[d]].context),delete a.cell[b[d]],a.removeItem(a.cellnames,b[d])}return a},a.addEntitysToGroups=function(b,c){var d,e,f,g,h;if(a.xta(b,c))for(d=[].concat(b),e=[].concat(c),g=0,h=d.length;h>g;g++)f=a.group[d[g]],f&&f.addEntitysToGroup(e);return a},a.removeEntitysFromGroups=function(b,c){var d,e,f,g,h;if(a.xta(b,c))for(d=[].concat(b),e=[].concat(c),g=0,h=d.length;h>g;g++)f=a.group[d[g]],f&&f.removeEntitysFromGroup(e);return a},a.deleteEntity=function(){var b,c,d,e,f,g,h;for(b=Array.prototype.slice.call(arguments),Array.isArray(b[0])&&(b=b[0]),c=0,d=b.length;d>c;c++)if(g=a.entity[b[c]])for(a.pathDeleteEntity(g),h=g.context,a.removeItem(a.ctxnames,h),delete a.ctx[h],a.removeItem(a.entitynames,b[c]),delete a.entity[b[c]],e=0,f=a.groupnames.length;f>e;e++)a.removeItem(a.group[a.groupnames[e]].entitys,b[c]);return a},a.pathDeleteEntity=function(){},a.newVector=function(b){return a.makeVector(b)},a.newPad=function(b){return a.makePad(b)},a.newCell=function(b){return a.makeCell(b)},a.newContext=function(b){return a.makeContext(b)},a.newGroup=function(b){return a.makeGroup(b)},a.newGradient=function(b){return a.makeGradient(b)},a.newRadialGradient=function(b){return a.makeRadialGradient(b)},a.makeVector=function(b){return new a.Vector(b)},a.makePad=function(b){return new a.Pad(b)},a.makeCell=function(b){return new a.Cell(b)},a.makeContext=function(b){return new a.Context(b)},a.makeGroup=function(b){return new a.Group(b)},a.makeGradient=function(b){return new a.Gradient(b)},a.makeRadialGradient=function(b){return new a.RadialGradient(b)},a.Vector=function(b){return b=a.safeObject(b),this.x=b.x||0,this.y=b.y||0,this.z=b.z||0,this.name=b.name||"generic",this},a.Vector.prototype=Object.create(Object.prototype),a.Vector.prototype.type="Vector",a.d.Vector={x:0,y:0,z:0,name:"generic"},a.Vector.prototype.setMagnitudeTo=function(a){return this.normalize(),this.scalarMultiply(a),this.getMagnitude()!==a&&(this.normalize(),this.scalarMultiply(a),this.getMagnitude()!==a&&(this.normalize(),this.scalarMultiply(a))),this},a.Vector.prototype.normalize=function(){var a=this.getMagnitude();return a>0&&(this.x/=a,this.y/=a,this.z/=a),this},a.Vector.prototype.zero=function(){return this.x=0,this.y=0,this.z=0,this},a.Vector.prototype.set=function(b){return b=a.safeObject(b),this.x=a.xtGet(b.x,this.x),this.y=a.xtGet(b.y,this.y),this.z=a.xtGet(b.z,this.z),this},a.Vector.prototype.isEqual=function(b){return a.isa(b,"vector")&&this.x===b.x&&this.y===b.y&&this.z===b.z?!0:!1},a.Vector.prototype.isLike=function(b){return a.isa(b,"obj")&&this.x===b.x&&this.y===b.y&&this.z===b.z?!0:!1},a.Vector.prototype.getData=function(){return{x:this.x,y:this.y,z:this.z}},a.Vector.prototype.hasCoordinates=function(b){return a.xta(b,b.x,b.y)?!0:!1},a.Vector.prototype.vectorAdd=function(b){return b=a.safeObject(b),this.x+=b.x||0,this.y+=b.y||0,this.z+=b.z||0,this},a.Vector.prototype.vectorSubtract=function(b){return b=a.safeObject(b),this.x-=b.x||0,this.y-=b.y||0,this.z-=b.z||0,this},a.Vector.prototype.vectorMultiply=function(b){return b=a.safeObject(b),this.x*=b.x||1,this.y*=b.y||1,this.z*=b.z||1,this},a.Vector.prototype.vectorDivide=function(b){return b=a.safeObject(b),this.x/=0!==(b.x||0)?b.x:1,this.y/=0!==(b.y||0)?b.y:1,this.z/=0!==(b.z||0)?b.z:1,this},a.Vector.prototype.scalarMultiply=function(b){return a.isa(b,"num")?(this.x*=b,this.y*=b,this.z*=b,this):this},a.Vector.prototype.scalarDivide=function(b){return a.isa(b,"num")&&0!==b?(this.x/=b,this.y/=b,this.z/=b,this):this},a.Vector.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},a.Vector.prototype.checkNotZero=function(){return this.x||this.y||this.z?!0:!1},a.Vector.prototype.getVector=function(){return a.makeVector({x:this.x,y:this.y,z:this.z})},a.Vector.prototype.getCrossProduct=function(b,c){var d,e,f,g,h,i;return a.isa(b,"vector")?(c=a.isa(c,"vector")?c:this,d=c.x||0,e=c.y||0,f=c.z||0,g=b.x||0,h=b.y||0,i=b.z||0,a.makeVector({x:e*i-f*h,y:-(d*i)+f*g,z:d*h+e*g})):this},a.Vector.prototype.getDotProduct=function(b,c){return a.isa(b,"vector")?(c=a.isa(c,"vector")?c:this,(b.x||0)*(c.x||0)+(b.y||0)*(c.y||0)+(b.z||0)*(c.z||0)):!1},a.Vector.prototype.getTripleScalarProduct=function(b,c,d){var e,f,g,h,i,j,k,l,m;return a.isa(b,"vector")&&a.isa(c,"vector")?(d=a.safeObject(d)?d:this,e=b.x||0,f=b.y||0,g=b.z||0,h=c.x||0,i=c.y||0,j=c.z||0,k=d.x||0,l=d.y||0,m=d.z||0,e*(i*m-j*l)+f*(-(h*m)+j*k)+g*(h*l-i*k)):!1},a.Vector.prototype.rotate=function(b){var c=[0,0];return a.isa(b,"num")?(c[0]=Math.atan2(this.y,this.x),c[0]+=.01745329251*b,c[1]=this.getMagnitude(),this.x=c[1]*Math.cos(c[0]),this.y=c[1]*Math.sin(c[0]),this):this},a.Vector.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.Vector.prototype.rotate3d=function(b,c){var d,e,f;return a.isa(b,"quaternion")?(c=scrawl.isa(c,"num")?c:this.getMagnitude(),d=a.workquat.q1.set(b),e=a.workquat.q2.set(this),f=a.workquat.q3.set(b).conjugate(),d.quaternionMultiply(e),d.quaternionMultiply(f),this.set(d.v).setMagnitudeTo(c),this):this},a.Base=function(b){return b=a.safeObject(b),this.name=a.makeName({name:b.name,type:this.type,target:this.classname}),this.work={},this},a.Base.prototype=Object.create(Object.prototype),a.Base.prototype.type="Base",a.Base.prototype.classname="objectnames",a.d.Base={comment:"",title:"",timestamp:""},a.Base.prototype.get=function(b){return a.xtGet(this[b],a.d[this.type][b])},a.Base.prototype.set=function(b){for(var c in b)a.xt(a.d[this.type][c])&&(this[c]=b[c]);return this},a.Base.prototype.clone=function(b){var c,d,e,f,g;for(c=a.mergeOver(this.parse(),a.safeObject(b)),delete c.context,d=Object.keys(this),e=this,f=0,g=d.length;g>f;f++)a.isa(this[d[f]],"fn")&&(c[d[f]]=e[d[f]]);return new a[this.type](c)},a.Base.prototype.parse=function(){return JSON.parse(JSON.stringify(this))},a.Base.prototype.resetWork=function(){var a,b,c;for(a=Object.keys(this.work),b=0,c=a.length;c>b;b++)this.work[a[b]].set(this[a[b]]);return!0},a.Position=function(b){a.Base.call(this,b),b=a.safeObject(b);var c=a.safeObject(b.start);return this.start=a.makeVector({x:a.xtGet(b.startX,c.x,0),y:a.xtGet(b.startY,c.y,0),name:this.type+"."+this.name+".start"}),this.work.start=a.makeVector({name:this.type+"."+this.name+".work.start"}),c=a.safeObject(b.handle),this.handle=a.makeVector({x:a.xtGet(b.handleX,c.x,0),y:a.xtGet(b.handleY,c.y,0),name:this.type+"."+this.name+".handle"}),this.work.handle=a.makeVector({name:this.type+"."+this.name+".work.handle"}),this.pivot=a.xtGet(b.pivot,a.d[this.type].pivot),this.scale=a.xtGet(b.scale,a.d[this.type].scale),this.roll=a.xtGet(b.roll,a.d[this.type].roll),this.flipReverse=a.xtGet(b.flipReverse,a.d[this.type].flipReverse),this.flipUpend=a.xtGet(b.flipUpend,a.d[this.type].flipUpend),this.lockX=a.xtGet(b.lockX,a.d[this.type].lockX),this.lockY=a.xtGet(b.lockY,a.d[this.type].lockY),this.offset=a.makeVector({name:this.type+"."+this.name+".offset"}),this.offset.flag=!1,this.mouseIndex=a.xtGet(b.mouseIndex,"mouse"),this.animationPositionInit(b),this.pathPositionInit(b),this},a.Position.prototype=Object.create(a.Base.prototype),a.Position.prototype.type="Position",a.Position.prototype.classname="objectnames",a.d.Position={start:{x:0,y:0},handle:{x:0,y:0},pivot:null,scale:1,flipReverse:!1,flipUpend:!1,lockX:!1,lockY:!1,roll:0,mouseIndex:"mouse",width:0,height:0},a.mergeInto(a.d.Position,a.d.Base),a.Position.prototype.animationPositionInit=function(){},a.Position.prototype.pathPositionInit=function(){},a.Position.prototype.get=function(b){var c=["startX","startY","handleX","handleY"];if(a.contains(c,b))switch(b){case"startX":return this.start.x;case"startY":return this.start.y;case"handleX":return this.handle.x;case"handleY":return this.handle.y}return this.animationPositionGet(b)||a.Base.prototype.get.call(this,b)},a.Position.prototype.animationPositionGet=function(){return!1},a.Position.prototype.set=function(b){return b=a.safeObject(b),a.Base.prototype.set.call(this,b),a.xto(b.start,b.startX,b.startY)&&this.setStart(b),a.xto(b.handle,b.handleX,b.handleY)&&this.setHandle(b),this.animationPositionSet(b),this},a.Position.prototype.setStart=function(b){var c;return b=a.safeObject(b),a.isa(this.start,"vector")||(this.start=a.makeVector(b.start||this.start)),c=a.safeObject(b.start),this.start.x=a.xtGet(b.startX,c.x,this.start.x),this.start.y=a.xtGet(b.startY,c.y,this.start.y),this},a.Position.prototype.setHandle=function(b){var c;return b=a.safeObject(b),a.isa(this.handle,"vector")||(this.handle=a.makeVector(b.handle||this.handle)),c=a.safeObject(b.handle),this.handle.x=a.xtGet(b.handleX,c.x,this.handle.x),this.handle.y=a.xtGet(b.handleY,c.y,this.handle.y),this},a.Position.prototype.animationPositionSet=function(){},a.Position.prototype.updateStart=function(){},a.Position.prototype.revertStart=function(){},a.Position.prototype.reverse=function(){},a.Position.prototype.setDeltaAttribute=function(){},a.Position.prototype.setDelta=function(b){return b=a.safeObject(b),a.xto(b.start,b.startX,b.startY)&&this.setDeltaStart(b),a.Position.prototype.pathPositionSetDelta.call(this,b),a.xto(b.handle,b.handleX,b.handleY)&&this.setDeltaHandle(b),b.scale&&this.setDeltaScale(b),this},a.Position.prototype.setDeltaStart=function(b){var c,d,e;b=a.safeObject(b),c=a.safeObject(b.start),d=a.xtGet(b.startX,c.x,0),e=a.xtGet(b.startY,c.y,0),this.start.x=a.isa(this.start.x,"num")?this.start.x+d:a.addPercentages(this.start.x,d),this.start.y=a.isa(this.start.y,"num")?this.start.y+e:a.addPercentages(this.start.y,e)},a.Position.prototype.setDeltaHandle=function(b){var c,d,e;return b=a.safeObject(b),c=a.safeObject(b.handle),d=a.xtGet(b.handleX,c.x,0),e=a.xtGet(b.handleY,c.y,0),this.handle.x=a.isa(this.handle.x,"num")?this.handle.x+d:a.addPercentages(this.handle.x,d),this.handle.y=a.isa(this.handle.y,"num")?this.handle.y+e:a.addPercentages(this.handle.y,e),this},a.Position.prototype.setDeltaScale=function(b){return b=a.safeObject(b),this.scale+=b.scale||0,this},a.Position.prototype.pathPositionSetDelta=function(){},a.Position.prototype.clone=function(b){var c,d;return b=a.safeObject(b),d=a.Base.prototype.clone.call(this,b),c=a.safeObject(b.start),d.start=a.makeVector({x:a.xtGet(b.startX,c.x,d.start.x),y:a.xtGet(b.startY,c.y,d.start.y),name:d.type+"."+d.name+".start"}),c=a.safeObject(b.handle),d.handle=a.makeVector({x:a.xtGet(b.handleX,c.x,d.handle.x),y:a.xtGet(b.handleY,c.y,d.handle.y),name:d.type+"."+d.name+".handle"}),d=this.animationPositionClone(d,b)},a.Position.prototype.animationPositionClone=function(a){return a},a.Position.prototype.getPivotOffsetVector=function(){var b,c;switch(this.type){case"Block":b=this.localHeight/this.scale||this.get("height"),c=this.localWidth/this.scale||this.get("width");break;case"Picture":case"Cell":b=this.pasteData.h/this.scale||this.get("height"),c=this.pasteData.w/this.scale||this.get("width");break;default:b=this.height||this.get("height"),c=this.width||this.get("width")}return a.Position.prototype.calculatePOV.call(this,this.work.handle,c,b,!1)},a.Position.prototype.getCenteredPivotOffsetVector=function(){var b,c;return b=this.localHeight/this.scale||this.height||this.get("height"),c=this.localWidth/this.scale||this.width||this.get("width"),a.Position.prototype.calculatePOV.call(this,this.work.handle,c,b,!0)},a.Position.prototype.calculatePOV=function(b,c,d,e){var f=["left","center","right"],g=["top","center","bottom"];if(a.isa(b.x,"str")&&!a.contains(f,b.x))b.x=e?parseFloat(b.x)/100*c-c/2:parseFloat(b.x)/100*c;else switch(b.x){case"left":b.x=e?-(c/2):0;break;case"center":b.x=e?0:c/2;break;case"right":b.x=e?c/2:c}if(a.isa(b.y,"str")&&!a.contains(g,b.y))b.y=e?parseFloat(b.y)/100*d-d/2:parseFloat(b.y)/100*d;else switch(b.y){case"top":b.y=e?-(d/2):0;break;case"center":b.y=e?0:d/2;break;case"bottom":b.y=e?d/2:d}return b.x=isNaN(b.x)?0:b.x,b.y=isNaN(b.y)?0:b.y,b},a.Position.prototype.getOffsetStartVector=function(){var b,c,d;return this.resetWork(),b=a.isa(this.handle.x,"str")?this.scale:1,c=a.isa(this.handle.y,"str")?this.scale:1,d=this.getPivotOffsetVector(),d.x*=b,d.y*=c,d.reverse()},a.Position.prototype.setStampUsingPivot=function(b){var c,d,e,f,g,h,i;return a.xt(a.pointnames)&&(c=a.point[this.pivot])?(e=a.entity[c.entity],d=c.getCurrentCoordinates().rotate(e.roll).vectorAdd(e.start),this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y,this):(c=a.entity[this.pivot])?(d="Particle"===c.type?c.get("place"):c.start,this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y,this):("mouse"===this.pivot&&(b=a.cell[b],i=a.pad[b.pad],g=this.start.x.substring?this.convertX(this.start.x,b):this.start.x,h=this.start.y.substring?this.convertY(this.start.y,b):this.start.y,g=isNaN(g)?0:g,h=isNaN(h)?0:h,f=this.correctCoordinates(i.mice[this.mouseIndex],b),null==this.oldX&&null==this.oldY&&(this.oldX=g,this.oldY=h),this.start.x=this.lockX?g:g+f.x-this.oldX,this.start.y=this.lockY?h:h+f.y-this.oldY,this.oldX=f.x,this.oldY=f.y),this.setStampUsingStacksPivot())},a.Position.prototype.correctCoordinates=function(b,c){var d,e;return b=a.safeObject(b),d=a.v.set(b),scrawl.xta(b.x,b.y)?(c=a.cell[c]?a.cell[c]:a.cell[a.pad[a.currentPad].base],e=a.pad[c.pad],e.width!==c.actualWidth&&(d.x/=e.width/c.actualWidth),e.height!==c.actualHeight&&(d.y/=e.height/c.actualHeight),d):!1},a.Position.prototype.setStampUsingStacksPivot=function(){return this},a.Position.prototype.convertX=function(a,b){var c,d;switch(typeof b){case"string":c=scrawl.cell[b].actualWidth;break;case"number":c=b;break;default:c=b.actualWidth}if(d=parseFloat(a)/100,isNaN(d))switch(a){case"right":return c;case"center":return c/2;default:return 0}return d*c},a.Position.prototype.convertY=function(a,b){var c,d;switch(typeof b){case"string":c=scrawl.cell[b].actualHeight;break;case"number":c=b;break;default:c=b.actualHeight}if(d=parseFloat(a)/100,isNaN(d))switch(a){case"bottom":return c;case"center":return c/2;default:return 0}return d*c},a.PageElement=function(b){return b=a.safeObject(b),a.Base.call(this,b),this.width=a.xtGet(b.width,a.d[this.type].width),this.height=a.xtGet(b.height,a.d[this.type].height),this.scale=a.xtGet(b.scale,a.d[this.type].scale),this.setLocalDimensions(),this.stacksPageElementConstructor(b),this.mice={},this},a.PageElement.prototype=Object.create(a.Base.prototype),a.PageElement.prototype.type="PageElement",a.PageElement.prototype.classname="objectnames",a.d.PageElement={width:300,height:150,localWidth:300,localHeight:150,displayOffsetX:0,displayOffsetY:0,scale:1,mice:{},interactive:!0,position:"static"},a.mergeInto(a.d.PageElement,a.d.Base),a.PageElement.prototype.stacksPageElementConstructor=function(){},a.PageElement.prototype.get=function(b){var c=this.getElement(),d=["width","height","position"];if(a.contains(d,b))switch(b){case"width":return a.xtGet(this.localWidth,parseFloat(c.width),a.d[this.type].width);case"height":return a.xtGet(this.localHeight,parseFloat(c.height),a.d[this.type].height);case"position":return a.xtGet(this.position,c.style.position)}return a.Base.prototype.get.call(this,b)},a.PageElement.prototype.set=function(b){return b=a.safeObject(b),a.Base.prototype.set.call(this,b),a.xto(b.width,b.height,b.scale)&&(this.setLocalDimensions(),this.setDimensions(),this.setDisplayOffsets()),a.xt(b.position)&&(this.position=b.position),a.xt(b.pivot)&&(this.pivot=b.pivot,this.pivot||(delete this.oldX,delete this.oldY)),a.xt(b.mouse)&&this.initMouse(b.mouse),a.xto(b.title,b.comment)&&this.setAccessibility(b),this},a.PageElement.prototype.setAccessibility=function(b){var c;return b=a.safeObject(b),c=this.getElement(),a.xt(b.title)&&(this.title=b.title,c.title=this.title),a.xt(b.comment)&&(this.comment=b.comment,c.setAttribute("data-comment",this.comment)),this},a.PageElement.prototype.setDisplayOffsets=function(){var a=this.getElement(),b=0,c=0;if(a.offsetParent)do b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;while(a.offsetParent);return this.displayOffsetX=b,this.displayOffsetY=c,this},a.PageElement.prototype.scaleDimensions=function(b){return a.isa(b,"num")&&(this.scale=b,this.setDimensions()),this},a.PageElement.prototype.setLocalDimensions=function(){return this.localWidth=this.width*this.scale,this.localHeight=this.height*this.scale,this},a.PageElement.prototype.setDimensions=function(){var a=this.getElement();return a.style.width=this.localWidth+"px",a.style.height=this.localHeight+"px",this},a.PageElement.prototype.getMouse=function(b){var c,d,e,f=[];if(a.xt(b)){if(a.xt(b)&&a.isa(b,"bool")&&b)return this.mice;if(a.isa(b,"event")){if(b.changedTouches){for(d=0,e=b.changedTouches.length;e>d;d++)c="t"+b.changedTouches[d].identifier,f.push(this.mice[c]);return f}return b.pointerType?(c="touch"!==b.pointerType?b.pointerType:"p"+b.pointerId,[this.mice[c]]):[this.mice.mouse]}return!1}return a.xtGet(this.mice.t0,this.mice.p1,this.mice.pen,this.mice.mouse,!1)},a.PageElement.prototype.getMouseIdFromEvent=function(b){var c,d,e,f=[];if(a.isa(b,"event"))if(b.changedTouches)for(d=0,e=b.changedTouches.length;e>d;d++)c="t"+b.changedTouches[d].identifier,f.push(c);else b.pointerType?(c="touch"!==b.pointerType?b.pointerType:"p"+b.pointerId,f.push(c)):f.push("mouse");return f},a.PageElement.prototype.handleMouseMove=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;if(a.xt(this.id)?(g=a.pad[this.id]||a.stack[this.id]||a.element[this.id]||!1,l=this):(g=this,l=this.getElement()),b.changedTouches)for(m=b.changedTouches,h=0,i=m.length;i>h;h++){if(o="t"+m[h].identifier,"touchstart"===b.type)for(j=0,k=a.activeListeners.length;k>j;j++)q=a.pad[a.activeListeners[j]]||a.stack[a.activeListeners[j]]||a.element[a.activeListeners[j]]||!1,q&&delete q.mice[o];if(a.xt(g.mice[o])||(g.mice[o]=a.makeVector({name:g.type+"."+g.name+".t."+o}),g.mice[o].active=null,g.mice[o].id=o),m[h].pageX||m[h].pageY?(c=m[h].pageX,d=m[h].pageY):(m[h].clientX||m[h].clientY)&&(c=m[h].clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=m[h].clientY+document.body.scrollTop+document.documentElement.scrollTop),e=g.displayOffsetX+g.localWidth,f=g.displayOffsetY+g.localHeight,"touchmove"===b.type)for(j=0,k=a.activeListeners.length;k>j;j++)this.name!==a.activeListeners[j]&&(p=a.canvas[a.activeListeners[j]]||a.stk[a.activeListeners[j]]||a.elm[a.activeListeners[j]]||!1,p&&a.triggerTouchFollow(b,p));n=c>=g.displayOffsetX&&e>=c&&d>=g.displayOffsetY&&f>=d?!0:!1,g.mice[o].active!==n&&(g.mice[o].active=n,("touchmove"===b.type||"touchfollow"===b.type)&&(n?a.triggerTouchEnter(b,l):a.triggerTouchLeave(b,l))),g.mice[o].x=c-g.displayOffsetX,g.mice[o].y=d-g.displayOffsetY,"Pad"===g.type&&(g.mice[o].x=Math.round(g.mice[o].x/g.scale||1),g.mice[o].y=Math.round(g.mice[o].y/g.scale||1)),("touchup"===b.type||"touchleave"===b.type)&&(g.mice[o].x=null,g.mice[o].y=null)}else b.pointerType?(o="touch"!==b.pointerType?b.pointerType:"p"+b.pointerId,a.xt(g.mice[o])||(g.mice[o]=a.makeVector({name:g.type+"."+g.name+".p."+o}),g.mice[o].active=null,g.mice[o].id=o),g.mice[o].active=!1,b.offsetX>=0&&b.offsetX<=g.localWidth&&b.offsetY>=0&&b.offsetY<=g.localHeight&&(g.mice[o].active=!0),g.mice[o].x=Math.round(b.offsetX),g.mice[o].y=Math.round(b.offsetY),"Pad"===g.type&&(g.mice[o].x=Math.round(g.mice[o].x/(g.scale||1)),g.mice[o].y=Math.round(g.mice[o].y/(g.scale||1)))):(a.xt(g.mice.mouse)||(g.mice.mouse=a.makeVector({name:g.type+"."+g.name+".ui.mouse"}),g.mice.mouse.active=null,g.mice.mouse.id="mouse"),b.pageX||b.pageY?(c=b.pageX,d=b.pageY):(b.clientX||b.clientY)&&(c=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,d=b.clientY+document.body.scrollTop+document.documentElement.scrollTop),e=g.displayOffsetX+g.localWidth,f=g.displayOffsetY+g.localHeight,g.mice.mouse.active=!1,c>=g.displayOffsetX&&e>=c&&d>=g.displayOffsetY&&f>=d&&(g.mice.mouse.active=!0),g.mice.mouse.x=c-g.displayOffsetX,g.mice.mouse.y=d-g.displayOffsetY,"Pad"===g.type&&(g.mice.mouse.x=Math.round(g.mice.mouse.x/(g.scale||1)),g.mice.mouse.y=Math.round(g.mice.mouse.y/(g.scale||1))));
return g.handleMouseTilt(b),g},a.PageElement.prototype.handleMouseTilt=function(){},a.PageElement.prototype.addMouseMove=function(){var b=this.getElement();return a.addListener(["up","down","move","enter","leave"],this.handleMouseMove,b),a.pushUnique(a.activeListeners,this.name),this},a.PageElement.prototype.removeMouseMove=function(){var b=this.getElement();return a.removeListener(["up","down","move","enter","leave"],this.handleMouseMove,b),a.removeItem(a.activeListeners,this.name),this},a.Pad=function(b){var c,d,e;return b=a.safeObject(b),a.isa(b.canvasElement,"canvas")?(b.width=a.xtGet(b.width,b.canvasElement.width,a.d.Pad.width),b.height=a.xtGet(b.height,b.canvasElement.height,a.d.Pad.height),b.name=a.xtGet(b.name,b.canvasElement.id,b.canvasElement.name,"Pad"),a.PageElement.call(this,b),this.name.match(/___/)&&(this.name=this.name.replace(/___/g,"_")),b.canvasElement.id=this.name,a.pad[this.name]=this,a.pushUnique(a.padnames,this.name),this.cells=[],c=a.makeCell({name:this.name,pad:this.name,canvas:b.canvasElement,compiled:!1,shown:!1,width:this.localWidth,height:this.localHeight}),a.pushUnique(this.cells,c.name),this.display=c.name,e=b.canvasElement.cloneNode(!0),e.setAttribute("id",this.name+"_base"),d=a.makeCell({name:this.name+"_base",pad:this.name,canvas:e,compileOrder:9999,shown:!1,width:"100%",height:"100%"}),a.pushUnique(this.cells,d.name),this.base=d.name,this.current=d.name,this.setDisplayOffsets(),this.setAccessibility(b),this.filtersPadInit(),this.padStacksConstructor(b),this.interactive=a.xtGet(b.interactive,!0),this.interactive&&this.addMouseMove(),this):!1},a.Pad.prototype=Object.create(a.PageElement.prototype),a.Pad.prototype.type="Pad",a.Pad.prototype.classname="padnames",a.d.Pad={cells:[],display:"",base:"",current:""},a.mergeInto(a.d.Pad,a.d.PageElement),a.Pad.prototype.getElement=function(){return a.canvas[this.display]},a.Pad.prototype.filtersPadInit=function(){},a.Pad.prototype.stacksPadInit=function(){},a.Pad.prototype.set=function(b){var c,d;return a.PageElement.prototype.set.call(this,b),b=a.safeObject(b),d=a.cell[this.display],c=a.cell[this.base],a.xto(b.scale,b.width,b.height)&&(d.set({pasteWidth:b.width?this.localWidth:d.pasteWidth,pasteHeight:b.height?this.localHeight:d.pasteHeight,scale:b.scale||d.scale}),c.set({scale:b.scale||c.scale})),this.padStacksSet(b),a.xto(b.start,b.startX,b.startY,b.handle,b.handleX,b.handleY,b.scale,b.width,b.height)&&this.setDisplayOffsets(),a.xto(b.backgroundColor,b.globalAlpha,b.globalCompositeOperation)&&c.set({backgroundColor:b.backgroundColor||c.backgroundColor,globalAlpha:b.globalAlpha||c.globalAlpha,globalCompositeOperation:b.globalCompositeOperation||c.globalCompositeOperation}),this},a.Pad.prototype.padStacksConstructor=function(){},a.Pad.prototype.padStacksSet=function(){},a.Pad.prototype.sortCellsCompile=function(){this.cells.sort(function(b,c){return a.cell[b].compileOrder-a.cell[c].compileOrder})},a.Pad.prototype.sortCellsShow=function(){this.cells.sort(function(b,c){return a.cell[b].showOrder-a.cell[c].showOrder})},a.Pad.prototype.clear=function(){var b,c,d;for(c=0,d=this.cells.length;d>c;c++)b=a.cell[this.cells[c]],b.rendered&&b.cleared&&b.clear();return this},a.Pad.prototype.compile=function(){var b,c,d;for(this.sortCellsCompile(),c=0,d=this.cells.length;d>c;c++)b=a.cell[this.cells[c]],b.rendered&&b.compiled&&b.compile();return this},a.Pad.prototype.show=function(){var b,c,d,e,f;for(b=a.cell[this.display],c=a.cell[this.base],this.sortCellsShow(),e=0,f=this.cells.length;f>e;e++)d=a.cell[this.cells[e]],d.rendered&&d.shown&&c.copyCellToSelf(d);return b.copyCellToSelf(c,!0),this},a.Pad.prototype.render=function(){return this.clear(),this.compile(),this.show(),this},a.Pad.prototype.addNewCell=function(b){var c,d;return b=a.safeObject(b),a.isa(b.name,"str")?(b.width=Math.round(b.width)||this.width,b.height=Math.round(b.height)||this.height,c=document.createElement("canvas"),c.setAttribute("id",b.name),c.setAttribute("height",b.height),c.setAttribute("width",b.width),b.pad=this.name,b.canvas=c,d=a.makeCell(b),a.pushUnique(this.cells,d.name),d):!1},a.Pad.prototype.addCells=function(){var b,c,d;for(b=Array.prototype.slice.call(arguments),Array.isArray(b[0])&&(b=b[0]),c=0,d=b.length;d>c;c++)a.cell[b[c]]&&this.cells.push(b[c]);return this},a.Pad.prototype.deleteCell=function(b){return a.isa(b,"str")?(a.removeItem(this.cells,b),this.display===b&&(this.display=this.current),this.base===b&&(this.base=this.current),this.current===b&&(this.current=this.base),this):this},a.Pad.prototype.makeCurrent=function(){return a.currentPad=this.name,this},a.Pad.prototype.setAccessibility=function(b){var c;return b=a.safeObject(b),c=this.getElement(),a.xt(b.title)&&(this.title=b.title,c.title=this.title),a.xt(b.comment)&&(this.comment=b.comment,c.setAttribute("data-comment",this.comment),c.innerHTML="<p>"+this.comment+"</p>"),this},a.Pad.prototype.setDimensions=function(){var a=this.getElement();return a.width=this.localWidth,a.height=this.localHeight,this},a.Cell=function(b){return b=a.safeObject(b),a.xta(b,b.canvas)?(this.coreCellInit(b),this.animationCellInit(b),this.collisionsCellInit(b),this.filtersCellInit(b),this):!1},a.Cell.prototype=Object.create(a.Position.prototype),a.Cell.prototype.type="Cell",a.Cell.prototype.classname="cellnames",a.d.Cell={pad:"",copy:{x:0,Y:0},copyWidth:300,copyHeight:150,copyData:!1,pasteData:!1,pasteWidth:300,pasteHeight:150,actualWidth:300,actualHeight:150,fieldLabel:"",globalAlpha:1,globalCompositeOperation:"source-over",backgroundColor:"rgba(0,0,0,0)",context:"",groups:[],rendered:!0,cleared:!0,compiled:!0,shown:!0,compileOrder:0,showOrder:0},a.mergeInto(a.d.Cell,a.d.Position),a.Cell.prototype.coreCellInit=function(b){var c,d;a.Position.call(this,b),a.Base.prototype.set.call(this,b),a.canvas[this.name]=b.canvas,a.context[this.name]=b.canvas.getContext("2d"),a.cell[this.name]=this,a.pushUnique(a.cellnames,this.name),this.pad=a.xtGet(b.pad,!1),c=a.safeObject(b.copy),this.copy=a.makeVector({x:a.xtGet(b.copyX,c.x,0),y:a.xtGet(b.copyY,c.y,0),name:this.type+"."+this.name+".copy"}),this.work.copy=a.makeVector({name:this.type+"."+this.name+".work.copy"}),this.actualWidth=a.canvas[this.name].width,this.actualHeight=a.canvas[this.name].height,this.copyWidth=this.actualWidth,this.copyHeight=this.actualHeight,this.copyData={x:0,y:0,w:0,h:0},this.pasteData={x:0,y:0,w:0,h:0},this.pasteWidth=this.actualWidth,this.pasteHeight=this.actualHeight,this.setDimensions(b),a.xto(b.pasteX,b.pasteY)&&(this.start.x=a.xtGet(b.pasteX,this.start.x),this.start.y=a.xtGet(b.pasteY,this.start.y)),a.xto(b.copyWidth,b.copyHeight,b.pasteWidth,b.pasteHeight,b.width,b.height)&&(this.copyWidth=a.xtGet(b.copyWidth,b.width,this.copyWidth),this.copyHeight=a.xtGet(b.copyHeight,b.height,this.copyHeight),this.pasteWidth=a.xtGet(b.pasteWidth,b.width,this.pasteWidth),this.pasteHeight=a.xtGet(b.pasteHeight,b.height,this.pasteHeight)),this.setCopy(),this.setPaste(),d=a.makeContext({name:this.name,cell:a.context[this.name]}),this.context=d.name,this.flipUpend=a.xtGet(b.flipUpend,a.d.Cell.flipUpend),this.flipReverse=a.xtGet(b.flipReverse,a.d.Cell.flipReverse),this.lockX=a.xtGet(b.lockX,a.d.Cell.lockX),this.lockY=a.xtGet(b.lockY,a.d.Cell.lockY),this.roll=a.xtGet(b.roll,a.d.Cell.roll),this.rendered=a.xtGet(b.rendered,!0),this.cleared=a.xtGet(b.cleared,!0),this.compiled=a.xtGet(b.compiled,!0),this.shown=a.xtGet(b.shown,!0),this.compileOrder=a.xtGet(b.compileOrder,0),this.showOrder=a.xtGet(b.showOrder,0),this.backgroundColor=a.xtGet(b.backgroundColor,"rgba(0,0,0,0)"),this.globalCompositeOperation=a.xtGet(b.globalCompositeOperation,"source-over"),this.globalAlpha=a.xtGet(b.globalAlpha,1),this.groups=a.xt(b.groups)?[].concat(b.groups):[],a.makeGroup({name:this.name,cell:this.name})},a.Cell.prototype.collisionsCellInit=function(){},a.Cell.prototype.filtersCellInit=function(){},a.Cell.prototype.animationCellInit=function(){},a.Cell.prototype.get=function(b){var c=["pasteX","pasteY","copyX","copyY"],d=["paste","copy"],e=["width","height"];if(a.contains(c,b))switch(b){case"pasteX":return this.start.x;case"pasteY":return this.start.y;case"copyX":return this.copy.x;case"copyY":return this.copy.y}if(a.contains(d,b))switch(b){case"paste":return this.start.getVector();case"copy":return this.copy.getVector()}if(a.contains(e,b))switch(b){case"width":return this.actualWidth;case"height":return this.actualHeight}return this.animationCellGet(b)||a.Position.prototype.get.call(this,b)},a.Cell.prototype.animationCellGet=function(){return!1},a.Cell.prototype.set=function(b){return a.Position.prototype.set.call(this,b),b=a.safeObject(b),a.xto(b.paste,b.pasteX,b.pasteY)&&this.setPasteVector(b,!1),a.xto(b.copy,b.copyX,b.copyY)&&this.setCopyVector(b,!1),a.xto(b.copyWidth,b.width)&&this.setCopyWidth(b,!1),a.xto(b.copyHeight,b.height)&&this.setCopyHeight(b,!1),a.xto(b.pasteWidth,b.width)&&this.setPasteWidth(b,!1),a.xto(b.pasteHeight,b.height)&&this.setPasteHeight(b,!1),a.xto(b.actualWidth,b.width)&&this.setActualWidth(b,!1),a.xto(b.actualHeight,b.height)&&this.setActualHeight(b,!1),a.xto(b.actualWidth,b.actualHeight,b.width,b.height)&&(this.setDimensions(b),a.ctx[this.context].getContextFromEngine(a.context[this.name])),this.animationCellSet(b),a.xto(b.copy,b.copyX,b.copyY,b.copyWidth,b.copyHeight,b.width,b.height,b.scale)&&this.setCopy(),a.xto(b.start,b.startX,b.startY,b.paste,b.pasteX,b.pasteY,b.pasteWidth,b.pasteHeight,b.width,b.height,b.scale)&&this.setPaste(),a.xto(b.handleX,b.handleY,b.handle,b.width,b.height,b.actualWidth,b.actualHeight,b.scale)&&(this.offset.flag=!1),this},a.Cell.prototype.setActualHeight=function(b,c){return b=a.safeObject(b),c=a.xtGet(c,!0),this.actualHeight=a.xtGet(b.actualHeight,b.height,this.actualHeight),c&&(this.setDimensions(b),a.ctx[this.context].getContextFromEngine(a.context[this.name]),this.offset.flag=!1),this},a.Cell.prototype.setActualWidth=function(b,c){return b=a.safeObject(b),c=a.xtGet(c,!0),this.actualWidth=a.xtGet(b.actualWidth,b.width,this.actualWidth),c&&(this.setDimensions(b),a.ctx[this.context].getContextFromEngine(a.context[this.name]),this.offset.flag=!1),this},a.Cell.prototype.setPasteHeight=function(b,c){return b=a.safeObject(b),c=a.xtGet(c,!0),this.pasteHeight=a.xtGet(b.pasteHeight,b.height,this.pasteHeight),c&&this.setPaste(),this},a.Cell.prototype.setPasteWidth=function(b,c){return b=a.safeObject(b),c=a.xtGet(c,!0),this.pasteWidth=a.xtGet(b.pasteWidth,b.width,this.pasteWidth),c&&this.setPaste(),this},a.Cell.prototype.setCopyHeight=function(b,c){return b=a.safeObject(b),c=a.xtGet(c,!0),this.copyHeight=a.xtGet(b.copyHeight,b.height,this.copyHeight),c&&this.setCopy(),this},a.Cell.prototype.setCopyWidth=function(b,c){return b=a.safeObject(b),c=a.xtGet(c,!0),this.copyWidth=a.xtGet(b.copyWidth,b.width,this.copyWidth),c&&this.setCopy(),this},a.Cell.prototype.setPasteVector=function(b,c){var d;return b=a.safeObject(b),c=a.xtGet(c,!0),d=a.safeObject(b.paste),this.start.x=a.xtGet(b.pasteX,d.x,this.start.x),this.start.y=a.xtGet(b.pasteY,d.y,this.start.y),c&&this.setPaste(),this},a.Cell.prototype.setCopyVector=function(b,c){var d;return b=a.safeObject(b),c=a.xtGet(c,!0),d=a.safeObject(b.copy),this.copy.x=a.xtGet(b.copyX,d.x,this.copy.x),this.copy.y=a.xtGet(b.copyY,d.y,this.copy.y),c&&this.setCopy(),this},a.Cell.prototype.animationCellSet=function(){},a.Cell.prototype.setDelta=function(b){return a.Position.prototype.setDelta.call(this,b),b=a.safeObject(b),a.xto(b.copy,b.copyX,b.copyY)&&this.setDeltaCopy(b,!1),a.xto(b.paste,b.pasteX,b.pasteY)&&this.setDeltaPaste(b,!1),a.xt(b.copyWidth)&&this.setDeltaCopyWidth(b,!1),a.xt(b.copyHeight)&&this.setDeltaCopyHeight(b,!1),a.xto(b.pasteWidth,b.width)&&this.setDeltaPasteWidth(b,!1),a.xto(b.pasteHeight,b.height)&&this.setDeltaPasteHeight(b,!1),a.xto(b.actualWidth,b.width)&&this.setDeltaActualWidth(b,!1),a.xto(b.actualHeight,b.height)&&this.setDeltaActualHeight(b,!1),a.xt(b.roll)&&this.setDeltaRoll(b),a.xt(b.globalAlpha)&&this.setDeltaGlobalAlpha(b),a.xto(b.actualWidth,b.width,b.actualHeight,b.height)&&(this.setDimensions(b),a.ctx[this.context].getContextFromEngine(a.context[this.name])),a.xto(b.copy,b.copyX,b.copyY,b.copyWidth,b.copyHeight,b.width,b.height,b.scale)&&this.setCopy(),a.xto(b.start,b.startX,b.startY,b.paste,b.pasteX,b.pasteY,b.pasteWidth,b.pasteHeight,b.width,b.height,b.scale)&&this.setPaste(),a.xto(b.handleX,b.handleY,b.handle,b.width,b.height,b.actualWidth,b.actualHeight,b.scale)&&(this.offset.flag=!1),this},a.Cell.prototype.setDeltaGlobalAlpha=function(b){return b=a.safeObject(b),this.globalAlpha+=b.globalAlpha||0,this},a.Cell.prototype.setDeltaRoll=function(b){return b=a.safeObject(b),this.roll+=b.roll||0,this},a.Cell.prototype.setDeltaActualHeight=function(b,c){var d;return b=a.safeObject(b),c=a.xtGet(c,!0),d=a.xtGet(b.actualHeight,b.height),this.actualHeight=a.isa(d,"num")?this.actualHeight+d:this.actualHeight,c&&(this.setDimensions(b),a.ctx[this.context].getContextFromEngine(a.context[this.name])),this},a.Cell.prototype.setDeltaActualWidth=function(b,c){var d;return b=a.safeObject(b),c=a.xtGet(c,!0),d=a.xtGet(b.actualWidth,b.width),this.actualWidth=a.isa(d,"num")?this.actualWidth+d:this.actualWidth,c&&(this.setDimensions(b),a.ctx[this.context].getContextFromEngine(a.context[this.name])),this},a.Cell.prototype.setDeltaPasteHeight=function(b,c){var d;return b=a.safeObject(b),c=a.xtGet(c,!0),d=a.xtGet(b.pasteHeight,b.height),this.pasteHeight=a.isa(this.pasteHeight,"num")?this.pasteHeight+d:a.addPercentages(this.pasteHeight,d),c&&this.setPaste(),this},a.Cell.prototype.setDeltaCopyHeight=function(b,c){return b=a.safeObject(b),c=a.xtGet(c,!0),this.copyHeight=a.isa(this.copyHeight,"num")?this.copyHeight+b.copyHeight:a.addPercentages(this.copyHeight,b.copyHeight),c&&this.setCopy(),this},a.Cell.prototype.setDeltaPasteWidth=function(b,c){var d;return b=a.safeObject(b),c=a.xtGet(c,!0),d=a.xtGet(b.pasteWidth,b.width),this.pasteWidth=a.isa(this.pasteWidth,"num")?this.pasteWidth+d:a.addPercentages(this.pasteWidth,d),c&&this.setPaste(),this},a.Cell.prototype.setDeltaCopyWidth=function(b,c){return b=a.safeObject(b),c=a.xtGet(c,!0),this.copyWidth=a.isa(this.copyWidth,"num")?this.copyWidth+b.copyWidth:a.addPercentages(this.copyWidth,b.copyWidth),c&&this.setCopy(),this},a.Cell.prototype.setDeltaPaste=function(b,c){var d,e,f;return b=a.safeObject(b),c=a.xtGet(c,!0),d=a.safeObject(b.paste),e=a.xtGet(b.pasteX,d.x,0),f=a.xtGet(b.pasteY,d.y,0),this.start.x=a.isa(this.start.x,"num")?this.start.x+e:a.addPercentages(this.start.x,e),this.start.y=a.isa(this.start.y,"num")?this.start.y+f:a.addPercentages(this.start.y,f),c&&this.setPaste(),this},a.Cell.prototype.setDeltaCopy=function(b,c){var d,e,f;return b=a.safeObject(b),d=a.safeObject(b.copy),c=a.xtGet(c,!0),e=a.xtGet(b.copyX,d.x,0),f=a.xtGet(b.copyY,d.y,0),this.copy.x=a.isa(e,"num")?this.copy.x+e:a.addPercentages(this.copy.x,e),this.copy.y=a.isa(f,"num")?this.copy.y+f:a.addPercentages(this.copy.y,f),c&&this.setCopy(),this},a.Cell.prototype.setEngine=function(b){var c,d,e,f,g,h,i,j=["Gradient","RadialGradient","Pattern"];if(!b.fastStamp&&(c=a.ctx[this.context],d=a.ctx[b.context],i=d.getChanges(c,b.scale,b.scaleOutline))){e=a.context[this.name];for(var k in i){if(h=!1,k[0]<"m")if(k[0]<"l")switch(k){case"fillStyle":a.xt(a.design[i[k]])?(h=a.design[i[k]],a.contains(j,h.type)&&h.update(b.name,this.name),f=h.getData()):f=i[k],e.fillStyle=f;break;case"font":e.font=i[k];break;case"globalAlpha":e.globalAlpha=i[k];break;case"globalCompositeOperation":e.globalCompositeOperation=i[k]}else switch(k){case"lineCap":e.lineCap=i[k];break;case"lineDash":e.mozDash=i[k],e.lineDash=i[k];try{e.setLineDash(i[k])}catch(l){}break;case"lineDashOffset":e.mozDashOffset=i[k],e.lineDashOffset=i[k];break;case"lineJoin":e.lineJoin=i[k];break;case"lineWidth":e.lineWidth=i[k]}else if("s"==k[0])switch(k){case"shadowBlur":e.shadowBlur=i[k];break;case"shadowColor":e.shadowColor=i[k];break;case"shadowOffsetX":e.shadowOffsetX=i[k];break;case"shadowOffsetY":e.shadowOffsetY=i[k];break;case"strokeStyle":a.xt(a.design[i[k]])?(h=a.design[i[k]],a.contains(j,h.type)&&h.update(b.name,this.name),g=h.getData()):g=i[k],e.strokeStyle=g}else switch(k){case"miterLimit":e.miterLimit=i[k];break;case"textAlign":e.textAlign=i[k];break;case"textBaseline":e.textBaseline=i[k];break;case"winding":e.mozFillRule=i[k],e.msFillRule=i[k]}c[k]=i[k]}}return b},a.Cell.prototype.clear=function(){var b,c;return c=a.context[this.name],b=a.ctx[this.context],c.setTransform(1,0,0,1,0,0),c.clearRect(0,0,this.actualWidth,this.actualHeight),"rgba(0,0,0,0)"!==this.backgroundColor&&(c.fillStyle=this.backgroundColor,c.fillRect(0,0,this.actualWidth,this.actualHeight),b.fillStyle=this.backgroundColor),this},a.Cell.prototype.compile=function(){var b,c,d;for(this.groups.sort(function(b,c){return a.group[b].order-a.group[c].order}),c=0,d=this.groups.length;d>c;c++)b=a.group[this.groups[c]],b.get("visibility")&&b.stamp(!1,this.name);return this},a.Cell.prototype.rotateDestination=function(a){var b,c,d=this.flipReverse?-1:1,e=this.flipUpend?-1:1,f=this.addPathRoll?this.roll+this.pathRoll:this.roll;return f*=.01745329251,b=Math.cos(f),c=Math.sin(f),a.setTransform(b*d,c*d,-c*e,b*e,this.pasteData.x,this.pasteData.y),this},a.Cell.prototype.prepareToCopyCell=function(b){return this.resetWork(),this.offset.flag||(this.offset.set(this.calculatePOV(this.work.handle,this.pasteData.w,this.pasteData.h,!1)).reverse(),this.offset.flag=!0,this.offset.x=Math.floor(this.offset.x),this.offset.y=Math.floor(this.offset.y)),this.pivot?this.setStampUsingPivot(a.pad[this.pad].base):this.pathPrepareToCopyCell(),this.setCopy(),this.setPaste(),this.rotateDestination(b),this},a.Cell.prototype.pathPrepareToCopyCell=function(){},a.Cell.prototype.setCopy=function(){return this.copyData.x=a.isa(this.copy.x,"str")?this.convertX(this.copy.x,this.actualWidth):this.copy.x,this.copyData.y=a.isa(this.copy.y,"str")?this.convertY(this.copy.y,this.actualHeight):this.copy.y,a.isBetween(this.copyData.x,0,this.actualWidth-1,!0)||(this.copyData.x=this.copyData.x<0?0:this.actualWidth-1),a.isBetween(this.copyData.y,0,this.actualHeight-1,!0)||(this.copyData.y=this.copyData.y<0?0:this.actualHeight-1),this.copyData.w=a.isa(this.copyWidth,"str")?this.convertX(this.copyWidth,this.actualWidth):this.copyWidth,this.copyData.h=a.isa(this.copyHeight,"str")?this.convertY(this.copyHeight,this.actualHeight):this.copyHeight,a.isBetween(this.copyData.w,1,this.actualWidth,!0)||(this.copyData.w=this.copyData.w<1?1:this.actualWidth),a.isBetween(this.copyData.h,1,this.actualHeight,!0)||(this.copyData.h=this.copyData.h<1?1:this.actualHeight),this.copyData.x+this.copyData.w>this.actualWidth&&(this.copyData.x=this.actualWidth-this.copyData.w),this.copyData.y+this.copyData.h>this.actualHeight&&(this.copyData.y=this.actualHeight-this.copyData.h),this.copyData.x=Math.floor(this.copyData.x),this.copyData.y=Math.floor(this.copyData.y),this.copyData.w=Math.floor(this.copyData.w),this.copyData.h=Math.floor(this.copyData.h),this},a.Cell.prototype.setPaste=function(){var b,c,d=a.pad[this.pad],e=a.cell[d.display],f=a.cell[d.base];return a.xta(e,f)&&(b=this.name===d.base?e.actualWidth:f.actualWidth,c=this.name===d.base?e.actualHeight:f.actualHeight,this.pasteData.x=this.start.x,a.isa(this.pasteData.x,"str")&&(this.pasteData.x=this.convertX(this.pasteData.x,b)),this.pasteData.y=this.start.y,a.isa(this.pasteData.y,"str")&&(this.pasteData.y=this.convertY(this.pasteData.y,c)),this.pasteData.w=this.pasteWidth,a.isa(this.pasteData.w,"str")&&(this.pasteData.w=this.convertX(this.pasteData.w,b)),this.pasteData.w*=this.scale,this.pasteData.h=this.pasteHeight,a.isa(this.pasteData.h,"str")&&(this.pasteData.h=this.convertY(this.pasteData.h,c)),this.pasteData.h*=this.scale,this.pasteData.w<1&&(this.pasteData.w=1),this.pasteData.h<1&&(this.pasteData.h=1),this.pasteData.x=Math.floor(this.pasteData.x),this.pasteData.y=Math.floor(this.pasteData.y),this.pasteData.w=Math.floor(this.pasteData.w),this.pasteData.h=Math.floor(this.pasteData.h)),this},a.Cell.prototype.copyCellToSelf=function(b){var c,d,e,f;return b=a.isa(b,"str")?a.cell[b]:b,a.xt(b)&&(d=a.context[this.name],c=a.ctx[this.name],e=a.context[b.name],f=a.canvas[b.name],b.globalAlpha!==c.globalAlpha&&(d.globalAlpha=b.globalAlpha,c.globalAlpha=b.globalAlpha),b.globalCompositeOperation!==c.globalCompositeOperation&&(d.globalCompositeOperation=b.globalCompositeOperation,c.globalCompositeOperation=b.globalCompositeOperation),e.setTransform(1,0,0,1,0,0),b.prepareToCopyCell(d),d.drawImage(f,b.copyData.x,b.copyData.y,b.copyData.w,b.copyData.h,b.offset.x,b.offset.y,b.pasteData.w,b.pasteData.h)),this},a.Cell.prototype.convertX=function(a,b){switch(a){case"left":return 0;case"right":return b;case"center":return b/2;default:return a=parseFloat(a)/100,isNaN(a)?0:a*b}},a.Cell.prototype.convertY=function(a,b){switch(a){case"top":return 0;case"bottom":return b;case"center":return b/2;default:return a=parseFloat(a)/100,isNaN(a)?0:a*b}},a.Cell.prototype.clearShadow=function(){var b,c;return c=a.context[this.name],b=a.ctx[this.context],c.shadowOffsetX=0,c.shadowOffsetY=0,c.shadowBlur=0,b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=0,this},a.Cell.prototype.restoreShadow=function(b){var c,d,e;return e=a.context[this.name],c=a.ctx[this.context],d=a.ctx[b],e.shadowOffsetX=d.shadowOffsetX,e.shadowOffsetY=d.shadowOffsetY,e.shadowBlur=d.shadowBlur,c.shadowOffsetX=d.shadowOffsetX,c.shadowOffsetY=d.shadowOffsetY,c.shadowBlur=d.shadowBlur,this},a.Cell.prototype.setToClearShape=function(){var b,c;return c=a.context[this.name],b=a.ctx[this.context],c.fillStyle="rgba(0, 0, 0, 0)",c.strokeStyle="rgba(0, 0, 0, 0)",c.shadowColor="rgba(0, 0, 0, 0)",b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",b.shadowColor="rgba(0, 0, 0, 0)",this},a.Cell.prototype.setDimensions=function(b){var c=a.pad[this.pad],d=a.canvas[this.name],e=a.xtGet(b.width,b.actualWidth,this.actualWidth),f=a.xtGet(b.height,b.actualHeight,this.actualHeight);return c&&(a.isa(e,"str")&&(e=parseFloat(e)/100*(c.localWidth/c.scale)),a.isa(f,"str")&&(f=parseFloat(f)/100*(c.localHeight/c.scale))),d.width=e,d.height=f,this.actualWidth=e,this.actualHeight=f,this},a.Cell.prototype.saveContext=function(){return a.context[this.name].save(),this},a.Cell.prototype.restoreContext=function(){return a.context[this.name].restore(),this},a.Cell.prototype.getImageData=function(b){var c,d,e,f,g;return b=a.safeObject(b),g=a.isa(b.name,"str")?this.name+"_"+b.name:this.name+"_imageData",c=a.xtGet(b.x,0),d=a.xtGet(b.y,0),e=a.xtGet(b.width,this.actualWidth),f=a.xtGet(b.height,this.actualHeight),a.imageData[g]=a.context[this.name].getImageData(c,d,e,f),g},a.Context=function(b){return b=a.safeObject(b),a.Base.call(this,b),b.cell?this.getContextFromEngine(b.cell):this.set(b),a.ctx[this.name]=this,a.pushUnique(a.ctxnames,this.name),this},a.Context.prototype=Object.create(a.Base.prototype),a.Context.prototype.type="Context",a.Context.prototype.classname="ctxnames",a.d.Context={fillStyle:"#000000",winding:"nonzero",strokeStyle:"#000000",globalAlpha:1,globalCompositeOperation:"source-over",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",font:"10pt sans-serif",textAlign:"start",textBaseline:"alphabetic"},a.contextKeys=Object.keys(a.d.Context),a.mergeInto(a.d.Context,a.d.Base),a.Context.prototype.setDelta=function(b){return b=a.safeObject(b),a.xt(b.lineDashOffset)&&(a.xt(this.lineDashOffset)||(this.lineDashOffset=a.d.Context.lineDashOffset),this.lineDashOffset+=b.lineDashOffset),a.xt(b.lineWidth)&&(a.xt(this.lineWidth)||(this.lineWidth=a.d.Context.lineWidth),this.lineWidth+=b.lineWidth,this.lineWidth<0&&(this.lineWidth=0)),a.xt(b.globalAlpha)&&(a.xt(this.globalAlpha)||(this.globalAlpha=a.d.Context.globalAlpha),this.globalAlpha+=b.globalAlpha,a.isBetween(this.globalAlpha,0,1,!0)||(this.globalAlpha=this.globalAlpha>.5?1:0)),this},a.Context.prototype.getContextFromEngine=function(b){for(var c=0,d=a.contextKeys.length;d>c;c++)this[a.contextKeys[c]]=b[a.contextKeys[c]];return this.winding=a.xtGet(b.mozFillRule,b.msFillRule,"nonzero"),this.lineDash=a.xt(b.lineDash)?b.lineDash:[],this.lineDashOffset=a.xtGet(b.mozDashOffset,b.lineDashOffset,0),this},a.Context.prototype.getChanges=function(b,c,d){var e,f,g,h,i,j,k,l=["lineWidth","shadowOffsetX","shadowOffsetY","shadowBlur"],m=["fillStyle","strokeStyle","shadowColor"],n=["fillStyle","strokeStyle"],o=["lineDash"],p=["name","timestamp"],q=["Gradient","RadialGradient","Pattern"],r={};for(i=0,e=0,f=a.contextKeys.length;f>e;e++)if(j=this.get(a.contextKeys[e]),a.contains(l,a.contextKeys[e]))d?j*c!==b[a.contextKeys[e]]&&(r[a.contextKeys[e]]=j*c,i++):j!==b[a.contextKeys[e]]&&(r[a.contextKeys[e]]=j,i++);else if(a.contains(m,a.contextKeys[e])&&a.design[j]&&"Color"===a.design[j].type)k=a.design[j].getData(),k!==b[a.contextKeys[e]]&&(r[a.contextKeys[e]]=k,i++);else if(a.contains(n,a.contextKeys[e])&&a.design[j]&&a.contains(q,a.design[j].type)&&a.design[j].autoUpdate)r[a.contextKeys[e]]=j,i++;else if(a.contains(o,a.contextKeys[e])&&a.xt(b.lineDash)){if(j.length!==b.lineDash.length)r.lineDash=j,i++;else for(g=0,h=j.length;h>g;g++)if(j[g]!==b.lineDash[g]){r.lineDash=j,i++;break}}else a.contains(p,a.contextKeys[e])||j!==b[a.contextKeys[e]]&&(r[a.contextKeys[e]]=j,i++);return i>0?r:!1},a.Group=function(b){return b=a.safeObject(b),a.Base.call(this,b),this.entitys=a.xt(b.entitys)?[].concat(b.entitys):[],this.cell=b.cell||a.pad[a.currentPad].current,this.order=a.xtGet(b.order,0),this.visibility=a.xtGet(b.visibility,!0),this.entitySort=a.xtGet(b.entitySort,!0),this.regionRadius=a.xtGet(b.regionRadius,0),a.group[this.name]=this,this.filtersGroupInit(b),a.pushUnique(a.groupnames,this.name),a.pushUnique(a.cell[this.cell].groups,this.name),this},a.Group.prototype=Object.create(a.Base.prototype),a.Group.prototype.type="Group",a.Group.prototype.classname="groupnames",a.d.Group={entitys:[],cell:"",order:0,visibility:!0,entitySort:!0,regionRadius:0},a.mergeInto(a.d.Group,a.d.Base),a.Group.prototype.sortEntitys=function(){this.entitySort&&this.entitys.sort(function(b,c){return a.entity[b].order-a.entity[c].order})},a.Group.prototype.forceStamp=function(a,b){var c=this.visibility;return this.visibility=!0,this.stamp(a,b),this.visibility=c,this},a.Group.prototype.stamp=function(b,c){var d,e,f;if(this.visibility){for(this.sortEntitys(),e=0,f=this.entitys.length;f>e;e++)d=a.entity[this.entitys[e]],d&&(d.group=this.name,d.stamp(b,c));this.stampFilter(a.context[this.cell],this.cell)}return this},a.Group.prototype.filtersGroupInit=function(){},a.Group.prototype.stampFilter=function(){},a.Group.prototype.addEntitysToGroup=function(){var b,c,d,e;for(b=Array.prototype.slice.call(arguments),Array.isArray(b[0])&&(b=b[0]),c=0,d=b.length;d>c;c++)e=b[c],a.xt(e)&&(a.isa(e,"str")?a.pushUnique(this.entitys,e):a.xt(e.name)&&a.pushUnique(this.entitys,e.name));return this},a.Group.prototype.removeEntitysFromGroup=function(){var b,c,d,e;for(b=Array.prototype.slice.call(arguments),Array.isArray(b[0])&&(b=b[0]),c=0,d=b.length;d>c;c++)e=b[c],a.xt(e)&&(a.isa(e,"str")?a.removeItem(this.entitys,e):a.xt(e.name)&&a.removeItem(this.entitys,e.name));return this},a.Group.prototype.updateEntitysBy=function(b){var c,d;for(b=a.safeObject(b),c=0,d=this.entitys.length;d>c;c++)a.entity[this.entitys[c]].setDelta({startX:a.xtGet(b.x,b.startX,0),startY:a.xtGet(b.y,b.startY,0),scale:a.xtGet(b.scale,0),roll:a.xtGet(b.roll,0)});return this},a.Group.prototype.setEntitysTo=function(b){var c,d;for(c=0,d=this.entitys.length;d>c;c++)a.entity[this.entitys[c]].set(b);return this},a.Group.prototype.pivotEntitysTo=function(b){var c,d,e,f,g,h,i={pivot:0,handleX:0,handleY:0};if(b=a.isa(b,"str")?b:!1,b&&(c=a.entity[b]||a.point[b]||!1))for(d="Point"===c.type?c.local:c.start,g=0,h=this.entitys.length;h>g;g++)e=a.entity[this.entitys[g]],f=a.v.set(e.start),f.vectorSubtract(d),i.pivot=b,i.handleX=-f.x,i.handleY=-f.y,e.set(i);return this},a.Group.prototype.getEntityAt=function(b){var c,d,e,f;for(b=a.safeObject(b),e=a.v.set(b),e=a.Position.prototype.correctCoordinates(e,this.cell),this.sortEntitys(),f=this.entitys.length-1;f>=0;f--)if(c=a.entity[this.entitys[f]],!(this.regionRadius&&(c.resetWork(),d=c.work.start.vectorSubtract(e),d.getMagnitude()>this.regionRadius))&&c.checkHit(e))return c;return!1},a.Group.prototype.getEntitysByMouseIndex=function(b){var c,d,e,f=[];if(a.isa(b,"str"))for(c=0,d=this.entitys.length;d>c;c++)e=a.entity[this.entitys[c]],e.mouseIndex===b&&f.push(e);return f},a.Group.prototype.getAllEntitysAt=function(b){var c,d,e,f,g;for(b=a.safeObject(b),e=a.v.set(b),f=[],e=a.Position.prototype.correctCoordinates(e,this.cell),this.sortEntitys(),g=this.entitys.length-1;g>=0;g--)c=a.entity[this.entitys[g]],this.regionRadius&&(c.resetWork(),d=c.work.start.vectorSubtract(e),d.getMagnitude()>this.regionRadius)||c.checkHit(e)&&f.push(c);return f.length>0?f:!1},a.Entity=function(b){b=a.safeObject(b),a.Position.call(this,b),b.name=this.name;var c=a.makeContext(b);return this.context=c.name,this.group=this.getGroup(b),this.fastStamp=a.xtGet(b.fastStamp,!1),this.scaleOutline=a.xtGet(b.scaleOutline,!0),this.order=a.xtGet(b.order,0),this.visibility=a.xtGet(b.visibility,!0),this.method=a.xtGet(b.method,a.d[this.type].method),this.collisionsEntityConstructor(b),this.filtersEntityInit(b),this},a.Entity.prototype=Object.create(a.Position.prototype),a.Entity.prototype.type="Entity",a.Entity.prototype.classname="entitynames",a.d.Entity={order:0,visibility:!0,method:"fill",data:"",radius:0,scaleOutline:!0,fastStamp:!1,context:"",group:""},a.mergeInto(a.d.Entity,a.d.Position),a.Entity.prototype.filtersEntityInit=function(){},a.Entity.prototype.collisionsEntityConstructor=function(){},a.Entity.prototype.registerInLibrary=function(b){return a.entity[this.name]=this,a.pushUnique(a.entitynames,this.name),a.group[this.group].addEntitysToGroup(this.name),this.collisionsEntityRegisterInLibrary(b),this},a.Entity.prototype.collisionsEntityRegisterInLibrary=function(){},a.Entity.prototype.get=function(b){return a.xt(a.d.Base[b])?a.Base.prototype.get.call(this,b):a.xt(a.d.Context[b])?a.ctx[this.context].get(b):a.Position.prototype.get.call(this,b)},a.Entity.prototype.set=function(b){return a.Position.prototype.set.call(this,b),a.ctx[this.context].set(b),b=a.safeObject(b),a.xt(b.group)&&b.group!==this.group&&(a.group[this.group].removeEntitysFromGroup(this.name),this.group=this.getGroup(b.group),a.group[this.group].addEntitysToGroup(this.name)),this.collisionsEntitySet(b),a.xto(b.handleX,b.handleY,b.handle,b.width,b.height,b.radius,b.scale)&&(this.offset.flag=!1),this},a.Entity.prototype.collisionsEntitySet=function(){},a.Entity.prototype.setDelta=function(b){return a.Position.prototype.setDelta.call(this,b),b=a.safeObject(b),a.xto(b.lineDashOffset,b.lineWidth,b.globalAlpha)&&a.ctx[this.context].setDelta(b),a.xt(b.roll)&&(this.roll+=b.roll||0),a.xt(b.width)&&(this.width=a.isa(this.width,"num")?this.width+b.width:a.addPercentages(this.width,b.width)),a.xt(b.height)&&(this.height=a.isa(this.height,"num")?this.height+b.height:a.addPercentages(this.height,b.height)),a.xto(b.handleX,b.handleY,b.handle,b.width,b.height,b.pasteWidth,b.pasteHeight,b.radius,b.scale)&&(this.offset.flag=!1),this.collisionsEntitySetDelta(b),this},a.Entity.prototype.collisionsEntitySetDelta=function(){},a.Entity.prototype.clone=function(b){var c,d,e;return b=a.safeObject(b),c=JSON.parse(JSON.stringify(a.ctx[this.context])),delete c.name,d=a.mergeInto(b,c),delete d.context,e=a.Position.prototype.clone.call(this,d),a.xt(b.createNewContext)&&!b.createNewContext&&(delete a.ctx[e.context],a.removeItem(a.ctxnames,e.context),e.context=this.context),e},a.Entity.prototype.getGroup=function(b){return b=a.safeObject(b),a.xt(b.group)&&a.group[b.group]?b.group:a.pad[a.currentPad].current},a.Entity.prototype.getEntityCell=function(b){return a.cell[this.getGroup(b)]},a.Entity.prototype.forceStamp=function(a,b){var c=this.visibility;return this.visibility=!0,this.stamp(a,b),this.visibility=c,this
},a.Entity.prototype.prepareStamp=function(){return this.offset.flag||(this.offset.set(this.getOffsetStartVector()),this.offset.flag=!0),this.offset},a.Entity.prototype.stamp=function(b,c){var d,e;return this.visibility&&(c=a.cell[c]||a.cell[a.group[this.group].cell],e=c.name,d=a.context[e],b=b||this.method,this.pivot?this.setStampUsingPivot(e):this.pathStamp(),this.callMethod(d,e,b),this.stampFilter(d,e)),this},a.Entity.prototype.pathStamp=function(){},a.Entity.prototype.stampFilter=function(){},a.Entity.prototype.callMethod=function(a,b,c){var d=c[0];if("f">d)if("c"===d)switch(c){case"clear":this.clear(a,b);break;case"clearWithBackground":this.clearWithBackground(a,b);break;case"clip":this.clip(a,b)}else switch(c){case"draw":this.draw(a,b);break;case"drawFill":this.drawFill(a,b)}else if("f"===d)switch(c){case"fill":this.fill(a,b);break;case"fillDraw":this.fillDraw(a,b);break;case"floatOver":this.floatOver(a,b)}else switch(c){case"none":this.none(a,b);break;case"sinkInto":this.sinkInto(a,b)}return this},a.Entity.prototype.rotateCell=function(a,b){var c,d,e=this.flipReverse?-1:1,f=this.flipUpend?-1:1,g=this.addPathRoll?this.roll+this.pathRoll:this.roll,h=this.start.x,i=this.start.y;return g*=.01745329251,c=Math.cos(g),d=Math.sin(g),h.substring&&(h=this.convertX(h,b)),i.substring&&(i=this.convertY(i,b)),a.setTransform(c*e,d*e,-d*f,c*f,h,i),this},a.Entity.prototype.getStartValues=function(){var b=this.getEntityCell(),c={x:0,y:0};return c.x=a.isa(this.start.x,"str")?this.convertX(this.start.x,b):this.start.x,c.y=a.isa(this.start.y,"str")?this.convertY(this.start.y,b):this.start.y,c},a.Entity.prototype.clear=function(){return this},a.Entity.prototype.clearWithBackground=function(){return this},a.Entity.prototype.draw=function(){return this},a.Entity.prototype.fill=function(){return this},a.Entity.prototype.drawFill=function(){return this},a.Entity.prototype.fillDraw=function(){return this},a.Entity.prototype.sinkInto=function(){return this},a.Entity.prototype.floatOver=function(){return this},a.Entity.prototype.clip=function(){return this},a.Entity.prototype.none=function(b,c){return a.cell[c].setEngine(this),this},a.Entity.prototype.clearShadow=function(b,c){var d=a.ctx[this.context];return(d.shadowOffsetX||d.shadowOffsetY||d.shadowBlur)&&(c=a.isa(c,"str")?a.cell[c]:c,c.clearShadow()),this},a.Entity.prototype.restoreShadow=function(b,c){var d=a.ctx[this.context];return(d.shadowOffsetX||d.shadowOffsetY||d.shadowBlur)&&(c=a.isa(c,"str")?a.cell[c]:c,c.restoreShadow(this.context)),this},a.Entity.prototype.pickupEntity=function(b){var c,d;return b=a.safeObject(b),d=a.v.set(b),c=a.cell[a.group[this.group].cell],d=this.correctCoordinates(d,c),this.oldX=d.x||0,this.oldY=d.y||0,this.oldPivot=this.pivot,this.mouseIndex=a.xtGet(b.id||"mouse"),this.pivot="mouse",this.order+=this.order+9999,this},a.Entity.prototype.dropEntity=function(b){var c=this.order;return this.set({pivot:a.xtGet(b,this.oldPivot,null),order:c>=9999?c-9999:0}),this.oldPivot=null,this.oldX=null,this.oldY=null,this.mouseIndex=null,this},a.Entity.prototype.checkHit=function(b){var c,d,e,f,g,h,i=[];for(b=a.safeObject(b),a.xt(b.tests)?i=b.tests:(i.length=0,i.push(b.x||0),i.push(b.y||0)),this.rotateCell(a.cvx,this.getEntityCell().name),c=this.prepareStamp(),g=this.localWidth?this.localWidth:this.width*this.scale,h=this.localHeight?this.localHeight:this.height*this.scale,a.cvx.beginPath(),a.cvx.rect(c.x,c.y,g,h),e=0,f=i.length;f>e&&!(d=a.cvx.isPointInPath(i[e],i[e+1]));e+=2);return d?(b.x=i[e],b.y=i[e+1],b):!1},a.Design=function(b){return a.Base.call(this,b),this.lockTo=a.xtGet(b.lockTo,a.d[this.type].lockTo),this},a.Design.prototype=Object.create(a.Base.prototype),a.Design.prototype.type="Design",a.Design.prototype.classname="designnames",a.d.Design={color:[{color:"black",stop:0},{color:"white",stop:.999999}],lockTo:"cell",autoUpdate:!1,cell:"",startX:0,startY:0,endX:0,endY:0},a.mergeInto(a.d.Design,a.d.Base),a.Design.prototype.setDelta=function(b){var c;return b=a.safeObject(b),b.startX&&(c=this.get("startX"),this.startX=a.isa(b.startX,"str")?a.addPercentages(c,b.startX):c+b.startX),b.startY&&(c=this.get("startY"),this.startY=a.isa(b.startY,"str")?a.addPercentages(c,b.startY):c+b.startY),b.startRadius&&(c=this.get("startRadius"),this.startRadius=c+b.startRadius),b.endX&&(c=this.get("endX"),this.endX=a.isa(b.endX,"str")?a.addPercentages(c,b.endX):c+b.endX),b.endY&&(c=this.get("endY"),this.endY=a.isa(b.endY,"str")?a.addPercentages(c,b.endY):c+b.endY),b.endRadius&&(c=this.get("endRadius"),this.endRadius=c+b.endRadius),b.shift&&a.xt(a.d.Design.shift)&&(c=this.get("shift"),this.shift=c+b.shift),this},a.Design.prototype.update=function(a,b){return this.makeGradient(a,b),this.applyStops(),this},a.Design.prototype.getData=function(){return a.xt(a.dsn[this.name])?a.dsn[this.name]:"rgba(0,0,0,0)"},a.Design.prototype.makeGradient=function(b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u;if(b=a.entity[b]||!1,c=a.xt(c)?a.cell[c]?a.cell[c]:a.cell[this.get("cell")]:b?a.cell[b.group]:a.cell[this.get("cell")],d=a.context[c.name],this.lockTo&&"cell"!==this.lockTo){switch(r=b.getOffsetStartVector(),b.type){case"Wheel":f=-r.x+b.radius*b.scale,g=-r.y+b.radius*b.scale;break;case"Shape":case"Path":b.isLine?(f=-r.x,g=-r.y):(f=-r.x+b.width/2*b.scale,g=-r.y+b.height/2*b.scale);break;default:f=-r.x,g=-r.y}s=a.xt(b.localWidth)?b.localWidth:b.width*b.scale,t=a.xt(b.localHeight)?b.localHeight:b.height*b.scale,h=a.xt(this.startX)?this.startX:0,"string"==typeof h&&(h=parseFloat(h)/100*s),i=a.xt(this.startY)?this.startY:0,"string"==typeof i&&(i=parseFloat(i)/100*t),k=a.xt(this.endX)?this.endX:s,"string"==typeof k&&(k=parseFloat(k)/100*s),l=a.xt(this.endY)?this.endY:t,"string"==typeof l&&(l=parseFloat(l)/100*t),"Gradient"===this.type?e=d.createLinearGradient(h-f,i-g,k-f,l-g):(j=a.xt(this.startRadius)?this.startRadius:0,"string"==typeof j&&(j=parseFloat(j)/100*s),m=a.xt(this.endRadius)?this.endRadius:s,"string"==typeof m&&(m=parseFloat(m)/100*s),e=d.createRadialGradient(h-f,i-g,j,k-f,l-g,m))}else f=b.start.x,"string"==typeof f&&(f=b.convertX(f,c.name)),g=b.start.y,"string"==typeof g&&(g=b.convertY(g,c.name)),h=a.xt(this.startX)?this.startX:0,"string"==typeof h&&(h=b.convertX(h,c.name)),i=a.xt(this.startY)?this.startY:0,"string"==typeof i&&(i=b.convertY(i,c.name)),k=a.xt(this.endX)?this.endX:c.actualWidth,"string"==typeof k&&(k=b.convertX(k,c.name)),l=a.xt(this.endY)?this.endY:c.actualWidth,"string"==typeof l&&(l=b.convertY(l,c.name)),f=b.flipReverse?c.actualWidth-f:f,g=b.flipUpend?c.actualHeight-g:g,h=b.flipReverse?c.actualWidth-h:h,i=b.flipUpend?c.actualHeight-i:i,k=b.flipReverse?c.actualWidth-k:k,l=b.flipUpend?c.actualHeight-l:l,n=h-f,o=i-g,p=k-f,q=l-g,u=b.roll,(b.flipReverse&&b.flipUpend||!b.flipReverse&&!b.flipUpend)&&(u=-b.roll),b.roll&&(a.v.set({x:n,y:o,z:0}).rotate(u),n=a.v.x,o=a.v.y,a.v.set({x:p,y:q,z:0}).rotate(u),p=a.v.x,q=a.v.y),"Gradient"===this.type?e=d.createLinearGradient(n,o,p,q):(j=a.xt(this.startRadius)?this.startRadius:0,"string"==typeof j&&(j=parseFloat(j)/100*c.actualWidth),m=a.xt(this.endRadius)?this.endRadius:c.actualWidth,"string"==typeof m&&(m=parseFloat(m)/100*c.actualWidth),e=d.createRadialGradient(n,o,j,p,q,m));return a.dsn[this.name]=e,this},a.Design.prototype.applyStops=function(){var b,c,d;if(b=this.get("color"),a.dsn[this.name])for(c=0,d=b.length;d>c;c++)a.dsn[this.name].addColorStop(b[c].stop,b[c].color);return this},a.Design.prototype.remove=function(){return delete a.dsn[this.name],delete a.design[this.name],a.removeItem(a.designnames,this.name),!0},a.Gradient=function(b){return b=a.safeObject(b),a.Design.call(this,b),a.Base.prototype.set.call(this,b),a.design[this.name]=this,a.pushUnique(a.designnames,this.name),this},a.Gradient.prototype=Object.create(a.Design.prototype),a.Gradient.prototype.type="Gradient",a.Gradient.prototype.classname="designnames",a.d.Gradient={},a.mergeInto(a.d.Gradient,a.d.Design),a.RadialGradient=function(b){return b=a.safeObject(b),a.Design.call(this,b),a.Base.prototype.set.call(this,b),a.design[this.name]=this,a.pushUnique(a.designnames,this.name),this},a.RadialGradient.prototype=Object.create(a.Design.prototype),a.RadialGradient.prototype.type="RadialGradient",a.RadialGradient.prototype.classname="designnames",a.d.RadialGradient={startRadius:0,endRadius:0},a.mergeInto(a.d.RadialGradient,a.d.Design),a.v=a.makeVector({name:"scrawl.v"}),a}();