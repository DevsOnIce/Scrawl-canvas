/*! scrawl-canvas 2014-11-01 */
var scrawl=window.scrawl||function(){"use strict";var a={};return a.version="3.1.7",a.nameslist=["objectnames","assetnames","padnames","cellnames","ctxnames","groupnames","designnames","entitynames"],a.sectionlist=["object","asset","pad","cell","canvas","context","ctx","imageData","group","design","dsn","entity"],a.radian=Math.PI/180,a.d={},a.v=null,a.workquat=null,a.f=document.createDocumentFragment(),a.cv=document.createElement("canvas"),a.cv.id="defaultHiddenCanvasElement",a.f.appendChild(a.cv),a.cvx=a.cv.getContext("2d"),a.loadAlias={block:"scrawlBlock",wheel:"scrawlWheel",phrase:"scrawlPhrase",path:"scrawlPath",shape:"scrawlShape",images:"scrawlImages",frame:"scrawlFrame",animation:"scrawlAnimation",collisions:"scrawlCollisions",factories:"scrawlPathFactories",color:"scrawlColor",filters:"scrawlFilters",physics:"scrawlPhysics",saveload:"scrawlSaveLoad",stacks:"scrawlStacks",quaternion:"scrawlQuaternion",imageload:"scrawlImageLoad"},a.modules=[],a.loadDependencies={block:[],wheel:[],phrase:[],path:[],shape:[],images:["imageload"],frame:["imageload"],animation:[],collisions:[],factories:[],color:[],filters:[],physics:["quaternion"],saveload:[],stacks:["quaternion"],quaternion:[]},a.init=function(){return a.reset(),a.pageInit(),a.setDisplayOffsets("all"),a.animationInit(),a.physicsInit(),a},a.pageInit=function(){a.getCanvases()},a.animationInit=function(){},a.physicsInit=function(){},a.reset=function(){for(var b=0,c=a.nameslist.length;c>b;b++)a[a.nameslist[b]]=[];for(var d=0,e=a.sectionlist.length;e>d;d++)a[a.sectionlist[d]]={};return a},a.loadModules=function(b){b=a.safeObject(b);var c,d,e,f,g=b.path||"",h=[].concat(b.modules),i=a.isa(b.callback,"fn")?b.callback:function(){},j=a.isa(b.error,"fn")?b.error:function(){},k=a.xtGet([b.minified,!0]),l=k?"-min.js":".js",m=[],n=[],o=Date.now(),p=3e4,q=function(b){var c,d=a.loadAlias[b]||b;a.contains(a.modules,d)||(c=document.createElement("script"),c.type="text/javascript",c.async="true",c.onload=function(){console.log("... "+b+" loaded",a.modules),r(b)},c.onerror=function(){console.log("... "+b+" failed to load",a.modules),r(b,!0)},c.src=/\.js$/.test(d)?g+d:g+d+l,document.body.appendChild(c))},r=function(b,c){a.removeItem(m,b),c||Date.now()>o+p?(console.log("failed to load all modules"),j()):a.pushUnique(a.modules,b),0===m.length&&(console.log("All modules loaded",a.modules),i())};for(c=0,d=h.length;d>c;c++){for(e=0,f=a.loadDependencies[h[c]].length;f>e;e++)a.pushUnique(n,a.loadDependencies[h[c]][e]);a.pushUnique(n,h[c])}for(m=[].concat(n),console.log("Modules to be loaded: ",n),c=0,d=n.length;d>c;c++)q(n[c]);return a},a.mergeInto=function(b,c){for(var d in c)c.hasOwnProperty(d)&&!a.xt(b[d])&&(b[d]=c[d]);return b},a.mergeOver=function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},a.contains=function(a,b){for(var c in a)if(a[c]===b)return!0;return!1},a.pushUnique=function(b,c){return a.contains(b,c)||b.push(c),b},a.removeItem=function(b,c){if(a.contains(b,c)){var d=b.indexOf(c);b.splice(d,1)}return b},a.isBetween=function(a,b,c,d){if(b>c){var e=b;b=c,c=e}return d?a>=b&&c>=a?!0:!1:a>b&&c>a||a===b&&a===c?!0:!1},a.addWithinBounds=function(b,c,d){d=a.safeObject(d),b=a.xtGet([b,0]),c=a.xtGet([c,0]);var e,f,g=a.xtGet([d.min,0]),h=a.xtGet([d.max,1]),i=a.xtGet([d.action,"stick"]),j=a.xtGet([d.operation,"add"]),k=20;if(0===c&&("divide"===j||"/"===j))return!1;switch(j){case"subtract":case"-":e=b-c;break;case"multiply":case"*":e=b*c;break;case"divide":case"/":e=b/c;break;default:e=b+c}for(;!a.isBetween(e,g,h,!0)&&k>0;){switch(f=(g+h)/2>e?!0:!1,i){case"bounce":e=f?g+(-e+g):h+(-e+h);break;case"loop":e=f?h-g+e:g-h+e;break;default:e=f?g:h}k--}return k>0?e:!1},a.isa=function(b,c){if(a.xta([b,c])){var d=c.toLowerCase(),e=d[0];if("m">e)if("d">e)switch(d){case"arr":return Array.isArray(b)?!0:!1;case"bool":return"boolean"==typeof b?!0:!1;case"canvas":return"[object HTMLCanvasElement]"===Object.prototype.toString.call(b)?!0:!1;default:return!1}else switch(d){case"date":return"[object Date]"===Object.prototype.toString.call(b)?!0:!1;case"fn":return"function"==typeof b?!0:!1;case"img":return"[object HTMLImageElement]"===Object.prototype.toString.call(b)?!0:!1;default:return!1}else if("s">e)switch(d){case"num":return b.toFixed?!0:!1;case"obj":return"[object Object]"===Object.prototype.toString.call(b)?!0:!1;case"quaternion":return b.type&&"Quaternion"===b.type?!0:!1;default:return!1}else switch(d){case"str":return b.substring?!0:!1;case"vector":return b.type&&"Vector"===b.type?!0:!1;case"video":return"[object HTMLVideoElement]"===Object.prototype.toString.call(b)?!0:!1;default:return!1}}return!1},a.safeObject=function(b){return a.isa(b,"obj")?b:{}},a.xt=function(a){return"undefined"!=typeof a?!0:!1},a.xtGet=function(a){var b=[].concat(a);if(b.length>0)for(var c=0,d=b.length;d>c;c++)if("undefined"!=typeof b[c])return b[c];return null},a.xtGetTrue=function(a){var b=[].concat(a);if(b.length>0)for(var c=0,d=b.length;d>c;c++)if(b[c])return b[c];return null},a.xta=function(a){var b=[].concat(a);if(b.length>0){for(var c=0,d=b.length;d>c;c++)if("undefined"==typeof b[c])return!1;return!0}return!1},a.xto=function(a){var b=[].concat(a);if(b.length>0)for(var c=0,d=b.length;d>c;c++)if("undefined"!=typeof b[c])return!0;return!1},a.makeName=function(b){b=a.safeObject(b);var c,d,e,f={name:a.isa(b.name,"str")?b.name:d,type:a.isa(b.type,"str")?b.type:d,target:a.isa(b.target,"str")?b.target:d};return a.contains(a.nameslist,f.target)?(c=a.xtGetTrue([f.name,f.type,"default"]),e=c.split("~~~"),a.contains(a[f.target],e[0])?e[0]+"~~~"+Math.floor(1e8*Math.random()):e[0]):(console.log("scrawl.makeName() error: insufficient or incorrect argument attributes"),!1)},a.setDisplayOffsets=function(b){b=a.xt(b)?b:"all";for(var c=0,d=a.padnames.length;d>c;c++)a.pad[a.padnames[c]].setDisplayOffsets();return a},a.getCanvases=function(){var b,c=document.getElementsByTagName("canvas"),d=[];if(c.length>0){for(var e=0,f=c.length;f>e;e++)d.push(c[e]);for(var g=0,h=c.length;h>g;g++)b=a.newPad({canvasElement:d[g]}),0===g&&(a.currentPad=b.name);return!0}return console.log("scrawl.getCanvases() failed to find any <canvas> elements on the page"),!1},a.addCanvasToPage=function(b){b=a.safeObject(b);var c,d,e,f,g;return c=document.getElementById(b.parentElement)||document.body,d=a.makeName({name:a.xtGet([b.canvasName,b.name,!1]),type:"Pad",target:"padnames"}),e=document.createElement("canvas"),e.id=d,c.appendChild(e),f=document.getElementById(d),f.width=b.width,f.height=b.height,g=a.newPad({canvasElement:f}),g.set(b),a.setDisplayOffsets(),g},a.prepareFilterSection=function(){return a.xt(a.filter)||(a.filter={},a.filternames=[]),a},a.setDrawOrder=function(b,c){for(var d=a.xt(c)?[].concat(c):[a.currentPad],e=0,f=d.length;f>e;e++)a.pad[d[e]].setDrawOrder(b);return a},a.clear=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].clear(b);return a},a.stampBackground=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].stampBackground(b);return a},a.compile=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].compile(b);return a},a.show=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].show(b);return a},a.render=function(b,c){var d=a.xt(c)?[].concat(c):a.padnames;if(d.length>0)for(var e=0,f=d.length;f>e;e++)a.pad[d[e]].render(b);return a},a.addPercentages=function(a,b){var c,d;return c=parseFloat(a),d=parseFloat(b),c+d+"%"},a.reversePercentage=function(a){var b=parseFloat(a);return b=-b,b+"%"},a.subtractPercentages=function(a,b){var c,d;return c=parseFloat(a),d=parseFloat(b),c-d+"%"},a.addNewCell=function(b,c){var d=a.isa(c,"str")?c:a.currentPad;return a.pad[d].addNewCell(b)},a.deleteCells=function(b){if(a.xt(b))for(var c=[].concat(b),d=0,e=c.length;e>d;d++){for(var f=0,g=a.padnames.length;g>f;f++)a.pad[a.padnames[f]].deleteCell(c[d]);delete a.group[c[d]],delete a.group[c[d]+"_field"],delete a.group[c[d]+"_fence"],a.removeItem(a.groupnames,c[d]),a.removeItem(a.groupnames,c[d]+"_field"),a.removeItem(a.groupnames,c[d]+"_fence"),delete a.context[c[d]],delete a.canvas[c[d]],delete a.ctx[a.cell[c[d]].context],a.removeItem(a.ctxnames,a.cell[c[d]].context),delete a.cell[c[d]],a.removeItem(a.cellnames,c[d])}return a},a.getImageDataValue=function(b){if(b=a.safeObject(b),a.xta([b.table,b.channel])&&a.isa(b.x,"num")&&a.isa(b.y,"num")){var c,d,e,f;if(c=a.imageData[b.table],c&&a.isBetween(b.y,-1,c.height)&&a.isBetween(b.x,-1,c.width)){if(d=4*(b.y*c.width+b.x),"color"===b.channel)e="rgba("+c.data[d]+","+c.data[d+1]+","+c.data[d+2]+","+c.data[d+3]+")";else{switch(b.channel){case"red":f=0;break;case"blue":f=1;break;case"green":f=2;break;case"alpha":f=3}e=c.data[d+f]}return e}}return console.log("scrawl.getImageDataValue() error: insufficient or incorrect arguments; or imageData does not exist; or coordinates are out of bounds"),!1},a.addEntitysToGroups=function(b,c){if(a.xta([b,c]))for(var d=[].concat(b),e=[].concat(c),f=0,g=d.length;g>f;f++)a.contains(a.groupnames,d[f])&&a.group[d[f]].addEntitysToGroup(e);return a},a.removeEntitysFromGroups=function(b,c){if(a.xta([b,c]))for(var d=[].concat(b),e=[].concat(c),f=0,g=d.length;g>f;f++)a.contains(a.groupnames,d[f])&&a.group[d[f]].removeEntitysFromGroup(e);return a},a.deleteEntity=function(b){for(var c,d,e=a.isa(b,"str")?[b]:[].concat(b),f=0,g=e.length;g>f;f++)if(a.contains(a.entitynames,e[f])){d=a.entity[e[f]],a.pathDeleteEntity(d),c=d.context,a.removeItem(a.ctxnames,c),delete a.ctx[c],a.removeItem(a.entitynames,e[f]),delete a.entity[e[f]];for(var h=0,i=a.groupnames.length;i>h;h++)a.removeItem(a.group[a.groupnames[h]].entitys,e[f])}return a},a.pathDeleteEntity=function(){},a.newVector=function(b){return new a.Vector(b)},a.newPad=function(b){return new a.Pad(b)},a.newCell=function(b){return new a.Cell(b)},a.newContext=function(b){return new a.Context(b)},a.newGroup=function(b){return new a.Group(b)},a.newGradient=function(b){return new a.Gradient(b)},a.newRadialGradient=function(b){return new a.RadialGradient(b)},a.Vector=function(b){return b=a.safeObject(b),this.x=b.x||0,this.y=b.y||0,this.z=b.z||0,this.name=b.name||"generic",this},a.Vector.prototype=Object.create(Object.prototype),a.Vector.prototype.type="Vector",a.d.Vector={x:0,y:0,z:0,name:"generic"},a.Vector.prototype.setMagnitudeTo=function(a){return this.normalize(),this.scalarMultiply(a),this.getMagnitude()!==a&&(this.normalize(),this.scalarMultiply(a),this.getMagnitude()!==a&&(this.normalize(),this.scalarMultiply(a))),this},a.Vector.prototype.normalize=function(){var a=this.getMagnitude();return a>0&&(this.x/=a,this.y/=a,this.z/=a),this},a.Vector.prototype.zero=function(){return this.x=0,this.y=0,this.z=0,this},a.Vector.prototype.set=function(b){return b=a.safeObject(b),this.x=a.xt(b.x)?b.x:this.x,this.y=a.xt(b.y)?b.y:this.y,this.z=a.xt(b.z)?b.z:this.z,this},a.Vector.prototype.isEqual=function(b){return a.isa(b,"vector")&&this.x===b.x&&this.y===b.y&&this.z===b.z?!0:!1},a.Vector.prototype.isLike=function(b){return a.isa(b,"obj")&&this.x===b.x&&this.y===b.y&&this.z===b.z?!0:!1},a.Vector.prototype.getData=function(){return{x:this.x,y:this.y,z:this.z}},a.Vector.prototype.hasCoordinates=function(b){return a.xta([b,b.x,b.y])?!0:!1},a.Vector.prototype.vectorAdd=function(b){return b=a.safeObject(b),this.x+=b.x||0,this.y+=b.y||0,this.z+=b.z||0,this},a.Vector.prototype.vectorSubtract=function(b){return b=a.safeObject(b),this.x-=b.x||0,this.y-=b.y||0,this.z-=b.z||0,this},a.Vector.prototype.vectorMultiply=function(b){return b=a.safeObject(b),this.x*=b.x||1,this.y*=b.y||1,this.z*=b.z||1,this},a.Vector.prototype.vectorDivide=function(b){return b=a.safeObject(b),this.x/=0!==(b.x||0)?b.x:1,this.y/=0!==(b.y||0)?b.y:1,this.z/=0!==(b.z||0)?b.z:1,this},a.Vector.prototype.scalarMultiply=function(b){return a.isa(b,"num")?(this.x*=b,this.y*=b,this.z*=b,this):(console.log("Vector.scalarMultiply() error: argument is not a number"),this)},a.Vector.prototype.scalarDivide=function(b){return a.isa(b,"num")&&0!==b?(this.x/=b,this.y/=b,this.z/=b,this):(console.log("Vector.scalarDivide() error: argument is not a number, or is zero"),this)},a.Vector.prototype.getMagnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},a.Vector.prototype.checkNotZero=function(){return this.x||this.y||this.z?!0:!1},a.Vector.prototype.getVector=function(){return console.log("Vector.getVector"),a.newVector({x:this.x,y:this.y,z:this.z})},a.Vector.prototype.getCrossProduct=function(b,c){if(console.log("Vector.getCrossProduct"),a.isa(b,"vector")){c=a.isa(c,"vector")?c:this;var d=c.x||0,e=c.y||0,f=c.z||0,g=b.x||0,h=b.y||0,i=b.z||0;return a.newVector({x:e*i-f*h,y:-(d*i)+f*g,z:d*h+e*g})}return console.log("Vector.getCrossProduct() error: argument is not a Vector"),this},a.Vector.prototype.getDotProduct=function(b,c){return a.isa(b,"vector")?(c=a.isa(c,"vector")?c:this,(b.x||0)*(c.x||0)+(b.y||0)*(c.y||0)+(b.z||0)*(c.z||0)):(console.log("Vector.getDotProduct() error: argument is not a Vector"),!1)},a.Vector.prototype.getTripleScalarProduct=function(b,c,d){if(a.isa(b,"vector")&&a.isa(c,"vector")){d=a.safeObject(d)?d:this;var e=b.x||0,f=b.y||0,g=b.z||0,h=c.x||0,i=c.y||0,j=c.z||0,k=d.x||0,l=d.y||0,m=d.z||0;return e*(i*m-j*l)+f*(-(h*m)+j*k)+g*(h*l-i*k)}return console.log("Vector.getTripleScalarProduct() error: argument is not a Vector"),!1},a.Vector.prototype.rotate=function(b){if(a.isa(b,"num")){var c=Math.atan2(this.y,this.x);c+=b*a.radian;var d=this.getMagnitude();return this.x=d*Math.cos(c),this.y=d*Math.sin(c),this}return console.log("Vector.rotate() error: argument is not a Number"),this},a.Vector.prototype.reverse=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},a.Vector.prototype.rotate3d=function(b,c){if(a.isa(b,"quaternion")){c=scrawl.isa(c,"num")?c:this.getMagnitude();var d=a.workquat.q1.set(b),e=a.workquat.q2.set(this),f=a.workquat.q3.set(b).conjugate();return d.quaternionMultiply(e),d.quaternionMultiply(f),this.set(d.v).setMagnitudeTo(c),this}return console.log("Vector.rotate3d() error: argument is not a Quaternion"),this},a.Base=function(b){return b=a.safeObject(b),this.name=a.makeName({name:b.name,type:this.type,target:this.classname}),this.work={},this},a.Base.prototype=Object.create(Object.prototype),a.Base.prototype.type="Base",a.Base.prototype.classname="objectnames",a.d.Base={comment:"",title:"",timestamp:""},a.Base.prototype.get=function(b){return a.xt(this[b])?this[b]:a.d[this.type][b]},a.Base.prototype.set=function(b){for(var c in b)a.xt(a.d[this.type][c])&&(this[c]=b[c]);return this},a.Base.prototype.clone=function(b){var c=a.mergeOver(this.parse(),a.safeObject(b));return delete c.context,new a[this.type](c)},a.Base.prototype.parse=function(){return JSON.parse(JSON.stringify(this))},a.Base.prototype.resetWork=function(){for(var a=Object.keys(this.work),b=0,c=a.length;c>b;b++)this.work[a[b]].set(this[a[b]]);return!0},a.Position=function(b){return a.Base.call(this,b),b=a.safeObject(b),this.corePositionInit(b),this.animationPositionInit(b),this.pathPositionInit(b),this},a.Position.prototype=Object.create(a.Base.prototype),a.Position.prototype.type="Position",a.Position.prototype.classname="objectnames",a.d.Position={start:!1,handle:!1,pivot:"",scale:1,flipReverse:!1,flipUpend:!1,lockX:!1,lockY:!1,roll:0,width:0,height:0},a.mergeInto(a.d.Position,a.d.Base),a.Position.prototype.corePositionInit=function(b){var c=a.safeObject(b.start);this.start=a.newVector({x:a.xtGet([b.startX,c.x,0]),y:a.xtGet([b.startY,c.y,0]),name:this.type+"."+this.name+".start"}),this.work.start=a.newVector({name:this.type+"."+this.name+".work.start"}),c=a.safeObject(b.handle),this.handle=a.newVector({x:a.xtGet([b.handleX,c.x,0]),y:a.xtGet([b.handleY,c.y,0]),name:this.type+"."+this.name+".handle"}),this.work.handle=a.newVector({name:this.type+"."+this.name+".work.handle"}),this.pivot=a.xtGet([b.pivot,a.d[this.type].pivot]),this.scale=a.xtGet([b.scale,a.d[this.type].scale]),this.roll=a.xtGet([b.roll,a.d[this.type].roll]),this.flipReverse=a.xtGet([b.flipReverse,a.d[this.type].flipReverse]),this.flipUpend=a.xtGet([b.flipUpend,a.d[this.type].flipUpend]),this.lockX=a.xtGet([b.lockX,a.d[this.type].lockX]),this.lockY=a.xtGet([b.lockY,a.d[this.type].lockY]),this.offset=a.newVector({name:this.type+"."+this.name+".offset"}),this.offset.flag=!1},a.Position.prototype.animationPositionInit=function(){},a.Position.prototype.pathPositionInit=function(){},a.Position.prototype.get=function(b){if(a.contains(["startX","startY","handleX","handleY"],b))switch(b){case"startX":return this.start.x;case"startY":return this.start.y;case"handleX":return this.handle.x;case"handleY":return this.handle.y}return this.animationPositionGet(b)||a.Base.prototype.get.call(this,b)},a.Position.prototype.animationPositionGet=function(){return!1},a.Position.prototype.set=function(b){return b=a.safeObject(b),a.Base.prototype.set.call(this,b),a.isa(this.start,"vector")||(this.start=a.newVector(b.start||this.start)),a.xto([b.startX,b.startY])&&(this.start.x=a.xtGet([b.startX,this.start.x]),this.start.y=a.xtGet([b.startY,this.start.y])),a.isa(this.handle,"vector")||(this.handle=a.newVector(b.handle||this.handle)),a.xto([b.handleX,b.handleY])&&(this.handle.x=a.xtGet([b.handleX,this.handle.x]),this.handle.y=a.xtGet([b.handleY,this.handle.y])),this.animationPositionSet(b),this},a.Position.prototype.animationPositionSet=function(){},a.Position.prototype.updateStart=function(){},a.Position.prototype.revertStart=function(){},a.Position.prototype.reverse=function(){},a.Position.prototype.setDelta=function(b){b=a.safeObject(b);var c,d,e;return a.xto([b.start,b.startX,b.startY])&&(c=a.safeObject(b.start),d=a.xtGet([b.startX,c.x,0]),e=a.xtGet([b.startY,c.y,0]),this.start.x=a.isa(this.start.x,"num")?this.start.x+d:a.addPercentages(this.start.x,d),this.start.y=a.isa(this.start.y,"num")?this.start.y+e:a.addPercentages(this.start.y,e)),a.Position.prototype.pathPositionSetDelta.call(this,b),a.xto([b.handle,b.handleX,b.handleY])&&(c=a.safeObject(b.handle),d=a.xtGet([b.handleX,c.x,0]),e=a.xtGet([b.handleY,c.y,0]),this.handle.x=a.isa(this.handle.x,"num")?this.handle.x+d:a.addPercentages(this.handle.x,d),this.handle.y=a.isa(this.handle.y,"num")?this.handle.y+e:a.addPercentages(this.handle.y,e)),b.scale&&(this.scale+=b.scale),this},a.Position.prototype.pathPositionSetDelta=function(){},a.Position.prototype.clone=function(b){b=a.safeObject(b);var c,d=a.Base.prototype.clone.call(this,b);return c=a.safeObject(b.start),d.start=a.newVector({x:a.xtGet([b.startX,c.x,d.start.x]),y:a.xtGet([b.startY,c.y,d.start.y]),name:d.type+"."+d.name+".start"}),c=a.safeObject(b.handle),d.handle=a.newVector({x:a.xtGet([b.handleX,c.x,d.handle.x]),y:a.xtGet([b.handleY,c.y,d.handle.y]),name:d.type+"."+d.name+".handle"}),d=this.animationPositionClone(d,b)},a.Position.prototype.animationPositionClone=function(a){return a},a.Position.prototype.getPivotOffsetVector=function(){var b=this.work.handle,c=this.targetHeight||this.localHeight/this.scale||this.height||this.get("height"),d=this.targetWidth||this.localWidth/this.scale||this.width||this.get("width");return a.Position.prototype.calculatePOV.call(this,b,d,c,!1)},a.Position.prototype.getCenteredPivotOffsetVector=function(){var b=this.work.handle,c=this.localHeight/this.scale||this.height||this.get("height"),d=this.localWidth/this.scale||this.width||this.get("width");return a.Position.prototype.calculatePOV.call(this,b,d,c,!0)},a.Position.prototype.calculatePOV=function(b,c,d,e){if(a.isa(b.x,"str")&&!a.contains(["left","center","right"],b.x))b.x=e?parseFloat(b.x)/100*c-c/2:parseFloat(b.x)/100*c;else switch(b.x){case"left":b.x=e?-(c/2):0;break;case"center":b.x=e?0:c/2;break;case"right":b.x=e?c/2:c}if(a.isa(b.y,"str")&&!a.contains(["top","center","bottom"],b.y))b.y=e?parseFloat(b.y)/100*d-d/2:parseFloat(b.y)/100*d;else switch(b.y){case"top":b.y=e?-(d/2):0;break;case"center":b.y=e?0:d/2;break;case"bottom":b.y=e?d/2:d}return b.x=isNaN(b.x)?0:b.x,b.y=isNaN(b.y)?0:b.y,b},a.Position.prototype.getOffsetStartVector=function(){this.resetWork();var b=a.isa(this.handle.x,"str")?this.scale:1,c=a.isa(this.handle.y,"str")?this.scale:1,d=this.getPivotOffsetVector();return d.x*=b,d.y*=c,d.reverse()},a.Position.prototype.setStampUsingPivot=function(b){var c,d,e;if(a.xt(a.pointnames)&&a.contains(a.pointnames,this.pivot))return c=a.point[this.pivot],e=a.entity[c.entity],d=c.getCurrentCoordinates().rotate(e.roll).vectorAdd(e.start),this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y,this;if(a.contains(a.entitynames,this.pivot))return c=a.entity[this.pivot],d="Particle"===c.type?c.get("place"):c.start,this.start.x=this.lockX?this.start.x:d.x,this.start.y=this.lockY?this.start.y:d.y,this;if("mouse"===this.pivot){var f=a.cell[b],g=a.pad[f.pad],h=this.correctCoordinates(g.mouse,b);a.xta([this.oldX,this.oldY])||(this.oldX=this.start.x,this.oldY=this.start.y),this.start.x=this.lockX?this.start.x:this.start.x+h.x-this.oldX,this.start.y=this.lockY?this.start.y:this.start.y+h.y-this.oldY,this.oldX=h.x,this.oldY=h.y}return this},a.Position.prototype.correctCoordinates=function(b,c){b=a.safeObject(b);var d=a.v.set(b);if(scrawl.xta([b.x,b.y])){c=a.contains(a.cellnames,c)?a.cell[c]:a.cell[a.pad[a.currentPad].base];var e=a.pad[c.pad];return e.width!==c.actualWidth&&(d.x/=e.width/c.actualWidth),e.height!==c.actualHeight&&(d.y/=e.height/c.actualHeight),d}return!1},a.PageElement=function(b){return b=a.safeObject(b),a.Base.call(this,b),this.scale=a.xtGet([b.scale,a.d[this.type].scale]),this.stacksPageElementConstructor(b),this},a.PageElement.prototype=Object.create(a.Base.prototype),a.PageElement.prototype.type="PageElement",a.PageElement.prototype.classname="objectnames",a.d.PageElement={width:300,height:150,displayOffsetX:0,displayOffsetY:0,scale:1,mouse:!1,position:"static"},a.mergeInto(a.d.PageElement,a.d.Base),a.PageElement.prototype.stacksPageElementConstructor=function(){},a.PageElement.prototype.get=function(b){var c=this.getElement();if(a.contains(["width","height"],b))switch(b){case"width":return a.xtGet([this.width,parseFloat(c.width),a.d[this.type].width]);case"height":return a.xtGet([this.height,parseFloat(c.height),a.d[this.type].height]);case"position":return a.xtGet([this.position,c.style.position])}return a.Base.prototype.get.call(this,b)},a.PageElement.prototype.set=function(b){b=a.safeObject(b),a.Base.prototype.set.call(this,b);this.getElement();return a.xto([b.width,b.height,b.scale])&&(this.setDimensions(),this.setDisplayOffsets()),a.xt(b.position)&&(this.position=b.position),a.xt(b.mouse)&&this.initMouse({mouse:b.mouse}),a.xt(b.pivot)&&(this.pivot=b.pivot,this.pivot||(delete this.oldX,delete this.oldY)),a.xto([b.title,b.comment])&&this.setAccessibility(b),this},a.PageElement.prototype.setAccessibility=function(b){b=a.safeObject(b);var c=this.getElement();return a.xt(b.title)&&(this.title=b.title,c.title=this.title),a.xt(b.comment)&&(this.comment=b.comment,c.setAttribute("data-comment",this.comment)),this},a.PageElement.prototype.setDisplayOffsets=function(){var a=0,b=0,c=this.getElement();if(c.offsetParent)do a+=c.offsetLeft,b+=c.offsetTop,c=c.offsetParent;while(c.offsetParent);return this.displayOffsetX=a,this.displayOffsetY=b,this},a.PageElement.prototype.scaleDimensions=function(b){return a.isa(b,"num")&&(this.scale=b,this.setDimensions()),this},a.PageElement.prototype.setDimensions=function(){var a=this.getElement();return a.style.width=this.width*this.scale+"px",a.style.height=this.height*this.scale+"px",this},a.PageElement.prototype.getMouse=function(){return this.mouse},a.PageElement.prototype.handleMouseMove=function(b){b=a.xt(b)?b:window.event;var c,d,e=scrawl.pad[b.target.id]||scrawl.stack[b.target.id]||scrawl.element[b.target.id]||!1,f=0,g=0;return e&&(e.mouse.active=!1,e.mouse.element=e.name,e.mouse.type=e.type,e.mouse.layer||a.xta([b,b.layerX])&&a.contains(["relative","absolute","fixed","sticky"],e.position)?(f=b.layerX,g=b.layerY,f>=0&&f<=e.width*e.scale&&g>=0&&g<=e.height*e.scale&&(e.mouse.active=!0),e.mouse.x=b.layerX*(1/e.scale),e.mouse.y=b.layerY*(1/e.scale),e.mouse.layer=!0):(b.pageX||b.pageY?(f=b.pageX,g=b.pageY):(b.clientX||b.clientY)&&(f=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,g=b.clientY+document.body.scrollTop+document.documentElement.scrollTop),c=e.displayOffsetX+e.width*e.scale,d=e.displayOffsetY+e.height*e.scale,f>=e.displayOffsetX&&c>=f&&g>=e.displayOffsetY&&d>=g&&(e.mouse.active=!0),e.mouse.x=(f-e.displayOffsetX)*(1/e.scale),e.mouse.y=(g-e.displayOffsetY)*(1/e.scale),e.mouse.layer=!1)),e},a.PageElement.prototype.handleMouseOut=function(b){b=a.xt(b)?b:window.event;var c=scrawl.pad[b.target.id]||scrawl.stack[b.target.id]||scrawl.element[b.target.id]||!1;return c&&(c.mouse.active=!1),c},a.PageElement.prototype.initMouse=function(b){return this.mouse=a.newVector({name:this.type+"."+this.name+".mouse"}),this.position||(this.position=this.get("position")),b.mouse?(this.mouse.set(b.mouse),this.addMouseMove()):this.removeMouseMove(),this},a.PageElement.prototype.addMouseMove=function(){var a,b=this.getElement();return b.removeEventListener("mousemove",this.handleMouseMove,!1),b.addEventListener("mousemove",this.handleMouseMove,!1),b.removeEventListener("mouseout",this.handleMouseOut,!1),b.removeEventListener("mouseleave",this.handleMouseOut,!1),b.setAttribute("onmouseout","return;"),a="function"==typeof b.onmouseout,b.setAttribute("onmouseout",null),a?b.addEventListener("mouseout",this.handleMouseOut,!1):b.addEventListener("mouseleave",this.handleMouseOut,!1),this},a.PageElement.prototype.removeMouseMove=function(){var a=this.getElement();return a.removeEventListener("mousemove",this.handleMouseMove,!1),a.removeEventListener("mouseout",this.handleMouseOut,!1),a.removeEventListener("mouseleave",this.handleMouseOut,!1),this},a.Pad=function(b){b=a.safeObject(b),a.PageElement.call(this,b);var c,d,e,f="Pad";return a.xt(b.canvasElement)&&(a.canvas.PadConstructorTemporaryCanvas=b.canvasElement,this.display="PadConstructorTemporaryCanvas",a.xto([b.canvasElement.id,b.canvasElement.name])&&(f=a.xtGet([b.canvasElement.id,b.canvasElement.name,f])),a.PageElement.call(this,{name:f}),this.name.match(/~~~/)&&(this.name=this.name.replace(/~~~/g,"_")),b.canvasElement.id||(b.canvasElement.id=this.name),!a.contains(a.cellnames,this.name))?(this.cells=[],this.drawOrder=[],this.width=a.xtGet([b.width,this.get("width")]),this.height=a.xtGet([b.height,this.get("height")]),this.setDimensions(),a.pad[this.name]=this,a.pushUnique(a.padnames,this.name),b.length>1&&this.set(b),c=a.newCell({name:this.name,pad:this.name,canvas:b.canvasElement}),a.pushUnique(this.cells,c.name),this.display=c.name,delete a.canvas.PadConstructorTemporaryCanvas,d=b.canvasElement.cloneNode(!0),d.setAttribute("id",this.name+"_base"),e=a.newCell({name:this.name+"_base",pad:this.name,canvas:d,backgroundColor:b.backgroundColor}),a.pushUnique(this.cells,e.name),this.base=e.name,this.current=e.name,this.setDisplayOffsets(),a.xto([b.title,b.comment])&&this.setAccessibility(b),b.mouse=a.isa(b.mouse,"bool")||a.isa(b.mouse,"vector")?b.mouse:!0,this.initMouse(b),this):(console.log("Failed to generate a Pad controller - no canvas element supplied"),!1)},a.Pad.prototype=Object.create(a.PageElement.prototype),a.Pad.prototype.type="Pad",a.Pad.prototype.classname="padnames",a.d.Pad={drawOrder:[],cells:[],display:"",base:"",current:""},a.mergeInto(a.d.Pad,a.d.PageElement),a.Pad.prototype.getElement=function(){return a.canvas[this.display]},a.Pad.prototype.set=function(b){if(a.PageElement.prototype.set.call(this,b),b=a.safeObject(b),this.setDrawOrder(b.drawOrder||this.get("drawOrder")),a.isa(b.scale,"num")&&(a.cell[this.display].scale=b.scale,this.scale=b.scale),a.xt(b.width)&&(a.cell[this.display].set({width:b.width}),this.width=b.width),a.xt(b.height)&&(a.cell[this.display].set({height:b.height}),this.height=b.height),a.xto([b.start,b.startX,b.startY,b.handle,b.handleX,b.handleY,b.scale,b.width,b.height])&&this.setDisplayOffsets(),a.xto([b.backgroundColor,b.globalAlpha,b.globalCompositeOperation])){var c=a.cell[this.base];a.cell[this.base].set({backgroundColor:b.backgroundColor||c.backgroundColor,globalAlpha:b.globalAlpha||c.globalAlpha,globalCompositeOperation:b.globalCompositeOperation||c.globalCompositeOperation})}return this},a.Pad.prototype.setDrawOrder=function(b){return this.drawOrder=a.xt(b)?[].concat(b):[],this},a.Pad.prototype.getCellsForDisplayAction=function(b){var c=[];if(a.isa(b,"arr"))c=b;else{for(var d=0,e=this.cells.length;e>d;d++)c.push(this.cells[d]);switch(b){case"all":break;case"display":c=[this.display];break;case"base":c=[this.base];break;case"non-base":a.removeItem(c,this.base);break;case"current":c=[this.current];break;case"non-current":a.removeItem(c,this.current);break;case"additionals":a.removeItem(c,this.display),a.removeItem(c,this.base);break;case"non-additionals":c=[this.display,this.base];break;case"none":c=[];break;default:a.removeItem(c,this.display)}}return c},a.Pad.prototype.clear=function(b){for(var c=this.getCellsForDisplayAction(b),d=0,e=c.length;e>d;d++)a.cell[c[d]].clear();return this},a.Pad.prototype.compile=function(b){for(var c=this.getCellsForDisplayAction(b),d=0,e=c.length;e>d;d++)a.cell[c[d]].compile();return this},a.Pad.prototype.stampBackground=function(b){for(var c=this.getCellsForDisplayAction(b),d=0,e=c.length;e>d;d++)a.cell[c[d]].stampBackground();return this},a.Pad.prototype.show=function(b){switch(b){case"wipe-base":a.cell[this.base].clear();break;case"wipe-both":a.cell[this.base].clear(),a.cell[this.display].clear();break;default:a.cell[this.display].clear()}if(this.drawOrder.length>0)for(var c=0,d=this.drawOrder.length;d>c;c++)a.cell[this.base].copyCellToSelf(a.cell[this.drawOrder[c]]);return a.cell[this.display].copyCellToSelf(a.cell[this.base],!0),this},a.Pad.prototype.render=function(b){return b=a.safeObject(b),this.clear(b.clear),this.compile(b.compile),this.show(b.show),this},a.Pad.prototype.addNewCell=function(b){var c,d;return b=a.safeObject(b),a.isa(b.name,"str")?(b.width=Math.round(b.width)||this.width,b.height=Math.round(b.height)||this.height,c=document.createElement("canvas"),c.setAttribute("id",b.name),c.setAttribute("height",b.height),c.setAttribute("width",b.width),b.pad=this.name,b.canvas=c,d=a.newCell(b),a.pushUnique(this.cells,d.name),d):!1},a.Pad.prototype.addCells=function(b){b=[].concat(b);for(var c=0,d=b.length;d>c;c++)a.contains(a.cellnames,b[c])&&(this.cells.push(b[c]),this.drawOrder.push(b[c]));return this},a.Pad.prototype.deleteCell=function(b){return a.isa(b,"str")?(a.removeItem(this.cells,b),this.display===b&&(this.display=this.current),this.base===b&&(this.base=this.current),this.current===b&&(this.current=this.base),this):(console.log("Pad.deleteCell error: argument is not a String"),this)},a.Pad.prototype.makeCurrent=function(){return a.currentPad=this.name,this},a.Pad.prototype.setAccessibility=function(b){b=a.safeObject(b);var c=this.getElement();return a.xt(b.title)&&(this.title=b.title,c.title=this.title),a.xt(b.comment)&&(this.comment=b.comment,c.setAttribute("data-comment",this.comment),c.innerHTML="<p>"+this.comment+"</p>"),this},a.Pad.prototype.setDimensions=function(){var a=this.getElement();return a.width=this.width*this.scale,a.height=this.height*this.scale,this},a.Cell=function(b){return b=a.safeObject(b),a.xta([b,b.canvas])?(this.coreCellInit(b),this.animationCellInit(b),this.collisionsCellInit(b),this):(console.log("Cell constructor encountered an error: no canvas element supplied to it"),!1)},a.Cell.prototype=Object.create(a.Position.prototype),a.Cell.prototype.type="Cell",a.Cell.prototype.classname="cellnames",a.d.Cell={pad:"",copy:!1,copyWidth:300,copyHeight:150,copyData:!1,pasteData:!1,pasteWidth:300,pasteHeight:150,actualWidth:300,actualHeight:150,fieldLabel:"",globalAlpha:1,globalCompositeOperation:"source-over",backgroundColor:"rgba(0,0,0,0)",context:"",groups:[],usePadDimensions:!1},a.mergeInto(a.d.Cell,a.d.Position),a.Cell.prototype.coreCellInit=function(b){var c,d;
a.Position.call(this,b),a.Base.prototype.set.call(this,b),a.canvas[this.name]=b.canvas,a.context[this.name]=b.canvas.getContext("2d"),a.cell[this.name]=this,a.pushUnique(a.cellnames,this.name),this.pad=a.xtGet([b.pad,!1]),c=a.safeObject(b.copy),this.copy=a.newVector({x:a.xtGet([b.copyX,c.x,0]),y:a.xtGet([b.copyY,c.y,0]),name:this.type+"."+this.name+".copy"}),this.work.copy=a.newVector({name:this.type+"."+this.name+".work.copy"}),this.actualWidth=a.canvas[this.name].width,this.actualHeight=a.canvas[this.name].height,this.copyWidth=this.actualWidth,this.copyHeight=this.actualHeight,this.copyData={x:0,y:0,w:0,h:0},this.pasteData={x:0,y:0,w:0,h:0},this.pasteWidth=this.actualWidth,this.pasteHeight=this.actualHeight,this.setDimensions(b),a.xto([b.pasteX,b.pasteY])&&(this.start.x=a.xtGet([b.pasteX,this.start.x]),this.start.y=a.xtGet([b.pasteY,this.start.y])),a.xto([b.copyWidth,b.copyHeight,b.pasteWidth,b.pasteHeight,b.width,b.height])&&(this.copyWidth=a.xtGet([b.copyWidth,b.width,this.copyWidth]),this.copyHeight=a.xtGet([b.copyHeight,b.height,this.copyHeight]),this.pasteWidth=a.xtGet([b.pasteWidth,b.width,this.pasteWidth]),this.pasteHeight=a.xtGet([b.pasteHeight,b.height,this.pasteHeight])),this.usePadDimensions=a.isa(b.usePadDimensions,"bool")?b.usePadDimensions:a.xto([b.copyWidth,b.copyHeight,b.pasteWidth,b.pasteHeight,b.width,b.height])?!1:!0,this.setCopy(),this.setPaste(),d=a.newContext({name:this.name,cell:a.context[this.name]}),this.context=d.name,this.flipUpend=a.xtGet([b.flipUpend,a.d.Cell.flipUpend]),this.flipReverse=a.xtGet([b.flipReverse,a.d.Cell.flipReverse]),this.lockX=a.xtGet([b.lockX,a.d.Cell.lockX]),this.lockY=a.xtGet([b.lockY,a.d.Cell.lockY]),this.roll=a.xtGet([b.roll,a.d.Cell.roll]),this.groups=a.xt(b.groups)?[].concat(b.groups):[],a.newGroup({name:this.name,cell:this.name})},a.Cell.prototype.collisionsCellInit=function(){},a.Cell.prototype.animationCellInit=function(){},a.Cell.prototype.get=function(b){if(a.contains(["pasteX","pasteY","copyX","copyY"],b))switch(b){case"pasteX":return this.start.x;case"pasteY":return this.start.y;case"copyX":return this.copy.x;case"copyY":return this.copy.y}if(a.contains(["paste","copy"],b))switch(b){case"paste":return this.start.getVector();case"copy":return this.copy.getVector()}if(a.contains(["width","height"],b))switch(b){case"width":return this.usePadDimensions?this.getPadWidth():this.actualWidth;case"height":return this.usePadDimensions?this.getPadHeight():this.actualHeight}return this.animationCellGet(b)||a.Position.prototype.get.call(this,b)},a.Cell.prototype.animationCellGet=function(){return!1},a.Cell.prototype.set=function(b){var c;return a.Position.prototype.set.call(this,b),b=a.safeObject(b),a.xto([b.paste,b.pasteX,b.pasteY])&&(c=a.safeObject(b.paste),this.start.x=a.xtGet([b.pasteX,c.x,this.start.x]),this.start.y=a.xtGet([b.pasteY,c.y,this.start.y])),a.xto([b.copy,b.copyX,b.copyY])&&(c=a.safeObject(b.copy),this.copy.x=a.xtGet([b.copyX,c.x,this.copy.x]),this.copy.y=a.xtGet([b.copyY,c.y,this.copy.y])),a.xto([b.copyWidth,b.copyHeight,b.width,b.height])&&(this.copyWidth=a.xtGet([b.copyWidth,b.width,this.copyWidth]),this.copyHeight=a.xtGet([b.copyHeight,b.height,this.copyHeight])),a.xto([b.pasteWidth,b.pasteHeight,b.width,b.height])&&(this.pasteWidth=a.xtGet([b.pasteWidth,b.width,this.pasteWidth]),this.pasteHeight=a.xtGet([b.pasteHeight,b.height,this.pasteHeight])),a.xto([b.actualWidth,b.actualHeight,b.width,b.height])&&(this.actualWidth=a.xtGet([b.actualWidth,b.width,this.actualWidth]),this.actualHeight=a.xtGet([b.actualHeight,b.height,this.actualHeight]),this.setDimensions(b),a.ctx[this.context].getContextFromEngine(a.context[this.name])),this.animationCellSet(b),a.xto([b.copy,b.copyX,b.copyY,b.copyWidth,b.copyHeight,b.width,b.height,b.scale])&&this.setCopy(),a.xto([b.start,b.startX,b.startY,b.paste,b.pasteX,b.pasteY,b.pasteWidth,b.pasteHeight,b.width,b.height,b.scale])&&this.setPaste(),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.actualWidth,b.actualHeight,b.scale])&&(this.offset.flag=!1),this},a.Cell.prototype.animationCellSet=function(){},a.Cell.prototype.setDelta=function(b){var c,d,e,f,g;return a.Position.prototype.setDelta.call(this,b),b=a.safeObject(b),a.xto([b.copy,b.copyX,b.copyY])&&(c=a.safeObject(b.copy),d=a.xtGet([b.copyX,c.x,0]),e=a.xtGet([b.copyY,c.y,0]),this.copy.x=a.isa(d,"num")?this.copy.x+d:a.addPercentages(this.copy.x,d),this.copy.y=a.isa(e,"num")?this.copy.y+e:a.addPercentages(this.copy.y,e)),a.xto([b.paste,b.pasteX,b.pasteY])&&(c=a.safeObject(b.paste),d=a.xtGet([b.pasteX,c.x,0]),e=a.xtGet([b.pasteY,c.y,0]),this.start.x=a.isa(this.start.x,"num")?this.start.x+d:a.addPercentages(this.start.x,d),this.start.y=a.isa(this.start.y,"num")?this.start.y+e:a.addPercentages(this.start.y,e)),a.xt([b.copyWidth])&&(this.copyWidth=a.isa(this.copyWidth,"num")?this.copyWidth+b.copyWidth:a.addPercentages(this.copyWidth,b.copyWidth)),a.xt([b.copyHeight])&&(this.copyHeight=a.isa(this.copyHeight,"num")?this.copyHeight+b.copyHeight:a.addPercentages(this.copyHeight,b.copyHeight)),a.xto([b.pasteWidth,b.width])&&(f=a.xtGet([b.pasteWidth,b.width]),this.pasteWidth=a.isa(this.pasteWidth,"num")?this.pasteWidth+f:a.addPercentages(this.pasteWidth,f)),a.xto([b.pasteHeight,b.height])&&(g=a.xtGet([b.pasteHeight,b.height]),this.pasteHeight=a.isa(this.pasteHeight,"num")?this.pasteHeight+g:a.addPercentages(this.pasteHeight,g)),a.xto([b.actualWidth,b.width])&&(f=a.xtGet([b.actualWidth,b.width]),this.actualWidth=a.isa(f,"num")?this.actualWidth+f:this.actualWidth),a.xto([b.actualHeight,b.height])&&(g=a.xtGet([b.actualHeight,b.height]),this.actualHeight=a.isa(g,"num")?this.actualHeight+g:this.actualHeight),a.xto([b.actualWidth,b.width,b.actualHeight,b.height])&&this.setDimensions(b),a.xt(b.globalAlpha)&&(this.globalAlpha+=b.globalAlpha),a.xto([b.copy,b.copyX,b.copyY,b.copyWidth,b.copyHeight,b.width,b.height,b.scale])&&this.setCopy(),a.xto([b.start,b.startX,b.startY,b.paste,b.pasteX,b.pasteY,b.pasteWidth,b.pasteHeight,b.width,b.height,b.scale])&&this.setPaste(),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.actualWidth,b.actualHeight,b.scale])&&(this.offset.flag=!1),this},a.Cell.prototype.getPadWidth=function(){return a.pad[this.pad].get("width")},a.Cell.prototype.getPadHeight=function(){return a.pad[this.pad].get("height")},a.Cell.prototype.setEngine=function(b){if(!b.fastStamp){var c,d,e,f,g=a.ctx[this.context],h=a.ctx[b.context],i=h.getChanges(g,b.scale,b.scaleOutline);if(i){delete i.count,c=a.context[this.name];for(var j in i){if(f=!1,j[0]<"m")if(j[0]<"l")switch(j){case"fillStyle":a.xt(a.design[i[j]])?(f=a.design[i[j]],a.contains(["Gradient","RadialGradient"],f.type)&&f.update(b.name,this.name),d=f.getData()):d=i[j],c.fillStyle=d;break;case"font":c.font=i[j];break;case"globalAlpha":c.globalAlpha=i[j];break;case"globalCompositeOperation":c.globalCompositeOperation=i[j]}else switch(j){case"lineCap":c.lineCap=i[j];break;case"lineDash":c.mozDash=i[j],c.lineDash=i[j];try{c.setLineDash(i[j])}catch(k){}break;case"lineDashOffset":c.mozDashOffset=i[j],c.lineDashOffset=i[j];break;case"lineJoin":c.lineJoin=i[j];break;case"lineWidth":c.lineWidth=i[j]}else if("s"==j[0])switch(j){case"shadowBlur":c.shadowBlur=i[j];break;case"shadowColor":c.shadowColor=i[j];break;case"shadowOffsetX":c.shadowOffsetX=i[j];break;case"shadowOffsetY":c.shadowOffsetY=i[j];break;case"strokeStyle":a.xt(a.design[i[j]])?(f=a.design[i[j]],a.contains(["Gradient","RadialGradient"],f.type)&&f.update(b.name,this.name),e=f.getData()):e=i[j],c.strokeStyle=e}else switch(j){case"miterLimit":c.miterLimit=i[j];break;case"textAlign":c.textAlign=i[j];break;case"textBaseline":c.textBaseline=i[j];break;case"winding":c.mozFillRule=i[j],c.msFillRule=i[j]}g[j]=i[j]}}}return b},a.Cell.prototype.clear=function(){var b=a.context[this.name];return b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,this.actualWidth,this.actualHeight),this},a.Cell.prototype.compile=function(){"rgba(0,0,0,0)"!==this.get("backgroundColor")&&this.stampBackground(),this.groups.sort(function(b,c){return a.group[b].order-a.group[c].order});for(var b=0,c=this.groups.length;c>b;b++)a.group[this.groups[b]].get("visibility")&&a.group[this.groups[b]].stamp(!1,this.name);return this},a.Cell.prototype.stampBackground=function(){var b=a.context[this.name],c=this.get("backgroundColor"),d=this.actualWidth,e=this.actualHeight,f=b.fillStyle;return b.setTransform(1,0,0,1,0,0),b.fillStyle=c,b.fillRect(0,0,d,e),b.fillStyle=f,this},a.Cell.prototype.rotateDestination=function(b){var c=this.flipReverse?-1:1,d=this.flipUpend?-1:1,e=this.addPathRoll?(this.roll+this.pathRoll)*a.radian:this.roll*a.radian,f=Math.cos(e),g=Math.sin(e);return b.setTransform(f*c,g*c,-g*d,f*d,this.pasteData.x,this.pasteData.y),this},a.Cell.prototype.prepareToCopyCell=function(b){return this.resetWork(),this.offset.flag||(this.offset.set(this.calculatePOV(this.work.handle,this.pasteData.w,this.pasteData.h,!1)).reverse(),this.offset.flag=!0),this.pivot?this.setStampUsingPivot(a.pad[this.pad].base):this.pathPrepareToCopyCell(),this.setCopy(),this.setPaste(),this.rotateDestination(b),this},a.Cell.prototype.pathPrepareToCopyCell=function(){},a.Cell.prototype.setCopy=function(){return this.copyData.x=a.isa(this.copy.x,"str")?this.convertX(this.copy.x,this.actualWidth):this.copy.x,this.copyData.y=a.isa(this.copy.y,"str")?this.convertY(this.copy.y,this.actualHeight):this.copy.y,a.isBetween(this.copyData.x,0,this.actualWidth-1,!0)||(this.copyData.x=this.copyData.x<0?0:this.actualWidth-1),a.isBetween(this.copyData.y,0,this.actualHeight-1,!0)||(this.copyData.y=this.copyData.y<0?0:this.actualHeight-1),this.copyData.w=a.isa(this.copyWidth,"str")?this.convertX(this.copyWidth,this.actualWidth):this.copyWidth,this.copyData.h=a.isa(this.copyHeight,"str")?this.convertY(this.copyHeight,this.actualHeight):this.copyHeight,a.isBetween(this.copyData.w,1,this.actualWidth,!0)||(this.copyData.w=this.copyData.w<1?1:this.actualWidth),a.isBetween(this.copyData.h,1,this.actualHeight,!0)||(this.copyData.h=this.copyData.h<1?1:this.actualHeight),this.copyData.x+this.copyData.w>this.actualWidth&&(this.copyData.x=this.actualWidth-this.copyData.w),this.copyData.y+this.copyData.h>this.actualHeight&&(this.copyData.y=this.actualHeight-this.copyData.h),this},a.Cell.prototype.setPaste=function(){var b=this.usePadDimensions,c=a.pad[this.pad];return this.pasteData.x=b?0:this.start.x,this.pasteData.y=b?0:this.start.y,this.pasteData.x=a.isa(this.pasteData.x,"str")?this.convertX(this.pasteData.x,c.width):this.pasteData.x,this.pasteData.y=a.isa(this.pasteData.y,"str")?this.convertY(this.pasteData.y,c.height):this.pasteData.y,this.pasteData.w=b?c.width:this.pasteWidth,this.pasteData.h=b?c.height:this.pasteHeight,this.pasteData.w=a.isa(this.pasteData.w,"str")?this.convertX(this.pasteData.w,this.actualWidth):this.pasteData.w,this.pasteData.h=a.isa(this.pasteData.h,"str")?this.convertY(this.pasteData.h,this.actualHeight):this.pasteData.h,this.pasteData.w=this.pasteData.w*this.scale*c.scale,this.pasteData.h=this.pasteData.h*this.scale*c.scale,this.pasteData.w<1&&(this.pasteData.w=1),this.pasteData.h<1&&(this.pasteData.h=1),this},a.Cell.prototype.copyCellToSelf=function(b,c){b=a.isa(b,"str")?a.cell[b]:b,c=a.xtGet([c,!1]);var d=b.get("lockTo"),e=d?a.cell[d]:b;if(a.xt(e)){var f=e.copyData,g=e.pasteData,h=e.offset,i=a.context[this.name],j=a.ctx[this.name],k=e.get("globalAlpha"),l=j.get("globalAlpha"),m=e.get("globalCompositeOperation"),n=j.get("globalCompositeOperation");k!==l&&(i.globalAlpha=k,j.set({globalAlpha:k})),m!==n&&(i.globalCompositeOperation=m,j.set({globalCompositeOperation:m})),a.context[e.name].setTransform(1,0,0,1,0,0),e.prepareToCopyCell(i),i.drawImage(a.canvas[e.name],f.x,f.y,f.w,f.h,h.x,h.y,g.w,g.h)}return this},a.Cell.prototype.convertX=function(a,b){switch(a){case"left":return 0;case"right":return b;case"center":return b/2;default:return a=parseFloat(a)/100,isNaN(a)?0:a*b}},a.Cell.prototype.convertY=function(a,b){switch(a){case"top":return 0;case"bottom":return b;case"center":return b/2;default:return a=parseFloat(a)/100,isNaN(a)?0:a*b}},a.Cell.prototype.clearShadow=function(){var b=a.context[this.name],c=a.ctx[this.context];return b.shadowOffsetX=0,b.shadowOffsetY=0,b.shadowBlur=0,c.set({shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0}),this},a.Cell.prototype.restoreShadow=function(b){var c=a.context[this.name],d=a.ctx[this.context],e=a.ctx[b],f=e.get("shadowOffsetX"),g=e.get("shadowOffsetY"),h=e.get("shadowBlur");return c.shadowOffsetX=f,c.shadowOffsetY=g,c.shadowBlur=h,d.set({shadowOffsetX:f,shadowOffsetY:g,shadowBlur:h}),this},a.Cell.prototype.setToClearShape=function(){var b=a.context[this.name],c=a.ctx[this.context];return b.fillStyle="rgba(0, 0, 0, 0)",b.strokeStyle="rgba(0, 0, 0, 0)",b.shadowColor="rgba(0, 0, 0, 0)",c.set({fillStyle:"rgba(0, 0, 0, 0)",strokeStyle:"rgba(0, 0, 0, 0)",shadowColor:"rgba(0, 0, 0, 0)"}),this},a.Cell.prototype.setDimensions=function(b){var c,d;return a.xt(b)&&!this.usePadDimensions?(c=a.xtGet([b.width,b.actualWidth,this.actualWidth]),c=a.isa(c,"str")?parseFloat(c)/100*this.getPadWidth():c,d=a.xtGet([b.height,b.actualHeight,this.actualHeight]),d=a.isa(d,"str")?parseFloat(d)/100*this.getPadHeight():d):(c=this.getPadWidth(),d=this.getPadHeight()),a.canvas[this.name].width=c,a.canvas[this.name].height=d,a.Base.prototype.set.call(this,{actualWidth:c,actualHeight:d}),this},a.Cell.prototype.saveContext=function(){return a.context[this.name].save(),this},a.Cell.prototype.restoreContext=function(){return a.context[this.name].restore(),this},a.Cell.prototype.getImageData=function(b){b=a.safeObject(b);var c=a.isa(b.name,"str")?this.name+"_"+b.name:this.name+"_imageData",d=a.xtGet([b.x,0]),e=a.xtGet([b.y,0]),f=a.xtGet([b.width,this.actualWidth]),g=a.xtGet([b.height,this.actualHeight]);return a.imageData[c]=a.context[this.name].getImageData(d,e,f,g),c},a.Context=function(b){return b=a.safeObject(b),a.Base.call(this,b),b.cell?this.getContextFromEngine(b.cell):this.set(b),a.ctx[this.name]=this,a.pushUnique(a.ctxnames,this.name),this},a.Context.prototype=Object.create(a.Base.prototype),a.Context.prototype.type="Context",a.Context.prototype.classname="ctxnames",a.d.Context={fillStyle:"#000000",winding:"nonzero",strokeStyle:"#000000",globalAlpha:1,globalCompositeOperation:"source-over",lineWidth:1,lineCap:"butt",lineJoin:"miter",lineDash:[],lineDashOffset:0,miterLimit:10,shadowOffsetX:0,shadowOffsetY:0,shadowBlur:0,shadowColor:"rgba(0,0,0,0)",font:"10pt sans-serif",textAlign:"start",textBaseline:"alphabetic"},a.contextKeys=Object.keys(a.d.Context),a.mergeInto(a.d.Context,a.d.Base),a.Context.prototype.setDelta=function(b){return b=a.safeObject(b),a.xt(b.lineDashOffset)&&(a.xt(this.lineDashOffset)||(this.lineDashOffset=a.d.Context.lineDashOffset),this.lineDashOffset+=b.lineDashOffset),a.xt(b.lineWidth)&&(a.xt(this.lineWidth)||(this.lineWidth=a.d.Context.lineWidth),this.lineWidth+=b.lineWidth,this.lineWidth<0&&(this.lineWidth=0)),a.xt(b.globalAlpha)&&(a.xt(this.globalAlpha)||(this.globalAlpha=a.d.Context.globalAlpha),this.globalAlpha+=b.globalAlpha,a.isBetween(this.globalAlpha,0,1,!0)||(this.globalAlpha=this.globalAlpha>.5?1:0)),this},a.Context.prototype.getContextFromEngine=function(b){for(var c=0,d=a.contextKeys.length;d>c;c++)this[a.contextKeys[c]]=b[a.contextKeys[c]];return this.winding=a.xtGet([b.mozFillRule,b.msFillRule,"nonzero"]),this.lineDash=a.xtGet([b.lineDash,[]]),this.lineDashOffset=a.xtGet([b.mozDashOffset,b.lineDashOffset,0]),this},a.Context.prototype.getChanges=function(b,c,d){for(var e,f,g={},h=0,i=0,j=a.contextKeys.length;j>i;i++)if(e=this.get(a.contextKeys[i]),a.contains(["lineWidth","shadowOffsetX","shadowOffsetY","shadowBlur"],a.contextKeys[i]))d?e*c!==b[a.contextKeys[i]]&&(g[a.contextKeys[i]]=e*c,h++):e!==b[a.contextKeys[i]]&&(g[a.contextKeys[i]]=e,h++);else if(a.contains(["fillStyle","strokeStyle","shadowColor"],a.contextKeys[i])&&a.contains(a.designnames,e)&&"Color"===a.design[e].type)f=a.design[e].getData(),f!==b[a.contextKeys[i]]&&(g[a.contextKeys[i]]=f,h++);else if(a.contains(["fillStyle","strokeStyle"],a.contextKeys[i])&&a.contains(a.designnames,e)&&a.contains(["Gradient","RadialGradient"],a.design[e].type)&&a.design[e].autoUpdate)g[a.contextKeys[i]]=e,h++;else if(a.contains(["lineDash"],a.contextKeys[i])&&a.xt(b.lineDash)){if(e.length!==b.lineDash.length)g.lineDash=e,h++;else for(var k=0,l=e.length;l>k;k++)if(e[k]!==b.lineDash[k]){g.lineDash=e,h++;break}}else a.contains(["name","timestamp"],a.contextKeys[i])||e!==b[a.contextKeys[i]]&&(g[a.contextKeys[i]]=e,h++);return h>0?g:!1},a.Group=function(b){return b=a.safeObject(b),a.Base.call(this,b),this.entitys=a.xt(b.entitys)?[].concat(b.entitys):[],this.cell=b.cell||a.pad[a.currentPad].current,this.order=a.xtGet([b.order,0]),this.visibility=a.xtGet([b.visibility,!0]),this.entitySort=a.xtGet([b.entitySort,!0]),this.regionRadius=a.xtGet([b.regionRadius,0]),a.group[this.name]=this,a.pushUnique(a.groupnames,this.name),a.pushUnique(a.cell[this.cell].groups,this.name),this},a.Group.prototype=Object.create(a.Base.prototype),a.Group.prototype.type="Group",a.Group.prototype.classname="groupnames",a.d.Group={entitys:[],cell:"",order:0,visibility:!0,entitySort:!0,regionRadius:0},a.mergeInto(a.d.Group,a.d.Base),a.Group.prototype.sortEntitys=function(){this.entitySort&&this.entitys.sort(function(b,c){return a.entity[b].order-a.entity[c].order})},a.Group.prototype.forceStamp=function(a,b){var c=this.visibility;return c||this.set({visibility:!0}),this.stamp(a,b),this.set({visibility:c}),this},a.Group.prototype.stamp=function(b,c){if(this.visibility){this.sortEntitys();for(var d=0,e=this.entitys.length;e>d;d++)a.entity[this.entitys[d]].stamp(b,c)}return this},a.Group.prototype.addEntitysToGroup=function(b){b=a.xt(b)?[].concat(b):[];for(var c=0,d=b.length;d>c;c++)a.pushUnique(this.entitys,b[c]);return this},a.Group.prototype.removeEntitysFromGroup=function(b){b=a.xt(b)?[].concat(b):[];for(var c=0,d=b.length;d>c;c++)a.removeItem(this.entitys,b[c]);return this},a.Group.prototype.updateEntitysBy=function(b){b=a.safeObject(b);for(var c=0,d=this.entitys.length;d>c;c++)a.entity[this.entitys[c]].setDelta({startX:a.xtGet([b.x,b.startX,0]),startY:a.xtGet([b.y,b.startY,0]),scale:a.xtGet([b.scale,0]),roll:a.xtGet([b.roll,0])});return this},a.Group.prototype.setEntitysTo=function(b){for(var c=0,d=this.entitys.length;d>c;c++)a.entity[this.entitys[c]].set(b);return this},a.Group.prototype.pivotEntitysTo=function(b){b=a.isa(b,"str")?b:!1;var c,d,e,f;if(b&&(c=a.entity[b]||a.point[b]||!1)){d="Point"===c.type?c.get("current"):c.start;for(var g=0,h=this.entitys.length;h>g;g++)e=a.entity[this.entitys[g]],f=a.v.set(e.start),f.vectorSubtract(d),e.set({pivot:b,handleX:-f.x,handleY:-f.y})}return this},a.Group.prototype.getEntityAt=function(b){b=a.safeObject(b);var c,d,e=a.v.set({x:b.x||0,y:b.y||0});e=a.Position.prototype.correctCoordinates(e,this.cell),this.sortEntitys();for(var f=this.entitys.length-1;f>=0;f--)if(c=a.entity[this.entitys[f]],!(this.regionRadius&&(c.resetWork(),d=c.work.start.vectorSubtract(e),d.getMagnitude()>this.regionRadius))&&c.checkHit({x:e.x,y:e.y}))return c;return!1},a.Group.prototype.getAllEntitysAt=function(b){b=a.safeObject(b);var c,d,e=a.v.set({x:b.x||0,y:b.y||0}),f=[];e=a.Position.prototype.correctCoordinates(e,this.cell),this.sortEntitys();for(var g=this.entitys.length-1;g>=0;g--)c=a.entity[this.entitys[g]],this.regionRadius&&(c.resetWork(),d=c.work.start.vectorSubtract(e),d.getMagnitude()>this.regionRadius)||c.checkHit(e)&&f.push(c);return f.length>0?f:!1},a.Entity=function(b){b=a.safeObject(b),a.Position.call(this,b),b.name=this.name;var c=a.newContext(b);return this.context=c.name,this.group=this.getGroup(b),this.fastStamp=a.xtGet([b.fastStamp,!1]),this.scaleOutline=a.xtGet([b.scaleOutline,!0]),this.order=a.xtGet([b.order,0]),this.visibility=a.xtGet([b.visibility,!0]),this.method=a.xtGet([b.method,a.d[this.type].method]),this.collisionsEntityConstructor(b),this},a.Entity.prototype=Object.create(a.Position.prototype),a.Entity.prototype.type="Entity",a.Entity.prototype.classname="entitynames",a.d.Entity={order:0,visibility:!0,method:"fill",data:"",radius:0,scaleOutline:!0,fastStamp:!1,context:"",group:""},a.mergeInto(a.d.Entity,a.d.Position),a.Entity.prototype.collisionsEntityConstructor=function(){},a.Entity.prototype.registerInLibrary=function(){return a.entity[this.name]=this,a.pushUnique(a.entitynames,this.name),a.group[this.group].addEntitysToGroup(this.name),this.collisionsEntityRegisterInLibrary(),this},a.Entity.prototype.collisionsEntityRegisterInLibrary=function(){},a.Entity.prototype.get=function(b){return a.xt(a.d.Base[b])?a.Base.prototype.get.call(this,b):a.xt(a.d.Context[b])?a.ctx[this.context].get(b):a.Position.prototype.get.call(this,b)},a.Entity.prototype.set=function(b){return a.Position.prototype.set.call(this,b),a.ctx[this.context].set(b),b=a.safeObject(b),a.xt(b.group)&&(a.group[this.group].removeEntitysFromGroup(this.name),this.group=this.getGroup(b.group),a.group[this.group].addEntitysToGroup(this.name)),this.collisionsEntitySet(b),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.radius,b.scale])&&(this.offset.flag=!1),this},a.Entity.prototype.collisionsEntitySet=function(){},a.Entity.prototype.setDelta=function(b){a.Position.prototype.setDelta.call(this,b),b=a.safeObject(b);var c=a.ctx[this.context];return a.xto([b.lineDashOffset,b.lineWidth,b.globalAlpha])&&c.setDelta(b),a.xt(b.roll)&&(this.roll+=b.roll||0),a.xt(b.width)&&(this.width=a.isa(this.width,"num")?this.width+b.width:a.addPercentages(this.width,b.width)),a.xt(b.height)&&(this.height=a.isa(this.height,"num")?this.height+b.height:a.addPercentages(this.height,b.height)),a.xto([b.handleX,b.handleY,b.handle,b.width,b.height,b.radius,b.scale])&&(this.offset.flag=!1),this},a.Entity.prototype.clone=function(b){b=a.safeObject(b);var c,d,e=JSON.parse(JSON.stringify(a.ctx[this.context]));return delete e.name,d=a.mergeInto(b,e),delete d.context,c=a.Position.prototype.clone.call(this,d),a.xt(b.createNewContext)&&!b.createNewContext&&(delete a.ctx[c.context],a.removeItem(a.ctxnames,c.context),c.context=this.context),c},a.Entity.prototype.getGroup=function(b){return b=a.safeObject(b),a.xt(b.group)&&a.contains(a.groupnames,b.group)?b.group:a.pad[a.currentPad].current},a.Entity.prototype.getEntityCell=function(b){var c=this.getGroup(b);return a.cell[c]},a.Entity.prototype.forceStamp=function(a,b){var c=this.visibility;return this.visibility=!0,this.stamp(a,b),this.visibility=c,this},a.Entity.prototype.prepareStamp=function(){return this.offset.flag||(this.offset.set(this.getOffsetStartVector()),this.offset.flag=!0),this.offset},a.Entity.prototype.stamp=function(b,c){if(this.visibility){var d=a.cell[c]||a.cell[a.group[this.group].cell],e=a.context[d.name],f=b||this.method;this.pivot?this.setStampUsingPivot(d.name):this.pathStamp(),this.callMethod(e,d.name,f)}return this},a.Entity.prototype.pathStamp=function(){},a.Entity.prototype.callMethod=function(a,b,c){switch(c){case"clear":this.clear(a,b);break;case"clearWithBackground":this.clearWithBackground(a,b);break;case"draw":this.draw(a,b);break;case"fill":this.fill(a,b);break;case"drawFill":this.drawFill(a,b);break;case"fillDraw":this.fillDraw(a,b);break;case"sinkInto":this.sinkInto(a,b);break;case"floatOver":this.floatOver(a,b);break;case"clip":this.clip(a,b);break;case"none":this.none(a,b)}return this},a.Entity.prototype.rotateCell=function(b,c){var d=this.flipReverse?-1:1,e=this.flipUpend?-1:1,f=this.addPathRoll?(this.roll+this.pathRoll)*a.radian:this.roll*a.radian,g=Math.cos(f),h=Math.sin(f),i=this.start.x,j=this.start.y;return"string"==typeof i&&(i=this.convertX(i,c)),"string"==typeof j&&(j=this.convertY(j,c)),b.setTransform(g*d,h*d,-h*e,g*e,i,j),this},a.Entity.prototype.convertX=function(a,b){var c=scrawl.cell[b].actualWidth;switch(a){case"left":return 0;case"right":return c;case"center":return c/2;default:return a=parseFloat(a)/100,isNaN(a)?0:a*c}},a.Entity.prototype.convertY=function(a,b){var c=scrawl.cell[b].actualHeight;switch(a){case"top":return 0;case"bottom":return c;case"center":return c/2;default:return a=parseFloat(a)/100,isNaN(a)?0:a*c}},a.Entity.prototype.clear=function(){return this},a.Entity.prototype.clearWithBackground=function(){return this},a.Entity.prototype.draw=function(){return this},a.Entity.prototype.fill=function(){return this},a.Entity.prototype.drawFill=function(){return this},a.Entity.prototype.fillDraw=function(){return this},a.Entity.prototype.sinkInto=function(){return this},a.Entity.prototype.floatOver=function(){return this},a.Entity.prototype.clip=function(){return this},a.Entity.prototype.none=function(b,c){return a.cell[c].setEngine(this),this},a.Entity.prototype.clearShadow=function(b,c){var d=a.ctx[this.context];return(d.shadowOffsetX||d.shadowOffsetY||d.shadowBlur)&&a.cell[c].clearShadow(),this},a.Entity.prototype.restoreShadow=function(b,c){var d=a.ctx[this.context];return(d.shadowOffsetX||d.shadowOffsetY||d.shadowBlur)&&a.cell[c].restoreShadow(this.context),this},a.Entity.prototype.pickupEntity=function(b){b=a.safeObject(b);var c=a.v.set({x:b.x||0,y:b.y||0}),d=a.cell[a.group[this.group].cell];return c=this.correctCoordinates(c,d),this.oldX=c.x||0,this.oldY=c.y||0,this.realPivot=this.pivot,this.set({pivot:"mouse",order:this.order+9999}),this},a.Entity.prototype.dropEntity=function(b){var c=this.order;return this.set({pivot:a.xtGet([b,this.realPivot,!1]),order:c>=9999?c-9999:0}),delete this.realPivot,delete this.oldX,delete this.oldY,this},a.Entity.prototype.checkHit=function(b){b=a.safeObject(b);var c,d,e=a.cvx,f=a.xt(b.tests)?[].concat(b.tests):[b.x||!1,b.y||!1];this.rotateCell(e,this.getEntityCell().name),c=this.prepareStamp(),e.beginPath(),e.rect(c.x,c.y,this.width*this.scale,this.height*this.scale);for(var g=0,h=f.length;h>g&&!(d=e.isPointInPath(f[g],f[g+1]));g+=2);return d?{x:f[g],y:f[g+1]}:!1},a.Design=function(b){return a.Base.call(this,b),this},a.Design.prototype=Object.create(a.Base.prototype),a.Design.prototype.type="Design",a.Design.prototype.classname="designnames",a.d.Design={color:[{color:"black",stop:0},{color:"white",stop:.999999}],setToEntity:!1,cell:"",startX:0,startY:0,endX:0,endY:0},a.mergeInto(a.d.Design,a.d.Base),a.Design.prototype.setDelta=function(b){var c;return b=a.safeObject(b),b.startX&&(c=this.get("startX"),this.startX=a.isa(b.startX,"str")?a.addPercentages(c,b.startX):c+b.startX),b.startY&&(c=this.get("startY"),this.startY=a.isa(b.startY,"str")?a.addPercentages(c,b.startY):c+b.startY),b.startRadius&&(c=this.get("startRadius"),this.startRadius=c+b.startRadius),b.endX&&(c=this.get("endX"),this.endX=a.isa(b.endX,"str")?a.addPercentages(c,b.endX):c+b.endX),b.endY&&(c=this.get("endY"),this.endY=a.isa(b.endY,"str")?a.addPercentages(c,b.endY):c+b.endY),b.endRadius&&(c=this.get("endRadius"),this.endRadius=c+b.endRadius),b.shift&&a.xt(a.d.Design.shift)&&(c=this.get("shift"),this.shift=c+b.shift),this},a.Design.prototype.update=function(a,b){return this.makeGradient(a,b),this.applyStops(),this},a.Design.prototype.getData=function(){return a.xt(a.dsn[this.name])?a.dsn[this.name]:"rgba(0,0,0,0)"},a.Design.prototype.makeGradient=function(b,c){b=a.entity[b]||!1,c=a.xt(c)?a.contains(a.cellnames,c)?a.cell[c]:a.cell[this.get("cell")]:b?a.cell[b.group]:a.cell[this.get("cell")];var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=a.context[c.name];if(this.get("setToEntity")){switch(q=b.getOffsetStartVector(),b.type){case"Wheel":e=-q.x+b.radius*b.scale,f=-q.y+b.radius*b.scale;break;case"Shape":case"Path":b.isLine?(e=-q.x,f=-q.y):(e=-q.x+b.width/2*b.scale,f=-q.y+b.height/2*b.scale);break;default:e=-q.x,f=-q.y}r=a.xt(b.localWidth)?b.localWidth:b.width*b.scale,s=a.xt(b.localHeight)?b.localHeight:b.height*b.scale,g=a.xt(this.startX)?this.startX:0,"string"==typeof g&&(g=parseFloat(g)/100*r),h=a.xt(this.startY)?this.startY:0,"string"==typeof h&&(h=parseFloat(h)/100*s),j=a.xt(this.endX)?this.endX:r,"string"==typeof j&&(j=parseFloat(j)/100*r),k=a.xt(this.endY)?this.endY:s,"string"==typeof k&&(k=parseFloat(k)/100*s),"Gradient"===this.type?d=u.createLinearGradient(g-e,h-f,j-e,k-f):(i=a.xt(this.startRadius)?this.startRadius:0,"string"==typeof i&&(i=parseFloat(i)/100*r),l=a.xt(this.endRadius)?this.endRadius:r,"string"==typeof l&&(l=parseFloat(l)/100*r),d=u.createRadialGradient(g-e,h-f,i,j-e,k-f,l))}else e=b.start.x,"string"==typeof e&&(e=b.convertX(e,c.name)),f=b.start.y,"string"==typeof f&&(f=b.convertY(f,c.name)),g=a.xt(this.startX)?this.startX:0,"string"==typeof g&&(g=b.convertX(g,c.name)),h=a.xt(this.startY)?this.startY:0,"string"==typeof h&&(h=b.convertY(h,c.name)),j=a.xt(this.endX)?this.endX:c.actualWidth,"string"==typeof j&&(j=b.convertX(j,c.name)),k=a.xt(this.endY)?this.endY:c.actualWidth,"string"==typeof k&&(k=b.convertY(k,c.name)),e=b.flipReverse?c.actualWidth-e:e,f=b.flipUpend?c.actualHeight-f:f,g=b.flipReverse?c.actualWidth-g:g,h=b.flipUpend?c.actualHeight-h:h,j=b.flipReverse?c.actualWidth-j:j,k=b.flipUpend?c.actualHeight-k:k,m=g-e,n=h-f,o=j-e,p=k-f,t=b.roll,(b.flipReverse&&b.flipUpend||!b.flipReverse&&!b.flipUpend)&&(t=-b.roll),b.roll&&(a.v.set({x:m,y:n,z:0}).rotate(t),m=a.v.x,n=a.v.y,a.v.set({x:o,y:p,z:0}).rotate(t),o=a.v.x,p=a.v.y),"Gradient"===this.type?d=u.createLinearGradient(m,n,o,p):(i=a.xt(this.startRadius)?this.startRadius:0,"string"==typeof i&&(i=parseFloat(i)/100*c.actualWidth),l=a.xt(this.endRadius)?this.endRadius:c.actualWidth,"string"==typeof l&&(l=parseFloat(l)/100*c.actualWidth),d=u.createRadialGradient(m,n,i,o,p,l));return a.dsn[this.name]=d,this},a.Design.prototype.applyStops=function(){var b=this.get("color");if(a.dsn[this.name])for(var c=0,d=b.length;d>c;c++)a.dsn[this.name].addColorStop(b[c].stop,b[c].color);return this},a.Design.prototype.remove=function(){return delete a.dsn[this.name],delete a.design[this.name],a.removeItem(a.designnames,this.name),!0},a.Gradient=function(b){return b=a.safeObject(b),a.Design.call(this,b),a.Base.prototype.set.call(this,b),a.design[this.name]=this,a.pushUnique(a.designnames,this.name),this},a.Gradient.prototype=Object.create(a.Design.prototype),a.Gradient.prototype.type="Gradient",a.Gradient.prototype.classname="designnames",a.d.Gradient={},a.mergeInto(a.d.Gradient,a.d.Design),a.Gradient.prototype.swap=function(){var a=this.get("startX"),b=this.get("startY"),c=this.get("endX"),d=this.get("endY");return this.set({startX:c,startY:d,endX:a,endY:b}),this.update(),this},a.RadialGradient=function(b){return b=a.safeObject(b),a.Design.call(this,b),a.Base.prototype.set.call(this,b),a.design[this.name]=this,a.pushUnique(a.designnames,this.name),this},a.RadialGradient.prototype=Object.create(a.Design.prototype),a.RadialGradient.prototype.type="RadialGradient",a.RadialGradient.prototype.classname="designnames",a.d.RadialGradient={startRadius:0,endRadius:0},a.mergeInto(a.d.RadialGradient,a.d.Design),a.RadialGradient.prototype.swap=function(){var a=this.get("startX"),b=this.get("startY"),c=this.get("startRadius"),d=this.get("endY"),e=this.get("endY"),f=this.get("endRadius");return this.set({startX:d,startY:e,startRadius:f,endX:a,endY:b,endRadius:c}),this.update(),this},a.v=a.newVector({name:"scrawl.v"}),a}();